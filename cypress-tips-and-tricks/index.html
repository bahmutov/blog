<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Cypress Tips and Tricks | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Read the docs Run Cypress on your own CI Record success and failure videos Move common code into utility package Separate tests into bundles Make JavaScript crashes useful Use test names when creati">
<meta property="og:type" content="article">
<meta property="og:title" content="Cypress Tips and Tricks">
<meta property="og:url" content="https://glebbahmutov.com/blog/cypress-tips-and-tricks/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="Read the docs Run Cypress on your own CI Record success and failure videos Move common code into utility package Separate tests into bundles Make JavaScript crashes useful Use test names when creati">
<meta property="og:locale">
<meta property="og:image" content="https://raw.githubusercontent.com/bahmutov/send-test-info/master/images/sentry-view.png">
<meta property="og:image" content="https://raw.githubusercontent.com/bahmutov/send-test-info/master/images/cypress-breadcrumbs.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/this-object.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/test-state.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/with-delay.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/skip-service-worker-registration.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/cannot-write-language.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/klingon.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/klingon-stub.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/about.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/about-fail.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/about-works.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/resolved.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/simple.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/incorrect.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/db.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/home.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/eyes.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/visible-link.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/url.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/first-post.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/pathname-print.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/second-comment.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/second-tab.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/a-attr.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/second-tab-same.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/stub-window-open.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/win-open.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/descriptors.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/replace.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/document.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/chromium.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/wait-for-data-should.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/wait-for-data-wrap.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/print.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/save-card-prompt.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cy-tips-and-tricks/payment.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-tips-and-tricks/eslint-cy.png">
<meta property="article:published_time" content="2016-12-30T05:00:00.000Z">
<meta property="article:modified_time" content="2021-09-27T14:18:19.623Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="testing">
<meta property="article:tag" content="cypress">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/bahmutov/send-test-info/master/images/sentry-view.png">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-cypress-tips-and-tricks" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2016-12-30T05:00:00.000Z" itemprop="datePublished">Dec 30 2016</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Cypress Tips and Tricks
    </h1>

    <h2 class="article-title" itemprop="name">
      A few tips on getting the most out of E2E testing tool Cypress
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- toc -->
<ul>
<li><a href="#read-the-docs">Read the docs</a></li>
<li><a href="#run-cypress-on-your-own-ci">Run Cypress on your own CI</a></li>
<li><a href="#record-success-and-failure-videos">Record success and failure videos</a></li>
<li><a href="#move-common-code-into-utility-package">Move common code into utility package</a></li>
<li><a href="#separate-tests-into-bundles">Separate tests into bundles</a></li>
<li><a href="#make-javascript-crashes-useful">Make JavaScript crashes useful</a></li>
<li><a href="#use-test-names-when-creating-data">Use test names when creating data</a></li>
<li><a href="#get-test-status">Get test status</a></li>
<li><a href="#explore-the-environment">Explore the environment</a></li>
<li><a href="#run-all-spec-files-locally">Run all spec files locally</a></li>
<li><a href="#get-command-log-on-failure">Get command log on failure</a></li>
<li><a href="#wait-on-the-right-thing">Wait on the right thing</a></li>
<li><a href="#write-and-read-files">Write and read files</a></li>
<li><a href="#read-json-files-with-retries">Read JSON files with retries</a></li>
<li><a href="#conditional-logic">Conditional logic</a></li>
<li><a href="#customize-cypress-test-runner-colors">Customize Cypress test runner colors</a></li>
<li><a href="#shorten-assertions">Shorten assertions</a></li>
<li><a href="#disable-serviceworker">Disable ServiceWorker</a><ul>
<li><a href="#alternative-delete-from-each-window-object">Alternative: delete from each window object</a></li>
</ul>
</li>
<li><a href="#control-navigatorlanguage">Control <code>navigator.language</code></a></li>
<li><a href="#use-fixtures-to-stub-network-requests">Use fixtures to stub network requests</a></li>
<li><a href="#use-code-coverage">Use code coverage</a></li>
<li><a href="#use-visual-testing">Use visual testing</a></li>
<li><a href="#interactive-and-headed-mode">Interactive and headed mode</a></li>
<li><a href="#produce-high-quality-video-recording">Produce high quality video recording</a></li>
<li><a href="#use-the-page-base-url">Use the page base url</a></li>
<li><a href="#pass-the-environment-variables-correctly">Pass the environment variables correctly</a></li>
<li><a href="#parse-and-use-url">Parse and use URL</a></li>
<li><a href="#deal-with-target_blank">Deal with <code>target=_blank</code></a></li>
<li><a href="#deal-with-windowopen">Deal with <code>window.open</code></a></li>
<li><a href="#deal-with-windowlocationreplace">Deal with <code>window.location.replace</code></a></li>
<li><a href="#minimize-memory-use">Minimize memory use</a></li>
<li><a href="#start-browser-with-specific-time-zone">Start browser with specific time zone</a></li>
<li><a href="#scaffold-the-new-projects-faster">Scaffold the new projects faster</a></li>
<li><a href="#install-chromium-via-puppeteer">Install Chromium via Puppeteer</a></li>
<li><a href="#create-aliases-before-each-test">Create aliases before each test</a></li>
<li><a href="#hover-command">Hover command</a></li>
<li><a href="#wait-for-data">Wait for data</a></li>
<li><a href="#make-http-requests">Make HTTP requests</a></li>
<li><a href="#restart-the-tests">Restart the tests</a></li>
<li><a href="#wait-for-network-idle">Wait for network idle</a></li>
<li><a href="#check-if-the-network-call-has-not-been-made">Check if the network call has not been made</a></li>
<li><a href="#find-good-cypress-examples">Find good Cypress examples</a></li>
<li><a href="#use-cylog-to-print-to-the-command-log">Use cy.log to print to the Command Log</a><ul>
<li><a href="#log-error-before-throwing-it">Log error before throwing it</a></li>
</ul>
</li>
<li><a href="#use-a-single-cycontains-command">Use a single cy.contains command</a></li>
<li><a href="#disable-save-credit-card-prompt">Disable Save Credit Card prompt</a><ul>
<li><a href="#turning-the-credit-card-save-prompt-off-by-changing-the-placeholder-text">Turning the credit card save prompt off by changing the placeholder text</a></li>
<li><a href="#turning-the-credit-card-save-prompt-off-by-using-autocomplete-off">Turning the credit card save prompt off by using autocomplete off</a></li>
</ul>
</li>
<li><a href="#print-timestamp-with-the-error-message">Print timestamp with the error message</a></li>
<li><a href="#add-a-custom-delay-command-for-better-videos">Add a custom delay command for better videos</a></li>
<li><a href="#visit-the-blank-page-to-stop-the-running-app">Visit the blank page to stop the running app</a></li>
<li><a href="#do-not-load-pesky-3rd-party-script">Do not load pesky 3rd party script</a></li>
<li><a href="#deal-with-type-module">Deal with type module</a></li>
<li><a href="#access-a-mysql-database">Access a MySQL database</a></li>
<li><a href="#fix-create-react-app-eslint-warnings">Fix Create-React-App ESLint warnings</a></li>
<li><a href="#use-lodash">Use Lodash</a></li>
<li><a href="#detect-when-the-document-reloads">Detect when the document reloads</a></li>
<li><a href="#time-part-of-the-test">Time part of the test</a></li>
<li><a href="#see-also">See also</a></li>
<li><a href="#related-posts">Related posts</a></li>
</ul>
<!-- tocstop -->
<p>We have been successfully using Cypress to verify our websites and
web apps for a while. Here are some tips &amp; tricks we have learned.</p>
<p>Even this blog is tested using Cypress :)</p>
<h2><span id="read-the-docs">Read the docs</span></h2><p><a target="_blank" rel="noopener" href="https://www.cypress.io/">Cypress</a> has excellent documentation at
<a target="_blank" rel="noopener" href="https://docs.cypress.io/">https://docs.cypress.io/</a>, including
<a target="_blank" rel="noopener" href="https://docs.cypress.io/docs/all-example-apps">examples</a>,
<a target="_blank" rel="noopener" href="https://on.cypress.io/guides">guides</a>,
<a target="_blank" rel="noopener" href="https://www.cypress.io/explore/">videos</a> and even a busy
<a target="_blank" rel="noopener" href="https://gitter.im/cypress-io/cypress">Gitter chat channel</a>.
There is also &quot;Search&quot; box that quickly finds relevant documents. The search <em>is really good</em> and covers the docs, the blog posts and the examples.</p>
<p>Recently common recipes were combined into a
<a target="_blank" rel="noopener" href="https://github.com/cypress-io/cypress-example-recipes">single place</a>.
If you still have an issue with Cypress, please search through open and
closed <a target="_blank" rel="noopener" href="https://github.com/cypress-io/cypress/issues">issues</a>.</p>
<p>You can also read my other blog posts about Cypress under
<a href="../tags/cypress/">tags/cypress</a>.</p>
<h2><span id="run-cypress-on-your-own-ci">Run Cypress on your own CI</span></h2><p>As long as the project has a project key, you can run the tests on your
own <a target="_blank" rel="noopener" href="https://on.cypress.io/continuous-integration">CI boxes</a>.
I found running inside Docker to be the easiest, and even built an
<a target="_blank" rel="noopener" href="https://hub.docker.com/r/bahmutov/cypress-image/">unofficial Docker image</a>
with all dependencies.</p>
<p>Note that <code>cypress ci ...</code> will upload recorded videos and screenshots
(if capturing them is <a target="_blank" rel="noopener" href="https://on.cypress.io/configuration#Screenshots">enabled</a>)
to the Cypress cloud, while <code>cypress run ...</code> will not.</p>
<h2><span id="record-success-and-failure-videos">Record success and failure videos</span></h2><p>When Cypress team has released the video capture feature in version
<a target="_blank" rel="noopener" href="https://github.com/cypress-io/cypress/wiki/changelog#01711-11162016">0.17.11</a>
it quickly became my favorite. I have configured our
<a target="_blank" rel="noopener" href="https://about.gitlab.com/gitlab-ci/">GitLab CI</a> to keep artifacts from
failed test runs for 1 week, while keeping videos from successful
test runs only for a 3 days.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">artifacts:</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">on_failure</span></span><br><span class="line">  <span class="attr">expire_in:</span> <span class="string">&#x27;1 week&#x27;</span></span><br><span class="line">  <span class="attr">untracked:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cypress/videos</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cypress/screenshots</span></span><br><span class="line"><span class="attr">artifacts:</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">on_success</span></span><br><span class="line">  <span class="attr">expire_in:</span> <span class="string">&#x27;3 days&#x27;</span></span><br><span class="line">  <span class="attr">untracked:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cypress/screenshots</span></span><br></pre></td></tr></table></figure>
<p>Whenever a test fails, I watch the failure video side by side with the video
from the last successful test run. The differences in the subject under test
are quickly obvious.</p>
<h2><span id="move-common-code-into-utility-package">Move common code into utility package</span></h2><p>Testing code should be engineered as well as the production code.
To avoid duplicating testing helper utilities, we advise to move all common
helpers into their own NPM module. For example, we use local CSS styles
with randomized class names in our web code.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-1b4a2 people-5ee98&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>This makes the selectors very long since we need to use prefixes.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">&#x27;[class*=people-]&#x27;</span>) <span class="comment">// UGLY!</span></span><br></pre></td></tr></table></figure>
<p>By creating a tiny helper function we alleviated the selector head aches.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;classPrefix&#125; <span class="keyword">from</span> <span class="string">&#x27;@team/cypress-utils/css-names&#x27;</span></span><br><span class="line"><span class="comment">// classPrefix(&#x27;foo&#x27;) returns &quot;[class*=foo-]&quot;</span></span><br><span class="line">cy.get(classPrefix(<span class="string">&#x27;people&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>The test code became a lot more readable.</p>
<h2><span id="separate-tests-into-bundles">Separate tests into bundles</span></h2><p>Using a single <code>cypress/integration/spec.js</code> file to test a large web
application quickly becomes difficult and time consuming. We have separated
our code into multiple files. Additionally, we keep the source files
in <code>src</code> folder and build the multiple bundles in <code>cypress/integration</code>
using <a target="_blank" rel="noopener" href="https://github.com/kensho/multi-cypress">kensho/multi-cypress</a> tool.</p>
<p>The <code>multi-cypress</code> tool assumes that Docker and GitLab CI are used to
actually run the tests. Each test will be inside its own &quot;test job&quot;, thus
10 spec files can be executed at once (assuming at least 10 GitLab CI
runners are available).</p>
<p>The command to run a specific spec file is
<code>cypress run --spec &quot;spec/filename.js&quot;</code> by the way.</p>
<h2><span id="make-javascript-crashes-useful">Make JavaScript crashes useful</span></h2><p>As I have said before, the true value of a test is not when it passes,
but when it fails. Additionally, even a passing test might generate
client-side errors that are not crashes and do not fail the test.
For example, we often use <a target="_blank" rel="noopener" href="https://sentry.io/">Sentry</a> exception monitoring
service where we forward all client-side errors.</p>
<p>If a client-side error happens while the E2E Cypress test is running,
we need this additional context: which test is executing, what steps were
already finished before the error was reported, etc.</p>
<p>By loading a small library
<a target="_blank" rel="noopener" href="https://github.com/bahmutov/send-test-info">send-test-info</a> before each
test, we can capture the name of the test, its spec filename and even
the Cypress test log as breadcrumbs; this information is then sent to Sentry
with each crash. For example, the exception below shows the name of the
test when the error was reported</p>
<p><img src="https://raw.githubusercontent.com/bahmutov/send-test-info/master/images/sentry-view.png" alt="Test name"></p>
<p>Similarly, the Cypress test steps are logged as breadcrumbs and are sent
with the exception allowing any developer to quickly get a sense when the
error happens as the test runs.</p>
<p><img src="https://raw.githubusercontent.com/bahmutov/send-test-info/master/images/cypress-breadcrumbs.png" alt="Test steps"></p>
<h2><span id="use-test-names-when-creating-data">Use test names when creating data</span></h2><p>Often as part of the E2E test we create items / users / posts. I like to
put the full test title in the created data to easily see what test created
which datum. Inside the test we can quickly grab the full title
(which includes the full parent&#39;s title and the current test name)
from the context.</p>
<p>I also like creating random numbers for additional difference</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uuid = <span class="function">() =&gt;</span> Cypress._.random(<span class="number">0</span>, <span class="number">1e6</span>)</span><br><span class="line">describe(<span class="string">&#x27;foo&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// note that we need to use &quot;function&quot; and not fat arrow</span></span><br><span class="line">  <span class="comment">// to actually get the right &quot;this&quot; context</span></span><br><span class="line">  it(<span class="string">&#x27;bar&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> id = uuid()</span><br><span class="line">    <span class="keyword">const</span> testName = <span class="built_in">this</span>.test.fullTitle()</span><br><span class="line">    <span class="keyword">const</span> name = <span class="string">`test name: <span class="subst">$&#123;testName&#125;</span> - <span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">    <span class="comment">// name will be &quot;test name: foo bar - &lt;random&gt;&quot;</span></span><br><span class="line">    makeItem(&#123;name&#125;) <span class="comment">// use the test name to create unique item</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2><span id="get-test-status">Get test status</span></h2><p>If you use <code>function () &#123;&#125;</code> as the test&#39;s body, or a body of a hook, you can find lots of interesting properties in the <code>this</code> object. For example, you can see the state of the test: passed or failed. To see them all, place the <code>debugger</code> keyword and run the test with DevTools open.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">afterEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">  <span class="keyword">debugger</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>There is an object for the entire test, and for the current hook</p>
<p><img src="/blog/images/cy-tips-and-tricks/this-object.png" alt="Information in the test context object"></p>
<p>The <code>this.currentTest</code> object contains the status of the entire test</p>
<p><img src="/blog/images/cy-tips-and-tricks/test-state.png" alt="Check if the test has passed or failed"></p>
<h2><span id="explore-the-environment">Explore the environment</span></h2><p>You can pause the test execution by using <code>debugger</code> keyword. Make sure
the DevTools are open!</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;bar&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">debugger</span></span><br><span class="line">  <span class="comment">// explore &quot;this&quot; context</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2><span id="run-all-spec-files-locally">Run all spec files locally</span></h2><p>If you separate <a target="_blank" rel="noopener" href="https://www.cypress.io/">Cypress</a>
E2E tests into multiple spec files, you soon end up with lots of files.
If you need to run the scripts one by one from the command line,
I wrote a small utility
<a target="_blank" rel="noopener" href="https://github.com/bahmutov/run-each-cypress-spec">run-each-cypress-spec</a>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">npm install -g run-each-cypress-spec</span><br><span class="line">run-specs</span><br><span class="line">...</span><br><span class="line">running cypress/integration/a-spec.js</span><br><span class="line">Started video recording: /Users/gleb/cypress/videos/p259n.mp4</span><br><span class="line">...</span><br><span class="line">running cypress/integration/b-spec.js</span><br><span class="line">Started video recording: /Users/gleb/cypress/videos/62er1.mp4</span><br></pre></td></tr></table></figure>
<p>If you need environment variables (like urls, passwords), you can easily
inject them using <a target="_blank" rel="noopener" href="https://github.com/bahmutov/as-a">as-a</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">as-a cy run-specs</span><br></pre></td></tr></table></figure>
<h2><span id="get-command-log-on-failure">Get command log on failure</span></h2><p>While videos of the failed tests are useful, sometimes we just want to get
a sense of the failure before triaging it. In the headless CI mode, you can
get a JSON file for each failed test with the log of all commands. See
the JSON file below as an example of a failed test and the file it generated.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;testName&quot;</span>: <span class="string">&quot;Website loads the About tab&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;testError&quot;</span>: <span class="string">&quot;Timed out retrying: Expected to find content: &#x27;Join Us&#x27; but never did.&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;testCommands&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;visit&quot;</span>,</span><br><span class="line">    <span class="string">&quot;new url https://www.company.com/#/&quot;</span>,</span><br><span class="line">    <span class="string">&quot;contains a.nav-link, About&quot;</span>,</span><br><span class="line">    <span class="string">&quot;click&quot;</span>,</span><br><span class="line">    <span class="string">&quot;new url https://www.company.com/#/about&quot;</span>,</span><br><span class="line">    <span class="string">&quot;hash&quot;</span>,</span><br><span class="line">    <span class="string">&quot;assert expected **#/about** to equal **#/about**&quot;</span>,</span><br><span class="line">    <span class="string">&quot;contains Join Us&quot;</span>,</span><br><span class="line">    <span class="string">&quot;assert expected **body :not(script):contains(**&#x27;Join Us&#x27;**),</span></span><br><span class="line"><span class="string">      [type=&#x27;submit&#x27;][value~=&#x27;Join Us&#x27;]** to exist in the DOM&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This is a separate project that just needs to be included from your
<code>cypress/support/index.js</code> file. For instructions see
<a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-failed-log">cypress-failed-log</a> project.</p>
<h2><span id="wait-on-the-right-thing">Wait on the right thing</span></h2><p>It is important to wait for the right element. Imagine we have a list of items
in the DOM. We expect a new element to appear with text &quot;Hello&quot;. We could
select first the list, then the element containing &quot;Hello&quot; and check if it
becomes visible</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">&#x27;.list&#x27;</span>)</span><br><span class="line">  .contains(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line">  .should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>But sometimes it does not work. When we <code>cy.get(&#39;.list&#39;)</code> Cypress saves the
DOM element as the &quot;subject&quot; and then tries to wait for a child of that
element with text &quot;Hello&quot; to become visible. If we use React for example, the
DOM of the list might be recreated from scratch if we push a new item into
the list. When that happens Cypress notices that the &quot;subject&quot; DOM it holds
a reference to becomes &quot;detached from the DOM&quot; - it becomes an orphan!</p>
<p>A better solution to this problem is to use a composite CSS selector that
will grab the list AND the item in a single operation.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cy.contains(<span class="string">&#x27;.list li&#x27;</span>, <span class="string">&#x27;Hello&#x27;</span>)</span><br><span class="line">  .should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>This forces Cypress to wait for the list AND list item element without caching
a reference to the DOM element <code>.list</code>.</p>
<p>You can use advanced CSS selectors to get an element in a single command.
For example instead of <code>cy.get(&#39;.something&#39;).first()</code> you could
use <code>cy.get(&#39;.something:first-child&#39;)</code>. Similarly,</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get first element</span></span><br><span class="line">cy.get(<span class="string">&#x27;.something&#x27;</span>).first()</span><br><span class="line">cy.get(<span class="string">&#x27;.something:first-child&#x27;</span>)</span><br><span class="line"><span class="comment">// get last element</span></span><br><span class="line">cy.get(<span class="string">&#x27;.something&#x27;</span>).last()</span><br><span class="line">cy.get(<span class="string">&#x27;.something:last-child&#x27;</span>)</span><br><span class="line"><span class="comment">// get second element</span></span><br><span class="line">cy.get(<span class="string">&#x27;.something&#x27;</span>).eq(<span class="number">1</span>)</span><br><span class="line">cy.get(<span class="string">&#x27;.something:nth-child(2)&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2><span id="write-and-read-files">Write and read files</span></h2><p>You can write files to disk directly from Cypress using
<a target="_blank" rel="noopener" href="https://docs.cypress.io/v1.0/docs/writefile">cy.writeFile</a> and read an
<em>existing</em> file using <a target="_blank" rel="noopener" href="https://docs.cypress.io/v1.0/docs/readfile">cy.readFile</a>.
What if you want to read a file that might not exist? <code>cy.readFile</code> will fail
the test if file does not exist, thus we need to find a work around.</p>
<p>In my case, the file I would like to load is a JSON of
<a target="_blank" rel="noopener" href="https://github.com/bahmutov/snap-shot">test values</a>
useful for <a target="_blank" rel="noopener" href="https://facebook.github.io/jest/blog/2016/07/27/jest-14.html">Jest-like snapshot testing</a>.</p>
<p>Here is a neat trick. Save the file using <code>cy.writeFile</code>, for example
<code>cy.writeFile(&#39;spanshots.json&#39;)</code> whenever there is something to save.
When reading the file, <em>fetch it through the Cypress code proxy</em> using <code>fetch</code>
Notice how the test spec itself is served by Cypress from URL which looks like
<code>http://localhost:49829/__cypress/tests?p=cypress/integration/spec.js-438</code>.
Let us &quot;hack&quot; it to load a file that might not exist.</p>
<p>The code below tries to load snapshots file before each test.
If the <code>fetch</code> call fails, the file does not exist.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> snapshots</span><br><span class="line">beforeEach(<span class="function"><span class="keyword">function</span> <span class="title">loadSnapshots</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> fetch(<span class="string">&#x27;/__cypress/tests?p=./snapshots.json&#x27;</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">r</span> =&gt;</span> r.text())</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span> <span class="title">loadedText</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// ?</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">&#x27;snapshots file does not exist&#x27;</span>)</span><br><span class="line">      snapshots = &#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>If the <code>fetch</code> call succeeds, the returned <code>text</code> will NOT be original JSON!
Instead it will be webpacked module :)</p>
<p>For example, here is the saved file</p>
<figure class="highlight json"><figcaption><span>snapshots.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;spec.js&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;works&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;foo&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here is how built-in Cypress bundler returns it in response to
<code>/__cypress/tests?p=./snapshots.json</code> - I have shortened the webpack
boilerplate preamble.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params">t,n,r</span>)</span>&#123;<span class="function"><span class="keyword">function</span> ...)(<span class="params">&#123;<span class="number">1</span>:[<span class="keyword">function</span>(<span class="built_in">require</span>,<span class="built_in">module</span>,<span class="built_in">exports</span>)&#123;</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="built_in">module</span>.<span class="built_in">exports</span>=&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="string">&quot;spec.js&quot;</span>: &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="string">&quot;works&quot;</span>: [</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="string">&quot;foo&quot;</span></span></span></span><br><span class="line"><span class="function"><span class="params">    ]</span></span></span><br><span class="line"><span class="function"><span class="params">  &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span></span></span><br><span class="line"><span class="function"><span class="params">&#125;,&#123;&#125;]&#125;,&#123;&#125;,[<span class="number">1</span>]</span>)</span>;</span><br></pre></td></tr></table></figure>
<p>Notice that our JSON has been placed into module with id &#39;1&#39; (first line
expression <code>&#123;1:</code>). The entire bundle registers a stand alone <code>require</code>
function. If we want to get into the actual &quot;module&quot; contents we have to
do the following in our <code>function loadedText(text)</code> to finish the hack</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadedText</span> (<span class="params">text</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (text.includes(<span class="string">&#x27;BUNDLE_ERROR&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">// if the bundler tried to handle missing file</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;not found&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> req = <span class="built_in">eval</span>(text)</span><br><span class="line">  snapshots = req(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Boom, the object <code>snapshots</code> has been loaded from the file <code>snapshots.json</code>
which might or might not exist.</p>
<p><strong>Note</strong> while I have successfully used the above hack when running Cypress
locally, it was always failing when doing <code>cypress run</code> in headless mode.</p>
<h2><span id="read-json-files-with-retries">Read JSON files with retries</span></h2><p>Cypress <a target="_blank" rel="noopener" href="https://on.cypress.io/readfile">cy.readFile</a> command automatically parses JSON files. It also re-reads the file if the assertions on the returned JSON fail. For example, let&#39;s validate the number of items stored by the app in its JSON &quot;database&quot; file:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// note cy.readFile retries reading the file until the should(cb) passes</span></span><br><span class="line"><span class="comment">// https://on.cypress.io/readfile</span></span><br><span class="line">cy.get(<span class="string">&#x27;.new-todo&#x27;</span>)</span><br><span class="line">  .type(<span class="string">&#x27;todo A&#123;enter&#125;&#x27;</span>)</span><br><span class="line">  .type(<span class="string">&#x27;todo B&#123;enter&#125;&#x27;</span>)</span><br><span class="line">  .type(<span class="string">&#x27;todo C&#123;enter&#125;&#x27;</span>)</span><br><span class="line">  .type(<span class="string">&#x27;todo D&#123;enter&#125;&#x27;</span>)</span><br><span class="line">cy.readFile(<span class="string">&#x27;./todomvc/data.json&#x27;</span>).should(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  expect(data).to.have.property(<span class="string">&#x27;todos&#x27;</span>)</span><br><span class="line">  expect(data.todos).to.have.length(<span class="number">4</span>, <span class="string">&#x27;4 saved items&#x27;</span>)</span><br><span class="line">  expect(data.todos[<span class="number">0</span>], <span class="string">&#x27;first item&#x27;</span>).to.include(&#123;</span><br><span class="line">    title: <span class="string">&#x27;todo A&#x27;</span>,</span><br><span class="line">    completed: <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>Even if the application sends the items after a time delay, the <code>cy.readFile(...).should(cb)</code> combination retries and successfully passes when all four items are found.</p>
<p><img src="/blog/images/cy-tips-and-tricks/with-delay.gif" alt="Test passes after the file has been updated"></p>
<h2><span id="conditional-logic">Conditional logic</span></h2><p>Sometimes you might need to interact with a page element that does not always
exist. For example there might a modal dialog the first time you use the
website. You want to close the modal dialog.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">&#x27;.greeting&#x27;</span>)</span><br><span class="line">  .contains(<span class="string">&#x27;Close&#x27;</span>)</span><br><span class="line">  .click()</span><br><span class="line">cy.get(<span class="string">&#x27;.greeting&#x27;</span>)</span><br><span class="line">  .should(<span class="string">&#x27;not.be.visible&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>But the modal is not shown the second time around and the above code will
fail. In order to check if an element exists without asserting it, use
the proxied jQuery function
<a target="_blank" rel="noopener" href="https://docs.cypress.io/v1.0/docs/cypress-jquery">Cypress.$</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $el = Cypress.$(<span class="string">&#x27;.greeting&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> ($el.length) &#123;</span><br><span class="line">  cy.log(<span class="string">&#x27;Closing greeting&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;.greeting&#x27;</span>)</span><br><span class="line">    .contains(<span class="string">&#x27;Close&#x27;</span>)</span><br><span class="line">    .click()</span><br><span class="line">&#125;</span><br><span class="line">cy.get(<span class="string">&#x27;.greeting&#x27;</span>)</span><br><span class="line">  .should(<span class="string">&#x27;not.be.visible&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>The above check is safe.</p>
<h2><span id="customize-cypress-test-runner-colors">Customize Cypress test runner colors</span></h2><p>Read <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2018/10/11/halloween-theme/">Cypress Halloween Theme</a> and check out <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-dark">cypress-dark</a> plugin.</p>
<h2><span id="shorten-assertions">Shorten assertions</span></h2><p>For <a target="_blank" rel="noopener" href="https://on.cypress.io/location"><code>cy.location</code></a> you can pass the part you are interested in</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cy.location().should(<span class="function"><span class="params">location</span> =&gt;</span> &#123;</span><br><span class="line">  expect(location.pathname).to.eq(<span class="string">&#x27;/todos&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>is the same as</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cy.location(<span class="string">&#x27;pathname&#x27;</span>).should(<span class="string">&#x27;equal&#x27;</span>, <span class="string">&#x27;/todos&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>You can use <code>its</code> to get nested properties easier</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">&#x27;@login&#x27;</span>).should(<span class="function"><span class="params">req</span> =&gt;</span> &#123;</span><br><span class="line">  expect(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>)).to.be.eq(req.response.body.accessToken);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>is the same as</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">&#x27;@login&#x27;</span>).its(<span class="string">&#x27;response.body.accessToken&#x27;</span>)</span><br><span class="line">  .should(<span class="function"><span class="params">accessToken</span> =&gt;</span> expect(accessToken).to.equal(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>)))</span><br></pre></td></tr></table></figure>
<p>and this could be expressed more clearly in steps</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cy.then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// by this step, there should the token stored in local storage</span></span><br><span class="line">  <span class="keyword">const</span> token = <span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">  <span class="comment">// and it should come from the response</span></span><br><span class="line">  cy.get(<span class="string">&#x27;@login&#x27;</span>).its(<span class="string">&#x27;response.body.accessToken&#x27;</span>).should(<span class="string">&#x27;equal&#x27;</span>, token)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>You can wait for network request to happen and then check something using <code>cy.then</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// notice that we are waiting for @login XHR alias</span></span><br><span class="line"><span class="comment">// before checking that the token is NOT set</span></span><br><span class="line">cy.get(<span class="string">&#x27;@login&#x27;</span>).should(<span class="function"><span class="params">req</span> =&gt;</span> &#123;</span><br><span class="line">  expect(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>)).to.be.null;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Instead we can use <code>.then</code> after waiting for the network request. It is also helpful to print the message when checking for the token, otherwise command log simply says &quot;expect null to equal null&quot;.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cy.wait(<span class="string">&#x27;@login&#x27;</span>)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    expect(<span class="built_in">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>), <span class="string">&#x27;token in local storage&#x27;</span>).to.be.null;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>You don&#39;t need to wrap elements just to dynamically use them. For example if you want to test each item from the list</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inputs = [</span><br><span class="line">  &#123; <span class="attr">element</span>: <span class="string">&#x27;username&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;foo&#x27;</span>, <span class="attr">error</span>: <span class="string">&#x27;Please enter your username.&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">element</span>: <span class="string">&#x27;password&#x27;</span>, <span class="attr">text</span>: <span class="string">&#x27;foo&#x27;</span>, <span class="attr">error</span>: <span class="string">&#x27;Please enter your password.&#x27;</span> &#125;</span><br><span class="line">];</span><br><span class="line">cy.wrap(inputs).each(<span class="function"><span class="params">input</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; element, text, error &#125; = input;</span><br><span class="line"></span><br><span class="line">  cy.getByTestId(element)</span><br><span class="line">    .type(text)</span><br><span class="line">    .should(<span class="string">&#x27;have.value&#x27;</span>, text);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Every Cypress command is automatically inserted into the queue, so you can iterate over the items and use Cypress commands, everything will be queued correctly.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">inputs.forEach(<span class="function"><span class="params">input</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; element, text, error &#125; = input;</span><br><span class="line"></span><br><span class="line">  cy.getByTestId(element)</span><br><span class="line">    .type(text)</span><br><span class="line">    .should(<span class="string">&#x27;have.value&#x27;</span>, text);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>I prefer <a target="_blank" rel="noopener" href="https://on.cypress.io/first"><code>cy.first()</code></a> to <code>cy.eq(0)</code>.</p>
<h2><span id="disable-serviceworker">Disable ServiceWorker</span></h2><p>ServiceWorkers are great - but they can really affect your end-to-end tests by introducing caching and coupling tests. If you want to disable the service worker caching you need to remove or delete <code>navigator.ServiceWorker</code> when visiting the page with <a target="_blank" rel="noopener" href="https://on.cypress.io/visit"><code>cy.visit</code></a>.</p>
<p>First, here is the way that <strong>does not</strong> work - simply deleting the property from the <code>navigator</code> object.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;disables it&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>, &#123;</span><br><span class="line">    onBeforeLoad (win) &#123;</span><br><span class="line">      <span class="keyword">delete</span> win.navigator.ServiceWorker</span><br><span class="line">      <span class="comment">// nope, win.navigator.ServiceWorker is still there</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The reason for this is that we are deleting the property from the wrong object. The <code>ServiceWorker</code> is NOT defined on the <code>navigator</code>, it is defined on its prototype. You can confirm this by using <code>Object.getOwnPropertyDescriptor</code> method:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(win.navigator, <span class="string">&#x27;ServiceWorker&#x27;</span>)</span><br><span class="line"><span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(win.navigator.__proto__, <span class="string">&#x27;ServiceWorker&#x27;</span>)</span><br><span class="line"><span class="comment">// &#123;set: undefined, enumerable: true, configurable: true, get: ∆í&#125;</span></span><br></pre></td></tr></table></figure>
<p>After we delete the property from the right object, the application code will no longer think it can register the service worker.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;disables it&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>, &#123;</span><br><span class="line">    onBeforeLoad (win) &#123;</span><br><span class="line">      <span class="keyword">delete</span> win.navigator.__proto__.ServiceWorker</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><figcaption><span>index.html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="string">&#x27;ServiceWorker&#x27;</span> <span class="keyword">in</span> navigator) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;registering service worker&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;skipping sw registration&#x27;</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/skip-service-worker-registration.png" alt="Service worker is no longer registered"></p>
<p><strong>Note:</strong> once deleted, the SW stays deleted in the window, even if the application navigates to another URL.</p>
<h3><span id="alternative-delete-from-each-window-object">Alternative: delete from each window object</span></h3><p>You can register an event handler to fire on every window load event, where you can remove the ServiceWorker</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cypress.on(<span class="string">&#x27;window:before:load&#x27;</span>, <span class="function">(<span class="params">win</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  <span class="keyword">delete</span> win.navigator.__proto__.ServiceWorker</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Read also <a href="../stub-navigator-api/">&quot;Stub navigator API in end-to-end tests&quot;</a> for another example.</p>
<h2><span id="control-navigatorlanguage">Control <code>navigator.language</code></span></h2><p>Imagine you have a page that shows different greeting depending on the <code>navigator.language</code> property.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;greeting&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> greeting = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;greeting&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (navigator.language === <span class="string">&#x27;Klingon&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// https://www.omniglot.com/language/phrases/klingon.php</span></span></span><br><span class="line"><span class="javascript">      greeting.innerText = <span class="string">&#x27;nuqneH&#x27;</span></span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">      greeting.innerText = <span class="string">&#x27;Hi there&#x27;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>How do we check if the default English greeting is displayed? Easily</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;shows default greeting&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#greeting&#x27;</span>, <span class="string">&#x27;Hi there&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>But how do we force the Klingon greeting to be displayed? Trying to change read-only <code>navigator.language</code> property throws an error.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;shows Klingon greeting&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>, &#123;</span><br><span class="line">    onBeforeLoad (win) &#123;</span><br><span class="line">      <span class="comment">// DOES NOT WORK</span></span><br><span class="line">      win.navigator.language = <span class="string">&#x27;Klingon&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#greeting&#x27;</span>, <span class="string">&#x27;nuqneH&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/cannot-write-language.png" alt="Error is thrown when trying to directly set `navigator.language`"></p>
<p>The <code>navigator.language</code> property is actually set on <code>navigator.__proto__</code> object:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(navigator, <span class="string">&#x27;language&#x27;</span>)</span><br><span class="line"><span class="comment">//&gt; undefined</span></span><br><span class="line"><span class="built_in">Object</span>.getOwnPropertyDescriptor(navigator.__proto__, <span class="string">&#x27;language&#x27;</span>)</span><br><span class="line"><span class="comment">//&gt; &#123;get: ∆í, set: undefined, enumerable: true, configurable: true&#125;</span></span><br></pre></td></tr></table></figure>
<p>We can create <code>language</code> property on the <code>navigator</code> object instead - thanks, prototypical inheritance! We can specify the property&#39;s value:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;shows Klingon greeting&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>, &#123;</span><br><span class="line">    onBeforeLoad (win) &#123;</span><br><span class="line">      <span class="comment">// DOES NOT WORK</span></span><br><span class="line">      <span class="comment">// Uncaught TypeError: Cannot assign to read only property</span></span><br><span class="line">      <span class="comment">// &#x27;language&#x27; of object &#x27;[object Navigator]&#x27;</span></span><br><span class="line">      <span class="comment">// win.navigator.language = &#x27;Klingon&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// instead we need to define a property like this</span></span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(win.navigator, <span class="string">&#x27;language&#x27;</span>, &#123;</span><br><span class="line">        value: <span class="string">&#x27;Klingon&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#greeting&#x27;</span>, <span class="string">&#x27;nuqneH&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>This test shows proper respect to each Klingon warrior browsing the web.</p>
<p><img src="/blog/images/cy-tips-and-tricks/klingon.png" alt="Klingon greeting"></p>
<p>How do we ensure that the application actually read <code>navigator.language</code> property when displaying the greeting? Maybe the &quot;nuqneH&quot; is hard-coded! We need to track <code>navigator.language</code> &quot;get&quot; access. We can do this using <a target="_blank" rel="noopener" href="https://on.cypress.io/stub"><code>cy.stub</code></a> method.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;checks if application gets language property&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>, &#123;</span><br><span class="line">    onBeforeLoad (win) &#123;</span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(win.navigator, <span class="string">&#x27;language&#x27;</span>, &#123;</span><br><span class="line">        get: cy.stub().returns(<span class="string">&#x27;Klingon&#x27;</span>).as(<span class="string">&#x27;language&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#greeting&#x27;</span>, <span class="string">&#x27;nuqneH&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;@language&#x27;</span>).should(<span class="string">&#x27;have.been.calledOnce&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Now we know for sure how the application behaves.</p>
<p><img src="/blog/images/cy-tips-and-tricks/klingon-stub.png" alt="Language was read by the application"></p>
<h2><span id="use-fixtures-to-stub-network-requests">Use fixtures to stub network requests</span></h2><p>If your tests are full of <a target="_blank" rel="noopener" href="https://on.cypress.io/network-requests">stubbed network responses</a>, move the responses into fixtures</p>
<p><strong>before</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;does A&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.server()</span><br><span class="line">  cy.route(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;**/api/v1/suggestion_query/query&#x27;</span>,</span><br><span class="line">    response: &#123;</span><br><span class="line">      ... loooong response object ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// UI actions</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;does B&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.server()</span><br><span class="line">  cy.route(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;**/api/v1/suggestion_query/query&#x27;</span>,</span><br><span class="line">    response: &#123;</span><br><span class="line">      ... another loooong response object ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// UI actions</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>after 1</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;does A&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.server()</span><br><span class="line">  cy.route(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;**/api/v1/suggestion_query/query&#x27;</span>,</span><br><span class="line">    <span class="comment">// loads JSON fixture from cypress/fixtures/first_query_response.json</span></span><br><span class="line">    response: <span class="string">&#x27;fixture:first_query_response&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// UI actions</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;does B&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.server()</span><br><span class="line">  cy.route(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;**/api/v1/suggestion_query/query&#x27;</span>,</span><br><span class="line">    <span class="comment">// loads JSON fixture from cypress/fixtures/second_query_response.json</span></span><br><span class="line">    response: <span class="string">&#x27;fixture:second_query_response&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// UI actions</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>after 2</strong></p>
<p>You can even require the JSON fixtures directly if the second response is just a little bit different from the first response</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> responseFixture = <span class="built_in">require</span>(<span class="string">&#x27;../fixtures/first_query_response&#x27;</span>)</span><br><span class="line">it(<span class="string">&#x27;does A&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.server()</span><br><span class="line">  cy.route(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;**/api/v1/suggestion_query/query&#x27;</span>,</span><br><span class="line">    response: responseFixture</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// UI actions</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;does B&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Lodash is bundled with Cypress https://on.cypress.io/_</span></span><br><span class="line">  <span class="comment">// so use it to avoid changing the shared response object</span></span><br><span class="line">  <span class="keyword">const</span> secondResponse = Cypress._.cloneDeep(responseFixture)</span><br><span class="line">  secondResponse.someProperty = <span class="string">&#x27;new value&#x27;</span></span><br><span class="line">  cy.server()</span><br><span class="line">  cy.route(&#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;**/api/v1/suggestion_query/query&#x27;</span>,</span><br><span class="line">    response: secondResponse</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// UI actions</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>See <a target="_blank" rel="noopener" href="https://on.cypress.io/route">cy.route</a> and <a target="_blank" rel="noopener" href="https://on.cypress.io/route">cy.fixture</a> documentation.</p>
<p><strong>Bonus:</strong> read <a href="../import-cypress-fixtures/">Import Cypress fixtures</a></p>
<h2><span id="use-code-coverage">Use code coverage</span></h2><p>You can instrument your application and use Cypress <a target="_blank" rel="noopener" href="https://on.cypress.io/code-coverage">code coverage</a> plugin to produce combined reports in multiple formats. End-to-end tests are <em>very effective</em> at covering a lot of code in a single test.</p>
<ul>
<li><a href="../combined-end-to-end-and-unit-test-coverage/">Combined End-to-end and Unit Test Coverage</a></li>
</ul>
<h2><span id="use-visual-testing">Use visual testing</span></h2><p>If a test grows to be very long because it checks so many elements on the page, see if it makes sense to test the <em>entire page</em> using <a target="_blank" rel="noopener" href="https://on.cypress.io/visual-testing">Visual Testing</a>.</p>
<p><strong>before</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;checks lots of things&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// perform some actions on the page</span></span><br><span class="line">  <span class="comment">// check results after action</span></span><br><span class="line">  cy.get(<span class="string">&#x27;selector1&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">    .find(<span class="string">&#x27;sub-selector1&#x27;</span>).should(<span class="string">&#x27;have.text&#x27;</span>, <span class="string">&#x27;expected text&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;selector2&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">    .find(<span class="string">&#x27;sub-selector2&#x27;</span>).should(<span class="string">&#x27;have.text&#x27;</span>, <span class="string">&#x27;expected text&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;selector3&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">    .find(<span class="string">&#x27;sub-selector3&#x27;</span>).should(<span class="string">&#x27;have.text&#x27;</span>, <span class="string">&#x27;expected text&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;selector4&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">    .find(<span class="string">&#x27;sub-selector4&#x27;</span>).should(<span class="string">&#x27;have.text&#x27;</span>, <span class="string">&#x27;expected text&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;selector5&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">    .find(<span class="string">&#x27;sub-selector6&#x27;</span>).should(<span class="string">&#x27;have.text&#x27;</span>, <span class="string">&#x27;expected text&#x27;</span>)</span><br><span class="line">  ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>after</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;checks lots of things&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// perform some actions on the page</span></span><br><span class="line">  <span class="comment">// check results after action</span></span><br><span class="line">  <span class="comment">// first, confirm the page has been updated after action</span></span><br><span class="line">  cy.get(<span class="string">&#x27;selector1&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">    .find(<span class="string">&#x27;sub-selector1&#x27;</span>).should(<span class="string">&#x27;have.text&#x27;</span>, <span class="string">&#x27;expected text&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// but instead of the checking individual elements</span></span><br><span class="line">  <span class="comment">// compare the entire page against expected &quot;gold&quot; image</span></span><br><span class="line">  <span class="comment">// using one of the visual testing plugins</span></span><br><span class="line">  <span class="comment">// https://on.cypress.io/plugins#visual-testing</span></span><br><span class="line">  cy.takeVisualSnapshot(<span class="string">&#x27;user action&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>Bonus:</strong> check out <a target="_blank" rel="noopener" href="https://github.com/bahmutov/sudoku">bahmutov/sudoku</a> for visual component testing using open source tools, and read <a href="../open-source-visual-testing-of-components/">Visual testing for React components using open source tools</a>.</p>
<h2><span id="interactive-and-headed-mode">Interactive and headed mode</span></h2><p>You can find out if the test is currently running using the <em>interactive mode</em> which is when the user calls <code>cypress open</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Cypress.config(<span class="string">&#x27;isInteractive&#x27;</span>)) &#123;</span><br><span class="line">  <span class="comment">// interactive &quot;cypress open&quot; mode!</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// &quot;cypress run&quot; mode</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>When you use the interactive mode you always see the browser, thus the browser is always <em>headed</em>. But when using the <code>cypress run</code> command, the browser might be headless or headed. You can find out how the browser is displayed:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Cypress.browser.isHeaded) &#123;</span><br><span class="line">  <span class="comment">// browser is headed</span></span><br><span class="line">  <span class="comment">// might be interactive mode &quot;cypress open&quot;</span></span><br><span class="line">  <span class="comment">// or &quot;cypress run --headed&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// browser is running headlessly</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>When using <code>cypress run</code>, Electron is <em>headless</em> by default, while Chrome and Firefox browsers are <em>headed</em> by default. You can control the browser though:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx cypress run --browser chrome --headless</span><br></pre></td></tr></table></figure>
<p>Trying to pass both <code>--headed</code> and <code>--headless</code> CLI parameters raises an error.</p>
<h2><span id="produce-high-quality-video-recording">Produce high quality video recording</span></h2><p>Read the full blog post <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2021/03/01/generate-high-resolution-videos-and-screenshots/">Generate High-Resolution Videos and Screenshots</a>.</p>
<p>You can find most of the advice below implemented in <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-movie">bahmutov/cypress-movie</a>. To generate better videos from tests</p>
<ul>
<li>set video compression to false</li>
<li>set browser window size to larger value, which should work fine when using headless Chrome on CI</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in your plugins file</span></span><br><span class="line">on(<span class="string">&#x27;before:browser:launch&#x27;</span>, <span class="function">(<span class="params">browser = &#123;&#125;, launchOptions</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> ([<span class="string">&#x27;chrome&#x27;</span>, <span class="string">&#x27;chromium&#x27;</span>].includes(browser.name) &amp;&amp; browser.isHeadless) &#123;</span><br><span class="line">    launchOptions.args.push(</span><br><span class="line">      <span class="string">`--window-size=1920,1080`</span>,</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> launchOptions</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>hide command log</li>
</ul>
<p>You can &quot;expand&quot; the application under test iframe to cover the entire window</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> clearViewport = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> runnerContainer = <span class="built_in">window</span>.parent.document.getElementsByClassName(</span><br><span class="line">    <span class="string">&#x27;iframes-container&#x27;</span>,</span><br><span class="line">  )[<span class="number">0</span>]</span><br><span class="line">  runnerContainer.setAttribute(</span><br><span class="line">    <span class="string">&#x27;style&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;left: 0; top: 0; width: 100%; height: 100%;&#x27;</span>,</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> sizeContainer = <span class="built_in">window</span>.parent.document.getElementsByClassName(</span><br><span class="line">    <span class="string">&#x27;size-container&#x27;</span>,</span><br><span class="line">  )[<span class="number">0</span>]</span><br><span class="line">  sizeContainer.setAttribute(<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> sidebar = <span class="built_in">window</span>.parent.document.getElementsByClassName(</span><br><span class="line">    <span class="string">&#x27;reporter-wrap&#x27;</span>,</span><br><span class="line">  )[<span class="number">0</span>]</span><br><span class="line">  sidebar.setAttribute(<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;opacity: 0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> header = <span class="built_in">window</span>.parent.document.querySelector(</span><br><span class="line">    <span class="string">&#x27;.runner.container header&#x27;</span>,</span><br><span class="line">  )</span><br><span class="line">  header.setAttribute(<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;opacity: 0&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Call this function before the tests.</p>
<ul>
<li>use native Chrome Debugger Protocol to take full page screenshots. See &quot;cypress-movie&quot; project.</li>
</ul>
<h2><span id="use-the-page-base-url">Use the page base url</span></h2><p>Sometimes multiple tests visit a different base url. For example, you might usually go to the index page by setting <code>baseUrl</code> in the config file</p>
<figure class="highlight json"><figcaption><span>cypress.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;baseUrl&quot;</span>: <span class="string">&quot;http://localhost:7080&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Every test can <code>cy.visit(&#39;/&#39;)</code> and get to the index page. But imagine that a suite of tests is trying to visit and test the &quot;About&quot; page. It is located at <code>/about.html</code>, so every test has to visit it.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&#x27;About&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;loads&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;/about.html&#x27;</span>)</span><br><span class="line">      .contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;loads again&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;/about.html&#x27;</span>)</span><br><span class="line">      .contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/about.png" alt="Visiting the about page from every test"></p>
<p>Now, we can refactor the tests to avoid duplication. For example, we could move the <code>cy.visit</code> into <code>beforeEach</code> hook.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;About&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;/about.html&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;loads&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;loads again&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Works.</p>
<p>Or we could create a utility function:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&#x27;About&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> visit = <span class="function">() =&gt;</span> cy.visit(<span class="string">&#x27;/about.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;loads&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    visit()</span><br><span class="line">    cy.contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;loads again&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    visit()</span><br><span class="line">    cy.contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>It works too.</p>
<p>Here is one more way to (abuse) <a target="_blank" rel="noopener" href="https://on.cypress.io/configuration#Test-Configuration">test configuration feature</a> introduced in <a target="_blank" rel="noopener" href="https://on.cypress.io/changelog#5-0-0">Cypress v5.0.0</a>. We will change the <code>baseUrl</code> in the <code>describe</code> block to apply to just these tests.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&#x27;About&#x27;</span>, &#123; <span class="attr">baseUrl</span>: <span class="string">&#x27;/about.html&#x27;</span> &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;loads&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;loads again&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Notice the <code>&#123; baseUrl: &#39;/about.html&#39; &#125;</code> parameter in <code>describe</code> call. We can overwrite multiple config values using this parameter. In our case, we overwrite the <code>baseUrl</code>, appending the file name. In the <code>cy.visit(&#39;&#39;)</code> call we pass an empty string - because we do not want to append <code>/</code> at the end.</p>
<p>But the tests fail.</p>
<p><img src="/blog/images/cy-tips-and-tricks/about-fail.png" alt="Extra slash at the end fails the tests"></p>
<p>While our visit used an empty string, Cypress requires <code>baseUrl</code> to be a valid base URL and appends <code>/</code> at the end automatically.</p>
<p>Luckily, <a target="_blank" rel="noopener" href="https://on.cypress.io/changelog#5-4-0">Cypress v5.4.0</a> has a fix for <code>baseUrl</code> that has params for issue <a target="_blank" rel="noopener" href="https://github.com/cypress-io/cypress/issues/2101">#2101</a>. If your base url is of the form <code>...?foo=bar</code> then visiting <code>&#39;&#39;</code> would keep the original full url. Let&#39;s change our test by appending <code>?</code> to the base url:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- describe(&#x27;About&#x27;, &#123; baseUrl: &#x27;/about.html&#x27; &#125;, () =&gt; &#123;</span></span><br><span class="line"><span class="addition">+ describe(&#x27;About&#x27;, &#123; baseUrl: &#x27;/about.html?&#x27; &#125;, () =&gt; &#123;</span></span><br></pre></td></tr></table></figure>
<p>Now the tests pass - and the <code>?/</code> at the end of the URL is ignored</p>
<p><img src="/blog/images/cy-tips-and-tricks/about-works.png" alt="The page is visited correctly"></p>
<h2><span id="pass-the-environment-variables-correctly">Pass the environment variables correctly</span></h2><p>Imagine you need to pass database username and password from your test. These values are probably available as environment variables. How would you pass them to <code>cypress run</code>? You might try something like this in the <code>package.json</code> file. It will NOT work:</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;cy:run&quot;</span>: <span class="string">&quot;node_modules\\.bin\\cypress run --env db.user=&#x27;$DB_USERNAME&#x27;,db.password=&#x27;$PASSWORD&#x27;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>First, you do not need the <code>node_modules\\.bin</code> path when calling an NPM alias - they are automatically resolved by the <code>npm run</code> command. Thus always use simply:</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;cy:run&quot;</span>: <span class="string">&quot;cypress run --env db.user=&#x27;$DB_USERNAME&#x27;,db.password=&#x27;$PASSWORD&#x27;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The above command will NOT work yet. To see why, change the <code>cypress run</code> to <code>cypress open</code> to see the Cypress GUI.</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;cy:run&quot;</span>: <span class="string">&quot;cypress run --env db.user=&#x27;$DB_USERNAME&#x27;,db.password=&#x27;$PASSWORD&#x27;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cy:open&quot;</span>: <span class="string">&quot;cypress open --env db.user=&#x27;$DB_USERNAME&#x27;,db.password=&#x27;$PASSWORD&#x27;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Select the &quot;Settings&quot; tab and inspect the resolved environment variables.</p>
<p><img src="/blog/images/cy-tips-and-tricks/resolved.png" alt="Resolved environment variables"></p>
<p>We have two problems:</p>
<ol>
<li>Instead of passing the environment variable&#39;s value, we got the strings &quot;$DB_USERNAME&quot; and &quot;$PASSWORD&quot;. Resolving environment variables inside commands might be tricky and depend on the operating system.</li>
<li>The username and the password are stored under names <code>db.user</code> and <code>db.password</code>, which might be not what you expect. From the dot notation, I would expect these values to create an object <code>db</code> with properties <code>user</code> and <code>password</code>.</li>
</ol>
<p>But there are other trickier problems here. Let&#39;s change our NPM scripts to avoid single quotes around the values. We hope that now the environment variables are resolved correctly.</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;cy:run&quot;</span>: <span class="string">&quot;cypress run --env db.user=$DB_USERNAME,db.password=$PASSWORD&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cy:open&quot;</span>: <span class="string">&quot;cypress open --env db.user=$DB_USERNAME,db.password=$PASSWORD&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>At first, it appears to work</p>
<p><img src="/blog/images/cy-tips-and-tricks/simple.png" alt="The username and the password were passed correctly"></p>
<p>Now, let&#39;s try a user name with a space.</p>
<p><img src="/blog/images/cy-tips-and-tricks/incorrect.png" alt="The username is incorrect, the password is missing completely"></p>
<p>Ummm. The space inside the username value created problems; the <code>cypress open</code> command effectively received ended with <code>--env db.user=joe smith,db.password=123</code>. The part after <code>--env db.user=joe</code> was ignored!</p>
<p><strong>Solution:</strong> Cypress can grab the environment variables in <a target="_blank" rel="noopener" href="https://on.cypress.io/environment-variables">multiple ways</a>. The most powerful and flexible way is to grab them from the <code>process.env</code> object using the plugins code.</p>
<figure class="highlight js"><figcaption><span>cypress/plugins/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">on, config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> username = process.env.DB_USERNAME</span><br><span class="line">  <span class="keyword">const</span> password = process.env.PASSWORD</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!username) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`missing DB_USERNAME environment variable`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!password) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`missing PASSWORD environment variable`</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// form a very nice object</span></span><br><span class="line">  <span class="comment">// from the spec use Cypress.env(&#x27;db&#x27;) to access it</span></span><br><span class="line">  config.env.db = &#123;</span><br><span class="line">    username, password,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// make sure to return the updated `config` object</span></span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The plugins file runs in Node environment, has access to the <code>process.env</code> object. It can grab the variables, check their values, and place them into a single object <code>db</code>. Now the Settings tab shows the correct values.</p>
<p><img src="/blog/images/cy-tips-and-tricks/db.png" alt="The right &quot;db&quot; object with the username and password"></p>
<p>Additional reading: the blog post <a href="/blog/keep-passwords-secret-in-e2e-tests/" title="Keep passwords secret in E2E tests">Keep passwords secret in E2E tests</a> and the recipe <a target="_blank" rel="noopener" href="https://github.com/cypress-io/cypress-example-recipes#fundamentals">Environment variables</a>.</p>
<p><strong>Tip:</strong> when working locally you can use the utility <a target="_blank" rel="noopener" href="https://github.com/bahmutov/as-a">as-a</a> to conveniently inject environment variables when running any command.</p>
<h2><span id="parse-and-use-url">Parse and use URL</span></h2><p>Let&#39;s take a <a target="_blank" rel="noopener" href="https://nextjs.org/docs/routing/dynamic-routes">Next.js application with dynamic routes</a>. We can scaffold one using the <a target="_blank" rel="noopener" href="https://github.com/vercel/next.js/tree/canary/examples/dynamic-routing">provided example</a>.</p>
<blockquote class="pullquote"><p>You can find the complete source code at <a target="_blank" rel="noopener" href="https://github.com/bahmutov/dynamic-routing-app">bahmutov/dynamic-routing-app</a></p>
</blockquote>
<p>The app was initialized using the provided example command</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npx create-next-app --example dynamic-routing dynamic-routing-app</span></span><br></pre></td></tr></table></figure>
<p>The app contains two dynamic routes:</p>
<ol>
<li><code>pages/post/[id]/index.js</code><ul>
<li>e.g. matches <code>/post/my-example</code> (<code>/post/:id</code>)</li>
</ul>
</li>
<li><code>pages/post/[id]/[comment].js</code><ul>
<li>e.g. matches <code>/post/my-example/a-comment</code> (<code>/post/:id/:comment</code>)</li>
</ul>
</li>
</ol>
<p>Let&#39;s see how we can parse the above URLs to use them during tests. First we need to install Cypress and <a target="_blank" rel="noopener" href="https://github.com/bahmutov/start-server-and-test">start-server-and-test</a>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yarn add -D cypress start-server-and-test</span></span><br><span class="line">info Direct dependencies</span><br><span class="line">‚îú‚îÄ cypress@6.1.0</span><br><span class="line">‚îî‚îÄ start-server-and-test@1.11.6</span><br></pre></td></tr></table></figure>
<p>I can scaffold the Cypress files with my helper <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cly">bahmutov/cly</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npx @bahmutov/cly init</span></span><br></pre></td></tr></table></figure>
<p>We place the base url <code>localhost:3000</code> in <code>cypress.json</code> file and start the app and Cypress. Our first test can confirm the home page loads:</p>
<figure class="highlight js"><figcaption><span>cypress/integration/spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&#x27;Dynamic routes&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;loads home&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;Home&#x27;</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;First Post&#x27;</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;li&#x27;</span>, <span class="string">&#x27;Second Post&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/home.png" alt="Home test"></p>
<p>Great, we can make sure the link &quot;About&quot; goes to the &quot;About&quot; page.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;goes to the about page&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>).contains(<span class="string">&#x27;li a&#x27;</span>, <span class="string">&#x27;About&#x27;</span>).click()</span><br><span class="line">  cy.url().should(<span class="string">&#x27;match&#x27;</span>, <span class="regexp">/\/about$/</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test passes, but with a tiny red flag. Notice little eye crossed icons next to the &quot;contains&quot; command?</p>
<p><img src="/blog/images/cy-tips-and-tricks/eyes.png" alt="The link was invisible when clicked"></p>
<p>The Next.js application fetches a static HTML with the markup present but invisible. It is hydrated later - but we want to click on the link like a real user would, after it becomes visible. Let&#39;s add an assertion.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;goes to the about page&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>).contains(<span class="string">&#x27;li a&#x27;</span>, <span class="string">&#x27;About&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>).click()</span><br><span class="line">  cy.url().should(<span class="string">&#x27;match&#x27;</span>, <span class="regexp">/\/about$/</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Much better.</p>
<p><img src="/blog/images/cy-tips-and-tricks/visible-link.gif" alt="The link becomes visible and then is clicked"></p>
<p>We assert that we go to the right page by using the expression <code>cy.url().should(&#39;match&#39;, /\/about$/)</code>. It works, but the command <a target="_blank" rel="noopener" href="https://on.cypress.io/url">cy.url</a> returns the full URL. If you click on the command you will see what it yields:</p>
<p><img src="/blog/images/cy-tips-and-tricks/url.png" alt="cy.url yields the full application URL"></p>
<p>We are interested only in the relative pathname - the <code>/about</code> part. Thus I suggest using <a target="_blank" rel="noopener" href="https://on.cypress.io/location">cy.location</a> command that parses the URL and can yield just the interesting part.</p>
<p>Now let&#39;s check the first post. We can start with the same test as before</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;goes to the first post&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>).contains(<span class="string">&#x27;li a&#x27;</span>, <span class="string">&#x27;First Post&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>).click()</span><br><span class="line">  cy.location(<span class="string">&#x27;pathname&#x27;</span>).should(<span class="string">&#x27;equal&#x27;</span>, <span class="string">&#x27;/post/first&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/first-post.png" alt="Testing the first post"></p>
<p>Now let&#39;s go to the first command. We need to click on the link, but before we do this, let&#39;s validate it. Let&#39;s grab the current post url and use it somehow in our tests.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;goes to the first comment&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>).contains(<span class="string">&#x27;li a&#x27;</span>, <span class="string">&#x27;First Post&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>).click()</span><br><span class="line">  cy.location(<span class="string">&#x27;pathname&#x27;</span>).should(<span class="string">&#x27;include&#x27;</span>, <span class="string">&#x27;/post&#x27;</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">pathname</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;pathname is&#x27;</span>, pathname)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>After the assertion <code>.should(&#39;include&#39;, &#39;/post&#39;)</code> passes, the value is yielded to the next command where we print it.</p>
<p><img src="/blog/images/cy-tips-and-tricks/pathname-print.png" alt="Getting the pathname after the page navigation"></p>
<p>Now we have all the JavaScript magic we need to parse and slice URL. Let&#39;s even change the test and go to the second comment of the first post.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;goes to the first post / second comment&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>).contains(<span class="string">&#x27;li a&#x27;</span>, <span class="string">&#x27;First Post&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>).click()</span><br><span class="line">  cy.location(<span class="string">&#x27;pathname&#x27;</span>)</span><br><span class="line">    .should(<span class="string">&#x27;include&#x27;</span>, <span class="string">&#x27;/post&#x27;</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">pathname</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// pathname is like &quot;/post/[id]&quot;</span></span><br><span class="line">      <span class="comment">// ignore first two items from the split</span></span><br><span class="line">      <span class="keyword">const</span> [, , post] = pathname.split(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">      expect(post, <span class="string">&#x27;first post&#x27;</span>).to.equal(<span class="string">&#x27;first&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// there should be a link to the second post</span></span><br><span class="line">      <span class="keyword">const</span> commentUrl = <span class="string">`/post/<span class="subst">$&#123;post&#125;</span>/second-comment`</span></span><br><span class="line">      cy.get(<span class="string">`a[href=&quot;<span class="subst">$&#123;commentUrl&#125;</span>&quot;]`</span>).should(<span class="string">&#x27;be.visible&#x27;</span>).click()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// let&#x27;s validate every part of the URL&#x27;s pathname</span></span><br><span class="line">  cy.location(<span class="string">&#x27;pathname&#x27;</span>).should(<span class="function"><span class="params">pathname</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// pathname is like &quot;/post/[id]/[comment]&quot;</span></span><br><span class="line">    <span class="keyword">const</span> [, , post, comment] = pathname.split(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    expect(post, <span class="string">&#x27;post id&#x27;</span>).to.equal(<span class="string">&#x27;first&#x27;</span>)</span><br><span class="line">    expect(comment, <span class="string">&#x27;comment id&#x27;</span>).to.equal(<span class="string">&#x27;second-comment&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>We can parse, validate, and use the URL in our test.</p>
<p><img src="/blog/images/cy-tips-and-tricks/second-comment.png" alt="Using parsed URL to browse to the second comment"></p>
<h2><span id="deal-with-target_blank">Deal with <code>target=_blank</code></span></h2><p>Imagine a link on the page uses <code>&lt;a href=&quot;/about.html&quot; target=&quot;_blank&quot;&gt;About&lt;/a&gt;</code>. Cypress does not work with the second tab, so what can we do?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;loads the about page&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;a&#x27;</span>).click()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/second-tab.gif" alt="Test opens the second tab invisible to Cypress"></p>
<p>Figure out what you want to test. You can for example verify the link has the expected address and attribute <code>target=_blank</code> and call it a day.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;loads the about page&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;a&#x27;</span>).should($a =&gt; &#123;</span><br><span class="line">    expect($a.attr(<span class="string">&#x27;href&#x27;</span>), <span class="string">&#x27;href&#x27;</span>).to.equal(<span class="string">&#x27;/about.html&#x27;</span>)</span><br><span class="line">    expect($a.attr(<span class="string">&#x27;target&#x27;</span>), <span class="string">&#x27;target&#x27;</span>).to.equal(<span class="string">&#x27;_blank&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/a-attr.png" alt="Test confirms the anchor link&#39;s attributes"></p>
<p>We can also change the target attribute before clicking the link (but after confirming it to be blank). Then we can verify the second &quot;tab&quot; loads correctly.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;loads the about page&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;a&#x27;</span>).should($a =&gt; &#123;</span><br><span class="line">    expect($a.attr(<span class="string">&#x27;href&#x27;</span>), <span class="string">&#x27;href&#x27;</span>).to.equal(<span class="string">&#x27;/about.html&#x27;</span>)</span><br><span class="line">    expect($a.attr(<span class="string">&#x27;target&#x27;</span>), <span class="string">&#x27;target&#x27;</span>).to.equal(<span class="string">&#x27;_blank&#x27;</span>)</span><br><span class="line">    $a.attr(<span class="string">&#x27;target&#x27;</span>, <span class="string">&#x27;_self&#x27;</span>)</span><br><span class="line">  &#125;).click()</span><br><span class="line">  cy.location(<span class="string">&#x27;pathname&#x27;</span>).should(<span class="string">&#x27;equal&#x27;</span>, <span class="string">&#x27;/about.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/second-tab-same.gif" alt="Test opens the target link in the same tab"></p>
<h2><span id="deal-with-windowopen">Deal with <code>window.open</code></span></h2><p>Imagine the application under test uses <code>window.open()</code> to load a new URL in the second tab.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/about.html&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.querySelector(<span class="string">&#x27;a&#x27;</span>).addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line">    e.preventDefault()</span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.open(<span class="string">&#x27;/about.html&#x27;</span>)</span></span><br><span class="line">  &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>By default the <code>/about.html</code> page opens in a new tab - and we do not want that. Let&#39;s stub the <code>window.open</code> method instead.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;opens the about page&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">  cy.window().then(<span class="function"><span class="params">win</span> =&gt;</span> &#123;</span><br><span class="line">    cy.stub(win, <span class="string">&#x27;open&#x27;</span>).as(<span class="string">&#x27;open&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.get(<span class="string">&#x27;a&#x27;</span>).click()</span><br><span class="line">  cy.get(<span class="string">&#x27;@open&#x27;</span>).should(<span class="string">&#x27;have.been.calledOnceWithExactly&#x27;</span>, <span class="string">&#x27;/about.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/stub-window-open.png" alt="Test stubs the window.open method"></p>
<p>If we really want to load the new URL, let&#39;s call the original <code>window.open</code> method, passing <code>_self</code> as the second parameter.</p>
<p><strong>Tip:</strong> use <code>&lt;method&gt;.wrappedMethod</code> to get to the original method wrapped in Sinon stub. When we call <code>cy.stub(win, &#39;open&#39;)</code> it replaces <code>win.open</code> method with a Sinon stub function. If we want to call the <em>real</em> <code>win.open</code> method, we can use the reference to the saved original function: the <code>win.open.wrappedMethod</code> is the original unstubbed <code>win.open</code> method.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;opens the about page&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">  cy.window().then(<span class="function"><span class="params">win</span> =&gt;</span> &#123;</span><br><span class="line">    cy.stub(win, <span class="string">&#x27;open&#x27;</span>).callsFake(<span class="function">(<span class="params">url, target</span>) =&gt;</span> &#123;</span><br><span class="line">      expect(target).to.be.undefined</span><br><span class="line">      <span class="comment">// call the original `win.open` method</span></span><br><span class="line">      <span class="comment">// but pass the `_self` argument</span></span><br><span class="line">      <span class="keyword">return</span> win.open.wrappedMethod.call(win, url, <span class="string">&#x27;_self&#x27;</span>)</span><br><span class="line">    &#125;).as(<span class="string">&#x27;open&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.get(<span class="string">&#x27;a&#x27;</span>).click()</span><br><span class="line">  cy.get(<span class="string">&#x27;@open&#x27;</span>).should(<span class="string">&#x27;have.been.calledOnceWithExactly&#x27;</span>, <span class="string">&#x27;/about.html&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/win-open.gif" alt="Test redirects `window.open` target"></p>
<p><strong>See also:</strong> the post <a href="/blog/stub-window-open/" title="Stub window.open">Stub window.open</a> and video <a target="_blank" rel="noopener" href="https://youtu.be/eOEDCmqpMjE">cy.stub: stub a method on the window object</a></p>
<h2><span id="deal-with-windowlocationreplace">Deal with <code>window.location.replace</code></span></h2><p>Imagine, our <code>index.html</code> does the following:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>First page<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// console.log(&#x27;app window is&#x27;, window)</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">window</span>.location.replace(<span class="string">&#x27;https://www.cypress.io&#x27;</span>)</span></span><br><span class="line">    &#125;, 2000)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>The redirect causes problems, as we cannot access the new origin from the test. We cannot simply stub the <code>location.replace</code> method - this property (and pretty much every property on the <code>location</code> object) is locked down; it is neither writable, nor configurable.</p>
<p><img src="/blog/images/cy-tips-and-tricks/descriptors.png" alt="The `window.location` property descriptors"></p>
<p>Thus we cannot use <code>cy.stub(win.location, &#39;replace&#39;)</code>. We cannot replace <code>window.location</code> property either - because it too is locked down. Instead we need to modify our application&#39;s code to avoid using the <code>window.location.replace</code> method completely.</p>
<p>During the test, we can use the <a target="_blank" rel="noopener" href="https://on.cypress.io/intercept">cy.intercept</a> command to modify the application code. For example, it could call <code>window.__location.replace</code> instead. Our test would create this dummy <code>window.__location</code> object before the application loads.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"><span class="comment">// https://gitter.im/cypress-io/cypress?at=60b6cfadbdecf719a091b355</span></span><br><span class="line">it(<span class="string">&#x27;replaces&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.on(<span class="string">&#x27;window:before:load&#x27;</span>, <span class="function">(<span class="params">win</span>) =&gt;</span> &#123;</span><br><span class="line">    win.__location = &#123;</span><br><span class="line">      replace: cy.stub().as(<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  cy.intercept(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>, <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">    req.continue(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      res.body = res.body.replaceAll(</span><br><span class="line">        <span class="string">&#x27;window.location.replace&#x27;</span>, <span class="string">&#x27;window.__location.replace&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).as(<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  cy.visit(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line">  cy.wait(<span class="string">&#x27;@index&#x27;</span>)</span><br><span class="line">  cy.contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;First page&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;@replace&#x27;</span>).should(<span class="string">&#x27;have.been.calledOnceWith&#x27;</span>, <span class="string">&#x27;https://www.cypress.io&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test runs and passes. Notice there is no redirect, and our stub and intercept were called.</p>
<p><img src="/blog/images/cy-tips-and-tricks/replace.png" alt="The passing test"></p>
<p>You can inspect the document the browser receives after the intercept replaced the <code>window.location</code> with <code>window.__location</code> string. The replacement happens at the proxy level, before the response is sent to the browser. See the presentation <a target="_blank" rel="noopener" href="https://slides.com/bahmutov/how-cy-intercept-works">How cy.intercept works</a> for details.</p>
<p><img src="/blog/images/cy-tips-and-tricks/document.png" alt="The HTML source the browser receives"></p>
<p>You can watch the above explanation in this <a target="_blank" rel="noopener" href="https://youtu.be/mML36U62-fQ">video</a></p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/mML36U62-fQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>

<h2><span id="minimize-memory-use">Minimize memory use</span></h2><p>Sometimes Cypress can crash during CI run due to running out of memory. Typically it shows a message like this:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">10:38:58 AM: We detected that the Chromium Renderer process just crashed.</span><br><span class="line">10:38:58 AM:</span><br><span class="line">10:38:58 AM: This is the equivalent to seeing the &#x27;sad face&#x27; when Chrome dies.</span><br><span class="line">10:38:58 AM:</span><br><span class="line">10:38:58 AM: This can happen for a number of different reasons:</span><br><span class="line">10:38:58 AM:</span><br><span class="line">10:38:58 AM: - You wrote an endless loop and you must fix your own code</span><br><span class="line">10:38:58 AM: - There is a memory leak in Cypress (unlikely but possible)</span><br><span class="line">10:38:58 AM: - You are running Docker (there is an easy fix for this: see link below)</span><br><span class="line">10:38:58 AM: - You are running lots of tests on a memory intense application</span><br><span class="line">10:38:58 AM: - You are running in a memory starved VM environment</span><br><span class="line">10:38:58 AM: - There are problems with your GPU / GPU drivers</span><br><span class="line">10:38:58 AM: - There are browser bugs in Chromium</span><br><span class="line">10:38:58 AM:</span><br><span class="line">10:38:58 AM: You can learn more including how to fix Docker here:</span><br><span class="line">10:38:58 AM:</span><br><span class="line">10:38:58 AM: https://on.cypress.io/renderer-process-crashed</span><br></pre></td></tr></table></figure>
<p>You can <a target="_blank" rel="noopener" href="https://on.cypress.io/troubleshooting#Log-memory-and-CPU-usage">profile memory usage</a> every second with environment variables</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export DEBUG=cypress:server:util:process_profiler</span><br><span class="line">export CYPRESS_PROCESS_PROFILER_INTERVAL=1000</span><br><span class="line">cypress run</span><br></pre></td></tr></table></figure>
<p>The things you can do to minimize the amount of memory used:</p>
<ul>
<li>try running tests without extra reporters, plugins, and preprocessors</li>
<li>split specs to have fewer tests per spec. Cypress opens and closes the browser for every spec</li>
<li>turn the video recording off with <code>video: false</code> using <code>cypress.json</code> or environment variables</li>
<li>turn the <a target="_blank" rel="noopener" href="https://on.cypress.io/troubleshooting#Disable-the-Command-Log">command log off</a> using the environment variable <code>CYPRESS_NO_COMMAND_LOG=1</code></li>
<li>expose garbage collection and running it after each test. See <a target="_blank" rel="noopener" href="https://github.com/cypress-io/cypress/issues/8525">issue 8525</a>, but in general for Electron browser you want to use an environment variable <code>ELECTRON_EXTRA_LAUNCH_ARGS=--js-flags=--expose_gc</code> and from the test call <code>window.gc()</code> method if available</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">afterEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.window().then(<span class="function"><span class="params">win</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (win.gc) &#123;</span><br><span class="line">      gc();</span><br><span class="line">      gc();</span><br><span class="line">      gc();</span><br><span class="line">      gc();</span><br><span class="line">      gc();</span><br><span class="line">      cy.wait(<span class="number">1000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>Tip:</strong> if Electron keeps crushing, try running tests using Chrome or Firefox browsers.</p>
<h2><span id="start-browser-with-specific-time-zone">Start browser with specific time zone</span></h2><p>You can start Cypress (and thus the browser it spawns) with specific time zone to see how the application handles it.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ &lt;timezone&gt; npx cypress open</span><br><span class="line"># for example</span><br><span class="line">$ TZ&#x3D;Asia&#x2F;Tokyo npx cypress open</span><br></pre></td></tr></table></figure>
<p>Typical time zones are <code>America/New_York</code>, <code>Europe/Berlin</code>, <code>Europe/London</code>, <code>Asia/Tokyo</code>.</p>
<p><strong>Tip:</strong> an application can obtain its time zone using the following code snippet</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Intl</span>.DateTimeFormat().resolvedOptions().timeZone</span><br><span class="line"><span class="comment">// &quot;America/New_York&quot;</span></span><br></pre></td></tr></table></figure>
<p>For more information, read <a href="/blog/testing-timezones/" title="Testing Time Zones in Parallel">Testing Time Zones in Parallel</a></p>
<h2><span id="scaffold-the-new-projects-faster">Scaffold the new projects faster</span></h2><p>By default every new project scaffolds example specs when you run <code>cypress open</code> for the very first time. I have written an utility <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cly">@bahmutov/cly</a> to scaffold a sample project without opening Cypress and then deleting the many scaffolded spec files.</p>
<p>You still need to install Cypress as a dev dependency first, but then you can do</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i -D cypress</span><br><span class="line">npx @bahmutov&#x2F;cly init</span><br></pre></td></tr></table></figure>
<p>You can scaffold a TypeScript or a bare-bones projects</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># adds appropriate tsconfig.json</span><br><span class="line">npx @bahmutov&#x2F;cly init --typescript</span><br><span class="line"># simple single spec without any fixtures, plugins, support files</span><br><span class="line">npx @bahmutov&#x2F;cly init --bare</span><br></pre></td></tr></table></figure>
<p>Watch me scaffolding new projects in the video below</p>
<center>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/g9ToLSD_lbQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>

<h2><span id="install-chromium-via-puppeteer">Install Chromium via Puppeteer</span></h2><p>Sometimes the CI machine you want to run tests on does not have Chrome installed, but you really want to use it to run your tests. For example, Chrome is more stable and crashes less often than Electron. If you cannot install Chrome browser using &quot;normal&quot; commands, you can install Chromium by installing <a target="_blank" rel="noopener" href="https://github.com/puppeteer/puppeteer#readme">Puppeteer</a> NPM dependency.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i -D puppeteer</span><br><span class="line">## or use Yarn</span><br><span class="line">yarn add -D puppeteer</span><br></pre></td></tr></table></figure>
<p>From the plugin file we can find the browser and insert it into the list of other system browsers discovered by Cypress.</p>
<figure class="highlight js"><figcaption><span>cypress/plugins/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (on, config) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browserFetcher = puppeteer.createBrowserFetcher()</span><br><span class="line">  <span class="keyword">const</span> revisions = <span class="keyword">await</span> browserFetcher.localRevisions()</span><br><span class="line">  <span class="keyword">if</span> (revisions.length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">&#x27;Could not find local Chromium browser&#x27;</span>)</span><br><span class="line">    <span class="comment">// still use the local browsers</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> info = <span class="keyword">await</span> browserFetcher.revisionInfo(revisions[<span class="number">0</span>])</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;found Chromium %o&#x27;</span>, info)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> chromium = &#123;</span><br><span class="line">    name: <span class="string">&#x27;chromium&#x27;</span>,</span><br><span class="line">    family: <span class="string">&#x27;chromium&#x27;</span>,</span><br><span class="line">    displayName: <span class="string">&#x27;Chromium&#x27;</span>,</span><br><span class="line">    version: info.revision,</span><br><span class="line">    majorVersion: info.revision,</span><br><span class="line">    path: info.executablePath,</span><br><span class="line">    channel: <span class="string">&#x27;dev&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  config.browsers.push(chromium)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Open Cypress and you should see &quot;Chromium&quot; in the drop down list of browsers.</p>
<p><img src="/blog/images/cy-tips-and-tricks/chromium.png" alt="Chromium browser in the drop down list"></p>
<p><strong>Tip:</strong> if you have problems with Cypress browser detection, run it with <code>DEBUG=cypress:server:browsers</code> environment variable.</p>
<p>To pick the Chromium browser in headless mode use the command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npx cypress run --browser chromium --headless</span><br><span class="line">## or using Yarn</span><br><span class="line">yarn cypress run --browser chromium --headless</span><br></pre></td></tr></table></figure>
<p>See my example project <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-chromium-via-puppeteer-example">cypress-chromium-via-puppeteer-example</a>.</p>
<p><strong>Tip:</strong> if you need to skip installing Puppeteer in some circumstances, use the environment variable <code>PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true</code>. I use this variable on some CIs to avoid waiting for the Chromium to download if I do not plan to run E2E tests in Chromium.</p>
<h2><span id="create-aliases-before-each-test">Create aliases before each test</span></h2><p>If you create aliases using <a target="_blank" rel="noopener" href="https://on.cypress.io/as">.as</a> command, remember that aliases are reset before each test. Thus you cannot create them in the <code>before</code> hook and use from the <em>second</em> test:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">before(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.wrap(<span class="string">&#x27;some value&#x27;</span>).as(<span class="string">&#x27;exampleValue&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;works in the first test&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.get(<span class="string">&#x27;@exampleValue&#x27;</span>).should(<span class="string">&#x27;equal&#x27;</span>, <span class="string">&#x27;some value&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// NOTE the second test is failing because the alias is reset</span></span><br><span class="line">it(<span class="string">&#x27;does not exist in the second test&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// there is not alias because it is created once before</span></span><br><span class="line">  <span class="comment">// the first test, and is reset before the second test</span></span><br><span class="line">  cy.get(<span class="string">&#x27;@exampleValue&#x27;</span>).should(<span class="string">&#x27;equal&#x27;</span>, <span class="string">&#x27;some value&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Instead, create the aliases using <code>beforeEach</code> hook</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">beforeEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// we will create a new alias before each test</span></span><br><span class="line">  cy.wrap(<span class="string">&#x27;some value&#x27;</span>).as(<span class="string">&#x27;exampleValue&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;works in the first test&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.get(<span class="string">&#x27;@exampleValue&#x27;</span>).should(<span class="string">&#x27;equal&#x27;</span>, <span class="string">&#x27;some value&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;works in the second test&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.get(<span class="string">&#x27;@exampleValue&#x27;</span>).should(<span class="string">&#x27;equal&#x27;</span>, <span class="string">&#x27;some value&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2><span id="hover-command">Hover command</span></h2><p>See <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cy-hover-example">bahmutov/cy-hover-example</a> for links.</p>
<h2><span id="wait-for-data">Wait for data</span></h2><p><strong>Tip:</strong> see the tested example at <a href="https://glebbahmutov.com/cypress-examples/recipes/wait-for-data">cypress-examples &quot;Wait for data&quot; recipe</a></p>
<p>Imagine we have a variable that later will receive some data. How do we retry the check from the test? Imagine we are waiting for a specific network request, and once it arrives it saves the list sent by the application.</p>
<p>Let me show you what <em>will not work</em>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list</span><br><span class="line"><span class="comment">// spy on the POST requests</span></span><br><span class="line">cy.intercept(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/users&#x27;</span>, <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(req.body)) &#123;</span><br><span class="line">    list = req.body</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">cy.get(<span class="string">&#x27;#post-list&#x27;</span>).click()</span><br><span class="line"><span class="comment">// üö® DOES NOT WORK</span></span><br><span class="line">expect(list).to.be.an(<span class="string">&#x27;array&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>The above code does not work because the <code>expect(list).to.be.an(&#39;array&#39;)</code> runs <em>before</em> the <code>cy.get(&#39;#post-list&#39;).click()</code> executes. The <code>expect</code> is immediate, while <code>cy.get</code> is chained and delayed.</p>
<p>You might delay checking the <code>list</code> by moving it into <code>.then</code> callback to be executed <em>after</em> the <code>.click()</code> command:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list</span><br><span class="line"><span class="comment">// spy on the POST requests</span></span><br><span class="line">cy.intercept(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/users&#x27;</span>, <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(req.body)) &#123;</span><br><span class="line">    list = req.body</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">cy.get(<span class="string">&#x27;#post-list&#x27;</span>).click()</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// üö® DOES NOT WORK</span></span><br><span class="line">    expect(list).to.be.an(<span class="string">&#x27;array&#x27;</span>)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>The above code is slightly more correct, but is still wrong. It will check the value of the <code>list</code> variable AFTER clicking on the button, but without auto-retries, it will only check <em>once</em>. What are the chances that the <code>cy.intercept</code> worked by then? Pretty much zero.</p>
<p>We need to retry checking the <code>list</code>, which we can do by changing the <code>.then</code> to <code>.should</code> command. The <code>.should(cb)</code> is retried automatically. Thus our first solution is to use the <code>cy.should(callback)</code> command:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list</span><br><span class="line"><span class="comment">// spy on the POST requests</span></span><br><span class="line">cy.intercept(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/users&#x27;</span>, <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(req.body)) &#123;</span><br><span class="line">    list = req.body</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">cy.get(<span class="string">&#x27;#post-list&#x27;</span>).click()</span><br><span class="line">  .should(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// need to somehow wait for the list to be defined</span></span><br><span class="line">    <span class="comment">// we cannot simply do expect(list).to.be.defined</span></span><br><span class="line">    <span class="comment">// since it will be just evaluated once</span></span><br><span class="line">    <span class="comment">// instead we need to use cy.should() assertions</span></span><br><span class="line">    expect(list).to.be.an(<span class="string">&#x27;array&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// now that we have the list let&#x27;s yield it</span></span><br><span class="line">    <span class="keyword">return</span> list</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// now the assertions will run against the list</span></span><br><span class="line">  .should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>You can see the solution working in the recording below, where the application requests the data after about 1.3 second delay.</p>
<p><img src="/blog/images/cy-tips-and-tricks/wait-for-data-should.gif" alt="Waiting for data using cy.should command"></p>
<p>We can improve this solution a little bit by using <a target="_blank" rel="noopener" href="https://on.cypress.io/wrap">cy.wrap</a> command. We can wrap a reference to an object, and the intercept will set a property inside that object. This &quot;trick&quot; allows us to use implicit assertions completely bypassing the need for &quot;.then&quot; callbacks.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// instead of a plain variable, store the list</span></span><br><span class="line"><span class="comment">// as a property of an object</span></span><br><span class="line"><span class="keyword">const</span> data = &#123;&#125;</span><br><span class="line"><span class="comment">// spy on the POST requests</span></span><br><span class="line">cy.intercept(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/users&#x27;</span>, <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(req.body)) &#123;</span><br><span class="line">    data.list = req.body</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">cy.get(<span class="string">&#x27;#post-list&#x27;</span>).click()</span><br><span class="line"><span class="comment">// the &quot;data&quot; variable is going to be the same</span></span><br><span class="line"><span class="comment">// only its contents is going to change. Thus we</span></span><br><span class="line"><span class="comment">// can wrap the &quot;data&quot; variable right away</span></span><br><span class="line">cy.wrap(data)</span><br><span class="line">  <span class="comment">// note that &quot;have.property&quot; assertion is special,</span></span><br><span class="line">  <span class="comment">// it yields the property!</span></span><br><span class="line">  .should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;list&#x27;</span>)</span><br><span class="line">  <span class="comment">// thus the next assertion runs against the &quot;data.list&quot; value</span></span><br><span class="line">  .should(<span class="string">&#x27;be.an&#x27;</span>, <span class="string">&#x27;array&#x27;</span>)</span><br><span class="line">  <span class="comment">// and now the assertions will run against the list</span></span><br><span class="line">  .and(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/cy-tips-and-tricks/wait-for-data-wrap.gif" alt="Waiting for data using cy.wrap command"></p>
<h2><span id="make-http-requests">Make HTTP requests</span></h2><p>Read <a href="/blog/cypress-request-and-cookies/" title="Cypress request and cookies">Cypress request and cookies</a></p>
<h2><span id="restart-the-tests">Restart the tests</span></h2><p>You can programmatically click the &quot;Re-run&quot; tests button from code to restart the tests</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.top.document.querySelector(<span class="string">&#x27;.reporter .restart&#x27;</span>).click()</span><br></pre></td></tr></table></figure>
<p>See <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-grep">cypress-grep</a> and <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-watch-and-reload">cypress-watch-and-reload</a> examples.</p>
<h2><span id="wait-for-network-idle">Wait for network idle</span></h2><p>Cypress is just JavaScript, and with the new <a target="_blank" rel="noopener" href="https://on.cypress.io/intercept">cy.intercept</a> you can implement your own &quot;wait for the network to be idle for N seconds&quot; feature.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;waits for network to be idle for 1 second&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> lastNetworkAt</span><br><span class="line">  cy.intercept(<span class="string">&#x27;*&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    lastNetworkAt = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// load the page, but delay loading of the data</span></span><br><span class="line">  cy.visit(<span class="string">&#x27;/?delay=800&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// wait for network to be idle for 1 second</span></span><br><span class="line">  <span class="keyword">const</span> started = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  cy.wrap(<span class="string">&#x27;network idle for 1 sec&#x27;</span>).should(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> t = lastNetworkAt || started</span><br><span class="line">    <span class="keyword">const</span> elapsed = +<span class="keyword">new</span> <span class="built_in">Date</span>() - t</span><br><span class="line">    <span class="keyword">if</span> (elapsed &lt; <span class="number">1000</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;Network is busy&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// by now everything should have been loaded</span></span><br><span class="line">  <span class="comment">// we can check by using very short timeout</span></span><br><span class="line">  cy.get(<span class="string">&#x27;.todo-list li&#x27;</span>, &#123; <span class="attr">timeout</span>: <span class="number">10</span> &#125;).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2><span id="check-if-the-network-call-has-not-been-made">Check if the network call has not been made</span></h2><p>Here is a test that confirms a specific network call is NOT made until the application adds a new item.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;does not make POST /todos request on load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// a cy.spy() creates a &quot;pass-through&quot; function</span></span><br><span class="line">  <span class="comment">// that can function as a network interceptor that does nothing</span></span><br><span class="line">  cy.intercept(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/todos&#x27;</span>, cy.spy().as(<span class="string">&#x27;post&#x27;</span>))</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  <span class="comment">// in order to confirm the network call was not made</span></span><br><span class="line">  <span class="comment">// we need to wait for something to happen, like the application</span></span><br><span class="line">  <span class="comment">// loading or some time passing</span></span><br><span class="line">  cy.wait(<span class="number">1000</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;@post&#x27;</span>).should(<span class="string">&#x27;not.have.been.called&#x27;</span>)</span><br><span class="line">  <span class="comment">// add a new item through the page UI</span></span><br><span class="line">  cy.get(<span class="string">&#x27;.new-todo&#x27;</span>).type(<span class="string">&#x27;a new item&#123;enter&#125;&#x27;</span>)</span><br><span class="line">  <span class="comment">// now the network call should have been made</span></span><br><span class="line">  cy.get(<span class="string">&#x27;@post&#x27;</span>)</span><br><span class="line">    .should(<span class="string">&#x27;have.been.calledOnce&#x27;</span>)</span><br><span class="line">    <span class="comment">// confirm the network call was made with the correct data</span></span><br><span class="line">    <span class="comment">// get the first object to the first call</span></span><br><span class="line">    .its(<span class="string">&#x27;args.0.0.body&#x27;</span>)</span><br><span class="line">    .should(<span class="string">&#x27;deep.include&#x27;</span>, &#123;</span><br><span class="line">      title: <span class="string">&#x27;a new item&#x27;</span>,</span><br><span class="line">      completed: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2><span id="find-good-cypress-examples">Find good Cypress examples</span></h2><p>You can find good Cypress example repositories by searching GitHub using topic <code>cypress-example</code> and user <code>bahmutov</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">github.com: topic:cypress-example user:bahmutov</span><br></pre></td></tr></table></figure>
<p>Here is <a target="_blank" rel="noopener" href="https://github.com/search?q=topic%3Acypress-example+user%3Abahmutov&amp;ref=opensearch">direct link</a> to the results.</p>
<p>Similarly, you can search for this topic under organization name <code>cypress-io</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">github.com: topic:cypress-example user:cypress-io</span><br></pre></td></tr></table></figure>
<p>Here is the <a target="_blank" rel="noopener" href="https://github.com/search?q=topic%3Acypress-example+user%3Acypress-io">direct link</a> to the results.</p>
<h2><span id="use-cylog-to-print-to-the-command-log">Use cy.log to print to the Command Log</span></h2><p>You can print the output of a command or a task using the <a target="_blank" rel="noopener" href="https://on.cypress.io/log">cy.log</a> command. For example, lets print the object yielded from a task</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cy.task(<span class="string">&#x27;getImageResolution&#x27;</span>, <span class="string">&#x27;test-smile.png&#x27;</span>).then(cy.log)</span><br></pre></td></tr></table></figure>
<p>If the object is large, <code>cy.log</code> shortens it and just prints <code>Object&#123;N&#125;</code> where <code>N</code> is the number of properties. We can print the entire object by passing it through a <code>JSON.stringify</code> method first.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cy.task(<span class="string">&#x27;getImageResolution&#x27;</span>, <span class="string">&#x27;test-smile.png&#x27;</span>)</span><br><span class="line">  .then(<span class="built_in">JSON</span>.stringify)</span><br><span class="line">  .then(cy.log)</span><br></pre></td></tr></table></figure>
<p><img src="../images/cy-tips-and-tricks/print.png" alt="Object printed using cy.log"></p>
<p>Because <code>cy.log</code> returns void, it does not change the current subject, and yields its argument to the next Cypress command.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cy.task(<span class="string">&#x27;getImageResolution&#x27;</span>, <span class="string">&#x27;test-smile.png&#x27;</span>)</span><br><span class="line">  .then(<span class="built_in">JSON</span>.stringify)</span><br><span class="line">  .then(cy.log)</span><br><span class="line">  .then(<span class="built_in">JSON</span>.parse) <span class="comment">// get back the object</span></span><br><span class="line">  .should(<span class="string">&#x27;include.all.keys&#x27;</span>, [<span class="string">&#x27;width&#x27;</span>, <span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;filename&#x27;</span>, <span class="string">&#x27;format&#x27;</span>])</span><br><span class="line">  .and(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;format&#x27;</span>, <span class="string">&#x27;PNG&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>You can watch this example in this short video</p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/SgTsCJCujNw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>

<h3><span id="log-error-before-throwing-it">Log error before throwing it</span></h3><p>If you are making a request and want to log the possible errors, use <code>.then</code> + <code>cy.log</code> combination before an assertion.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cy.request(&#123; ... &#125;)</span><br><span class="line">  .its(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">body</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (body.errors) &#123;</span><br><span class="line">      <span class="comment">// make the errors visible in the Command Log</span></span><br><span class="line">      cy.log(<span class="built_in">JSON</span>.stringify(body.errors, <span class="literal">null</span>, <span class="number">2</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// because .then returns undefined</span></span><br><span class="line">    <span class="comment">// the previous subject is yielded to the next assertion</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .should(<span class="string">&#x27;not.have.key&#x27;</span>, <span class="string">&#x27;errors&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2><span id="use-a-single-cycontains-command">Use a single cy.contains command</span></h2><p>Instead of using <code>cy.get(selector).contains(text).should(&#39;exist&#39;)</code> chain, you can simply use</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cy.contains(selector, text)</span><br></pre></td></tr></table></figure>
<ol>
<li>The assertion <code>should(&#39;exist&#39;)</code> is already built into <a target="_blank" rel="noopener" href="https://on.cypress.io/contains">cy.contains</a> command</li>
<li>The single command will be retried until the text appears or the command times out</li>
</ol>
<p>Watch <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=VSIaDbv4GyE">this short video</a> to see the single command in action.</p>
<h2><span id="disable-save-credit-card-prompt">Disable Save Credit Card prompt</span></h2><p>Sometimes when you fill a credit card form during the test, the Chrome browser asks if you want to save the credit card numbers.</p>
<p><img src="../images/cy-tips-and-tricks/save-card-prompt.png" alt="Save card browser prompt"></p>
<p>Note: I have taken the credit card example from <a target="_blank" rel="noopener" href="https://codesandbox.io/s/9y8vkrrx9o">this example</a> and ran it locally.</p>
<p>In order to stop Chrome browser from ever asking to store payment methods, you could navigate to the special <code>chrome://settings/payments</code> URL and flip the switch:</p>
<p><img src="../images/cy-tips-and-tricks/payment.png" alt="The browser payment settings"></p>
<p>Unfortunately, I could not find an equivalent <a target="_blank" rel="noopener" href="https://peter.sh/experiments/chromium-command-line-switches/">Chrome command line switch</a> to turn it off when <a target="_blank" rel="noopener" href="https://on.cypress.io/browser-launch-api">launching the browser</a>. Thus I needed another way.</p>
<h3><span id="turning-the-credit-card-save-prompt-off-by-changing-the-placeholder-text">Turning the credit card save prompt off by changing the placeholder text</span></h3><p>In my particular example I found that the browser did not show the &quot;Save Credit Card&quot; prompt if the place holder text did not include &quot;credit&quot; or &quot;number&quot; words.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># shows the card save prompt</span><br><span class="line">placeholder=&quot;Card Number&quot;</span><br><span class="line"># does not show the card save prompt</span><br><span class="line">placeholder=&quot;Card Digits&quot;</span><br></pre></td></tr></table></figure>
<p>Unfortunately, you could not change the placeholder attribute after the page has loaded. The test code below did not work:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// changing the placeholder attribute</span></span><br><span class="line"><span class="comment">// before clicking the Submit button</span></span><br><span class="line"><span class="comment">// does not prevent the card save prompt</span></span><br><span class="line">cy.get(<span class="string">&#x27;[name=number]&#x27;</span>)</span><br><span class="line">  .invoke(<span class="string">&#x27;attr&#x27;</span>, <span class="string">&#x27;placeholder&#x27;</span>, <span class="string">&#x27;Card digits&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>Thus I have change the application&#39;s HTML values.</p>
<h3><span id="turning-the-credit-card-save-prompt-off-by-using-autocomplete-off">Turning the credit card save prompt off by using autocomplete off</span></h3><p>In another credit card form example, I was able to successfully turn off the credit card save prompt by adding an attribute <code>autocomplete=off</code> on the form element itself.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get to the form that surrounds the credit card</span></span><br><span class="line"><span class="comment">// and set the autocomplete=off attribute</span></span><br><span class="line">cy.get(<span class="string">&#x27;form&#x27;</span>)</span><br><span class="line">  .invoke(<span class="string">&#x27;attr&#x27;</span>, <span class="string">&#x27;autocomplete&#x27;</span>, <span class="string">&#x27;off&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>Try it - it might work for you.</p>
<h2><span id="print-timestamp-with-the-error-message">Print timestamp with the error message</span></h2><p>By default a failed test just prints the error message. You might want to have the timestamp to better debug the failure. The way to do this is to modify the error message in the <a target="_blank" rel="noopener" href="https://on.cypress.io/catalog-of-events">failure event handler</a>. This is what I have done in Cypress v8:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// register error handler to catch any errors thrown during tests</span></span><br><span class="line"><span class="comment">// https://on.cypress.io/catalog-of-events</span></span><br><span class="line">Cypress.on(<span class="string">&#x27;fail&#x27;</span>, <span class="function">(<span class="params">error, runnable</span>) =&gt;</span> &#123;</span><br><span class="line">  error.message = <span class="keyword">new</span> <span class="built_in">Date</span>().toUTCString() + <span class="string">&#x27;\n&#x27;</span> + error.message</span><br><span class="line">  <span class="keyword">throw</span> error <span class="comment">// throw error to have test still fail</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>I am using the <code>Cypress.on</code> method instead of <code>cy.on</code> to make the handler apply to every test. Here is the failing test</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f = &#123;</span><br><span class="line">  <span class="function"><span class="title">failme</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;I am out!&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;prints error with timestamp&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// this test fails on purpose</span></span><br><span class="line">  cy.wait(<span class="number">2000</span>)</span><br><span class="line">  cy.wrap(f).invoke(<span class="string">&#x27;failme&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Here is the terminal output</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">  1) prints error with timestamp:</span><br><span class="line">     Error: Tue, 27 Jul 2021 12:10:24 GMT</span><br><span class="line">Timed out retrying after 4000ms: I am out!</span><br><span class="line">  Error: Timed out retrying after 4000ms: I am out!</span><br></pre></td></tr></table></figure>
<h2><span id="add-a-custom-delay-command-for-better-videos">Add a custom delay command for better videos</span></h2><p>I often use the custom <code>delay</code> command to make the recorded test videos clear. Cypress runs pretty fast, and sometimes it is hard to understand from the video what exactly has happening. So I often add a one second delay before clicking a button or checking a box.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">&#x27;button#submit&#x27;</span>)</span><br><span class="line">  .should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">  .wait(<span class="number">1000</span>, &#123; <span class="attr">log</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">  .click()</span><br></pre></td></tr></table></figure>
<p>I extracted the <code>.wait(1000, &#123; log: false &#125;)</code> into a custom command <code>delay</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> delay = <span class="function">(<span class="params">subject, ms = <span class="number">1000</span></span>) =&gt;</span> &#123;</span><br><span class="line">  cy.wait(ms, &#123; <span class="attr">log</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">  <span class="keyword">if</span> (subject) &#123;</span><br><span class="line">    cy.wrap(subject, &#123;</span><br><span class="line">      log: <span class="literal">false</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Cypress.Commands.add(<span class="string">&#x27;delay&#x27;</span>, &#123; <span class="attr">prevSubject</span>: <span class="string">&#x27;optional&#x27;</span> &#125;, delay)</span><br></pre></td></tr></table></figure>
<p>The above command can be used in a chain or as a stand-alone parent command.</p>
<h2><span id="visit-the-blank-page-to-stop-the-running-app">Visit the blank page to stop the running app</span></h2><p>See the blog post <a href="/blog/visit-blank-page-between-tests/" title="Visit The Blank Page Between Cypress Tests">Visit The Blank Page Between Cypress Tests</a>.</p>
<h2><span id="do-not-load-pesky-3rd-party-script">Do not load pesky 3rd party script</span></h2><p>Sometimes 3rd party scripts throw random errors when the page is changing quickly. In that case, stub the resource with an empty string.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * a way to stop loading PayPal JS SDK which seems to throw errors</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> doNotLoadPayPalJS = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.log(<span class="string">&#x27;**doNotLoadPayPalJS**&#x27;</span>)</span><br><span class="line">  cy.intercept(</span><br><span class="line">    &#123;</span><br><span class="line">      method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      hostname: <span class="string">&#x27;www.paypal.com&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      body: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// in your test before visiting the page</span></span><br><span class="line">doNotLoadPayPalJS()</span><br><span class="line">cy.visit(<span class="string">&#x27;/&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h2><span id="deal-with-type-module">Deal with type module</span></h2><p>If the project uses ES6 modules by specifying in the <code>package.json</code> <code>&quot;type&quot;: &quot;module&quot;</code>, this could cause problems for loading the Cypress plugin file. In that case, create a dummy <code>package.json</code> in the <code>cypress</code> folder. Specify the CommonJS type and Node will resolve the plugin file again.</p>
<figure class="highlight json"><figcaption><span>cypress/package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;cypress-tests&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;private&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;commonjs&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>See the example in <a target="_blank" rel="noopener" href="https://github.com/bahmutov/verify-code-example">bahmutov/verify-code-example</a>.</p>
<h2><span id="access-a-mysql-database">Access a MySQL database</span></h2><p>The test runner could access a database during the test to read some data. For example, the blog post <a href="/blog/verify-phone-part-two/" title="How To Verify Phone Number During Tests Part 2">How To Verify Phone Number During Tests Part 2</a> describes how to query a MySQL database to read the phone number verification code and entering it into the web application form.</p>
<h2><span id="fix-create-react-app-eslint-warnings">Fix Create-React-App ESLint warnings</span></h2><p>When creating a new application using Create-React-App, you will see ESLint warnings - because it does not know about the Cypress globals like <code>cy</code> and <code>Cypress</code>.</p>
<p><img src="../images/cypress-tips-and-tricks/eslint-cy.png" alt="ESLint gives a warning for cy global"></p>
<p>To fix, install <a target="_blank" rel="noopener" href="https://github.com/cypress-io/eslint-plugin-cypress">Cypress ESLint plugin</a> and add the recommended settings to the <code>package.json</code></p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;eslintConfig&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;extends&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;react-app&quot;</span>,</span><br><span class="line">      <span class="string">&quot;plugin:cypress/recommended&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For more details, see <a href="/blog/configure-prettier-in-vscode/" title="How to configure Prettier and VSCode">How to configure Prettier and VSCode</a>.</p>
<h2><span id="use-lodash">Use Lodash</span></h2><p>The super useful <a target="_blank" rel="noopener" href="https://lodash.com/docs">Lodash library</a> is bundled with Cypress under <code>Cypress._</code> property. Thus you do not need to install it or even import it from the spec file.</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- import _ from &#x27;lodash&#x27;</span></span><br><span class="line"><span class="addition">+ const &#123; _ &#125; = Cypress</span></span><br></pre></td></tr></table></figure>
<p>If you need Lodash methods in your plugin file, you will need to install and require it, though.</p>
<h2><span id="detect-when-the-document-reloads">Detect when the document reloads</span></h2><p>If the page submits a form, or navigates, sometimes the test needs to wait for the new document to load. To accomplish this, we can compare the <code>document</code> reference before the navigation and after.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// detect the form update by waiting for the new document</span></span><br><span class="line">cy.document().then(<span class="function">(<span class="params">doc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// an event causing the reload</span></span><br><span class="line">  cy.contains(<span class="string">&#x27;button&#x27;</span>, <span class="string">&#x27;create&#x27;</span>).click()</span><br><span class="line">  cy.document().should(<span class="string">&#x27;not.equal&#x27;</span>, doc)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The above code works, but the assertion dumps the <code>document</code> object into the Cypress Command Log, which takes up a lot of space there. Improved version without a very long assertion in the Command Log can use <code>assert</code> function.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// detect the form update by waiting for the new document</span></span><br><span class="line">cy.document().then(<span class="function">(<span class="params">doc</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// an event causing the reload</span></span><br><span class="line">  cy.contains(<span class="string">&#x27;button&#x27;</span>, <span class="string">&#x27;create&#x27;</span>).click()</span><br><span class="line">  cy.document().should(<span class="function">(<span class="params">d</span>) =&gt;</span> assert(d !== doc, <span class="string">&#x27;document changed&#x27;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/f2n6cZVMS34" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>

<h2><span id="time-part-of-the-test">Time part of the test</span></h2><p>You can time how long part of a test takes, or even an individual Cypress command. Then you can add an explicit assertion about the elapsed duration. For example, let&#39;s time how long the loading element in the application is visible. We can assert the loading element goes away in less than two seconds:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> started</span><br><span class="line">cy.get(<span class="string">&#x27;.loading&#x27;</span>)</span><br><span class="line">  .should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// take a timestamp after the loading indicator is visible</span></span><br><span class="line">    started = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="comment">// how to check if the loading element goes away in less than 2 seconds?</span></span><br><span class="line">cy.get(<span class="string">&#x27;.loading&#x27;</span>)</span><br><span class="line">  .should(<span class="string">&#x27;not.be.visible&#x27;</span>)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// take another timestamp when the indicator goes away.</span></span><br><span class="line">    <span class="comment">// compute the elapsed time</span></span><br><span class="line">    <span class="comment">// assert the elapsed time is less than 2 seconds</span></span><br><span class="line">    <span class="keyword">const</span> finished = +<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">    <span class="keyword">const</span> elapsed = finished - started</span><br><span class="line">    expect(elapsed, <span class="string">&#x27;loading takes less than 2 seconds&#x27;</span>).to.be.lessThan(</span><br><span class="line">      <span class="number">2000</span></span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>See the full explanation in the video below:</p>
<center>
<iframe width="560" height="315" src="https://www.youtube.com/embed/tjK_FCYikzI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</center>

<h2><span id="see-also">See also</span></h2><ul>
<li>my website <a target="_blank" rel="noopener" href="https://cypress.tips/">cypress.tips</a></li>
<li><a href="/blog/writing-custom-cypress-command/" title="Writing a Custom Cypress Command">Writing a Custom Cypress Command</a> and <a href="/blog/publishing-cypress-command/" title="How to Publish Custom Cypress Command on NPM">How to Publish Custom Cypress Command on NPM</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cypress.io/blog/">Cypress blog</a>, I have written a large number of <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/author/gleb">blog posts</a> there.</li>
<li><a target="_blank" rel="noopener" href="https://ruleoftech.com/2019/notes-of-best-practices-for-writing-cypress-tests">Notes of Best Practices for writing Cypress tests</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.alec.coffee/the-hitchhikers-guide-to-cypress-end-to-end-testing/">The Hitchhikers Guide to Cypress End-To-End Testing</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.to/bahmutov/unit-testing-vuex-data-store-using-cypress-io-test-runner-3g4n">Unit testing Vuex data store using Cypress.io Test Runner</a></li>
<li>video playlist <a target="_blank" rel="noopener" href="https://www.youtube.com/playlist?list=PLP9o9QNnQuAYYRpJzDNWpeuOVTwxmIxcI">Cypress Tips &amp; Tricks</a></li>
<li><a target="_blank" rel="noopener" href="https://filiphric.com/">Cypress blog posts</a> by <a target="_blank" rel="noopener" href="https://twitter.com/filip_hric/">Filip Hric</a></li>
</ul>
<h2><span id="related-posts">Related posts</span></h2><ul>
<li><a href="/blog/npm-tips-and-tricks/" title="NPM Tips and Tricks">NPM Tips and Tricks</a></li>
<li><a href="/blog/git-tips-and-tricks/" title="Git Tips And Tricks">Git Tips And Tricks</a></li>
<li><a href="/blog/large-web-app-development/" title="Large Web App Development">Large Web App Development</a></li>
<li><a href="/blog/cypress-tips-and-tricks/" title="Cypress Tips and Tricks">Cypress Tips and Tricks</a>
</li>
</ul>

      
    </div>

    
      <footer class="article-footer personal-links">
  <p>
    Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
    see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
    watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
    browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
  </p>
  <p>
    Want to know more about Cypress? Check out <a href="https://cypress.tips" target="_blank">cypress.tips</a>
  </p>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/cypress-tips-and-tricks/" data-id="cku2qli9j01zojvvg7d2k7x1e" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/cypress-tips-and-tricks/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/" rel="tag">cypress</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/testing/" rel="tag">testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../server-push-on-dokku/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          HTTP/2 server push on Dokku
        
      </div>
    </a>
  
  
    <a href="../functors-encapsulate-imperative-logic/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Functors encapsulate imperative logic</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">138</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">417</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">109</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">143</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">68</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">165</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">130</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.38px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.54px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.77px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.85px;">advice</a> <a href="../tags/algolia/" style="font-size: 10.38px;">algolia</a> <a href="../tags/angularjs/" style="font-size: 17.69px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.08px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.69px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.77px;">browser</a> <a href="../tags/ci/" style="font-size: 16.54px;">ci</a> <a href="../tags/circle/" style="font-size: 12.69px;">circle</a> <a href="../tags/climate/" style="font-size: 14.62px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 13.46px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.31px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 19.62px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 13.85px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.77px;">d3</a> <a href="../tags/db/" style="font-size: 14.62px;">db</a> <a href="../tags/docker/" style="font-size: 14.23px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.92px;">documentation</a> <a href="../tags/es6/" style="font-size: 14.62px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.08px;">functional</a> <a href="../tags/generators/" style="font-size: 11.54px;">generators</a> <a href="../tags/git/" style="font-size: 15px;">git</a> <a href="../tags/github/" style="font-size: 15.38px;">github</a> <a href="../tags/graphql/" style="font-size: 11.15px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.31px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.77px;">gulp</a> <a href="../tags/hiring/" style="font-size: 10.77px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.31px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.54px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.77px;">interview</a> <a href="../tags/jade/" style="font-size: 11.15px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.77px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.85px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 16.92px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.15px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.46px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.15px;">performance</a> <a href="../tags/presentation/" style="font-size: 12.31px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.31px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.38px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/react/" style="font-size: 11.54px;">react</a> <a href="../tags/react-native/" style="font-size: 11.15px;">react native</a> <a href="../tags/reactive/" style="font-size: 14.23px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.15px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.54px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 13.08px;">security</a> <a href="../tags/sentry/" style="font-size: 13.85px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.92px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.23px;">testing</a> <a href="../tags/tutorial/" style="font-size: 15.77px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 11.92px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.38px;">ui</a> <a href="../tags/vercel/" style="font-size: 13.08px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.15px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.54px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.92px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.77px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/09/">September 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/08/">August 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../what-i-do-after-a-conference/">What I Do After A Conference</a>
          </li>
        
          <li>
            <a href="../test-plain-or-markdown-file/">Test Plain Or Markdown File Using Cypress</a>
          </li>
        
          <li>
            <a href="../skip-cypress-install-on-ci/">Skip Cypress Install On CI</a>
          </li>
        
          <li>
            <a href="../verify-phone-part-two/">How To Verify Phone Number During Tests Part 2</a>
          </li>
        
          <li>
            <a href="../verify-phone-part-one/">How To Verify Phone Number During Tests Part 1</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/cypress-tips-and-tricks/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
