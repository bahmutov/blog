<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hydrate your apps | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="source for this example: bahmutov/hydrate-vue-todo
live demo
the hydrate script repo bahmutov/hydrate-app
see the hydration used at my own website glebbahmutov.com

I love declarative web application">
<meta property="og:type" content="article">
<meta property="og:title" content="Hydrate your apps">
<meta property="og:url" content="http://glebbahmutov.com/blog/hydrate-your-apps/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="source for this example: bahmutov/hydrate-vue-todo
live demo
the hydrate script repo bahmutov/hydrate-app
see the hydration used at my own website glebbahmutov.com

I love declarative web application">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hydrate your apps">
<meta name="twitter:description" content="source for this example: bahmutov/hydrate-vue-todo
live demo
the hydrate script repo bahmutov/hydrate-app
see the hydration used at my own website glebbahmutov.com

I love declarative web application">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="..//" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="..//" id="subtitle">Software advice from Dr. Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">Software advice from <a id="subtitle" href="http://glebbahmutov.com">Dr. Gleb Bahmutov PhD</a></span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="..//">Home</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-hydrate-your-apps" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2015-12-16T05:00:00.000Z" itemprop="datePublished">Dec 16 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/process/">process</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Hydrate your apps
    </h1>

    <h2 class="article-title" itemprop="name">
      Remove the empty page flicker on web application startup.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>source for this example: <a href="https://github.com/bahmutov/hydrate-vue-todo" target="_blank" rel="external">bahmutov/hydrate-vue-todo</a></li>
<li>live <a href="http://glebbahmutov.com/hydrate-vue-todo/" target="_blank" rel="external">demo</a></li>
<li>the hydrate script repo <a href="https://github.com/bahmutov/hydrate-app" target="_blank" rel="external">bahmutov/hydrate-app</a></li>
<li>see the hydration used at my own website <a href="http://glebbahmutov.com/" target="_blank" rel="external">glebbahmutov.com</a></li>
</ul>
<p>I love declarative web application frameworks like Angular and <a href="http://vuejs.org/" target="_blank" rel="external">Vue.js</a> -
my personal website <a href="http://glebbahmutov.com/" target="_blank" rel="external">glebbahmutov.com</a> is a Vue app! Nothing is easier
than starting a new application by writing HTML markup with a few additional
directives. For example to show a list of items, one could simply write</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">li</span> <span class="attribute">v-for</span>=<span class="value">&quot;todo in todos&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">span</span> <span class="attribute">v-text</span>=<span class="value">&quot;todo.text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">button</span> <span class="attribute">v-on:click</span>=<span class="value">&quot;removeTodo($index)&quot;</span>&gt;</span>X<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Beautiful, simple and powerful. But this suffers from several problems, all because the
initial page markup is NOT what we want to show. We want to NOT show the above template,
instead we want to show the generated HTML <em>after the application has started</em>, something
like this</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">span</span>&gt;</span>Clean room<span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">button</span>&gt;</span>X<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">span</span>&gt;</span>Learn Italian<span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">button</span>&gt;</span>X<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>The gap between the time the browser shows the initial page and the time the application
starts and updates the page with the real content is very noticeable and annoying. </p>
<p>I dislike the following 3 problems</p>
<ul>
<li>the initial template is visible before the web app takes over</li>
<li>an empty space is visible before the web app runs</li>
<li>any content after the web app suddenly moves down</li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/n0HPG-TVr-Q?rel=0" frameborder="0" allowfullscreen></iframe>

<p>Any network delay makes the problems more obvious, and of course the browser caching
makes the problems less apparent, but does not completely or even reliably removes it. 
Even when the data and the framework code have been loaded, 
the web application might need a lot of time to actually compute 
and render the live DOM. I have done a lot of experiments, trying to figure out how 
to speed up the initial loading of Angular 1 applications, 
<a href="https://www.youtube.com/watch?v=gxZE8SqC7as" target="_blank" rel="external">all without much success</a>.</p>
<h2 id="remove-the-initial-template-simple">Remove the initial template (simple)</h2><p>We can solve the flash of the template at the beginning quickly. Just hide the
div where the application&apos;s template is located. Make it visible once the
web application has started.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css"></span><br><span class="line"><span class="class">.hidden</span> <span class="rules">{</span><br><span class="line">  <span class="rule"><span class="attribute">visibility</span>:<span class="value"> hidden</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value"> none</span></span>;</span><br><span class="line">}</span></span><br><span class="line"></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;app&quot;</span> <span class="attribute">class</span>=<span class="value">&quot;hidden&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">li</span> <span class="attribute">v-for</span>=<span class="value">&quot;todo in todos&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">span</span> <span class="attribute">v-text</span>=<span class="value">&quot;todo.text&quot;</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">button</span> <span class="attribute">v-on:click</span>=<span class="value">&quot;removeTodo($index)&quot;</span>&gt;</span>X<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>We should remove the &quot;hidden&quot; class when the application is ready. In Vue, it is simple</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">  el: <span class="string">&apos;#app&apos;</span>,</span><br><span class="line">  ready: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&apos;app&apos;</span>).classList.remove(<span class="string">&apos;hidden&apos;</span>)</span><br><span class="line">  }</span><br><span class="line">})</span><br></pre></td></tr></table></figure>
<p>The sudden DOM update looks weird if there is any content after the div, as shown below.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/yXcdo506t6E?rel=0" frameborder="0" allowfullscreen></iframe>

<p>Is there something we can render instead of blank space at the startup?</p>
<h2 id="hydrated-web-application">Hydrated web application</h2><p>I was inspired by the <a href="https://github.com/henrikjoreteg/feather-app" target="_blank" rel="external">FeatherApp</a> - a very 
lightweight application where the first two features are</p>
<ul>
<li>Initial render of clientside components to static HTML at build time. 
So the browser gets &quot;pre-rendered&quot; HTML.</li>
<li>JS &quot;taking over&quot; once loaded in the browser.</li>
</ul>
<p>While this is a great feature: generate the partial HTML as output of the build step, 
it is difficult to make useful for two reasons</p>
<ol>
<li>Only some web frameworks (React, Cycle) can easily render HTML without a full browser.</li>
<li>We probably don&apos;t have good or relevant data yet to render during the build time.</li>
</ol>
<p>When you think about what would be nice to render immediately for a particular user, one answer
comes to mind: render the <em>last viewed page</em> and continue work after the app loads. This
solves the above two problems nicely</p>
<ol>
<li>Every framework supports it - because the HTML to be saved and restored is already 
inside the browser.</li>
<li>The rendered content is tailored to a specific user - this is what the user saw
at the last saved checkpoint.</li>
</ol>
<p>Before going into the implementation specifics, see the results in the video below.
For the demo purposes, the web framework library is only loaded after 2 second delay.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/oTjB3GLHyBM?rel=0" frameborder="0" allowfullscreen></iframe>

<p>Even before the app JavaScript loads and runs, the page appears. 
It appears very very quickly, and the footer text is not shifting wildly around the page.</p>
<h2 id="implementation-details">Implementation details</h2><p>The main application has two parts: the index HTML page and the <code>src/app.js</code>, taken
pretty much verbatim from <a href="http://vuejs.org/guide/#All_Together_Now" target="_blank" rel="external">vuejs.org/guide</a>.
The application code loads at the bottom of the body.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;app&quot;</span> <span class="attribute">class</span>=<span class="value">&quot;hidden&quot;</span>&gt;</span></span><br><span class="line">    Enter todo: <span class="tag">&lt;<span class="title">input</span> <span class="attribute">v-model</span>=<span class="value">&quot;newTodo&quot;</span> <span class="attribute">v-on:keyup.enter</span>=<span class="value">&quot;addTodo&quot;</span></span><br><span class="line">      <span class="attribute">placeholder</span>=<span class="value">&quot;learn Italian&quot;</span> <span class="attribute">title</span>=<span class="value">&quot;Enter text and press Enter&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">&quot;https://cdn.jsdelivr.net/vue/1.0.11/vue.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">&quot;src/app.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>The app code is just a single component attached to <code>#app</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/app.js</span></span><br><span class="line"><span class="keyword">new</span> Vue({</span><br><span class="line">  el: <span class="string">&apos;#app&apos;</span>,</span><br><span class="line">  data: {</span><br><span class="line">    newTodo: <span class="string">&apos;&apos;</span>,</span><br><span class="line">    todos: []</span><br><span class="line">  },</span><br><span class="line">  methods: {</span><br><span class="line">    addTodo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{ ... }</span><br><span class="line">    removeTodo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{ ... }</span><br><span class="line">  }</span><br><span class="line">})</span><br></pre></td></tr></table></figure>
<p>The hydration feature is implemented in a single file <a href="https://github.com/bahmutov/hydrate-vue-todo/blob/master/src/hydration.js" target="_blank" rel="external">src/hydration.js</a>.
It is a factory function that creates a single object called <code>bottle</code> and adds it to
the <code>window</code> object for simplicity. The application code can do the following with the <code>bottle</code></p>
<ul>
<li><p><code>bottle.open()</code> - called on page load, loads saved HTML snapshot and places into the page.
This is the &quot;dry&quot; HTLM shown to the user while the application is loading.
The bottle is opened automatically when the script is loading.</p>
</li>
<li><p><code>bottle.drink()</code> - called by the application when it has fully loaded and wants to replace
the &quot;dry&quot; HTML with actual live application. In Vue this command can be called from
the <code>ready</code> callback</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ready: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  bottle.drink()</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&apos;app&apos;</span>).classList.remove(<span class="string">&apos;hidden&apos;</span>)</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<ul>
<li><code>bottle.refill()</code> - can be called multiple times by the app to save DOM snapshots to be
used on next load. Think every time we add a todo, or remove one, if we reload the page
we want to show the updated HTML. For example we want to save both the <code>todos</code> list and
the rendered HTML after adding a new one</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app methods fragment</span></span><br><span class="line">save: <span class="function"><span class="keyword">function</span> <span class="title">save</span> (<span class="params"></span>) </span>{</span><br><span class="line">  localStorage.setItem(<span class="string">&apos;todos&apos;</span>, <span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.todos))</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="comment">// we should save the HTML after it has been rendered</span></span><br><span class="line">    bottle.refill()</span><br><span class="line">  }, <span class="number">0</span>)</span><br><span class="line">},</span><br><span class="line">addTodo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> text = <span class="keyword">this</span>.newTodo.trim()</span><br><span class="line">  <span class="keyword">if</span> (text) {</span><br><span class="line">    <span class="keyword">this</span>.todos.push({ text: text })</span><br><span class="line">    <span class="keyword">this</span>.newTodo = <span class="string">&apos;&apos;</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">this</span>.save()</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>Finally, there is a utility method <code>bottle.recycle()</code> that deletes whatever HTML snapshot
is stored in the <code>localStorage</code>.</p>
<p>For clarity, the demo has built-in console log messages and user interface popups, plus
a blue overlay shown while the application is &quot;dry&quot; and the user cannot interfact with the
input field or buttons.</p>
<p>To enable hydration, I include the <code>src/hydration.js</code> right after the web application element,
but before anything else. The configuration is passed to the <code>hydration</code> function via
script tags.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;app&quot;</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">&quot;src/hydration.js&quot;</span></span><br><span class="line">  <span class="attribute">id</span>=<span class="value">&quot;app&quot;</span></span><br><span class="line">  <span class="attribute">verbose</span>=<span class="value">&quot;true&quot;</span></span><br><span class="line">  <span class="attribute">on</span>=<span class="value">&quot;hydrate&quot;</span></span><br><span class="line">  <span class="attribute">verbose-ui</span>=<span class="value">&quot;true&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>There is a little bit more complexity and extra calls just to enable conditional hydration
based on the check box - this is a demo comparing the original app vs hydrated one, after all!
I invite you to see the results for yourself at <a href="http://glebbahmutov.com/hydrate-vue-todo/" target="_blank" rel="external">glebbahmutov.com/hydrate-vue-todo</a>.</p>
<h2 id="shortcomings">Shortcomings</h2><p>The hydration has its own shortcomings.</p>
<ol>
<li>The user cannot interact meaningfully with the page while the &quot;dry&quot; HTML is shown.
In my opinion this is not a huge deal, because in most cases the first couple of seconds I am
reading the website, not actively using it. Showing the loading message / overlay gives
the user an idea that the app is read-only.</li>
<li>The stored HTML cannot be too massive due to localStorage limitation (about 5MB limit).</li>
<li>The &quot;dry&quot; HTML is extra work for the browser. Not a lot of extra work, because it is 
rendered only once, but it is saved multiple times - every time the web app thinks it makes
sense to have a saved checkpoint.</li>
</ol>
<p>You might think that direct pasting of HTML from the <code>localStorage</code> into the DOM is a security
risk. I think the risk is minimal. First, this HTML comes directly from the user&apos;s own DOM.
Second, the other websites do not have access to the <code>localStorage</code> snapshot - only the domain
that wrote it there has access. 
Third, the HTML snapshots are compatible with the Content-Security-Policy - 
your website can have the <a href="../disable-inline-javascript-for-security/">inline JavaScript disabled</a> and the hydration would still
work; my personal website <a href="http://glebbahmutov.com/" target="_blank" rel="external">glebbahmutov.com</a> has very strict
policy and works just fine.</p>
<h2 id="where-to-go-from-here">Where to go from here</h2><ul>
<li>Checkout the tiny library for app hydration I wrote
<a href="https://github.com/bahmutov/hydrate-app" target="_blank" rel="external">hydrate-app</a>. Let me know if it works or not.</li>
<li>The <a href="https://github.com/henrikjoreteg/feather-app" target="_blank" rel="external">Feather App</a> - my inspiration</li>
<li>Offline-First <a href="https://github.com/pazguille/offline-first" target="_blank" rel="external">resources</a> - a huge list
of resources for people who want the web application to work even if they are offline.
Nothing specific about web app hydration though.</li>
</ul>
<h2 id="ideas-to-explore">Ideas to explore</h2><p>The ServiceWorker feature allows to cache and returns quickly HTML and JavaScript
(or even some unexpected value, see <a href="https://github.com/bahmutov/service-turtle" target="_blank" rel="external">service-turtle</a>).
What if instead of using <code>localStorage</code> to store the HTML snapshots, we sent the
HTML to the ServiceWorker, who would cache it? Basically, it will rewrite the page HTML,
and on the next load would return the modified HTML - making the dynamic page
appear static!</p>
<p>The current DOM snapshot is being replaced by the newly initialized and rendered application.
This is probably fine for Angular, Vue, but React could patch it up from the VirtualDom,
thus removing the need to actually swap one HTML with another. Might be worth exploring.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>

    

    <footer class="article-footer">
      <a data-url="http://glebbahmutov.com/blog/hydrate-your-apps/" data-id="ciikqygis00ldxrurdbvb6j4z" class="article-share-link">Share</a>
      
        <a href="http://glebbahmutov.com/blog/hydrate-your-apps/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/advice/">advice</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/performance/">performance</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../hydrate-at-build-time/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hydrate at build time
        
      </div>
    </a>
  
  
    <a href="../my-node-tools/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">My Node tools</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">70</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">190</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">83</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angular/">angular</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">54</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/database/">database</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">42</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">143</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">54</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">44</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 12.86px;">QUnit</a><a href="../tags/advice/" style="font-size: 19.29px;">advice</a><a href="../tags/angular/" style="font-size: 10px;">angular</a><a href="../tags/angularjs/" style="font-size: 18.57px;">angularjs</a><a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a><a href="../tags/assertions/" style="font-size: 13.57px;">assertions</a><a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a><a href="../tags/browser/" style="font-size: 14.29px;">browser</a><a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a><a href="../tags/d3/" style="font-size: 11.43px;">d3</a><a href="../tags/database/" style="font-size: 10px;">database</a><a href="../tags/db/" style="font-size: 12.86px;">db</a><a href="../tags/es6/" style="font-size: 14.29px;">es6</a><a href="../tags/es7/" style="font-size: 10px;">es7</a><a href="../tags/functional/" style="font-size: 17.14px;">functional</a><a href="../tags/generators/" style="font-size: 12.86px;">generators</a><a href="../tags/git/" style="font-size: 13.57px;">git</a><a href="../tags/grunt/" style="font-size: 13.57px;">grunt</a><a href="../tags/gulp/" style="font-size: 11.43px;">gulp</a><a href="../tags/immutable/" style="font-size: 10px;">immutable</a><a href="../tags/interview/" style="font-size: 11.43px;">interview</a><a href="../tags/jade/" style="font-size: 12.14px;">jade</a><a href="../tags/javascript/" style="font-size: 20px;">javascript</a><a href="../tags/jshint/" style="font-size: 11.43px;">jshint</a><a href="../tags/modular-development/" style="font-size: 15px;">modular development</a><a href="../tags/nodejs/" style="font-size: 18.57px;">nodejs</a><a href="../tags/performance/" style="font-size: 15.71px;">performance</a><a href="../tags/promises/" style="font-size: 16.43px;">promises</a><a href="../tags/proposal/" style="font-size: 10.71px;">proposal</a><a href="../tags/reactive/" style="font-size: 10.71px;">reactive</a><a href="../tags/reactjs/" style="font-size: 10.71px;">reactjs</a><a href="../tags/security/" style="font-size: 12.14px;">security</a><a href="../tags/sentry/" style="font-size: 13.57px;">sentry</a><a href="../tags/testing/" style="font-size: 17.86px;">testing</a><a href="../tags/tutorial/" style="font-size: 12.86px;">tutorial</a><a href="../tags/ui/" style="font-size: 10px;">ui</a><a href="../tags/web-workers/" style="font-size: 12.86px;">web workers</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../instant-web-application/">Instant Web Application</a>
          </li>
        
          <li>
            <a href="../hydrate-at-build-time/">Hydrate at build time</a>
          </li>
        
          <li>
            <a href="">Hydrate your apps</a>
          </li>
        
          <li>
            <a href="../my-node-tools/">My Node tools</a>
          </li>
        
          <li>
            <a href="../pass-the-logic/">Pass the logic</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="..//" class="mobile-nav-link">Home</a>
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'http://glebbahmutov.com/blog/hydrate-your-apps/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css" type="text/css">
  <script src="../fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="../js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>