<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Testing React Native Todo Application Using Cypress | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="IntroductionRecently I have read a nice guide to writing unit and integration tests using Jest for a React Native Todo app. You can read the guide at Quick Guide to React Native Testing and see the so">
<meta property="og:type" content="article">
<meta property="og:title" content="Testing React Native Todo Application Using Cypress">
<meta property="og:url" content="https://glebbahmutov.com/blog/testing-rn-todo-app/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="IntroductionRecently I have read a nice guide to writing unit and integration tests using Jest for a React Native Todo app. You can read the guide at Quick Guide to React Native Testing and see the so">
<meta property="og:locale">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/todo-test.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/todo-expo.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/loads.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/adds.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/fails.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/filters.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/remove.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/cover-log.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/coverage.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/missed.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/load-failed.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/duplicate.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/delete-error.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/all-tests.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/new-cover.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/ci.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/percy.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/set-recording.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/dashboard.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/a11y-test.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/contrast.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/completed-contrast.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/fixed-contrast.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/visual-checks.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/visual-diff.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/visual-checks-green.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/invoke.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/rn-todo/network-test.png">
<meta property="article:published_time" content="2021-06-21T04:00:00.000Z">
<meta property="article:modified_time" content="2021-07-11T12:38:04.627Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="testing">
<meta property="article:tag" content="cypress">
<meta property="article:tag" content="a11y">
<meta property="article:tag" content="react native">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/rn-todo/todo-test.gif">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-testing-rn-todo-app" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2021-06-21T04:00:00.000Z" itemprop="datePublished">Jun 21 2021</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Testing React Native Todo Application Using Cypress
    </h1>

    <h2 class="article-title" itemprop="name">
      Integration tests for a React Native application running in the browser using Expo with network control, code coverage, visual, and a11y testing.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2><span id="introduction">Introduction</span></h2><p>Recently I have read a nice guide to writing unit and integration tests using Jest for a React Native Todo app. You can read the guide at <a target="_blank" rel="noopener" href="https://stassop.medium.com/quick-guide-to-react-native-testing-a5a830223c9e">Quick Guide to React Native Testing</a> and see the source code at <a target="_blank" rel="noopener" href="https://github.com/stassop/ReactNativeTodo">stassop/ReactNativeTodo</a>. Recently I have been looking at how to test RN apps using <a target="_blank" rel="noopener" href="https://www.cypress.io/">Cypress.io</a> test runner. You can read my explorations in the blog post <a href="/blog/testing-react-native-app-using-cypress/" title="The Complete Guide to Testing React Native App Using Cypress">The Complete Guide to Testing React Native App Using Cypress</a>. In this blog post I will show how to apply the testing principles and write tests quickly and efficiently.</p>
<p>You can find the complete application and my tests in the repo <a target="_blank" rel="noopener" href="https://github.com/bahmutov/ReactNativeTodo">bahmutov/ReactNativeTodo</a>. The tests run in the browser, the typical test is shown below.</p>
<p><img src="../images/rn-todo/todo-test.gif" alt="ReactNative Todo app tested using Cypress"></p>
<!-- toc -->
<ul>
<li><a href="#jest-tests">Jest tests</a></li>
<li><a href="#adding-expo">Adding Expo</a></li>
<li><a href="#adding-cypress">Adding Cypress</a></li>
<li><a href="#resetting-todos">Resetting todos</a></li>
<li><a href="#completing-items">Completing items</a></li>
<li><a href="#filters">Filters</a></li>
<li><a href="#removing-todos">Removing todos</a></li>
<li><a href="#selector-refactoring">Selector refactoring</a></li>
<li><a href="#code-coverage">Code coverage</a></li>
<li><a href="#testing-server-errors">Testing server errors</a></li>
<li><a href="#continuous-integration">Continuous integration</a></li>
<li><a href="#visual-testing">Visual testing</a></li>
<li><a href="#cypress-dashboard">Cypress dashboard</a></li>
<li><a href="#accessability-testing">Accessability testing</a></li>
<li><a href="#unit-testing">Unit testing</a></li>
<li><a href="#api-tests">API tests</a></li>
<li><a href="#network-tests">Network tests</a></li>
<li><a href="#component-testing">Component testing</a></li>
<li><a href="#help-wanted">Help wanted</a></li>
</ul>
<!-- tocstop -->
<h2><span id="jest-tests">Jest tests</span></h2><p>The app comes with existing tests written using Jest and executed in the terminal. The tests are pretty low-level and have to mock the entire environment, creating dependencies between the tests and the code. For example, this is the integration test as originally written by the app&#39;s author:</p>
<figure class="highlight js"><figcaption><span>__tests__/integration/integration.test.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> TestRenderer <span class="keyword">from</span> <span class="string">&#x27;react-test-renderer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Text, TextInput, TouchableOpacity &#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">&#x27;redux-saga&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Api <span class="keyword">from</span> <span class="string">&#x27;../../api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; App &#125; <span class="keyword">from</span> <span class="string">&#x27;../../components/App&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Checkbox &#125; <span class="keyword">from</span> <span class="string">&#x27;../../components/Checkbox&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Error</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../../components/Error&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IconButton &#125; <span class="keyword">from</span> <span class="string">&#x27;../../components/IconButton&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Todo &#125; <span class="keyword">from</span> <span class="string">&#x27;../../components/Todo&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TodoFilter &#125; <span class="keyword">from</span> <span class="string">&#x27;../../components/TodoFilters&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; rootReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;../../reducers&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; rootSaga &#125; <span class="keyword">from</span> <span class="string">&#x27;../../sagas&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sagaMiddleware = createSagaMiddleware();</span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer, applyMiddleware(thunk, sagaMiddleware));</span><br><span class="line">sagaMiddleware.run(rootSaga);</span><br><span class="line"></span><br><span class="line">jest.useFakeTimers(); <span class="comment">// Prevent issues with LayoutAnimation</span></span><br><span class="line"></span><br><span class="line">jest.spyOn(Api, <span class="string">&#x27;fetchTodos&#x27;</span>).mockResolvedValue([</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">text</span>: <span class="string">&#x27;Todo one&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">text</span>: <span class="string">&#x27;Todo two&#x27;</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;App&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Use async/await to allow for async calls to resolve</span></span><br><span class="line">  <span class="comment">// https://reactjs.org/docs/testing-recipes.html#data-fetching</span></span><br><span class="line">  <span class="keyword">let</span> root;</span><br><span class="line">  beforeAll(<span class="function">() =&gt;</span> TestRenderer.act(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> renderer = <span class="keyword">await</span> TestRenderer.create(</span><br><span class="line">      &lt;Provider store=&#123; store &#125;&gt;</span><br><span class="line">        &lt;App /&gt;</span><br><span class="line">      &lt;/Provider&gt;</span><br><span class="line">    );</span><br><span class="line">    root = renderer.root;</span><br><span class="line">  &#125;));</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;Fetches todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> todos = root.findAllByType(Todo);</span><br><span class="line"></span><br><span class="line">    expect(todos).toHaveLength(<span class="number">2</span>);</span><br><span class="line">    expect(todos[<span class="number">0</span>].props.text).toBe(<span class="string">&#x27;Todo one&#x27;</span>);</span><br><span class="line">    expect(todos[<span class="number">1</span>].props.text).toBe(<span class="string">&#x27;Todo two&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>There are 42 lines of set up and internal code imports before we get to the test itself! Any change in the libraries or application code would require rewriting the test itself, because it is so closely coupled to the app. Let&#39;s look at the &quot;Create todo&quot; unit test. It is ... really verbose and tightly coupled to the code.</p>
<figure class="highlight js"><figcaption><span>__tests__/components/CreateTodo.test.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> TestRenderer <span class="keyword">from</span> <span class="string">&#x27;react-test-renderer&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;TextInput, TouchableOpacity&#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> reactRedux <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Actions <span class="keyword">from</span> <span class="string">&#x27;../../actions&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;CreateTodo&#125; <span class="keyword">from</span> <span class="string">&#x27;../../components/CreateTodo&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// useDispatch() will be called by every test</span></span><br><span class="line"><span class="keyword">const</span> useDispatchMock = jest.fn();</span><br><span class="line">jest.spyOn(reactRedux, <span class="string">&#x27;useDispatch&#x27;</span>).mockReturnValue(useDispatchMock);</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;Handles success&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> text = <span class="string">&#x27;Todo&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> expectedAction = Actions.createTodo(text);</span><br><span class="line">  <span class="comment">// useSelector() will be called by every act()</span></span><br><span class="line">  jest.spyOn(reactRedux, <span class="string">&#x27;useSelector&#x27;</span>).mockReturnValue(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> renderer;</span><br><span class="line">  <span class="comment">// Wrap create() in act() for hooks to take effect</span></span><br><span class="line">  TestRenderer.act(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    renderer = TestRenderer.create(<span class="xml"><span class="tag">&lt;<span class="name">CreateTodo</span> /&gt;</span></span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> root = renderer.root;</span><br><span class="line">  <span class="keyword">const</span> textInput = root.findByType(TextInput);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Wrap each call in act() for it to take effect before the next one</span></span><br><span class="line">  TestRenderer.act(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    textInput.props.onChangeText(text);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  TestRenderer.act(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    textInput.props.onSubmitEditing();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  expect(useDispatchMock).toHaveBeenCalledWith(expectedAction);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>That&#39;s a lot of internal set up just to ensure the app can create a todo, don&#39;t you think? Let&#39;s see if there is a better way. Remember the above tests, as we are about to see a much simpler way.</p>
<h2><span id="adding-expo">Adding Expo</span></h2><p>The application was set to run using <code>react-native</code> on iOS or Android devices. To write Cypress tests, I added <a target="_blank" rel="noopener" href="https://expo.io/">Expo</a> tool. This tools makes it possible to see the same RN app bundled and running in the regular browser. Having the application running in the browser while developing and testing it has advantages:</p>
<ul>
<li>it is faster to bundle and open the app in the browser than compiling and running the app in the emulator</li>
<li>the browser DevTools are really helpful for debugging the application</li>
<li>finally, if we have a web application, we can write tests using Cypress!</li>
</ul>
<p>I have added Expo to the Todo app following the <a target="_blank" rel="noopener" href="https://docs.expo.io/guides/running-in-the-browser/">Expo guide</a>.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># match the React DOM version to the React version</span><br><span class="line">$ npm i -D expo expo-cli react-native-web react-dom@17.0.1 babel-preset-expo</span><br><span class="line">+ react-dom@17.0.1</span><br><span class="line">+ react-native-web@0.17.0</span><br><span class="line">+ expo-cli@4.5.2</span><br><span class="line">+ expo@41.0.1</span><br><span class="line">+ babel-preset-expo@8.3.0</span><br></pre></td></tr></table></figure>
<p>Then I started using <a target="_blank" rel="noopener" href="https://github.com/bahmutov/ReactNativeTodo/commit/ae9c91529fbb78e8f361e2fa3dcc67f09ce7acb7">Expo icons</a> and fonts to make sure the app looks in the browser the same as on iOS.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// using icons before</span></span><br><span class="line">&lt;Icon</span><br><span class="line">  icon=&#123; checked ? <span class="string">&#x27;radio_button_checked&#x27;</span> : <span class="string">&#x27;radio_button_unchecked&#x27;</span> &#125;</span><br><span class="line">  style=&#123;[ styles.icon, disabled &amp;&amp; styles.disabled ]&#125;</span><br><span class="line">/&gt;</span><br><span class="line"><span class="comment">// using matching Expo icons</span></span><br><span class="line"><span class="keyword">import</span> &#123;MaterialIcons&#125; <span class="keyword">from</span> <span class="string">&#x27;@expo/vector-icons&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#123;checked ? (</span><br><span class="line">  &lt;MaterialIcons</span><br><span class="line">    name=<span class="string">&quot;radio-button-checked&quot;</span></span><br><span class="line">    size=&#123;<span class="number">32</span>&#125;</span><br><span class="line">    color=&#123;Colors.buttonActive&#125;</span><br><span class="line">  /&gt;</span><br><span class="line">) : (</span><br><span class="line">  &lt;MaterialIcons</span><br><span class="line">    name=<span class="string">&quot;radio-button-unchecked&quot;</span></span><br><span class="line">    size=&#123;<span class="number">32</span>&#125;</span><br><span class="line">    color=&#123;Colors.buttonActive&#125;</span><br><span class="line">  /&gt;</span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure>
<p>I can run the application using <code>expo start --web</code> command and see it in the browser.</p>
<p><img src="../images/rn-todo/todo-expo.png" alt="ReactNative Todo app running in the browser"></p>
<p>Getting Expo to show your RN application in the browser is definitely worth your time and effort.</p>
<p><strong>Tip:</strong> I have a small example of adding Expo to an existing RN project in <a target="_blank" rel="noopener" href="https://github.com/bahmutov/react-native-to-expo">bahmutov/react-native-to-expo</a>.</p>
<h2><span id="adding-cypress">Adding Cypress</span></h2><p>I will install Cypress and configure it to load <code>localhost:19006</code> by default - that&#39;s the Expo&#39;s default local port.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -D cypress</span><br><span class="line">+ cypress@7.5.0</span><br></pre></td></tr></table></figure>
<p>The configuration file <code>cypress.json</code> sets the viewport and the base URL.</p>
<figure class="highlight json"><figcaption><span>cypress.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;fixturesFolder&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;baseUrl&quot;</span>: <span class="string">&quot;http://localhost:19006&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;viewportWidth&quot;</span>: <span class="number">400</span>,</span><br><span class="line">  <span class="attr">&quot;viewportHeight&quot;</span>: <span class="number">660</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The simplest test can load the application and stop. Any errors in the application&#39;s code, a thrown error, or an unhandled promise rejection would fail this test.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;RN Todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it.only(<span class="string">&#x27;loads&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="../images/rn-todo/loads.png" alt="The very first Cypress test"></p>
<p>Let&#39;s add a couple of Todo items and verify they appear in the list. We need to somehow select the input text box. Let&#39;s add the <code>testID</code> property to the component.</p>
<figure class="highlight js"><figcaption><span>components/CreateTodo.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextInput</span><br><span class="line">  testID=<span class="string">&quot;add-todo&quot;</span></span><br><span class="line">  value=&#123;text&#125;</span><br><span class="line">  ref=&#123;inputRef&#125;</span><br><span class="line">  style=&#123;styles.textInput&#125;</span><br><span class="line">  placeholder=&#123;<span class="string">&#x27;Add todo&#x27;</span>&#125;</span><br><span class="line">  onChangeText=&#123;setText&#125;</span><br><span class="line">  onSubmitEditing=&#123;create&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>React Native automatically maps the <code>testID=&quot;add-todo&quot;</code> to the HTML attribute <code>data-testid=&quot;add-todo&quot;</code> when the application is running in the browser. Similarly I will add a test ID to the Todo components.</p>
<figure class="highlight js"><figcaption><span>components/Todo.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Todo = <span class="function">(<span class="params">&#123;id, text, done, progress&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> dispatch = useDispatch();</span><br><span class="line">  <span class="keyword">const</span> deleteSelf = <span class="function">() =&gt;</span> dispatch(Actions.deleteTodo(id));</span><br><span class="line">  <span class="keyword">const</span> toggle = <span class="function"><span class="params">checked</span> =&gt;</span> dispatch(Actions.toggleTodo(id, checked));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;View</span><br><span class="line">      style=&#123;styles.container&#125;</span><br><span class="line">      testID=<span class="string">&quot;todo&quot;</span></span><br><span class="line">      accessibilityLabel=&#123;done ? <span class="string">&#x27;completed&#x27;</span> : <span class="string">&#x27;incomplete&#x27;</span>&#125;&gt;</span><br><span class="line">      ...</span><br><span class="line">  )</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>Tip:</strong> I have added accessibility label too, we will use it later to confirm the task completion works.</p>
<p>Let&#39;s extend our test by adding several todo items and confirming they appear.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;RN Todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;adds todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="comment">// using Enter works on the web</span></span><br><span class="line">    cy.get(<span class="string">&#x27;[data-testid=add-todo]&#x27;</span>)</span><br><span class="line">      .should(<span class="string">&#x27;have.focus&#x27;</span>)</span><br><span class="line">      .type(<span class="string">&#x27;code RN app&#123;enter&#125;&#x27;</span>);</span><br><span class="line">    cy.get(<span class="string">&#x27;[data-testid=todo]&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// clicking &quot;Add&quot; button works too</span></span><br><span class="line">    cy.get(<span class="string">&#x27;[data-testid=add-todo]&#x27;</span>).type(<span class="string">&#x27;add Expo&#x27;</span>);</span><br><span class="line">    cy.get(<span class="string">&#x27;[data-testid=add]&#x27;</span>).click();</span><br><span class="line">    cy.get(<span class="string">&#x27;[data-testid=todo]&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The test runs and it is a pleasure watching it.</p>
<p><img src="../images/rn-todo/adds.gif" alt="The test is adding two todos and confirming"></p>
<h2><span id="resetting-todos">Resetting todos</span></h2><p>If we re-run the test the second time, it fails.</p>
<p><img src="../images/rn-todo/fails.png" alt="The test fails"></p>
<p>We can see the HTTP call to the server in the terminal returning an error code 500</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS /create 204 3.847 ms - -</span><br><span class="line">POST /create 500 14.099 ms - -</span><br></pre></td></tr></table></figure>
<p>The test assumes it starts with zero items on the server. Of course, that is not true - the server keeps the previous state. There are several ways we can solve this problem; <a target="_blank" rel="noopener" href="https://on.cypress.io/network-requests">network stubbing</a> is usually used to isolate the frontend tests from the backend. In my case I have added another endpoint to the server to remove all existing items.</p>
<figure class="highlight js"><figcaption><span>server/app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> deleteAll = <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> writeTodos([]);</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> res.json([]), TIMEOUT);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    next(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// new method for tests to use</span></span><br><span class="line">app.post(<span class="string">&#x27;/delete-all&#x27;</span>, deleteAll);</span><br></pre></td></tr></table></figure>
<p>The test can execute HTTP request using <a target="_blank" rel="noopener" href="https://on.cypress.io/request">cy.request</a> command.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;RN Todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.request(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:3000/delete-all&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;adds todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The test passes every time.</p>
<h2><span id="completing-items">Completing items</span></h2><p>Let&#39;s continue writing our test. The user should be able to complete items. When the item is completed, it gets a different Aria label.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;RN Todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.request(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:3000/delete-all&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;adds todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="comment">// using Enter works on the web</span></span><br><span class="line">    cy.get(<span class="string">&#x27;[data-testid=add-todo]&#x27;</span>)</span><br><span class="line">      .should(<span class="string">&#x27;have.focus&#x27;</span>)</span><br><span class="line">      .type(<span class="string">&#x27;code RN app&#123;enter&#125;&#x27;</span>);</span><br><span class="line">    cy.get(<span class="string">&#x27;[data-testid=todo]&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// clicking &quot;Add&quot; button works too</span></span><br><span class="line">    cy.get(<span class="string">&#x27;[data-testid=add-todo]&#x27;</span>).type(<span class="string">&#x27;add Expo&#x27;</span>);</span><br><span class="line">    cy.get(<span class="string">&#x27;[data-testid=add]&#x27;</span>).click();</span><br><span class="line">    cy.get(<span class="string">&#x27;[data-testid=todo]&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    cy.log(<span class="string">&#x27;**complete item**&#x27;</span>);</span><br><span class="line">    cy.contains(<span class="string">&#x27;[data-testid=todo]&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>)</span><br><span class="line">      .find(<span class="string">&#x27;[data-testid=toggle]&#x27;</span>)</span><br><span class="line">      .click();</span><br><span class="line">    cy.contains(<span class="string">&#x27;[data-testid=todo]&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).should(</span><br><span class="line">      <span class="string">&#x27;have.attr&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;aria-label&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;completed&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// the other todo should still be incomplete</span></span><br><span class="line">    cy.contains(<span class="string">&#x27;[data-testid=todo]&#x27;</span>, <span class="string">&#x27;add Expo&#x27;</span>).should(</span><br><span class="line">      <span class="string">&#x27;have.attr&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;aria-label&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;incomplete&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Cypress commands are chainable. Thus to find the Todo item by text, then find the toggle checkbox icon and click on it, we use the chain</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cy.contains(<span class="string">&#x27;[data-testid=todo]&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>)</span><br><span class="line">  .find(<span class="string">&#x27;[data-testid=toggle]&#x27;</span>)</span><br><span class="line">  .click();</span><br></pre></td></tr></table></figure>
<p>To verify the completeness status, we use the Aria label attribute</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cy.contains(<span class="string">&#x27;[data-testid=todo]&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).should(</span><br><span class="line">  <span class="string">&#x27;have.attr&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;aria-label&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;completed&#x27;</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>Perfect.</p>
<h2><span id="filters">Filters</span></h2><p>I like creating longer meaningful tests that go through the entire user stories. Having long tests does not making debugging a failed tests more complex - Cypress automatically captures a video of the entire test run, and a screenshot at the moment of failure. The Command Log is clearly visible in the video and the screenshot, giving you an idea where and why the test has failed.</p>
<p>Let&#39;s exercise the &quot;Active | All | Done&quot; filters. We already have one item completed, and another one still active. So we add to our test:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cy.log(<span class="string">&#x27;**filters**&#x27;</span>);</span><br><span class="line">cy.contains(<span class="string">&#x27;[data-testid=filter]&#x27;</span>, <span class="string">&#x27;Active&#x27;</span>).click();</span><br><span class="line">cy.get(<span class="string">&#x27;[data-testid=todo]&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">cy.contains(<span class="string">&#x27;[data-testid=todo]&#x27;</span>, <span class="string">&#x27;add Expo&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">cy.contains(<span class="string">&#x27;[data-testid=filter]&#x27;</span>, <span class="string">&#x27;Done&#x27;</span>).click();</span><br><span class="line">cy.get(<span class="string">&#x27;[data-testid=todo]&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">cy.contains(<span class="string">&#x27;[data-testid=todo]&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>The test passes. Cypress has a nice time-traveling debugger. When you hover over the commands on the left, Cypress shows the application&#39;s DOM at that moment. It even shows where the <code>.click()</code> clicked, and how the application has responded.</p>
<p><img src="../images/rn-todo/filters.gif" alt="The time-traveling debugger"></p>
<h2><span id="removing-todos">Removing todos</span></h2><p>The last feature in our application is removing todos by clicking on the Trash icon button. Let&#39;s test it.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cy.log(<span class="string">&#x27;**removing**&#x27;</span>);</span><br><span class="line">cy.contains(<span class="string">&#x27;[data-testid=todo]&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>)</span><br><span class="line">  .find(<span class="string">&#x27;[data-testid=delete]&#x27;</span>)</span><br><span class="line">  .click();</span><br><span class="line">cy.get(<span class="string">&#x27;[data-testid=todo]&#x27;</span>).should(<span class="string">&#x27;not.exist&#x27;</span>);</span><br><span class="line">cy.contains(<span class="string">&#x27;[data-testid=filter]&#x27;</span>, <span class="string">&#x27;All&#x27;</span>).click();</span><br><span class="line">cy.get(<span class="string">&#x27;[data-testid=todo]&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">cy.contains(<span class="string">&#x27;[data-testid=todo]&#x27;</span>, <span class="string">&#x27;add Expo&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>The entire test is very fast, and executes in 2 seconds.</p>
<p><img src="../images/rn-todo/remove.png" alt="The full test"></p>
<h2><span id="selector-refactoring">Selector refactoring</span></h2><p>In our test we used test ID attributes or a combination of test ID + text like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cy.get(<span class="string">&#x27;[data-testid=todo]&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">cy.contains(<span class="string">&#x27;[data-testid=todo]&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>The above spec code is just JavaScript. If you find it too verbose, you can add little helper functions and even <a target="_blank" rel="noopener" href="https://on.cypress.io/custom-commands">custom Cypress commands</a>. Let&#39;s introduce a little utility function to return the full data attribute test id selector.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/with-helpers.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns data attribute selector for the given test id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> tid = <span class="function"><span class="params">testId</span> =&gt;</span> <span class="string">`[data-testid=&quot;<span class="subst">$&#123;testId&#125;</span>&quot;]`</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;RN Todos with helpers&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.request(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:3000/delete-all&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;adds todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="comment">// using Enter works on the web</span></span><br><span class="line">    cy.get(tid(<span class="string">&#x27;add-todo&#x27;</span>)).should(<span class="string">&#x27;have.focus&#x27;</span>).type(<span class="string">&#x27;code RN app&#123;enter&#125;&#x27;</span>);</span><br><span class="line">    cy.get(tid(<span class="string">&#x27;todo&#x27;</span>)).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// clicking &quot;Add&quot; button works too</span></span><br><span class="line">    cy.get(tid(<span class="string">&#x27;add-todo&#x27;</span>)).type(<span class="string">&#x27;add Expo&#x27;</span>);</span><br><span class="line">    cy.get(tid(<span class="string">&#x27;add&#x27;</span>)).click();</span><br><span class="line">    cy.get(tid(<span class="string">&#x27;todo&#x27;</span>)).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    cy.log(<span class="string">&#x27;**complete item**&#x27;</span>);</span><br><span class="line">    cy.contains(tid(<span class="string">&#x27;todo&#x27;</span>), <span class="string">&#x27;code RN&#x27;</span>).find(tid(<span class="string">&#x27;toggle&#x27;</span>)).click();</span><br><span class="line">    cy.contains(tid(<span class="string">&#x27;todo&#x27;</span>), <span class="string">&#x27;code RN&#x27;</span>).should(</span><br><span class="line">      <span class="string">&#x27;have.attr&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;aria-label&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;completed&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// the other todo should still be incomplete</span></span><br><span class="line">    cy.contains(tid(<span class="string">&#x27;todo&#x27;</span>), <span class="string">&#x27;add Expo&#x27;</span>).should(</span><br><span class="line">      <span class="string">&#x27;have.attr&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;aria-label&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;incomplete&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    cy.log(<span class="string">&#x27;**filters**&#x27;</span>);</span><br><span class="line">    cy.contains(tid(<span class="string">&#x27;filter&#x27;</span>), <span class="string">&#x27;Active&#x27;</span>).click();</span><br><span class="line">    cy.get(tid(<span class="string">&#x27;todo&#x27;</span>)).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    cy.contains(tid(<span class="string">&#x27;todo&#x27;</span>), <span class="string">&#x27;add Expo&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">    cy.contains(tid(<span class="string">&#x27;filter&#x27;</span>), <span class="string">&#x27;Done&#x27;</span>).click();</span><br><span class="line">    cy.get(tid(<span class="string">&#x27;todo&#x27;</span>)).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    cy.contains(tid(<span class="string">&#x27;todo&#x27;</span>), <span class="string">&#x27;code RN&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    cy.log(<span class="string">&#x27;**removing**&#x27;</span>);</span><br><span class="line">    cy.contains(tid(<span class="string">&#x27;todo&#x27;</span>), <span class="string">&#x27;code RN&#x27;</span>).find(tid(<span class="string">&#x27;delete&#x27;</span>)).click();</span><br><span class="line">    cy.get(tid(<span class="string">&#x27;todo&#x27;</span>)).should(<span class="string">&#x27;not.exist&#x27;</span>);</span><br><span class="line">    cy.contains(tid(<span class="string">&#x27;filter&#x27;</span>), <span class="string">&#x27;All&#x27;</span>).click();</span><br><span class="line">    cy.get(tid(<span class="string">&#x27;todo&#x27;</span>)).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    cy.contains(tid(<span class="string">&#x27;todo&#x27;</span>), <span class="string">&#x27;add Expo&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>We always use <code>cy.get(tid(...))</code> and <code>cy.contains(tid(...), text)</code>, thus we can create a common abstraction function called <code>byTestId</code>.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/with-helpers.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns data attribute selector for the given test id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> tid = <span class="function"><span class="params">testId</span> =&gt;</span> <span class="string">`[data-testid=&quot;<span class="subst">$&#123;testId&#125;</span>&quot;]`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Selects elements using cy.get or cy.contains</span></span><br><span class="line"><span class="comment"> * using the provided test ID attribute.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> byTestId = <span class="function">(<span class="params">testId, text</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (text) &#123;</span><br><span class="line">    <span class="keyword">return</span> cy.contains(tid(testId), text);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> cy.get(tid(testId));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;RN Todos with helpers&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  beforeEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.request(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:3000/delete-all&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;adds todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    <span class="comment">// using Enter works on the web</span></span><br><span class="line">    byTestId(<span class="string">&#x27;add-todo&#x27;</span>).should(<span class="string">&#x27;have.focus&#x27;</span>).type(<span class="string">&#x27;code RN app&#123;enter&#125;&#x27;</span>);</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// clicking &quot;Add&quot; button works too</span></span><br><span class="line">    byTestId(<span class="string">&#x27;add-todo&#x27;</span>).type(<span class="string">&#x27;add Expo&#x27;</span>);</span><br><span class="line">    byTestId(<span class="string">&#x27;add&#x27;</span>).click();</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    cy.log(<span class="string">&#x27;**complete item**&#x27;</span>);</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).find(tid(<span class="string">&#x27;toggle&#x27;</span>)).click();</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).should(<span class="string">&#x27;have.attr&#x27;</span>, <span class="string">&#x27;aria-label&#x27;</span>, <span class="string">&#x27;completed&#x27;</span>);</span><br><span class="line">    <span class="comment">// the other todo should still be incomplete</span></span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;add Expo&#x27;</span>).should(</span><br><span class="line">      <span class="string">&#x27;have.attr&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;aria-label&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;incomplete&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    cy.log(<span class="string">&#x27;**filters**&#x27;</span>);</span><br><span class="line">    byTestId(<span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;Active&#x27;</span>).click();</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;add Expo&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">    byTestId(<span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;Done&#x27;</span>).click();</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    cy.log(<span class="string">&#x27;**removing**&#x27;</span>);</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).find(tid(<span class="string">&#x27;delete&#x27;</span>)).click();</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;not.exist&#x27;</span>);</span><br><span class="line">    byTestId(<span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;All&#x27;</span>).click();</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;add Expo&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The test runs just like before, and the code is readable and easy to understand. The test is NOT coupled to the implementation details. We only interact with the external representation of the elements through the page. Thus we are free to refactor the internals of the application - as long as the test is passing, the application will be working for our users.</p>
<h2><span id="code-coverage">Code coverage</span></h2><p>Is our single test enough? Is it effective? Are there features in our application that the test does NOT cover? Let&#39;s add <a target="_blank" rel="noopener" href="https://on.cypress.io/code-coverage">code coverage</a> to find out. I have added <code>babel-plugin-istanbul</code> and <code>@cypress-io/code-coverage</code> plugin to generate the code coverage report.</p>
<figure class="highlight js"><figcaption><span>babel.config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  presets: [<span class="string">&#x27;babel-preset-expo&#x27;</span>],</span><br><span class="line">  plugins: [<span class="string">&#x27;istanbul&#x27;</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>cypress/support/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;@cypress/code-coverage/support&#x27;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>cypress/plugins/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">on, config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;@cypress/code-coverage/task&#x27;</span>)(on, config);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// add other tasks to be registered here</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// IMPORTANT to return the config object</span></span><br><span class="line">  <span class="comment">// with the any changed environment variables</span></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>When running the test, I can see the code coverage messages from the plugin.</p>
<p><img src="../images/rn-todo/cover-log.png" alt="The code coverage messages"></p>
<p>Let&#39;s open the HTML code coverage report</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ open coverage/lcov-report/index.html</span><br></pre></td></tr></table></figure>
<p><img src="../images/rn-todo/coverage.png" alt="The code coverage summary"></p>
<p>Our single complete end-to-end test covers 90% of the application&#39;s source code. Let&#39;s drill into individual files to find what the test has missed. For example, let&#39;s open the code coverage report of the reducers file.</p>
<p><img src="../images/rn-todo/missed.png" alt="The file report shows missed branches"></p>
<p>The source lines missed by the tests are highlighted in red. The missed branches and switch statements are highlighted in yellow. Our tests never encountered or tested an application error, thus we missed those lines.</p>
<h2><span id="testing-server-errors">Testing server errors</span></h2><p>Let&#39;s add a test verifies the error from the server is shown on load.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;shows error on load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.intercept(<span class="string">&#x27;http://localhost:3000/&#x27;</span>, &#123;</span><br><span class="line">    statusCode: <span class="number">500</span>,</span><br><span class="line">    body: &#123;</span><br><span class="line">      error: <span class="string">&#x27;Load failed&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;Load failed&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>We are using the <a target="_blank" rel="noopener" href="https://on.cypress.io/intercept">cy.intercept</a> command to mock the network call <em>outside</em> the browser. Thus our application really thinks that the server responded with status 500 and an error message.</p>
<p><img src="../images/rn-todo/load-failed.png" alt="Testing the load failed path"></p>
<p>Similarly, we can test how the application handles an error while creating a new Todo.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">it.only(<span class="string">&#x27;shows error on create&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> error = <span class="string">&#x27;Create todo failed&#x27;</span>;</span><br><span class="line">  cy.intercept(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:3000/create&#x27;</span>, &#123;</span><br><span class="line">    statusCode: <span class="number">500</span>,</span><br><span class="line">    body: &#123;</span><br><span class="line">      error,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;add-todo&#x27;</span>).type(<span class="string">&#x27;add Expo&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;add&#x27;</span>).click();</span><br><span class="line">  byTestId(<span class="string">&#x27;error&#x27;</span>, error).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>We can also avoid mocking the server. For example, the server disallows creating empty and duplicate items.</p>
<figure class="highlight js"><figcaption><span>server/app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createTodo = <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;text&#125; = req.body;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!text) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">&#x27;No text provided!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> todos = <span class="keyword">await</span> readTodos();</span><br><span class="line">    <span class="keyword">let</span> todo = todos.find(<span class="function"><span class="params">todo</span> =&gt;</span> todo.text === text);</span><br><span class="line">    <span class="keyword">if</span> (todo) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">&#x27;Todo already exists!&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      todo = &#123;text, <span class="attr">id</span>: <span class="built_in">Date</span>.now(), <span class="attr">done</span>: <span class="literal">false</span>&#125;;</span><br><span class="line">      todos.push(todo);</span><br><span class="line">      <span class="keyword">await</span> writeTodos(todos);</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> res.json(todo), TIMEOUT);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    next(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>Let&#39;s verify the application shows the error message send by the server in those cases.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;does not allow adding empty items&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// spy on the network call to create an item</span></span><br><span class="line">  cy.intercept(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:3000/create&#x27;</span>).as(<span class="string">&#x27;create&#x27;</span>);</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    <span class="comment">// note: this delay should not be necessary</span></span><br><span class="line">    <span class="comment">// but the application has a logical error</span></span><br><span class="line">    <span class="comment">// if the error happens quickly, the quickly disappears</span></span><br><span class="line">    .wait(<span class="number">500</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;add-todo&#x27;</span>).should(<span class="string">&#x27;have.value&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;add&#x27;</span>).click();</span><br><span class="line">  <span class="comment">// from the network spy, get the response object</span></span><br><span class="line">  <span class="comment">// and extract the error message</span></span><br><span class="line">  cy.wait(<span class="string">&#x27;@create&#x27;</span>)</span><br><span class="line">    .its(<span class="string">&#x27;response.body.error&#x27;</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      expect(error).to.be.a(<span class="string">&#x27;string&#x27;</span>);</span><br><span class="line">      byTestId(<span class="string">&#x27;error&#x27;</span>, error).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Similar test confirms we cannot add duplicate items.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;does not allow duplicates&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// spy on the network call to create an item</span></span><br><span class="line">  cy.intercept(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:3000/create&#x27;</span>).as(<span class="string">&#x27;create&#x27;</span>);</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;add-todo&#x27;</span>).type(<span class="string">&#x27;duplicate&#123;enter&#125;&#x27;</span>);</span><br><span class="line">  cy.wait(<span class="string">&#x27;@create&#x27;</span>); <span class="comment">// first call is successful</span></span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  byTestId(<span class="string">&#x27;add-todo&#x27;</span>).type(<span class="string">&#x27;duplicate&#123;enter&#125;&#x27;</span>);</span><br><span class="line">  <span class="comment">// second call should fail</span></span><br><span class="line">  cy.wait(<span class="string">&#x27;@create&#x27;</span>)</span><br><span class="line">    .its(<span class="string">&#x27;response.body.error&#x27;</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      expect(error).to.be.a(<span class="string">&#x27;string&#x27;</span>);</span><br><span class="line">      byTestId(<span class="string">&#x27;error&#x27;</span>, error).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="../images/rn-todo/duplicate.png" alt="Duplicate item error test"></p>
<p>Let&#39;s confirm that we cannot delete an item with invalid id, and that the error message is shown. We will change the ID field in the outgoing request before it goes to the server.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;shows error on delete&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// intercept the network call and change the item&#x27;s id</span></span><br><span class="line">  <span class="comment">// to cause the delete to fail</span></span><br><span class="line">  cy.intercept(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://localhost:3000/delete&#x27;</span>, <span class="function"><span class="params">req</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// set invalid id</span></span><br><span class="line">    req.body.id = <span class="number">10</span>;</span><br><span class="line">  &#125;).as(<span class="string">&#x27;delete&#x27;</span>);</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;add-todo&#x27;</span>).type(<span class="string">&#x27;write tests&#123;enter&#125;&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).first().find(tid(<span class="string">&#x27;delete&#x27;</span>)).click();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// the delete call should fail</span></span><br><span class="line">  cy.wait(<span class="string">&#x27;@delete&#x27;</span>)</span><br><span class="line">    .its(<span class="string">&#x27;response.body.error&#x27;</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      expect(error).to.be.a(<span class="string">&#x27;string&#x27;</span>);</span><br><span class="line">      byTestId(<span class="string">&#x27;error&#x27;</span>, error).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="comment">// the original todo is still there</span></span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;write tests&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="../images/rn-todo/delete-error.png" alt="Cannot delete invalid item test"></p>
<p>We can similarly test the edge case when the user tries to complete a Todo with invalid ID. All tests run in about 7 seconds.</p>
<p><img src="../images/rn-todo/all-tests.gif" alt="Running all tests"></p>
<p>With these API tests, we get a new code coverage report that shows our tests cover 97% of the application&#39;s code.</p>
<p><img src="../images/rn-todo/new-cover.png" alt="New code coverage report"></p>
<p>We can continue chasing each missed line. We can also instrument and collect code coverage from the server&#39;s JavaScript code, see the <a href="/blog/backend-coverage/" title="Backend Code Coverage from Cypress API tests">Backend Code Coverage from Cypress API tests</a> post.</p>
<h2><span id="continuous-integration">Continuous integration</span></h2><p>We definitely need to test our application on every commit and every pull request. Let&#39;s use <a href="/blog/trying-github-actions/" title="GitHub Actions">GitHub Actions</a> workflow to run our application and execute Cypress tests.</p>
<figure class="highlight yml"><figcaption><span>.github/workflows/ci.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">e2e</span></span><br><span class="line"><span class="attr">on:</span> [<span class="string">push</span>, <span class="string">pull_request</span>]</span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">cypress-run:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-20.04</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># Install NPM dependencies, cache them correctly</span></span><br><span class="line">      <span class="comment"># and run all Cypress tests</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cypress</span> <span class="string">run</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">start:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">web:server</span></span><br><span class="line">          <span class="attr">wait-on:</span> <span class="string">&#x27;http://localhost:19006&#x27;</span></span><br></pre></td></tr></table></figure>
<p>Each spec file is executed on CI.</p>
<p><img src="../images/rn-todo/ci.png" alt="Tests running on CI"></p>
<p><strong>Tip:</strong> I like adding Cypress version badge to my example projects to communicate to the readers if the project is up-to-date. Read the blog post <a href="/blog/keep-examples-up-to-date/" title="Keep Examples Up To Date">Keep Examples Up To Date</a>.</p>
<h2><span id="visual-testing">Visual testing</span></h2><p>Our application looks nice, doesn&#39;t it? What if someone changes the layout or CSS properties, making it look ugly? Can we prevent style regressions? Yes, with the help of <a target="_blank" rel="noopener" href="https://on.cypress.io/visual-testing">visual testing</a>. For this project, I have added <a target="_blank" rel="noopener" href="https://docs.percy.io/docs/cypress">Percy.io visual service</a>.</p>
<p>At every major step of the test, I take the full app screenshot using Percy command <code>cy.percySnapshot(name)</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;adds todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">  <span class="comment">// using Enter works on the web</span></span><br><span class="line">  byTestId(<span class="string">&#x27;add-todo&#x27;</span>).should(<span class="string">&#x27;have.focus&#x27;</span>).type(<span class="string">&#x27;code RN app&#123;enter&#125;&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="comment">// clicking &quot;Add&quot; button works too</span></span><br><span class="line">  byTestId(<span class="string">&#x27;add-todo&#x27;</span>).type(<span class="string">&#x27;add Expo&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;add&#x27;</span>).click();</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// visual snapshot</span></span><br><span class="line">  cy.percySnapshot(<span class="string">&#x27;two items&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  cy.log(<span class="string">&#x27;**complete item**&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).find(tid(<span class="string">&#x27;toggle&#x27;</span>)).click();</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).should(<span class="string">&#x27;have.attr&#x27;</span>, <span class="string">&#x27;aria-label&#x27;</span>, <span class="string">&#x27;completed&#x27;</span>);</span><br><span class="line">  <span class="comment">// the other todo should still be incomplete</span></span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;add Expo&#x27;</span>).should(</span><br><span class="line">    <span class="string">&#x27;have.attr&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;aria-label&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;incomplete&#x27;</span>,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  cy.percySnapshot(<span class="string">&#x27;completed first item&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  cy.log(<span class="string">&#x27;**filters**&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;Active&#x27;</span>).click();</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;add Expo&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;Done&#x27;</span>).click();</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  cy.log(<span class="string">&#x27;**removing**&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).find(tid(<span class="string">&#x27;delete&#x27;</span>)).click();</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;not.exist&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;filter&#x27;</span>, <span class="string">&#x27;All&#x27;</span>).click();</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;add Expo&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>You can see the results at <a target="_blank" rel="noopener" href="https://percy.io/bahmutov/ReactNativeTodo">https://percy.io/bahmutov/ReactNativeTodo</a>. The first time it runs, I need to approve the images.</p>
<p><img src="../images/rn-todo/percy.gif" alt="Reviewing app screenshots at Percy dashboard"></p>
<p><strong>Note:</strong> currently the rendered screenshots are missing icons, I am investigating, see <a target="_blank" rel="noopener" href="https://github.com/percy/percy-cypress/issues/366">issue 366</a>.</p>
<h2><span id="cypress-dashboard">Cypress dashboard</span></h2><p>Whenever Cypress executes tests, it captures the video of the entire test run. If there are any failed tests, Cypress saves an image with the failure. We could store these videos and images as <a target="_blank" rel="noopener" href="https://github.com/cypress-io/github-action#artifacts">CI test artifacts</a> but a more useful approach is to record them on <a target="_blank" rel="noopener" href="https://on.cypress.io/dashboard-introduction">Cypress Dashboard</a>.</p>
<p><img src="../images/rn-todo/set-recording.png" alt="Setting up test recording on Cypress Dashboard"></p>
<p>We should set the shown record key as repo secret and pass to the test runner as an environment variable.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># run Cypress tests with Percy</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cypress</span> <span class="string">run</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v2</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">install:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">command-prefix:</span> <span class="string">&#x27;percy exec -- npx&#x27;</span></span><br><span class="line">    <span class="attr">wait-on:</span> <span class="string">&#x27;http://localhost:19006&#x27;</span></span><br><span class="line">    <span class="attr">record:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">all</span></span><br><span class="line">  <span class="comment"># inject the Percy token</span></span><br><span class="line">  <span class="attr">env:</span></span><br><span class="line">    <span class="attr">PERCY_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.PERCY_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">CYPRESS_RECORD_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.CYPRESS_RECORD_KEY</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>You can see the recorded tests on the Dashboard <a target="_blank" rel="noopener" href="https://dashboard.cypress.io/projects/hyr4ik">here</a>. You can see each test run and drill down into each test.</p>
<p><img src="../images/rn-todo/dashboard.png" alt="Recorded tests on Cypress Dashboard"></p>
<p>The entire dev team can access all test results in a single place and track the test stats along each branch across the entire project&#39;s lifetime.</p>
<h2><span id="accessability-testing">Accessability testing</span></h2><p>Let&#39;s install <a target="_blank" rel="noopener" href="https://github.com/component-driven/cypress-axe">cypress-axe</a> plugin to find a11y problems in our app.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev cypress-axe axe-core</span><br><span class="line">+ cypress-axe@0.12.2</span><br><span class="line">+ axe-core@4.2.2</span><br></pre></td></tr></table></figure>
<p>We could write a separate accessability test, but I prefer inserting the a11y checking commands into the regular tests, similar to visual testing.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;adds todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">  <span class="comment">// using Enter works on the web</span></span><br><span class="line">  byTestId(<span class="string">&#x27;add-todo&#x27;</span>).should(<span class="string">&#x27;have.focus&#x27;</span>).type(<span class="string">&#x27;code RN app&#123;enter&#125;&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="comment">// clicking &quot;Add&quot; button works too</span></span><br><span class="line">  byTestId(<span class="string">&#x27;add-todo&#x27;</span>).type(<span class="string">&#x27;add Expo&#x27;</span>);</span><br><span class="line">  byTestId(<span class="string">&#x27;add&#x27;</span>).click();</span><br><span class="line">  byTestId(<span class="string">&#x27;todo&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// visual snapshot</span></span><br><span class="line">  cy.percySnapshot(<span class="string">&#x27;two items&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// a11y check</span></span><br><span class="line">  cy.injectAxe();</span><br><span class="line">  cy.checkA11y();</span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The first time the test runs, it finds 5 violations and fails the test.</p>
<p><img src="../images/rn-todo/a11y-test.png" alt="The test fails due to a11y errors"></p>
<p>By clicking on each violation we can print the details to the DevTols console. For example, the first violation has determined that the contrast on the filters buttons is too low.</p>
<p><img src="../images/rn-todo/contrast.png" alt="The contrast violation"></p>
<p>When starting with a11y testing, you probably will have lots of errors. I recommend running just some important tests first, fixing the issues, then expanding the tests. Let&#39;s ensure the color contrast is correct by testing the <code>cat.color</code> only:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cy.checkA11y(<span class="literal">null</span>, &#123;</span><br><span class="line">  runOnly: &#123;</span><br><span class="line">    type: <span class="string">&#x27;tag&#x27;</span>,</span><br><span class="line">    values: [<span class="string">&#x27;cat.color&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>We can make the button background color darker to <code>#484848</code> to pass the test. Then we can add another Axe check after completing an item.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cy.log(<span class="string">&#x27;**complete item**&#x27;</span>);</span><br><span class="line">byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).find(tid(<span class="string">&#x27;toggle&#x27;</span>)).click();</span><br><span class="line">byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;code RN&#x27;</span>).should(<span class="string">&#x27;have.attr&#x27;</span>, <span class="string">&#x27;aria-label&#x27;</span>, <span class="string">&#x27;completed&#x27;</span>);</span><br><span class="line"><span class="comment">// the other todo should still be incomplete</span></span><br><span class="line">byTestId(<span class="string">&#x27;todo&#x27;</span>, <span class="string">&#x27;add Expo&#x27;</span>).should(</span><br><span class="line">  <span class="string">&#x27;have.attr&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;aria-label&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;incomplete&#x27;</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">cy.percySnapshot(<span class="string">&#x27;completed first item&#x27;</span>);</span><br><span class="line">cy.checkA11y(<span class="literal">null</span>, &#123;</span><br><span class="line">  runOnly: &#123;</span><br><span class="line">    type: <span class="string">&#x27;tag&#x27;</span>,</span><br><span class="line">    values: [<span class="string">&#x27;cat.color&#x27;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The check fails - the contrast is too low.</p>
<p><img src="../images/rn-todo/completed-contrast.png" alt="The text contrast violation"></p>
<p>We fix the application and test again. This time, the test is green.</p>
<p><img src="../images/rn-todo/fixed-contrast.png" alt="The application without a11y color violations"></p>
<p>I have opened a pull request with a11y checks <a target="_blank" rel="noopener" href="https://github.com/bahmutov/ReactNativeTodo/pull/1">#1</a>. Notice that the functional Cypress tests passed, while visual tests have caught the background color change. The GitHub checks show the failed Percy check.</p>
<p><img src="../images/rn-todo/visual-checks.png" alt="Functional and visual checks"></p>
<p>We can click on the failed visual check to review the changes and approve it at the Percy Dashboard.</p>
<p><img src="../images/rn-todo/visual-diff.gif" alt="Visual differences in buttons and text"></p>
<p>Once we review the visual changes and approve them, the GitHub check turns green.</p>
<p><img src="../images/rn-todo/visual-checks-green.png" alt="The pull request is ready to go"></p>
<h2><span id="unit-testing">Unit testing</span></h2><p>Occasionally you need unit tests. For example, when refactoring actions or reducers it helps to run just their unit tests. The current project includes Jest unit tests, here are tests for actions.</p>
<figure class="highlight js"><figcaption><span>__tests__/actions/actions.test.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Actions <span class="keyword">from</span> <span class="string">&#x27;../../actions&#x27;</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;Action creators&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;Creates CREATE_TODO action&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> action = &#123; <span class="attr">type</span>: Actions.CREATE_TODO, <span class="attr">text</span>: <span class="string">&#x27;Todo&#x27;</span> &#125;;</span><br><span class="line">    expect(Actions.createTodo(<span class="string">&#x27;Todo&#x27;</span>)).toStrictEqual(action);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Such unit tests are easy to recreate in Cypress - just replace Jest assertions with Chai ones.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/actions-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Actions <span class="keyword">from</span> <span class="string">&#x27;../../actions&#x27;</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;Action creators&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;Creates CREATE_TODO action&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> action = &#123; <span class="attr">type</span>: Actions.CREATE_TODO, <span class="attr">text</span>: <span class="string">&#x27;Todo&#x27;</span> &#125;;</span><br><span class="line">    expect(Actions.createTodo(<span class="string">&#x27;Todo&#x27;</span>)).to.deep.equal(action);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Similarly, async actions can also be tested. Compare the Jest test</p>
<figure class="highlight js"><figcaption><span>__tests__/actions/actions.test.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> configureMockStore <span class="keyword">from</span> <span class="string">&#x27;redux-mock-store&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Api <span class="keyword">from</span> <span class="string">&#x27;../../api&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Actions <span class="keyword">from</span> <span class="string">&#x27;../../actions&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mockStore = configureMockStore([ thunk ]);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;Async actions&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;Handles successful fetch&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> store = mockStore();</span><br><span class="line">    <span class="keyword">const</span> todos = [&#123; <span class="attr">text</span>: <span class="string">&#x27;Text&#x27;</span>, <span class="attr">id</span>: <span class="number">123</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;];</span><br><span class="line">    <span class="comment">// Mock async API method success</span></span><br><span class="line">    <span class="keyword">const</span> fetchTodosMock = jest.spyOn(Api, <span class="string">&#x27;fetchTodos&#x27;</span>).mockResolvedValue(todos);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectedActions = [</span><br><span class="line">      Actions.fetchTodos(),</span><br><span class="line">      Actions.fetchTodosSuccess(todos),</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If a test returns nothing it will pass by default</span></span><br><span class="line">    <span class="keyword">return</span> store</span><br><span class="line">      <span class="comment">// Dispatch async action</span></span><br><span class="line">      .dispatch(Actions.fetchTodosAsync())</span><br><span class="line">      <span class="comment">// Wait for async action to complete</span></span><br><span class="line">      .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// Mocked method is called</span></span><br><span class="line">        expect(fetchTodosMock).toHaveBeenCalled();</span><br><span class="line">        <span class="comment">// Expected actions are dispatched</span></span><br><span class="line">        expect(store.getActions()).toStrictEqual(expectedActions);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>To its equivalent Cypress test:</p>
<figure class="highlight js"><figcaption><span>cypress/integration/actions-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> configureMockStore <span class="keyword">from</span> <span class="string">&#x27;redux-mock-store&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Api <span class="keyword">from</span> <span class="string">&#x27;../../api&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Actions <span class="keyword">from</span> <span class="string">&#x27;../../actions&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mockStore = configureMockStore([ thunk ]);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;Async actions&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;Handles successful fetch&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> store = mockStore();</span><br><span class="line">    <span class="keyword">const</span> todos = [&#123; <span class="attr">text</span>: <span class="string">&#x27;Text&#x27;</span>, <span class="attr">id</span>: <span class="number">123</span>, <span class="attr">done</span>: <span class="literal">false</span> &#125;];</span><br><span class="line">    <span class="comment">// Mock async API method success</span></span><br><span class="line">    cy.stub(Api, <span class="string">&#x27;fetchTodos&#x27;</span>).resolves(todos)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectedActions = [</span><br><span class="line">      Actions.fetchTodos(),</span><br><span class="line">      Actions.fetchTodosSuccess(todos),</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If a test returns nothing it will pass by default</span></span><br><span class="line">    <span class="keyword">return</span> store</span><br><span class="line">      <span class="comment">// Dispatch async action</span></span><br><span class="line">      .dispatch(Actions.fetchTodosAsync())</span><br><span class="line">      <span class="comment">// Wait for async action to complete</span></span><br><span class="line">      .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// Mocked method is called</span></span><br><span class="line">        expect(Api.fetchTodos).to.have.been.called</span><br><span class="line">        <span class="comment">// Expected actions are dispatched</span></span><br><span class="line">        expect(store.getActions()).to.deep.equal(expectedActions);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>We are using Sinon stubs via <a target="_blank" rel="noopener" href="https://on.cypress.io/stub">cy.stub</a> and Chai assertions. We can also rewrite the above test to expose more of the objects to Cypress logging.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/actions-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">describe(<span class="string">&#x27;Async actions&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;Handles successful fetch&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> store = mockStore();</span><br><span class="line">    <span class="keyword">const</span> todos = [&#123;<span class="attr">text</span>: <span class="string">&#x27;Text&#x27;</span>, <span class="attr">id</span>: <span class="number">123</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;];</span><br><span class="line">    <span class="comment">// Mock async API method success</span></span><br><span class="line">    cy.stub(Api, <span class="string">&#x27;fetchTodos&#x27;</span>).resolves(todos).as(<span class="string">&#x27;fetchTodos&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> expectedActions = [</span><br><span class="line">      Actions.fetchTodos(),</span><br><span class="line">      Actions.fetchTodosSuccess(todos),</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    cy.wrap(store).invoke(<span class="string">&#x27;dispatch&#x27;</span>, Actions.fetchTodosAsync());</span><br><span class="line">    cy.get(<span class="string">&#x27;@fetchTodos&#x27;</span>).should(<span class="string">&#x27;have.been.called&#x27;</span>);</span><br><span class="line">    cy.wrap(store).invoke(<span class="string">&#x27;getActions&#x27;</span>).should(<span class="string">&#x27;deep.equal&#x27;</span>, expectedActions);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>We can click on the Command Log entry to get more information, for example we can look at the <code>store.getActions()</code> command by clicking on the <code>.invoke(&#39;getActions&#39;)</code> entry. It prints the store object, and the yielded value, allowing us to see clearly what has happened.</p>
<p><img src="../images/rn-todo/invoke.png" alt="Inspecting individual method call"></p>
<p>The above exploration experience during testing and the debugging speed are my favorite features of running the browser unit tests in Cypress. You can find unit tests for actions, reduces, and sagas in the <a target="_blank" rel="noopener" href="https://github.com/bahmutov/ReactNativeTodo/tree/main/cypress/integration">cypress/integration</a> folder.</p>
<h2><span id="api-tests">API tests</span></h2><p>The original ReactNativeTodo repository has a few API tests, but these are NOT true API tests that exercise the backend server. Instead, these tests exercise the API wrapper that calls <code>fetch</code>. A typical test looks like this:</p>
<figure class="highlight js"><figcaption><span>__tests__/api/api.test.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Api <span class="keyword">from</span> <span class="string">&#x27;../../api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; GET, POST &#125; = Api;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;asyncRequest()&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fetchMock = <span class="built_in">global</span>.fetch = jest.fn();</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;Handles GET requests&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&#x27;http://localhost:3000/&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> params = &#123;</span><br><span class="line">      method: GET,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    Api.asyncRequest();</span><br><span class="line">    expect(fetchMock).toHaveBeenCalledWith(url, params);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The Cypress version looks like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Api <span class="keyword">from</span> <span class="string">&#x27;../../api&#x27;</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;asyncRequest()&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Cypress stubs are reset before each test</span></span><br><span class="line">  beforeEach(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.spy(<span class="built_in">window</span>, <span class="string">&#x27;fetch&#x27;</span>).as(<span class="string">&#x27;fetch&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  it(<span class="string">&#x27;Handles GET requests&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">&#x27;http://localhost:3000/&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> params = &#123;</span><br><span class="line">      method: GET,</span><br><span class="line">      headers: &#123;</span><br><span class="line">        Accept: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    Api.asyncRequest();</span><br><span class="line">    cy.get(<span class="string">&#x27;@fetch&#x27;</span>).should(<span class="string">&#x27;have.been.calledWith&#x27;</span>, url, params);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2><span id="network-tests">Network tests</span></h2><p>We can write better API tests by spying on the network calls made by the browser using <a target="_blank" rel="noopener" href="https://on.cypress.io/intercept">cy.intercept</a> command, rather than spying on the <code>window.fetch</code> function.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Api <span class="keyword">from</span> <span class="string">&#x27;../../api&#x27;</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;network&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// use cy.intercept command to spy on the</span></span><br><span class="line">  <span class="comment">// actual network calls made by the code</span></span><br><span class="line">  it(<span class="string">&#x27;creates todos&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> apiUrl = <span class="string">&#x27;http://localhost:3000&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    cy.intercept(<span class="string">`<span class="subst">$&#123;apiUrl&#125;</span>/`</span>, <span class="function"><span class="params">req</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// make sure the call is not cached by the browser</span></span><br><span class="line">      <span class="keyword">delete</span> req.headers[<span class="string">&#x27;if-none-match&#x27;</span>];</span><br><span class="line">    &#125;)</span><br><span class="line">      .as(<span class="string">&#x27;todos&#x27;</span>)</span><br><span class="line">      .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// once we prepared the intercept</span></span><br><span class="line">        <span class="comment">// make the call using the app code</span></span><br><span class="line">        Api.asyncRequest();</span><br><span class="line">      &#125;);</span><br><span class="line">    cy.wait(<span class="string">&#x27;@todos&#x27;</span>).its(<span class="string">&#x27;response.body&#x27;</span>).should(<span class="string">&#x27;be.an&#x27;</span>, <span class="string">&#x27;array&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// delete all items</span></span><br><span class="line">    cy.request(<span class="string">&#x27;POST&#x27;</span>, <span class="string">`<span class="subst">$&#123;apiUrl&#125;</span>/delete-all`</span>).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> Api.asyncRequest();</span><br><span class="line">    &#125;);</span><br><span class="line">    cy.wait(<span class="string">&#x27;@todos&#x27;</span>).its(<span class="string">&#x27;response.body&#x27;</span>).should(<span class="string">&#x27;deep.equal&#x27;</span>, []);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// let&#x27;s add a new item</span></span><br><span class="line">    <span class="keyword">const</span> todo = &#123;<span class="attr">text</span>: <span class="string">&#x27;Todo&#x27;</span>&#125;;</span><br><span class="line">    cy.then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> Api.asyncRequest(POST, <span class="string">&#x27;create&#x27;</span>, todo);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// we can also add new async commands by wrapping</span></span><br><span class="line">    <span class="comment">// the object and using cy.invoke method</span></span><br><span class="line">    cy.wrap(Api).invoke(<span class="string">&#x27;fetchTodos&#x27;</span>);</span><br><span class="line">    <span class="comment">// 1 todo item</span></span><br><span class="line">    cy.wait(<span class="string">&#x27;@todos&#x27;</span>)</span><br><span class="line">      .its(<span class="string">&#x27;response.body&#x27;</span>)</span><br><span class="line">      .should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">      .its(<span class="number">0</span>)</span><br><span class="line">      <span class="comment">// each new todo item gets a random ID</span></span><br><span class="line">      <span class="comment">// and property &quot;done: false&quot; at start</span></span><br><span class="line">      .should(<span class="string">&#x27;deep.include&#x27;</span>, todo)</span><br><span class="line">      .and(<span class="function"><span class="params">todo</span> =&gt;</span> &#123;</span><br><span class="line">        expect(todo).to.have.property(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">        expect(todo).to.have.property(<span class="string">&#x27;done&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>The Command Log shows each network spy and Ajax call. We can combine multiple network calls, and can even create hybrid UI + network tests.</p>
<p><img src="../images/rn-todo/network-test.png" alt="Cypress network test again the backend"></p>
<p><strong>Tip:</strong> for better API tests using Cypress, see <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2017/11/07/add-gui-to-your-e2e-api-tests/">Add GUI to your E2E API tests</a> and use <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cy-api">bahmutov/cy-api</a> plugin.</p>
<h2><span id="component-testing">Component testing</span></h2><p>Since I have created component testing for React a few years ago, it became part of <a target="_blank" rel="noopener" href="https://on.cypress.io/component-testing">Cypress core</a>. I have yet to figure out how to use Metro / Expo web bundler to serve individual React Native components during tests. Stay tuned.</p>
<h2><span id="help-wanted">Help wanted</span></h2><p>Do you want to help me write and test similar React Native applications at <a target="_blank" rel="noopener" href="https://www.mercari.com/">Mercari US</a>? We need every technologist, from the web to the backend, to micro-services, to quality assurance, machine learning, AI, and other buzzwords. All positions are listed at <a target="_blank" rel="noopener" href="https://www.mercari.com/careers/">https://www.mercari.com/careers/</a> and are remote in United States and Japan, and I guarantee a healthy professional environment with solid benefits and a huge career potential. If you ping me, I promise to answer your questions and do a referral. <strong>Career tip:</strong> read the blog posts <a href="/blog/help-me-say-yes/" title="Help Me Say Yes">Help Me Say Yes</a> and <a href="/blog/dont-help-me-say-no/" title="Don&#39;t help me say No">Don&#39;t help me say No</a> before applying.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  <p>
    Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
    see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
    watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
    browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
  </p>
  <p>
    Want to know more about Cypress? Check out <a href="https://cypress.tips" target="_blank">cypress.tips</a>
  </p>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/testing-rn-todo-app/" data-id="ckw25dphf020edtvg5axsabnw" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/testing-rn-todo-app/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/a11y/" rel="tag">a11y</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/" rel="tag">cypress</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/react-native/" rel="tag">react native</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/testing/" rel="tag">testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../sanity-test/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Sanity Test for Landing Page
        
      </div>
    </a>
  
  
    <a href="../stubbing-the-non-configurable/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Stubbing The Non-configurable</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">138</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">430</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">109</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">156</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">68</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">165</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">133</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.38px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.54px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.77px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.85px;">advice</a> <a href="../tags/algolia/" style="font-size: 10.38px;">algolia</a> <a href="../tags/angularjs/" style="font-size: 17.69px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.08px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.69px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.77px;">browser</a> <a href="../tags/ci/" style="font-size: 16.54px;">ci</a> <a href="../tags/circle/" style="font-size: 13.46px;">circle</a> <a href="../tags/climate/" style="font-size: 14.62px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 14.62px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.31px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 19.62px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 13.85px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.77px;">d3</a> <a href="../tags/db/" style="font-size: 14.62px;">db</a> <a href="../tags/docker/" style="font-size: 14.23px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.92px;">documentation</a> <a href="../tags/es6/" style="font-size: 14.62px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.08px;">functional</a> <a href="../tags/generators/" style="font-size: 11.54px;">generators</a> <a href="../tags/git/" style="font-size: 15px;">git</a> <a href="../tags/github/" style="font-size: 15.38px;">github</a> <a href="../tags/graphql/" style="font-size: 11.54px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.31px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.77px;">gulp</a> <a href="../tags/hiring/" style="font-size: 10.77px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.31px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.54px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.77px;">interview</a> <a href="../tags/jade/" style="font-size: 11.15px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.77px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.85px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 16.92px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.15px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.46px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.15px;">performance</a> <a href="../tags/presentation/" style="font-size: 12.31px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.31px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.38px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/react/" style="font-size: 11.54px;">react</a> <a href="../tags/react-native/" style="font-size: 11.15px;">react native</a> <a href="../tags/reactive/" style="font-size: 14.23px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.15px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.54px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 13.08px;">security</a> <a href="../tags/sentry/" style="font-size: 13.85px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.92px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.23px;">testing</a> <a href="../tags/tutorial/" style="font-size: 15.77px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 12.31px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.38px;">ui</a> <a href="../tags/vercel/" style="font-size: 13.08px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.15px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.54px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.92px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.77px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/11/">November 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/10/">October 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/09/">September 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/08/">August 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../flaky-cy-type/">Solve Flake In Cypress Typing Into An Input Element</a>
          </li>
        
          <li>
            <a href="../parallelism-parameter/">CircleCI Parallelism As A Parameter</a>
          </li>
        
          <li>
            <a href="../test-sitemap/">Test your sitemap using Cypress</a>
          </li>
        
          <li>
            <a href="../cypress-grep-filters/">Faster test execution with cypress-grep</a>
          </li>
        
          <li>
            <a href="../cypresss-data-session/">Flexible Cypress Data Setup And Validation</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/testing-rn-todo-app/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
