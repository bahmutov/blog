<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Immutable JavaScript example | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="I prefer using Array.prototype.map over Array.prototype.forEach because .map semantically  signals to everyone that it constructs a new array, while .forEach might modify the existing one.  In order t">
<meta property="og:type" content="article">
<meta property="og:title" content="Immutable JavaScript example">
<meta property="og:url" content="https://glebbahmutov.com/blog/immutable-javascript-example/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="I prefer using Array.prototype.map over Array.prototype.forEach because .map semantically  signals to everyone that it constructs a new array, while .forEach might modify the existing one.  In order t">
<meta property="og:locale">
<meta property="article:published_time" content="2014-11-22T05:00:00.000Z">
<meta property="article:modified_time" content="2021-06-15T13:13:30.293Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="immutable">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-immutable-javascript-example" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2014-11-22T05:00:00.000Z" itemprop="datePublished">Nov 22 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Immutable JavaScript example
    </h1>

    <h2 class="article-title" itemprop="name">
      Implementing Todo list with Undo using immutable data structure.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I prefer using <code>Array.prototype.map</code> over <code>Array.prototype.forEach</code> because <code>.map</code> semantically 
signals to everyone that it constructs a new array, while <code>.forEach</code> might modify the existing one. 
In order to actually prevent modifying the array in <code>.map</code>, one needs to use an immutable
array, see <a href="../avoid-side-effects-with-immutable-data-structures/">Avoiding Side Effects</a> blog post. In this blog post I will
show another benefit of using an immutable list in my JavaScript programs - easy implementation
of Undo command.</p>
<p>This is an exploration in progress of immutable data in JavaScript. 
I am not sure that this example clearly shows the advantages of immutability. Consider this a
practice exercise. I implement a Todo list using the traditional object oriented encapsulation
and the same features using an immutable data structure. I also answered a few questions at the end of this
blog post; these questions poped up as I was working with immutable objects.</p>
<h2><span id="todo-list-using-oo">Todo list using OO</span></h2><p>I will start with implementing a simple Todo list using a regular array. Each item has a label and
<code>done</code> property.</p>
<h3><span id="using-individual-todo-items">Using individual todo items</span></h3><p>My initial implementation allows to directly modify the state of a todo item in the collection</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Todos</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _todos = [];</span><br><span class="line">  <span class="keyword">var</span> todosModule = &#123;</span><br><span class="line">    add: <span class="function"><span class="keyword">function</span> (<span class="params">label</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> newTodo = &#123;</span><br><span class="line">        label: label,</span><br><span class="line">        done: <span class="literal">false</span></span><br><span class="line">      &#125;;</span><br><span class="line">      _todos.push(newTodo);</span><br><span class="line">      <span class="keyword">return</span> newTodo;</span><br><span class="line">    &#125;,</span><br><span class="line">    toString: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _todos.map(<span class="function"><span class="keyword">function</span> (<span class="params">todo</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> todo.label + <span class="string">&#x27; &#x27;</span> + (todo.done ? <span class="string">&#x27;done&#x27;</span> : <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      &#125;).join(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> todosModule;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The above code makes marking an individual item as done very convenient</p>
<pre><code>// typical use
var todos = Todos();
var doFoo = todos.add(&apos;foo&apos;);
var doBar = todos.add(&apos;bar&apos;);
console.log(todos.toString());
// foo
// bar
doFoo.done = true;
console.log(todos.toString());
// foo done
// bar
doBar.done = true;
console.log(todos.toString());
// foo done
// bar done
</code></pre><p>Unfortunately I do not see how to implement <code>todos.undo()</code> if the list has no idea what has happened.
I will need to move <code>done</code> into the <code>todos</code> object</p>
<h3><span id="using-todos-api-to-mark-item-done">Using Todos API to mark item done</span></h3><pre><code>function Todos() &#123;
  var _todos = [];
  var todosModule = &#123;
    add: function (label) &#123;
      _todos.push(&#123;
        label: label,
        done: false
      &#125;);
      return todosModule;
    &#125;,
    done: function (index) &#123;
      _todos[index].done = true;
      return todosModule;
    &#125;,
    toString: function () &#123;
      return _todos.map(function (todo) &#123;
        return todo.label + &apos; &apos; + (todo.done ? &apos;done&apos; : &apos;&apos;);
      &#125;).join(&apos;\n&apos;);
    &#125;
  &#125;;
  return todosModule;
&#125;
</code></pre><p>The <code>Todos</code> object only has 3 methods <code>add</code>, <code>done</code> and <code>toString</code>. One can easily add tasks,
print them, and mark an individual task as done.</p>
<pre><code>var todos = Todos();
todos
  .add(&apos;foo&apos;)
  .add(&apos;bar&apos;);
console.log(todos.toString());
// foo
// bar
todos.done(0);
console.log(todos.toString());
// foo done
// bar
todos.done(1);
console.log(todos.toString());
// foo done
// bar done
</code></pre><p>There is only a single reference <code>todos</code> always pointing at the same object. When we call <code>todos.add</code> we modify
the only instance. This makes implementing <code>undo</code> simple.</p>
<h2><span id="cleardone">clearDone</span></h2><p>If we mark items done, let us clear the list of done items too.</p>
<pre><code>clearDone: function () &#123;
  _todos = _todos.filter(function (todo) &#123;
    return !todo.done;
  &#125;);
  return todosModule;
&#125;
// use clearDone
var todos = Todos();
todos.add(&apos;foo&apos;).add(&apos;bar&apos;);
todos.done(0);
console.log(todos.toString());
// foo done
// bar
todos.clearDone();
console.log(todos.toString());
// bar
</code></pre><h2><span id="undo-cleardone-command">Undo clearDone command</span></h2><p>We will keep track of <code>done</code> calls using list of commands. Each command is an object that can reverse a
previous <code>todos</code> list modification. An example of a command with undo:</p>
<pre><code>var sum = 0;
function add(a) &#123;
    sum += a;
    return &#123;
        undo: function () &#123;
            sum -= a;
        &#125;
    &#125;;
&#125;
var undoAdd10 = add(10); // sum = 10
var undoAdd20 = add(20); // sum = 30
undoAdd20.undo(); // sum = 10
undoAdd10.undo(); // sum = 0
</code></pre><p>We should respect the action order, thus we will use a stack to keep list of commands to undo
them in reverse order.</p>
<pre><code>function Todos() &#123;
  var _todos = [];
  var _commands = [];
  var todosModule = &#123;
    add: function (label) &#123;
      _todos.push(&#123;
        label: label,
        done: false
      &#125;);
      return todosModule;
    &#125;,
    done: function (index) &#123;
      _todos[index].done = true;
      return todosModule;
    &#125;,
    toString: function () &#123;
      return _todos.map(function (todo) &#123;
        return todo.label + &apos; &apos; + (todo.done ? &apos;done&apos; : &apos;&apos;);
      &#125;).join(&apos;\n&apos;);
    &#125;,
    clearDone: function () &#123;
      _commands.push(&#123;
        // save entire list using undo function closure
        undo: function (prevTodos) &#123;
          _todos = prevTodos;
        &#125;.bind(null, _todos)
      &#125;);
      _todos = _todos.filter(function (todo) &#123;
        return !todo.done;
      &#125;);
      return todosModule;
    &#125;,
    undo: function () &#123;
      if (_commands.length) &#123;
        _commands.pop().undo();
      &#125;
    &#125;
  &#125;;
  return todosModule;
&#125;
</code></pre><p>we can set <code>done</code>, clear done tasks, then undo the clear operation</p>
<pre><code>var todos = Todos();
todos.add(&apos;foo&apos;).add(&apos;bar&apos;);
todos.done(0);
// foo done
// bar
todos.clearDone();
// bar
todos.undo();
// foo done
// bar
</code></pre><p>Notice the added complexity that now is inside the Todos object. Because the undo commands need full access
to the list, the undo functionality is added inside the <code>Todos</code> closure.</p>
<h2><span id="undo-any-action">Undo any action</span></h2><p>Our undo <code>clearDone</code> feature just restores the previous list. Why don&#39;t we reuse it for other actions?
Let us factor it out into <code>checkpoint</code> function</p>
<pre><code>function Todos() &#123;
  var _todos = [];
  var _commands = [];
  function checkPoint() &#123;
    _commands.push(&#123;
      undo: function (prevTodos) &#123;
        _todos = prevTodos;
      &#125;.bind(null, _todos)
    &#125;);
  &#125;
  var todosModule = &#123;
    clearDone: function () &#123;
      checkPoint();
      _todos = _todos.filter(function (todo) &#123;
        return !todo.done;
      &#125;);
      return todosModule;
    &#125;
    // the rest is the same
  &#125;
&#125;
</code></pre><p>Now we can just call <code>checkPoint</code> before any action, and we get the undo feature.</p>
<pre><code>var todosModule = &#123;
  add: function (label) &#123;
    checkPoint();
    _todos.push(&#123;
      label: label,
      done: false
    &#125;);
    return todosModule;
  &#125;,
  done: function (index) &#123;
    checkPoint();
    _todos[index].done = true;
    return todosModule;
  &#125;,
  clearDone: function () &#123;
    checkPoint();
    _todos = _todos.filter(function (todo) &#123;
      return !todo.done;
    &#125;);
    return todosModule;
  &#125;,
  toString: function () &#123;
    return _todos.map(function (todo) &#123;
      return todo.label + &apos; &apos; + (todo.done ? &apos;done&apos; : &apos;&apos;);
    &#125;).join(&apos;\n&apos;);
  &#125;,
  undo: function () &#123;
    if (_commands.length) &#123;
      _commands.pop().undo();
    &#125;
  &#125;
&#125;;
</code></pre><h2><span id="wait-something-is-wrong">Wait, something is wrong!</span></h2><p>We are not correctly restoring the todo list after marking an item done</p>
<pre><code>var todos = Todos();
todos.add(&apos;foo&apos;).add(&apos;bar&apos;);
todos.done(0);
console.log(todos.toString());
// foo done
// bar
console.log(&apos;undo done()&apos;);
todos.undo();
console.log(todos.toString());
// foo done
// bar done
</code></pre><p>Notice that the item <code>foo</code> still remains <code>done</code>! This is because we are making a copy of the
reference to the list, not a deep copy of the todos.</p>
<h2><span id="deep-clone-_todos">Deep clone _todos</span></h2><p>A good approach to simplify the saving and restoring of todos list is to
deep clone the list.</p>
<pre><code>function checkPoint() &#123;
  var _ = require(&apos;lodash&apos;);
  _commands.push(&#123;
    undo: function (prevTodos) &#123;
      _todos = prevTodos;
    &#125;.bind(null, _.cloneDeep(_todos))
  &#125;);
&#125;
</code></pre><p>Now any operation can be undone, not matter how it is implemented</p>
<pre><code>var todos = Todos();
todos.add(&apos;foo&apos;).add(&apos;bar&apos;);
todos.done(0);
console.log(todos.toString());
// foo done
// bar
console.log(&apos;undo done()&apos;);
todos.undo();
console.log(todos.toString());
// foo
// bar
</code></pre><p>I call this approach <em>semi-immutable</em>. We are making a copy of the internal data structure, with this extra complexity
inside the Todos instance.</p>
<h2><span id="multiple-references-and-equality">Multiple references and equality</span></h2><p>If we reference the todos list in several places, can we check if it has been modified? For example,
we could maintain the reference to the list in our MVC model object, and pass reference to the view object.</p>
<pre><code>// model
var todos = Todos();
view.render(todos);
// view renders todos, allows user to mark items done
// should we save todos to the server?
</code></pre><p>To see if we need to save todos to the server, we could add new feature to the Todos object. Every
method that modifies the internal state could mark the object <code>dirty</code>.</p>
<pre><code>function Todos() &#123;
  var _todos = [];
  var _commands = [];
  var _dirty;
  var todosModule = &#123;
    add: function (label) &#123;
      checkPoint();
      _dirty = true;
      // ...
    &#125;,
    done: function (index) &#123;
      checkPoint();
      _dirty = true;
      // ...
    &#125;,
    clearDone: function () &#123;
      checkPoint();
      _dirty = true;
      ...
    &#125;
    undo: function () &#123;
      if (_commands.length) &#123;
        _commands.pop().undo();
        _dirty = true;
      &#125;
    &#125;,
    isDirty: function () &#123;
      return _dirty;
    &#125;
  &#125;;
</code></pre><p>Notice the added complexity: our list of todo items now has two additional features mixed in: undo commands 
and dirty state bit.</p>
<p>The dirty bit is also inefficient.</p>
<pre><code>var todos = Todos():
save(todos);
todos.add(&apos;bar&apos;);
todos.undo();
if (todos.isDirty()) &#123;
    save(todos);
&#125;
</code></pre><p>The second save is unnecessary, since we reverted the state back to the way it was during the first one.
Instead of the dirty bit, we could actually compare item <em>contents</em> for equality. For this we need to break privacy
and return <code>_todos</code> so that it is possible to compare two lists using deep equality comparison 
<a target="_blank" rel="noopener" href="https://lodash.com/docs#isEqual">lodash.isEqual</a>.</p>
<pre><code>function Todos() &#123;
  var _todos = [];
  var _commands = [];
  // no dirty bit
  var todosModule = &#123;
    items: function()
    isEqual: function (t) &#123;
        var _ = require(&apos;lodash&apos;);
        return _.isEqual(t.items(), _todos);
    &#125;
  &#125;
&#125;
</code></pre><p>We are both breaking the privacy and use expensive method just to confirm that nothing has changed since
last time we used the object.</p>
<h2><span id="immutable-todo-list-implementation">Immutable todo list implementation</span></h2><p>The main principle behind the immutable data is that every time something changes we construct a new
object. Instead of plain array, I will use a wrapper from <a target="_blank" rel="noopener" href="https://www.npmjs.org/package/seamless-immutable">seamless-immutable</a>.</p>
<pre><code>var Immutable = require(&apos;seamless-immutable&apos;);
function Todos(todos) &#123;
  todos = todos || Immutable([]);
  var todosModule = &#123;
    add: function (label) &#123;
      var newTodo = &#123;
        label: label,
        done: false
      &#125;;
      var added = todos.concat(newTodo);
      // return new object
      return Todos(added);
    &#125;,
    done: function (index) &#123;
      var changed = todos.map(function (todo, k) &#123;
        return k === index ? &#123;
          label: todo.label,
          done: true
        &#125; : todo;
      &#125;);
      // return new object
      return Todos(changed);
    &#125;,
    toString: function () &#123;
      return todos.map(function (todo, k) &#123;
        return k + &apos;: &apos; + todo.label + &apos; &apos; + (todo.done ? &apos;done&apos; : &apos;&apos;);
      &#125;).join(&apos;\n&apos;);
    &#125;
  &#125;;
  return todosModule;
&#125;
</code></pre><p>Notice how adding new todo item method changed:</p>
<pre><code>// mutable
function Todos() &#123;
  var _todos = [];
  var todosModule = &#123;
    add: function (label) &#123;
      _todos.push(&#123;
        label: label,
        done: false
      &#125;);
      return todosModule;
    &#125;
  &#125;;
  return todosModule;
&#125;
// immutable
function Todos(todos) &#123;
  todos = todos || Immutable([]);
  var todosModule = &#123;
    add: function (label) &#123;
      var newTodo = &#123;
        label: label,
        done: false
      &#125;;
      var added = todos.concat(newTodo);
      return Todos(added);
    &#125;
  &#125;;
  return todosModule;
&#125;
</code></pre><p>We construct new <code>added</code> list by concatenating the existing immutable list with new item,
and then call <code>Todos(added)</code> to return completely new object. Each time we call a method on
the Todos object, we get back a reference to different object.</p>
<pre><code>var todos = Todos();
var addedFoo = todos.add(&apos;foo&apos;);
var addedBar = addedFoo.add(&apos;bar&apos;);
todos === addedFoo; // false
todos === addedBar; // false
addedFoo === addedBar; // false
</code></pre><p>We need to be careful when using the object because we want to print the object after
all modifications</p>
<pre><code>var todos = Todos();
var addedFoo = todos.add(&apos;foo&apos;);
var addedBar = addedFoo.add(&apos;bar&apos;);
console.log(todos.toString()); // prints nothing - todos is empty
console.log(addedBar.toString());
// 0: foo done
// 1: bar
</code></pre><p>Another observation: when setting <code>done</code> property on an object we are constructing
new object, thus preventing any modifications through any other possible reference.</p>
<h2><span id="undo-command-around-immutable-object">Undo command around immutable object</span></h2><p>Because each operation on Todos returns new object, we could easily implement the
Undo feature using an external proxy object.</p>
<pre><code>function TodosWithUndo() &#123;
  var states = [Todos()];
  var t = &#123;
    add: function (label) &#123;
      states.push(states[states.length - 1].add(label));
      return t;
    &#125;,
    done: function (index) &#123;
      states.push(states[states.length - 1].done(index));
      return t;
    &#125;,
    undo: function () &#123;
      if (states.length &gt; 1) &#123;
        states.pop();
      &#125;
      return t;
    &#125;,
    toString: function () &#123;
      return states[states.length - 1].toString();
    &#125;
  &#125;;
  return t;
&#125;
</code></pre><p>The TodosWithUndo saves the reference to the current immutable </p>
<p>Use:</p>
<pre><code>var ts = TodosWithUndo();
// ts is mutable
ts.add(&apos;foo&apos;).add(&apos;bar&apos;);
console.log(&apos;after done first&apos;);
ts.done(0);
// prints
// 0: foo done
// 1: bar
console.log(ts.toString());
ts.undo();
console.log(ts.toString());
// prints
// 0: foo
// 1: bar
</code></pre><p>In this implementation, we are <em>sure</em> that every operation creates a <em>new</em> Todo instance, 
completely separate from the previous one. Nothing in the application logic can modify
the list of instances we keep inside TodosWithUndo - not even a stray reference returned to the
outside can modify it! The reasoning about program&#39;s state and data flow becomes very simple.</p>
<h2><span id="additional-questions">Additional questions</span></h2><blockquote>
<p>Does an object added to the immutable list become immutable?</p>
</blockquote>
<p>You can still modify the object via its original reference, but the object inside an immutable collection is
a separate copy</p>
<pre><code>&apos;use strict&apos;;
var obj = &#123;
  foo: &apos;foo&apos;,
  bar: &apos;bar&apos;
&#125;;
var Immutable = require(&apos;seamless-immutable&apos;);
var list = Immutable([]).concat(obj);
console.log(list);
// [ &#123; foo: &apos;foo&apos;, bar: &apos;bar&apos; &#125; ]
obj.foo = &apos;not foo&apos;;
console.log(list);
// [ &#123; foo: &apos;foo&apos;, bar: &apos;bar&apos; &#125; ]
console.log(&apos;object itself&apos;, obj);
// object itself &#123; foo: &apos;not foo&apos;, bar: &apos;bar&apos; &#125;
</code></pre><blockquote>
<p>Is this a deep copy of an object?</p>
</blockquote>
<p>Yes, the object is deep cloned when added to the immutable collection</p>
<pre><code>&apos;use strict&apos;;
var obj = &#123;
  foo: &apos;foo&apos;,
  bar: &#123;
    baz: &apos;baz&apos;
  &#125;
&#125;;
var Immutable = require(&apos;seamless-immutable&apos;);
var list = Immutable([]).concat(obj);
console.log(list);
// [ &#123; foo: &apos;foo&apos;, bar: &#123; baz: &apos;baz&apos; &#125; &#125; ]
obj.bar.baz = &apos;not baz&apos;;
console.log(list);
// [ &#123; foo: &apos;foo&apos;, bar: &#123; baz: &apos;baz&apos; &#125; &#125; ]
console.log(&apos;object itself&apos;, obj);
// object itself object itself &#123; foo: &apos;foo&apos;, bar: &#123; baz: &apos;not baz&apos; &#125; &#125;
</code></pre><blockquote>
<p>Can immutable data structures be used with 3rd party functional libraries, like <a target="_blank" rel="noopener" href="https://lodash.com/docs">lodash</a>?</p>
</blockquote>
<p>Almost. Lodash can take immutable data structures as inputs for methods that do not modify the input
data structure: map, filter, etc. The returned object is NOT an immutable</p>
<pre><code>var _ = require(&apos;lodash&apos;);
var list = Immutable([1, 2, 3]);
function double(x) &#123; return x * 2; &#125;
var doubled = list.map(double);
console.log(doubled);
// [2, 4, 6]
// doubled[1] = 10; // exception because doubled is Immutable
var _doubled = _.map(list, double);
console.log(_doubled);
// [2, 4, 6]
_doubled[1] = 10; // works because _doubled is a regular Array
</code></pre><p>A work around is to wrap the returned value in Immutable again</p>
<pre><code>var _doubled = Immutable(_.map(list, double));
// _doubled is Immutable
</code></pre><p>A convenient library to work with Immutable is <a target="_blank" rel="noopener" href="http://ramda.github.io/ramdocs/docs/">Ramda</a>. Just pipe the result through Immutable
function call</p>
<pre><code>var R = require(&apos;ramda&apos;);
var _doubled = R.pipe(R.map(double), Immutable)(list);
console.log(_doubled);
// [2, 4, 6]
// _doubled is immutable too
</code></pre><blockquote>
<p>Are there good libraries for working with immutable data and have large API?</p>
</blockquote>
<p>I used <a target="_blank" rel="noopener" href="https://www.npmjs.org/package/seamless-immutable">seamless-immutable</a> in the above example. It is very simple to use: just
wrap an existing object or array to start. Other libraries have richer APIs. Take a look at <a target="_blank" rel="noopener" href="http://swannodette.github.io/mori/">mori</a>
and <a target="_blank" rel="noopener" href="http://facebook.github.io/immutable-js/">Immutable</a>.</p>
<blockquote>
<p>Isn&#39;t deep copy on each operation a slow and memory hungry process?</p>
</blockquote>
<p>Yes, if we naively deep cloned everything. Luckily, people have programed the persistent data structures
to store diffs efficiently. See <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=mS264h8KGwk">this video</a> by David Nolen <a target="_blank" rel="noopener" href="https://twitter.com/swannodette">@swannodette</a> 
that explains <a target="_blank" rel="noopener" href="http://swannodette.github.io/mori/">mori</a> implementation performance shortcuts.</p>
<h2><span id="conclusions">Conclusions</span></h2><p>Keeping some data immutable (Todos) helped clarify the data flow in this case. At the same time, other pieces
can still mutate the state (TodosWithUndo). This way I could dip my toes into the immutable programming paradigm,
without rewriting my entire application.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  <p>
    Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
    see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
    watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
    browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
  </p>
  <p>
    Want to know more about Cypress? Check out <a href="https://cypress.tips" target="_blank">cypress.tips</a>
  </p>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/immutable-javascript-example/" data-id="cksz56ghw01s9irvgg6mhagxv" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/immutable-javascript-example/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/immutable/" rel="tag">immutable</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/javascript/" rel="tag">javascript</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../measuring-semver-adherence/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Measuring semver adherence
        
      </div>
    </a>
  
  
    <a href="../point-free-programming-is-not-pointless/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Point-free programming is not pointless.</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">138</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">414</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">109</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">140</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">68</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">165</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">130</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.38px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.54px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.77px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.85px;">advice</a> <a href="../tags/algolia/" style="font-size: 10.38px;">algolia</a> <a href="../tags/angularjs/" style="font-size: 17.69px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.08px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.69px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.77px;">browser</a> <a href="../tags/ci/" style="font-size: 16.54px;">ci</a> <a href="../tags/circle/" style="font-size: 12.69px;">circle</a> <a href="../tags/climate/" style="font-size: 14.62px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 13.46px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.31px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 19.62px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 13.85px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.77px;">d3</a> <a href="../tags/db/" style="font-size: 14.23px;">db</a> <a href="../tags/docker/" style="font-size: 14.23px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.92px;">documentation</a> <a href="../tags/es6/" style="font-size: 14.62px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.08px;">functional</a> <a href="../tags/generators/" style="font-size: 11.54px;">generators</a> <a href="../tags/git/" style="font-size: 15px;">git</a> <a href="../tags/github/" style="font-size: 15.38px;">github</a> <a href="../tags/graphql/" style="font-size: 11.15px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.31px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.77px;">gulp</a> <a href="../tags/hiring/" style="font-size: 10.77px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.31px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.54px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.77px;">interview</a> <a href="../tags/jade/" style="font-size: 11.15px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.77px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.85px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 16.92px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.15px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.46px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.15px;">performance</a> <a href="../tags/presentation/" style="font-size: 11.92px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.31px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.38px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/react/" style="font-size: 11.54px;">react</a> <a href="../tags/react-native/" style="font-size: 11.15px;">react native</a> <a href="../tags/reactive/" style="font-size: 14.23px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.15px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.54px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 13.08px;">security</a> <a href="../tags/sentry/" style="font-size: 13.85px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.92px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.23px;">testing</a> <a href="../tags/tutorial/" style="font-size: 15.77px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 11.92px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.38px;">ui</a> <a href="../tags/vercel/" style="font-size: 12.69px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.15px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.54px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.92px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.77px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/08/">August 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../verify-phone-part-one/">How To Verify Phone Number During Tests Part 1</a>
          </li>
        
          <li>
            <a href="../detached/">Solving The Element Is Detached From DOM Error In Cypress</a>
          </li>
        
          <li>
            <a href="../scrape-slides/">Scrape Slides</a>
          </li>
        
          <li>
            <a href="../code-coverage-for-chat-tests/">Code Coverage For Chat App</a>
          </li>
        
          <li>
            <a href="../test-video-play/">Test Video Play Using Cypress</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/immutable-javascript-example/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
