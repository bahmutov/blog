<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Caching Cypress On CircleCI | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Imagine a situation where you have a monorepo with the web application and the Cypress tests living in their separate subfolders. You might want to keep the tests slightly separate to avoid clashing d">
<meta property="og:type" content="article">
<meta property="og:title" content="Caching Cypress On CircleCI">
<meta property="og:url" content="https://glebbahmutov.com/blog/cypress-circleci-subfolders/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="Imagine a situation where you have a monorepo with the web application and the Cypress tests living in their separate subfolders. You might want to keep the tests slightly separate to avoid clashing d">
<meta property="og:locale">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/install.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/info.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/workflow.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/attached-workspace.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/files.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/run-tests.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/parallel1.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/parallel2.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/record-project.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/set-record-key.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/parallel-time1.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/parallel-time2.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/dashboard.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/finished1.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/finished2.png">
<meta property="article:published_time" content="2022-08-20T04:00:00.000Z">
<meta property="article:modified_time" content="2022-09-07T20:35:28.987Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="cypress">
<meta property="article:tag" content="circle">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/cypress-circleci-subfolders/install.png">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-cypress-circleci-subfolders" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2022-08-20T04:00:00.000Z" itemprop="datePublished">Aug 20 2022</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Caching Cypress On CircleCI
    </h1>

    <h2 class="article-title" itemprop="name">
      How to cache Cypress when running app and the tests from subfolders of the repo.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Imagine a situation where you have a monorepo with the web application and the Cypress tests living in their separate subfolders. You might want to keep the tests slightly separate to avoid clashing dependencies and typings. In the example repo <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todo-app-subfolders">bahmutov&#x2F;todo-app-subfolders</a> I have put the frontend, the api, and the Cypress tests in their own 3 subfolders</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">repo/</span><br><span class="line">  api/</span><br><span class="line">    REST API running on port 3000</span><br><span class="line">    - package.json</span><br><span class="line">    - package-lock.json</span><br><span class="line">  frontend/</span><br><span class="line">    static site running on port 5555</span><br><span class="line">    - package.json</span><br><span class="line">    - package-lock.json</span><br><span class="line">  e2e/</span><br><span class="line">    Cypress tests for localhost:5555</span><br><span class="line">    - package.json</span><br><span class="line">    - package-lock.json</span><br><span class="line"></span><br><span class="line">  root has its own package.json</span><br><span class="line">  with basic scripts and Prettier</span><br><span class="line">  - package.json</span><br><span class="line">  - package-lock.json</span><br></pre></td></tr></table></figure>

<p>We need to run <code>npm install</code> in each subfolder when running locally. To test the app, we need to start the api, start the frontend, and then open Cypress. <strong>Tip:</strong> the project uses <a target="_blank" rel="noopener" href="https://github.com/bahmutov/start-server-and-test">start-server-and-test</a> utility to do it all with a single <code>npm run dev</code> command.</p>
<p>How do we install the dependencies and run the tests on CircleCI? Normally, I would use <a target="_blank" rel="noopener" href="https://github.com/cypress-io/circleci-orb">Cypress CircleCI Orb</a>, but in this case, it is simpler to do the caching on our own, since everything resides in different subfolders. Fear not, we can write a config file without a problem.</p>
<blockquote class="pullquote"><p>üéÅ If you want to see the completed config file, visit the <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todo-app-subfolders">bahmutov&#x2F;todo-app-subfolders</a> and check out its <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todo-app-subfolders/blob/main/.circleci/config.yml">.circleci&#x2F;config.yml</a> file.</p>
</blockquote>

<p><strong>Note:</strong> if Cypress folder is outside the frontend application folder, it might be hard to set up the <a target="_blank" rel="noopener" href="https://on.cypress.io/component-testing">component testing</a>, as Cypress won&#39;t be able to find the webpack &#x2F; application settings to bundle the tests correctly. In my example, I only use the end-to-end tests, so that is not a concern.</p>
<h2><span id="install-the-dependencies">Install the dependencies</span></h2><p>First, things first. We need to install the dependencies in each subfolder. Let&#39;s write a simple &quot;install&quot; job</p>
<figure class="highlight yml"><figcaption><span>.circleci/config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">2.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https://circleci.com/docs/2.0/executor-intro/</span></span><br><span class="line"><span class="attr">executors:</span></span><br><span class="line">  <span class="attr">ci-image:</span></span><br><span class="line">    <span class="attr">docker:</span></span><br><span class="line">      <span class="comment"># https://github.com/cypress-io/cypress-docker-images</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">cypress/base:16.14.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">commands:</span></span><br><span class="line">  <span class="attr">list-files:</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">List</span> <span class="string">files</span></span><br><span class="line">          <span class="attr">command:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            echo &quot;current folder $(pwd)&quot;</span></span><br><span class="line"><span class="string">            echo &quot;&quot;</span></span><br><span class="line"><span class="string">            echo &quot;current folder contents&quot;</span></span><br><span class="line"><span class="string">            ls -l</span></span><br><span class="line"><span class="string">            echo &quot;&quot;</span></span><br><span class="line"><span class="string">            echo &quot;api folder&quot;</span></span><br><span class="line"><span class="string">            ls -l api</span></span><br><span class="line"><span class="string">            echo &quot;&quot;</span></span><br><span class="line"><span class="string">            echo &quot;frontend folder&quot;</span></span><br><span class="line"><span class="string">            ls -l frontend</span></span><br><span class="line"><span class="string">            echo &quot;&quot;</span></span><br><span class="line"><span class="string">            echo &quot;e2e folder&quot;</span></span><br><span class="line"><span class="string">            ls -l e2e</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">install-cypress:</span></span><br><span class="line">    <span class="attr">executor:</span> <span class="string">ci-image</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">checkout</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list-files</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">Install</span> <span class="string">API</span> <span class="string">dependencies</span></span><br><span class="line">          <span class="attr">command:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">          <span class="attr">working_directory:</span> <span class="string">api</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">Install</span> <span class="string">frontend</span> <span class="string">dependencies</span></span><br><span class="line">          <span class="attr">command:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">          <span class="attr">working_directory:</span> <span class="string">frontend</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">Install</span> <span class="string">E2E</span> <span class="string">dependencies</span></span><br><span class="line">          <span class="attr">command:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">          <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">Check</span> <span class="string">Cypress</span></span><br><span class="line">          <span class="attr">command:</span> <span class="string">npx</span> <span class="string">cypress</span> <span class="string">verify</span></span><br><span class="line">          <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br><span class="line"><span class="attr">workflows:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2.1</span></span><br><span class="line">  <span class="attr">build-and-test:</span></span><br><span class="line">    <span class="attr">jobs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">install-cypress</span></span><br></pre></td></tr></table></figure>

<p><strong>Tip:</strong> I love printing the local files using my custom <code>list-files</code> command, since you never know for sure how a workspace or a cache is restored and what files you get. In our case, it looks correct after checking out the files from the repo:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">current folder /root/project</span><br><span class="line"></span><br><span class="line">current folder contents</span><br><span class="line">total 40</span><br><span class="line">-rw-r--r-- 1 root root    96 Aug 19 19:57 README.md</span><br><span class="line">drwxr-xr-x 4 root root   129 Aug 19 19:57 api</span><br><span class="line">drwxr-xr-x 3 root root   112 Aug 19 19:57 e2e</span><br><span class="line">drwxr-xr-x 3 root root    65 Aug 19 19:57 frontend</span><br><span class="line">-rw-r--r-- 1 root root 31689 Aug 19 19:57 package-lock.json</span><br><span class="line">-rw-r--r-- 1 root root   587 Aug 19 19:57 package.json</span><br><span class="line"></span><br><span class="line">api folder</span><br><span class="line">total 128</span><br><span class="line">-rw-r--r-- 1 root root    434 Aug 19 19:57 README.md</span><br><span class="line">-rw-r--r-- 1 root root     18 Aug 19 19:57 data.json</span><br><span class="line">drwxr-xr-x 2 root root     23 Aug 19 19:57 img</span><br><span class="line">-rw-r--r-- 1 root root 117455 Aug 19 19:57 package-lock.json</span><br><span class="line">-rw-r--r-- 1 root root    962 Aug 19 19:57 package.json</span><br><span class="line">drwxr-xr-x 2 root root     31 Aug 19 19:57 scripts</span><br><span class="line"></span><br><span class="line">frontend folder</span><br><span class="line">total 68</span><br><span class="line">-rw-r--r-- 1 root root 64596 Aug 19 19:57 package-lock.json</span><br><span class="line">-rw-r--r-- 1 root root   349 Aug 19 19:57 package.json</span><br><span class="line">drwxr-xr-x 3 root root    72 Aug 19 19:57 public</span><br><span class="line"></span><br><span class="line">e2e folder</span><br><span class="line">total 128</span><br><span class="line">drwxr-xr-x 3 root root     17 Aug 19 19:57 cypress</span><br><span class="line">-rw-r--r-- 1 root root    250 Aug 19 19:57 cypress.config.js</span><br><span class="line">-rw-r--r-- 1 root root     90 Aug 19 19:57 jsconfig.json</span><br><span class="line">-rw-r--r-- 1 root root 118740 Aug 19 19:57 package-lock.json</span><br><span class="line">-rw-r--r-- 1 root root    305 Aug 19 19:57 package.json</span><br></pre></td></tr></table></figure>

<p>The job runs through its commands and installs the dependencies one by one.</p>
<p><img src="../images/cypress-circleci-subfolders/install.png" alt="Installing all dependencies one by one on CI"></p>
<p>Nice, it works. If we print the files again, we will see <code>api/node_modules</code>, <code>frontend/node_modules</code>, and <code>e2e/node_modules</code> folders. Running the next CI workflow has a problem; it has to reinstall everything from scratch, making it slow. Can we speed things up? What folders should we cache and restore to avoid reinstalling? Every time we run the <code>npm ci</code> command, it removes the local <code>node_modules</code> folder. Thus we cannot cache <code>api/node_modules</code>, <code>frontend/node_modules</code>, etc. We need to cache the downloaded NPM modules stored by default in the <code>~/.npm</code> folder. Plus we need to <a target="_blank" rel="noopener" href="https://on.cypress.io/caching">cache Cypress binary</a>, which normally is in the <code>~/.cache/Cypress</code> folder.</p>
<p><strong>Tip:</strong> you can see where Cypress keeps its downloaded binary files using the <a target="_blank" rel="noopener" href="https://on.cypress.io/command-line#cypress-cache-command"><code>npx cypress cache path</code></a> command. For example, on a Mac laptop:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npx cypress cache path</span><br><span class="line">/Users/glebbahmutov/Library/Caches/Cypress</span><br></pre></td></tr></table></figure>

<p><strong>Tip 2:</strong> you can show the basic Cypress information after installing it using the <a target="_blank" rel="noopener" href="https://on.cypress.io/command-line#cypress-info"><code>npx cypress info</code></a>:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Cypress</span> <span class="string">info</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">npx</span> <span class="string">cypress</span> <span class="string">info</span></span><br><span class="line">    <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br></pre></td></tr></table></figure>

<p><img src="../images/cypress-circleci-subfolders/info.png" alt="Printing Cypress information on CircleCI using the cypress info command"></p>
<p>The <code>npx cypress info</code> shows that Cypress binaries are cached inside <code>/root/.cache/Cypress</code> folder, which is the user home folder that can be accessed via <code>~/.cache/Cypress</code> in general. We need to cache this folder to skip re-downloading the Cypress binary file on each test flow run.</p>
<p>Thus we will cache the following folders:</p>
<ul>
<li><code>~/.npm</code> where NPM downloads modules during <code>npm i</code> and <code>npm ci</code> command before placing them into <code>node_modules</code></li>
<li><code>~/.cache/Cypress</code> where Cypress downloads and stores its binary file</li>
</ul>
<p><strong>Tip:</strong> if we are using Yarn, we could simply cache <code>~/.cache/yarn</code> and <code>~/.cache/Cypress</code> folders, or even <code>~/.cache</code>.</p>
<p>We will throw away the cached files if any of our lock files change.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">install-cypress:</span></span><br><span class="line">  <span class="attr">executor:</span> <span class="string">ci-image</span></span><br><span class="line">  <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">checkout</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">list-files</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">restore_cache:</span></span><br><span class="line">        <span class="attr">keys:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">deps-v1-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">&quot;api/package-lock.json&quot;</span> <span class="string">&#125;&#125;-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">&quot;e2e/package-lock.json&quot;</span> <span class="string">&#125;&#125;-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">&quot;frontend/package-lock.json&quot;</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="comment"># a separate cache for Cypress binary</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">restore_cache:</span></span><br><span class="line">        <span class="attr">keys:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">cypress-v2-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">&quot;e2e/package-lock.json&quot;</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Install</span> <span class="string">API</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">        <span class="attr">working_directory:</span> <span class="string">api</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Install</span> <span class="string">frontend</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">        <span class="attr">working_directory:</span> <span class="string">frontend</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Install</span> <span class="string">E2E</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">npm</span> <span class="string">ci</span></span><br><span class="line">        <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Check</span> <span class="string">Cypress</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">npx</span> <span class="string">cypress</span> <span class="string">verify</span></span><br><span class="line">        <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br><span class="line">    <span class="comment"># save the downloaded NPM modules</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">save_cache:</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">deps-v1-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">&quot;api/package-lock.json&quot;</span> <span class="string">&#125;&#125;-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">&quot;e2e/package-lock.json&quot;</span> <span class="string">&#125;&#125;-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">&quot;frontend/package-lock.json&quot;</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">~/.npm</span></span><br><span class="line">    <span class="comment"># save the installed Cypress binary</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">save_cache:</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">cypress-v2-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">&quot;e2e/package-lock.json&quot;</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">paths:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">~/.cache/Cypress</span></span><br></pre></td></tr></table></figure>

<p><strong>Tip:</strong> you might want to split single NPM cache into 3 separate ones for each project. This way if one of the lock files changes, then no need to create a new cache. But in practice, that is not that important.</p>
<h2><span id="pass-the-installed-files">Pass the installed files</span></h2><p>Great, we have one CI job that installs the dependencies very quickly, because it restores the dependencies very quickly unless the package lock files have changed. How about running Cypress tests?</p>
<p>We could have run the end-to-end tests right there in the <code>install-cypress</code> job:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install-cypress job</span></span><br><span class="line"><span class="comment"># after saving the caches</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Start</span> <span class="string">API</span> <span class="string">üé¨</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">npm</span> <span class="string">start</span></span><br><span class="line">    <span class="attr">working_directory:</span> <span class="string">api</span></span><br><span class="line">    <span class="attr">background:</span> <span class="literal">true</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Start</span> <span class="string">frontend</span> <span class="string">üé¨</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">npm</span> <span class="string">start</span></span><br><span class="line">    <span class="attr">working_directory:</span> <span class="string">frontend</span></span><br><span class="line">    <span class="attr">background:</span> <span class="literal">true</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Run</span> <span class="string">tests</span> <span class="string">üöÄ</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">npx</span> <span class="string">cypress</span> <span class="string">run</span></span><br><span class="line">    <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br></pre></td></tr></table></figure>

<p>But as the number of tests grows, it makes more sense to run the tests in parallel using several test jobs. Those jobs should grab all files installed by the <code>install-cypress</code> job. Here is where we need to play a trick and combine <a target="_blank" rel="noopener" href="https://circleci.com/blog/persisting-data-in-workflows-when-to-use-caching-artifacts-and-workspaces/">CircleCI workspaces with restoring a cache</a>. Let&#39;s revisit the end of the install-cypress job and extend it with <a target="_blank" rel="noopener" href="https://circleci.com/docs/workspaces">persist_to_workspace</a> CircleCI command:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install-cypress job</span></span><br><span class="line"><span class="comment"># after saving the caches</span></span><br><span class="line"><span class="comment"># pass all the files (including the local node_modules)</span></span><br><span class="line"><span class="comment"># to the next job in the workflow</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">persist_to_workspace:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">paths:</span> <span class="string">&#x27;*&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Any job that requires the <code>install-cypress</code> job will get its workspace, which is all files from the project&#39;s repo. The command <code>persist_to_workspace</code> runs inside the current project working directory <code>/root/project</code> and saves <em>all</em> repo files plus the installed <code>node_modules</code> subfolders already present. It won&#39;t save any outside files like <code>~/.cache/Cypress</code> though, so keep this in mind when restoring (attaching) the workspace in the job</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test-cypress:</span></span><br><span class="line">  <span class="attr">executor:</span> <span class="string">ci-image</span></span><br><span class="line">  <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">attach_workspace:</span></span><br><span class="line">        <span class="attr">at:</span> <span class="string">&#x27;.&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">list-files</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">restore_cache:</span></span><br><span class="line">        <span class="attr">keys:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">cypress-v2-&#123;&#123;</span> <span class="string">checksum</span> <span class="string">&quot;e2e/package-lock.json&quot;</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Check</span> <span class="string">Cypress</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">npx</span> <span class="string">cypress</span> <span class="string">verify</span></span><br><span class="line">        <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Start</span> <span class="string">API</span> <span class="string">üé¨</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">npm</span> <span class="string">start</span></span><br><span class="line">        <span class="attr">working_directory:</span> <span class="string">api</span></span><br><span class="line">        <span class="attr">background:</span> <span class="literal">true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Start</span> <span class="string">frontend</span> <span class="string">üé¨</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">npm</span> <span class="string">start</span></span><br><span class="line">        <span class="attr">working_directory:</span> <span class="string">frontend</span></span><br><span class="line">        <span class="attr">background:</span> <span class="literal">true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Run</span> <span class="string">tests</span> <span class="string">üöÄ</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">npx</span> <span class="string">cypress</span> <span class="string">run</span></span><br><span class="line">        <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br><span class="line"></span><br><span class="line"><span class="attr">workflows:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">2.1</span></span><br><span class="line">  <span class="attr">build-and-test:</span></span><br><span class="line">    <span class="attr">jobs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">install-cypress</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">test-cypress:</span></span><br><span class="line">          <span class="attr">requires:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">install-cypress</span></span><br></pre></td></tr></table></figure>

<p><img src="../images/cypress-circleci-subfolders/workflow.png" alt="CircleCI workflow with install and test jobs"></p>
<p>We are passing all <code>/root/project</code> files by attaching the previously saved workspace using the <code>attach_workspace</code> command. This restores the files in the <code>/root/project</code> folder (notice we don&#39;t have to use the <code>checkout</code> command at all)</p>
<p><img src="../images/cypress-circleci-subfolders/attached-workspace.png" alt="The workspace already includes installed NPM dependencies"></p>
<p>Then we restore the Cypress binary cache folder <code>~/.cache/Cypress</code> and we are good to go - all dependencies are there. The entire workspace and how it passes files from one job to another can be seen in the diagram below</p>
<p><img src="../images/cypress-circleci-subfolders/files.png" alt="How the files are passes from the install to the test job"></p>
<p>We start both services as background processes, run the tests, and CircleCI shuts down the running background processes when the job finishes.</p>
<p><img src="../images/cypress-circleci-subfolders/run-tests.png" alt="CircleCI completes the test-cypress job"></p>
<p><strong>Note:</strong> the command <code>persist_to_workspace</code> can only pass <em>local</em> files, and our <code>~/.cache</code> folder is outside. We could install Cypress in a different local subfolder using <code>CYPRESS_CACHE_FOLDER</code>, see <a target="_blank" rel="noopener" href="https://on.cypress.io/caching">Cypress caching guide</a>. Then we could skip the <code>restore_cache</code> command.</p>
<h2><span id="parallel-testing">Parallel testing</span></h2><p>Ok, all is going well. Until we get more tests, and suddenly a single test job running the tests one after another takes too long.</p>
<p><img src="../images/cypress-circleci-subfolders/parallel1.png" alt="The workflow takes 13 minutes because of the tests"></p>
<p><img src="../images/cypress-circleci-subfolders/parallel2.png" alt="Each test file takes about 3 minutes and we have 4 of them"></p>
<p>We need to turn on <a target="_blank" rel="noopener" href="https://on.cypress.io/parallelization">Cypress spec parallelization</a>, thus running specs in parallel in different test containers. No problem.</p>
<ul>
<li>start recording the tests on Cypress dashboard by creating a new project from Cypress Test Runner</li>
</ul>
<p><img src="../images/cypress-circleci-subfolders/record-project.png" alt="Create a new project for recording our tests"></p>
<ul>
<li>set the record key as CircleCI environment variable <code>CYPRESS_RECORD_KEY</code></li>
</ul>
<p><img src="../images/cypress-circleci-subfolders/set-record-key.png" alt="Keep the record key a secret on CircleCI"></p>
<ul>
<li>use N CircleCI test containers in parallel and run the tests in parallel</li>
</ul>
<figure class="highlight yml"><figcaption><span>.circleci/config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test-cypress:</span></span><br><span class="line">  <span class="attr">executor:</span> <span class="string">ci-image</span></span><br><span class="line">  <span class="attr">parallelism:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">attach_workspace:</span></span><br><span class="line">        <span class="attr">at:</span> <span class="string">&#x27;.&#x27;</span></span><br><span class="line">    <span class="string">...</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Run</span> <span class="string">tests</span> <span class="string">üöÄ</span></span><br><span class="line">        <span class="attr">command:</span> <span class="string">npx</span> <span class="string">cypress</span> <span class="string">run</span> <span class="string">--record</span> <span class="string">--parallel</span></span><br><span class="line">        <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br></pre></td></tr></table></figure>

<p>That&#39;s it - you only need the <code>parallelism</code> parameter and pass the <code>cypress run --record --parallel</code> arguments, and Cypress does the rest. Let&#39;s look at the new timings.</p>
<p><img src="../images/cypress-circleci-subfolders/parallel-time1.png" alt="The workflow duration dropped from 14 to 4 and a half minutes"></p>
<p><img src="../images/cypress-circleci-subfolders/parallel-time2.png" alt="CircleCI ran 5 test jobs in parallel"></p>
<p>Each test job grabbed the workspace created by the single install job and quickly restored the Cypress binary from cache. Then the tests were split by the Cypress Dashboard across the machines that joined the test run.</p>
<p><img src="../images/cypress-circleci-subfolders/dashboard.png" alt="All tests were executed in parallel"></p>
<p><strong>Note:</strong> CircleCI has tested using 5 jobs in parallel, but the Cypress Dashboard is showing specs split across 4 machines. Yup, by the time the 5th machine has started, the specs have already been allocated and the last machine had nothing to do, so it has finished quickly.</p>
<p><img src="../images/cypress-circleci-subfolders/finished1.png" alt="5 CircleCI machines executed the tests in parallel in test-cypress job"></p>
<p><img src="../images/cypress-circleci-subfolders/finished2.png" alt="The last machine joined late and had nothing to test"></p>
<h2><span id="bonus-1-wait-for-the-site-before-starting-the-tests">Bonus 1: Wait for the site before starting the tests</span></h2><p>Sometimes our frontend takes a while to start. We want to wait and check for the site to be up before running the tests. I always use the utility <a target="_blank" rel="noopener" href="https://github.com/jeffbski/wait-on#readme">wait-on</a> for this (and sometimes I combine starting the server with waiting for it to start using <a target="_blank" rel="noopener" href="https://github.com/bahmutov/start-server-and-test">start-server-and-test</a> CLI module). Let&#39;s add the <code>wait-on</code> as a dev dependency to the frontend package</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npm i -D wait-on</span></span><br><span class="line">+ wait-on@6.0.1</span><br></pre></td></tr></table></figure>

<p>I will add a script to wait for the local port 5555 to respond to HTTP GET requests (by default <code>wait-on</code> sends <code>HTTP HEAD</code> command, which many bundlers ignore)</p>
<figure class="highlight json"><figcaption><span>frontend/package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;serve -p 5555 public&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;wait-for-app&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wait-on http-get://localhost:5555 --log --timeout 60000&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>On CircleCI we will run the <code>wait-for-app</code> command after starting the server but before running Cypress tests</p>
<figure class="highlight yml"><figcaption><span>.circleci/config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Start</span> <span class="string">API</span> <span class="string">üé¨</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">npm</span> <span class="string">start</span></span><br><span class="line">    <span class="attr">working_directory:</span> <span class="string">api</span></span><br><span class="line">    <span class="attr">background:</span> <span class="literal">true</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Start</span> <span class="string">frontend</span> <span class="string">üé¨</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">npm</span> <span class="string">start</span> <span class="string">--</span> <span class="string">--no-clipboard</span></span><br><span class="line">    <span class="attr">working_directory:</span> <span class="string">frontend</span></span><br><span class="line">    <span class="attr">background:</span> <span class="literal">true</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Wait</span> <span class="string">for</span> <span class="string">frontend</span> <span class="string">‚è≥</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">wait-for-app</span></span><br><span class="line">    <span class="attr">working_directory:</span> <span class="string">frontend</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Run</span> <span class="string">tests</span> <span class="string">üöÄ</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">npx</span> <span class="string">cypress</span> <span class="string">run</span> <span class="string">--record</span> <span class="string">--parallel</span></span><br><span class="line">    <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br></pre></td></tr></table></figure>

<p>That&#39;s it - even if the server takes up to a minute to start responding to the external requests, it is ok. End-to-end tests will run only after the web app starts.</p>
<h2><span id="see-also">See also</span></h2><ul>
<li>the final <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todo-app-subfolders/blob/main/.circleci/config.yml">.circleci&#x2F;config.yml</a> in the repo <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todo-app-subfolders">bahmutov&#x2F;todo-app-subfolders</a></li>
<li>my other <a href="../tags/circle">blog posts about CircleCI</a></li>
<li><a href="/blog/do-not-let-cypress-cache-snowball/" title="Do Not Let Cypress Cache Snowball on CI">Do Not Let Cypress Cache Snowball on CI</a></li>
<li><a href="/blog/circle-ram-disk/" title="Start CircleCI Machines Faster by Using RAM Disk">Start CircleCI Machines Faster by Using RAM Disk</a></li>
<li><a href="/blog/split-spec/" title="Make Cypress Run Faster by Splitting Specs">Make Cypress Run Faster by Splitting Specs</a></li>
<li><a href="/blog/testing-timezones/" title="Testing Time Zones in Parallel">Testing Time Zones in Parallel</a></li>
<li><a target="_blank" rel="noopener" href="https://on.cypress.io/ci">Cypress CI guide</a></li>
</ul>
<h2><span id="bonus-1-set-cypress-dashboard-tag-for-the-main-branch">Bonus 1: set Cypress Dashboard tag for the main branch</span></h2><p>Let&#39;s say we want to tag the test runs on Cypress Dashboard but only the ones made from the <code>main</code> branch. We can write a conditional command when running the tests</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">run:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Run</span> <span class="string">tests</span> <span class="string">üöÄ</span></span><br><span class="line">    <span class="comment"># if the current branch is &quot;main&quot;,</span></span><br><span class="line">    <span class="comment"># tag this Cypress Dashboard recording with &quot;main&quot;</span></span><br><span class="line">    <span class="comment"># otherwise do not add any tags</span></span><br><span class="line">    <span class="comment"># https://circleci.com/docs/env-vars#built-in-environment-variables</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">|</span></span><br><span class="line"><span class="string">      if [ &quot;$&#123;CIRCLE_BRANCH&#125;&quot; == &quot;main&quot; ]; then</span></span><br><span class="line"><span class="string">        npx cypress run --record --parallel --tag &quot;main&quot;</span></span><br><span class="line"><span class="string">      else</span></span><br><span class="line"><span class="string">        npx cypress run --record --parallel</span></span><br><span class="line"><span class="string">      fi</span></span><br><span class="line"><span class="string"></span>    <span class="attr">working_directory:</span> <span class="string">e2e</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
      <footer class="article-footer personal-links">
  <p>
    Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
    see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
    watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
    browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
  </p>
  <p>
    Want to know more about Cypress? Check out <a href="https://cypress.tips" target="_blank">cypress.tips</a>
  </p>
  <p>
    Have a Cypress question? Want me to answer it? Consider supporting me via <a target="_blank" rel="noopener" href="https://github.com/sponsors/bahmutov">GitHub Sponsors</a> or by purchasing my <a target="_blank" rel="noopener" href="https://cypress.tips/courses">Cypress courses</a>.
  </p>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/cypress-circleci-subfolders/" data-id="clayeq1iz003tbnvgatccfudf" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/cypress-circleci-subfolders/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/circle/" rel="tag">circle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/" rel="tag">cypress</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../cypress-if/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Conditional Commands For Cypress
        
      </div>
    </a>
  
  
    <a href="../test-using-apis/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">You Should Test More Using APIs</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">152</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">502</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">113</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angular/" rel="tag">angular</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">239</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">70</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">166</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">155</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.37px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.48px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.74px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.89px;">advice</a> <a href="../tags/algolia/" style="font-size: 10.74px;">algolia</a> <a href="../tags/angular/" style="font-size: 10px;">angular</a> <a href="../tags/angularjs/" style="font-size: 17.78px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 12.96px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.59px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 14.81px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.56px;">browser</a> <a href="../tags/ci/" style="font-size: 17.41px;">ci</a> <a href="../tags/circle/" style="font-size: 14.44px;">circle</a> <a href="../tags/climate/" style="font-size: 14.44px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 15.19px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.22px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 20px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 14.07px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.74px;">d3</a> <a href="../tags/db/" style="font-size: 14.44px;">db</a> <a href="../tags/docker/" style="font-size: 14.07px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.85px;">documentation</a> <a href="../tags/es6/" style="font-size: 14.44px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.15px;">functional</a> <a href="../tags/generators/" style="font-size: 11.48px;">generators</a> <a href="../tags/git/" style="font-size: 15.19px;">git</a> <a href="../tags/github/" style="font-size: 16.67px;">github</a> <a href="../tags/graphql/" style="font-size: 11.48px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.22px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.74px;">gulp</a> <a href="../tags/hiring/" style="font-size: 11.11px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.22px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.48px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.74px;">interview</a> <a href="../tags/jade/" style="font-size: 11.11px;">jade</a> <a href="../tags/javascript/" style="font-size: 19.63px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.74px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.7px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 17.04px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.11px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.52px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.3px;">performance</a> <a href="../tags/presentation/" style="font-size: 12.22px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.41px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.37px;">proposal</a> <a href="../tags/ramda/" style="font-size: 17.04px;">ramda</a> <a href="../tags/react/" style="font-size: 12.22px;">react</a> <a href="../tags/react-native/" style="font-size: 11.11px;">react native</a> <a href="../tags/reactive/" style="font-size: 14.07px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.11px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.48px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 12.96px;">security</a> <a href="../tags/sentry/" style="font-size: 13.7px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.85px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.26px;">testing</a> <a href="../tags/tutorial/" style="font-size: 15.93px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 12.59px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.37px;">ui</a> <a href="../tags/vercel/" style="font-size: 13.33px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.11px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.48px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.85px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.74px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/11/">November 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/10/">October 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/09/">September 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/08/">August 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/07/">July 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/06/">June 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/05/">May 2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/04/">April 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/03/">March 2022</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/02/">February 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/01/">January 2022</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/12/">December 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/11/">November 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/10/">October 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/09/">September 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/08/">August 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../inject-env/">How To Inject Environment Variables Into Cypress Tests</a>
          </li>
        
          <li>
            <a href="../spy-on-clipboard-copy/">Spy On Clipboard Copy Method Call</a>
          </li>
        
          <li>
            <a href="../spy-on-postmessage/">Spy On window.postMessage Calls</a>
          </li>
        
          <li>
            <a href="../tips-and-tricks-for-e2e/">Tips And Tricks For Writing Fast And Maintainable Front-End Tests</a>
          </li>
        
          <li>
            <a href="../mock-process-env-in-react/">Mock process.env In Your Cypress React Tests</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/cypress-circleci-subfolders/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
