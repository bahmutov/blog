<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hacking Node require | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I often thought the Node require function was limited. Many times I needed to manually bust cache
before loading a module (during unit testing for example). Recently I looked at how require could be
i">
<meta property="og:type" content="article">
<meta property="og:title" content="Hacking Node require">
<meta property="og:url" content="http://glebbahmutov.com/blog/hacking-node-require/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="I often thought the Node require function was limited. Many times I needed to manually bust cache
before loading a module (during unit testing for example). Recently I looked at how require could be
i">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hacking Node require">
<meta name="twitter:description" content="I often thought the Node require function was limited. Many times I needed to manually bust cache
before loading a module (during unit testing for example). Recently I looked at how require could be
i">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="..//" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="..//" id="subtitle">Software advice from Dr. Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">Software advice from <a id="subtitle" href="http://glebbahmutov.com">Dr. Gleb Bahmutov PhD</a></span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="..//">Home</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-hacking-node-require" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2015-01-04T05:00:00.000Z" itemprop="datePublished">Jan 4 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Hacking Node require
    </h1>

    <h2 class="article-title" itemprop="name">
      Replace NodeJS require to add cache busting, pre- and post-processing, mocking, arguments.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I often thought the Node <code>require</code> function was limited. Many times I needed to manually bust cache
before loading a module (during unit testing for example). Recently I looked at how <code>require</code> could be
improved and wrote <a href="https://github.com/bahmutov/really-need" target="_blank" rel="external">really-need</a>. It has two types of cache control (before and after loading),
source transformation callback, exported object transformation callback and even passing additional arguments
to the module instead of using global properties or config function pattern.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span> = <span class="built_in">require</span>(<span class="string">&apos;really-need&apos;</span>);</span><br><span class="line"><span class="comment">// require(name, options)</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&apos;./foo&apos;</span>, {</span><br><span class="line">    bust: <span class="literal">true</span>, <span class="comment">// load foo.js even if previously cached</span></span><br><span class="line">    keep: <span class="literal">false</span>, <span class="comment">// remove loaded value from cache</span></span><br><span class="line">    pre: <span class="function"><span class="keyword">function</span> (<span class="params">source, filename</span>) </span>{</span><br><span class="line">        <span class="comment">// transform source</span></span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    },</span><br><span class="line">    post: <span class="function"><span class="keyword">function</span> (<span class="params">exported, filename</span>) </span>{</span><br><span class="line">        <span class="comment">// modify exported value</span></span><br><span class="line">        <span class="keyword">return</span> exported;</span><br><span class="line">    },</span><br><span class="line">    args: {</span><br><span class="line">        __dirname: <span class="string">&apos;/diff/path&apos;</span>,</span><br><span class="line">        <span class="built_in">require</span>: <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>{</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&apos;foo is trying to load&apos;</span>, name);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">require</span>(name);</span><br><span class="line">        },</span><br><span class="line">        <span class="comment">// or even custom variables instead of globals</span></span><br><span class="line">        a: <span class="number">10</span></span><br><span class="line">    }</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>You can use <em>really-need</em> when doing module replacements, mocking, code transformations and similar
tasks, see <a href="https://github.com/bahmutov/really-need#use" target="_blank" rel="external">usage examples</a>. </p>
<h2 id="how-it-was-done">How it was done</h2><p>The really interesting thing about this project is how simple it was to hack around Node&apos;s <code>require</code> function.
Turns out <code>require</code> is not a system call, instead it is JavaScript function and a part of the 
<a href="http://nodejs.org/api/" target="_blank" rel="external">system modules</a> included with the Node. 
Every file loaded using <code>require(name)</code> becomes an instance of <code>Module</code> class,
you can find its source in <a href="https://github.com/joyent/node/blob/master/lib/module.js" target="_blank" rel="external">module.js</a>. In general, when you make a <code>require(name)</code> call,
the following things happen</p>
<ul>
<li>The name argument to <code>require(name)</code> is mapped to the full filename 
using <code>Module._resolveFilename(name, this);</code> method.</li>
<li>If <code>cache[fullName]</code> exists, then <code>cache[fullName].exports</code> is returned. This speeds up module loading,
because a module can only be loaded once. You can <code>delete cache[fullName]</code> yourself before 
calling <code>require(name)</code> to bust cache.</li>
<li>Otherwise, the source from <code>fullName</code> is loaded, 
and the corresponding callback is run to preprocess the source, see <a href="https://github.com/joyent/node/blob/master/lib/module.js#L345" target="_blank" rel="external">Module.prototype.load</a>.
I have a separate project <a href="https://github.com/bahmutov/node-hook" target="_blank" rel="external">node-hook</a> for setting up these hooks.</li>
<li>Finally, the transformed source is compiled (evaluated) and the <code>module.exports</code> value is returned
to the user, see <a href="https://github.com/joyent/node/blob/master/lib/module.js#L378" target="_blank" rel="external">Module.prototype._compile</a>.</li>
</ul>
<p>So what is <code>require</code> function? I thought it was a property of the <code>global</code> object, but could not find
it there.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(global.require);</span><br><span class="line"><span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>Interestingly, if you start node REPL, there is <code>global.require</code></p>
<pre><code>$ node
&gt; global.require
{ [<span class="function"><span class="keyword">Function</span></span>: require]
  resolve: [<span class="function"><span class="keyword">Function</span></span>],
  main: undefined,
  extensions: 
   { <span class="string">&apos;.js&apos;</span>: [<span class="function"><span class="keyword">Function</span></span>],
     <span class="string">&apos;.json&apos;</span>: [<span class="function"><span class="keyword">Function</span></span>],
     <span class="string">&apos;.node&apos;</span>: [<span class="function"><span class="keyword">Function</span></span>: dlopen] },
  registerExtension: [<span class="function"><span class="keyword">Function</span></span>],
  cache: {} }
</code></pre><p>So inside the file <code>index.js</code> where is the <code>require</code> coming from? Turns out, before compiling the <code>index.js</code>, the
<code>Module.prototype._compile</code> wraps it in an IIFE. You can see (and even overwrite) the wrapper code</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Module = <span class="built_in">require</span>(<span class="string">&apos;module&apos;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(Module.wrapper);</span><br><span class="line">[ <span class="string">&apos;(function (exports, require, module, __filename, __dirname) { &apos;</span>,</span><br><span class="line">  <span class="string">&apos;\n});&apos;</span> ]</span><br></pre></td></tr></table></figure>
<p>Each CommonJS module&apos;s source executes inside a function that gets its own <code>require</code> as an argument.
The actual <code>require</code> is prepared inside <code>Module.prototype._compile</code> (line <code>// 1</code>)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Module.prototype._compile = <span class="function"><span class="keyword">function</span>(<span class="params">content, filename</span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">path</span>) </span>{ <span class="comment">// 1</span></span><br><span class="line">    <span class="keyword">return</span> self.require(path);</span><br><span class="line">  }</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">var</span> wrapper = Module.wrap(content);</span><br><span class="line">  <span class="keyword">var</span> compiledWrapper = runInThisContext(wrapper, { filename: filename });</span><br><span class="line">  <span class="keyword">var</span> args = [self.exports, <span class="built_in">require</span>, self, filename, dirname];</span><br><span class="line">  <span class="keyword">return</span> compiledWrapper.apply(self.exports, args);</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>When writing <em>really-need</em> I wanted to be able to pass an options object in addition to the name to be loaded</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="built_in">require</span>(<span class="string">&apos;./foo&apos;</span>, { bust: <span class="literal">true</span> });</span><br></pre></td></tr></table></figure>
<p>I started with modifying <code>Module.prototype.require</code> and added the second argument.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Module = <span class="built_in">require</span>(<span class="string">&apos;module&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> _require = Module.prototype.require;</span><br><span class="line">Module.prototype.require = <span class="function"><span class="keyword">function</span> <span class="title">reallyNeedRequire</span>(<span class="params">name, options</span>) </span>{</span><br><span class="line">    options = options || {};</span><br><span class="line">    <span class="keyword">var</span> nameToLoad = Module._resolveFilename(name, <span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">if</span> (options.bust) {</span><br><span class="line">        <span class="keyword">delete</span> <span class="built_in">require</span>.cache[nameToLoad];</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> _require.call(<span class="keyword">this</span>, nameToLoad);</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>But here is the problem: if I load another module, then the second module still 
gets the unary <code>require</code> through the IIFE</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&apos;/bar&apos;</span>, { bust: <span class="literal">true</span> });</span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">require</span> = <span class="built_in">require</span>(<span class="string">&apos;really-need&apos;</span>);</span><br><span class="line"><span class="comment">// require is now our binary function </span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&apos;./foo&apos;</span>, { bust: <span class="literal">true</span> });</span><br></pre></td></tr></table></figure>
<p>When <code>index.js</code> loads <code>foo.js</code>, and <code>foo.js</code> tries to load <code>bar.js</code>, it again uses the original unary <code>require</code>.
In essence, <code>Module.prototype._compile</code> tries to evaluate the following JavaScript</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// comes from _compile</span></span><br><span class="line"><span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">path</span>) </span>{ <span class="comment">// 1</span></span><br><span class="line">  <span class="keyword">return</span> self.require(path);</span><br><span class="line">}</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">require, ...</span>) </span>{</span><br><span class="line">    <span class="comment">// foo.js</span></span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&apos;/bar&apos;</span>, { bust: <span class="literal">true</span> }); <span class="comment">// 2</span></span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>The second options argument in line <code>// 2</code> is ignored, because the <code>require</code> from <code>_compile</code> is used (<code>// 1</code>).
How do we hack the <a href="https://github.com/joyent/node/blob/master/lib/module.js#L378" target="_blank" rel="external">Module.prototype._compile</a> to overwrite the prepared <code>function require</code>
to pass the options argument?</p>
<p>Using <code>eval</code> and <a href="../faking-lexical-scope/">fake lexical scope</a>!</p>
<p>We can replace <code>Module.prototype._compile</code> with the following code that is almost like the original <code>_compile</code>,
and is in fact 99% the original code.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// really-need index.js</span></span><br><span class="line"><span class="keyword">var</span> _compileStr = Module.prototype._compile.toString();</span><br><span class="line"><span class="comment">// pass all arguments from loaded module to our self.require</span></span><br><span class="line">_compileStr = _compileStr.replace(<span class="string">&apos;self.require(path);&apos;</span>, </span><br><span class="line">  <span class="string">&apos;self.require.apply(self, arguments);&apos;</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="comment">/* jshint -W061 */</span></span><br><span class="line"><span class="keyword">var</span> patchedCompile = <span class="built_in">eval</span>(<span class="string">&apos;(&apos;</span> + _compileStr + <span class="string">&apos;)&apos;</span>); <span class="comment">// 2</span></span><br><span class="line">Module.prototype._compile = <span class="function"><span class="keyword">function</span>(<span class="params">content, filename</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> patchedCompile.call(<span class="keyword">this</span>, content, filename);</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<p>We grab the full <code>_compile</code> source code using <code>Module.prototype._compile.toString();</code> and replace unary
<code>require</code> call with <code>apply(self, arguments);</code>. The source transformation is simple enough to avoid
using an abstract syntax tree. Then we evaluate the patched source code and get the <code>patchedCompile</code> function
in line <code>// 2</code>. We create our own <code>Module.prototype._compile</code> that makes a call to the patched version.
There are more things in the <a href="https://github.com/bahmutov/really-need/blob/master/index.js#L117" target="_blank" rel="external">full source</a>, so we keep the call explicit.</p>
<p>When I tried to <code>eval</code> patched source, the interpreter crashed. The original <code>_compile</code> uses 3 variables
via lexical scope that are missing in my <code>index.js</code>. They were simple to add to the lexical scope</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// really-need index.js</span></span><br><span class="line"><span class="comment">// these variables are needed inside eval _compile</span></span><br><span class="line"><span class="comment">/* jshint -W098 */</span></span><br><span class="line"><span class="keyword">var</span> runInNewContext = <span class="built_in">require</span>(<span class="string">&apos;vm&apos;</span>).runInNewContext;</span><br><span class="line"><span class="keyword">var</span> runInThisContext = <span class="built_in">require</span>(<span class="string">&apos;vm&apos;</span>).runInThisContext;</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&apos;path&apos;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="keyword">var</span> patchedCompile = <span class="built_in">eval</span>(<span class="string">&apos;(&apos;</span> + _compileStr + <span class="string">&apos;)&apos;</span>); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>When <code>eval</code> tries to evaluate the <code>_compileStr</code> and finds a reference to the <code>path</code> for example, it
looks at the lexical scope where <code>eval</code> is located and finds <code>var path = require(&apos;path&apos;);</code>, thus
everything is peachy. I call it faking lexical scope, because I could easily substitute my own
object for true <code>path</code> module.</p>
<p>Why do we need the left-hand assignment in the original call <code>require = require(&apos;really-need&apos;);</code> then?
Because I cannot overwrite the original variable <code>require</code> in the calling code. If I did not need to make
any more <code>require</code> calls after loading <em>really-need</em>, I could have omitted the assignment.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>

    

    <footer class="article-footer">
      <a data-url="http://glebbahmutov.com/blog/hacking-node-require/" data-id="ciikqsb5o00mkvzurqgc8lkaf" class="article-share-link">Share</a>
      
        <a href="http://glebbahmutov.com/blog/hacking-node-require/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/nodejs/">nodejs</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../adapted-point-free-callbacks/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Adapted point-free callbacks
        
      </div>
    </a>
  
  
    <a href="../essence-of-functional-programming/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Essence of functional programming</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">70</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">190</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">83</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angular/">angular</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">54</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/database/">database</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">42</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">143</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">54</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">44</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 12.86px;">QUnit</a><a href="../tags/advice/" style="font-size: 19.29px;">advice</a><a href="../tags/angular/" style="font-size: 10px;">angular</a><a href="../tags/angularjs/" style="font-size: 18.57px;">angularjs</a><a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a><a href="../tags/assertions/" style="font-size: 13.57px;">assertions</a><a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a><a href="../tags/browser/" style="font-size: 14.29px;">browser</a><a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a><a href="../tags/d3/" style="font-size: 11.43px;">d3</a><a href="../tags/database/" style="font-size: 10px;">database</a><a href="../tags/db/" style="font-size: 12.86px;">db</a><a href="../tags/es6/" style="font-size: 14.29px;">es6</a><a href="../tags/es7/" style="font-size: 10px;">es7</a><a href="../tags/functional/" style="font-size: 17.14px;">functional</a><a href="../tags/generators/" style="font-size: 12.86px;">generators</a><a href="../tags/git/" style="font-size: 13.57px;">git</a><a href="../tags/grunt/" style="font-size: 13.57px;">grunt</a><a href="../tags/gulp/" style="font-size: 11.43px;">gulp</a><a href="../tags/immutable/" style="font-size: 10px;">immutable</a><a href="../tags/interview/" style="font-size: 11.43px;">interview</a><a href="../tags/jade/" style="font-size: 12.14px;">jade</a><a href="../tags/javascript/" style="font-size: 20px;">javascript</a><a href="../tags/jshint/" style="font-size: 11.43px;">jshint</a><a href="../tags/modular-development/" style="font-size: 15px;">modular development</a><a href="../tags/nodejs/" style="font-size: 18.57px;">nodejs</a><a href="../tags/performance/" style="font-size: 15.71px;">performance</a><a href="../tags/promises/" style="font-size: 16.43px;">promises</a><a href="../tags/proposal/" style="font-size: 10.71px;">proposal</a><a href="../tags/reactive/" style="font-size: 10.71px;">reactive</a><a href="../tags/reactjs/" style="font-size: 10.71px;">reactjs</a><a href="../tags/security/" style="font-size: 12.14px;">security</a><a href="../tags/sentry/" style="font-size: 13.57px;">sentry</a><a href="../tags/testing/" style="font-size: 17.86px;">testing</a><a href="../tags/tutorial/" style="font-size: 12.86px;">tutorial</a><a href="../tags/ui/" style="font-size: 10px;">ui</a><a href="../tags/web-workers/" style="font-size: 12.86px;">web workers</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../instant-web-application/">Instant Web Application</a>
          </li>
        
          <li>
            <a href="../hydrate-at-build-time/">Hydrate at build time</a>
          </li>
        
          <li>
            <a href="../hydrate-your-apps/">Hydrate your apps</a>
          </li>
        
          <li>
            <a href="../my-node-tools/">My Node tools</a>
          </li>
        
          <li>
            <a href="../pass-the-logic/">Pass the logic</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="..//" class="mobile-nav-link">Home</a>
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'http://glebbahmutov.com/blog/hacking-node-require/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css" type="text/css">
  <script src="../fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="../js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>