<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hydrate at build time | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="demo, 
source
I have shown how to quickly restart a web application from last known markup saved in
localStorage in Hydrate your apps blog post. In this blog post I will
show how to do the same at the">
<meta property="og:type" content="article">
<meta property="og:title" content="Hydrate at build time">
<meta property="og:url" content="http://glebbahmutov.com/blog/hydrate-at-build-time/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="demo, 
source
I have shown how to quickly restart a web application from last known markup saved in
localStorage in Hydrate your apps blog post. In this blog post I will
show how to do the same at the">
<meta property="og:image" content="https://raw.githubusercontent.com/bahmutov/hydrate-vdom-todo/master/images/no-hydration-web-app.png">
<meta property="og:image" content="https://raw.githubusercontent.com/bahmutov/hydrate-vdom-todo/master/images/hydrated-at-build-time.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hydrate at build time">
<meta name="twitter:description" content="demo, 
source
I have shown how to quickly restart a web application from last known markup saved in
localStorage in Hydrate your apps blog post. In this blog post I will
show how to do the same at the">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="..//" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="..//" id="subtitle">Software advice from Dr. Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">Software advice from <a id="subtitle" href="http://glebbahmutov.com">Dr. Gleb Bahmutov PhD</a></span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="..//">Home</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-hydrate-at-build-time" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2015-12-21T05:00:00.000Z" itemprop="datePublished">Dec 21 2015</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/process/">process</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Hydrate at build time
    </h1>

    <h2 class="article-title" itemprop="name">
      Generate the initial HTML markup from web app at build time to avoid blank screen.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://glebbahmutov.com/hydrate-vdom-todo/" target="_blank" rel="external">demo</a>, 
<a href="https://github.com/bahmutov/hydrate-vdom-todo" target="_blank" rel="external">source</a></p>
<p>I have shown how to quickly restart a web application from last known markup saved in
localStorage in <a href="../hydrate-your-apps/">Hydrate your apps</a> blog post. In this blog post I will
show how to do the same at <em>the very first time the web application loads</em>. We are going
to use the web application itself to generate the initial HTML markup during the build step,
and then we are going to &quot;rehydrate&quot; the markup when the application starts in the user&apos;s browser.
This avoids a flash of a blank content or a spinning loader common in many web apps.</p>
<h2 id="typical-web-application-startup">Typical web application startup</h2><p>Look at a typical web application startup timeline below (you can see this 
<a href="http://glebbahmutov.com/ng-services/examples/todo-mvc/" target="_blank" rel="external">live</a>)</p>
<p><img src="https://raw.githubusercontent.com/bahmutov/hydrate-vdom-todo/master/images/no-hydration-web-app.png" alt="web application"></p>
<p>The browser loads the initial base page, then the framework and application code. Once the 
web application starts it fills the blank page with the actual content. The user sees blank space
until the web application starts. If we inspect the page&apos;s markup, it is empty at the beginning</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">&quot;framework.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">&quot;app.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>The application fills the &quot;div#app&quot; element with the actual content</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">section</span> <span class="attribute">class</span>=<span class="value">&quot;todoapp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">header</span> <span class="attribute">class</span>=<span class="value">&quot;header&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="title">header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">section</span> <span class="attribute">class</span>=<span class="value">&quot;main&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="title">section</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">footer</span> <span class="attribute">class</span>=<span class="value">&quot;footer&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="title">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Can we do better? In some cases, we do know the initial data that our application will render
at build time. Let us prebuild the HTML markup and serve it right away, and the web application
will have time to start and then enhance the static markup with live behavior 
(I call this enhancement &quot;hydration&quot;)</p>
<h2 id="prebuilt-web-application-startup">Prebuilt web application startup</h2><p>If we are showing a Todo application with a set of initial items, we could run the web application
at build time (some frameworks make it easier than others, for example 
<a href="https://github.com/Matt-Esch/virtual-dom" target="_blank" rel="external">virtual-dom</a> makes it very simple), capture the 
produced HTML and put it into the &quot;index.html&quot;.</p>
<p>You can find this source code in <a href="https://github.com/bahmutov/hydrate-vdom-todo" target="_blank" rel="external">bahmutov/hydrate-vdom-todo</a>. We are going to
start by looking at the web application main rendering loop - and it is very simple.</p>
<p>See the full file at 
<a href="https://github.com/bahmutov/hydrate-vdom-todo/blob/master/src/app.js" target="_blank" rel="external">src/app.js</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Todos = <span class="built_in">require</span>(<span class="string">&apos;./todos&apos;</span>) <span class="comment">// data = Model</span></span><br><span class="line"><span class="keyword">const</span> render = <span class="built_in">require</span>(<span class="string">&apos;./render/render&apos;</span>) <span class="comment">// Model -&gt; VirtualNode</span></span><br><span class="line"><span class="comment">// standard Virtual-Dom rendering loop</span></span><br><span class="line"><span class="keyword">var</span> prevView = render(Todos) <span class="comment">// VirtualNode</span></span><br><span class="line"><span class="keyword">var</span> renderedNode = createElement(preView) <span class="comment">// initial DOM element</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(renderedNode); <span class="comment">// add it to the document</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderApp</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">const</span> view = render(Todos) <span class="comment">// view is a VirtualNode</span></span><br><span class="line">  <span class="keyword">const</span> patches = diff(prevView, view) <span class="comment">// prevView is previous VirtualNode</span></span><br><span class="line">  renderedNode = patch(renderedNode, patches) <span class="comment">// (DOM node, patches) -&gt; (updated Dom node)</span></span><br><span class="line">  prevView = view</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>This is pretty <a href="https://github.com/Matt-Esch/virtual-dom#example" target="_blank" rel="external">standard virtual dom rendering loop</a>. The great thing
about the first 3 code lines - they do not require a live browser and produce &quot;virtual&quot;
markup from actual data, and we can easily convert it to HTML at build time.</p>
<p>Thus as part of my build in addition to running webpack, I also run 
<a href="https://github.com/bahmutov/hydrate-vdom-todo/blob/master/hydrate-app.js" target="_blank" rel="external">hydrate-app.js</a>
that is extremely simple. It takes the empty 
<a href="https://github.com/bahmutov/hydrate-vdom-todo/blob/master/index.html" target="_blank" rel="external">index.html</a> and fills
the web application&apos;s div with the initial HTML</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Model</span></span><br><span class="line"><span class="keyword">const</span> render = <span class="built_in">require</span>(<span class="string">&apos;./src/render/render&apos;</span>)</span><br><span class="line"><span class="keyword">const</span> Todos = <span class="built_in">require</span>(<span class="string">&apos;./src/todos&apos;</span>)</span><br><span class="line"><span class="comment">// rendered is a VirtualNode</span></span><br><span class="line"><span class="keyword">const</span> rendered = render(Todos)</span><br><span class="line"><span class="keyword">const</span> toHTML = <span class="built_in">require</span>(<span class="string">&apos;vdom-to-html&apos;</span>)</span><br><span class="line"><span class="keyword">const</span> beautify = <span class="built_in">require</span>(<span class="string">&apos;js-beautify&apos;</span>).html</span><br><span class="line"><span class="keyword">const</span> appMarkup = beautify(toHTML(rendered), { indent_size: <span class="number">2</span> })</span><br><span class="line"><span class="comment">// appMarkup is the same as if running in the browser</span></span><br><span class="line"><span class="comment">// insert the markup into &quot;index.html&quot;, saving the result</span></span><br><span class="line"><span class="comment">// in &quot;dist/index.html&quot;</span></span><br><span class="line">updateIndex(<span class="string">&apos;./index.html&apos;</span>, <span class="string">&apos;./dist/index.html&apos;</span>, appMarkup)</span><br></pre></td></tr></table></figure>
<p>The <a href="https://github.com/bahmutov/hydrate-vdom-todo/blob/master/dist/index.html" target="_blank" rel="external">dist/index.html</a>
has nice static HTML in its application div</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">section</span> <span class="attribute">class</span>=<span class="value">&quot;todoapp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">header</span> <span class="attribute">class</span>=<span class="value">&quot;header&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="title">header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">section</span> <span class="attribute">class</span>=<span class="value">&quot;main&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">input</span> <span class="attribute">class</span>=<span class="value">&quot;toggle-all&quot;</span> <span class="attribute">type</span>=<span class="value">&quot;checkbox&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">&quot;toggle-all&quot;</span>&gt;</span>Mark all as complete<span class="tag">&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">ul</span> <span class="attribute">class</span>=<span class="value">&quot;todo-list&quot;</span>&gt;</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="tag">&lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">section</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">footer</span>&gt;</span>...<span class="tag">&lt;/<span class="title">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>The browser now shows the correct information immediately. </p>
<h2 id="hydrating-the-page">Hydrating the page</h2><p>We now get the initial web application markup immediately because it is part of the page.
How do we &quot;hydrate&quot; or tell our application that it should just extend the existing markup?
By default, the rendering loop tries to create a new root element from the <code>VirtualNode</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// start render</span></span><br><span class="line"><span class="keyword">var</span> prevView = render(Todos) <span class="comment">// VirtualNode</span></span><br><span class="line"><span class="keyword">var</span> renderedNode = createElement(preView) <span class="comment">// initial DOM element</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(renderedNode); <span class="comment">// add it to the document</span></span><br></pre></td></tr></table></figure>
<p>Instead of using <code>createElement</code> that takes <code>VirtualNode</code> instance and returns new
DOM element, we can grab the DOM element from the page and create a <code>VirtualNode</code>!
I am using helper library <a href="https://github.com/TimBeyer/html-to-vdom" target="_blank" rel="external">html-to-vdom</a> that
does this.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// grab DOM element already present</span></span><br><span class="line"><span class="keyword">const</span> appNode = <span class="built_in">document</span>.getElementById(<span class="string">&apos;app&apos;</span>)</span><br><span class="line"><span class="keyword">var</span> renderedNode = appNode.firstElementChild</span><br><span class="line"><span class="keyword">const</span> convertHTML = <span class="built_in">require</span>(<span class="string">&apos;html-to-vdom&apos;</span>)</span><br><span class="line"><span class="keyword">var</span> prevView = convertHTML(renderedNode.outerHTML)</span><br></pre></td></tr></table></figure>
<p>That is it, now that we created a <code>VirtualDom</code> from the actual HTML we can
patch it using normal VirtualDom <code>diff</code> methods.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderApp</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">const</span> view = render(Todos)</span><br><span class="line">  <span class="keyword">const</span> patches = diff(prevView, view)</span><br><span class="line">  renderedNode = patch(renderedNode, patches)</span><br><span class="line">  prevView = view</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>This is how a Virtual-Dom application can start without destroying and recreating a 
part of the page.</p>
<h2 id="results">Results</h2><p>You can check out the <a href="http://glebbahmutov.com/hydrate-vdom-todo/" target="_blank" rel="external">live result</a>, and most 
importantly profile the timeline.</p>
<p><img src="https://raw.githubusercontent.com/bahmutov/hydrate-vdom-todo/master/images/hydrated-at-build-time.png" alt="hydrated timeline"></p>
<p>Notice that the Todo contents is shown right away - the application code is non-blocking at the
bottom of the body, the markup is available, and the user sees the list at startup. The application
once again starts at 1 second mark, but the content does not flash or flicker - because the
virtual dom only adds a few patches to the HTML already there; all the patches are just setting
up the event handlers!</p>
<h3 id="a-note-of-caution">A note of caution</h3><p>The true web application should still start quickly. The initial markup might be there, but it is
static - there are no event handlers, and the user might try to interact with the page only
to find that it is unresponsive. One can allow the page to be used in the <em>read-only</em> mode - 
the user should be able to scroll, maybe go to the outside resources via A links, and so on.</p>
<h2 id="further-reading">Further reading</h2><p>Some frameworks make it simple to render HTML and state (model) to hydrate the page and
quickly start. For example Virtual-Dom and React make it simple to generate static HTML
on the server and hydrate on the client.</p>
<h3 id="react-implementation">React implementation</h3><p>You can see how React can generate custom HTML markup and hydrate the application at
every server request in this 
<a href="https://github.com/rackt/redux/tree/master/examples/universal" target="_blank" rel="external">universal example</a>.
Each HTTP GET to the page runs the application code and generates 2 things: the HTML
and the data store.</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="keyword">use</span>(handleRender)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleRender</span><span class="params">(req, res)</span> </span>{</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">const</span> store = configureStore(initialState)</span><br><span class="line">    <span class="comment">// Render the component to a string</span></span><br><span class="line">    <span class="keyword">const</span> html = renderToString(</span><br><span class="line">      &lt;Provider store={store}&gt;</span><br><span class="line">        &lt;App /&gt;</span><br><span class="line">      &lt;/Provider&gt;</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">// Grab the initial state from our Redux store</span></span><br><span class="line">    <span class="keyword">const</span> finalState = store.getState()</span><br><span class="line">    <span class="comment">// Send the rendered page back to the client</span></span><br><span class="line">    res.send(renderFullPage(html, finalState))</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>We send both the HTML and the <code>finalState</code>; the state being a simple JSON object
in the page</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function renderFullPage(html, initialState) {</span><br><span class="line">  return `</span><br><span class="line">    <span class="doctype">&lt;!doctype html&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">title</span>&gt;</span>Redux Universal Example<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">&quot;app&quot;</span>&gt;</span>${html}<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line">          <span class="built_in">window</span>.__INITIAL_STATE__ = ${<span class="built_in">JSON</span>.stringify(initialState)}</span><br><span class="line">        </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">&quot;/static/bundle.js&quot;</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br><span class="line">    `</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>The <a href="https://github.com/rackt/redux/blob/master/examples/universal/client/index.js" target="_blank" rel="external">client code</a> 
can grab the state and update the HTML to start running</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = <span class="built_in">window</span>.__INITIAL_STATE__</span><br><span class="line"><span class="keyword">const</span> store = configureStore(initialState)</span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">&apos;app&apos;</span>)</span><br><span class="line">render(</span><br><span class="line">  &lt;Provider store={store}&gt;</span><br><span class="line">    &lt;App/&gt;</span><br><span class="line">  &lt;/Provider&gt;,</span><br><span class="line">  rootElement</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>

    

    <footer class="article-footer">
      <a data-url="http://glebbahmutov.com/blog/hydrate-at-build-time/" data-id="ciip3cgro00ll7furnsvskdsq" class="article-share-link">Share</a>
      
        <a href="http://glebbahmutov.com/blog/hydrate-at-build-time/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/advice/">advice</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/performance/">performance</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../instant-web-application/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Instant Web Application
        
      </div>
    </a>
  
  
    <a href="../hydrate-your-apps/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hydrate your apps</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">70</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">190</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angular/">angular</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">54</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/database/">database</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">42</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">143</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">54</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">44</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 12.86px;">QUnit</a><a href="../tags/advice/" style="font-size: 19.29px;">advice</a><a href="../tags/angular/" style="font-size: 10px;">angular</a><a href="../tags/angularjs/" style="font-size: 18.57px;">angularjs</a><a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a><a href="../tags/assertions/" style="font-size: 13.57px;">assertions</a><a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a><a href="../tags/browser/" style="font-size: 14.29px;">browser</a><a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a><a href="../tags/d3/" style="font-size: 11.43px;">d3</a><a href="../tags/database/" style="font-size: 10px;">database</a><a href="../tags/db/" style="font-size: 12.86px;">db</a><a href="../tags/es6/" style="font-size: 14.29px;">es6</a><a href="../tags/es7/" style="font-size: 10px;">es7</a><a href="../tags/functional/" style="font-size: 17.14px;">functional</a><a href="../tags/generators/" style="font-size: 12.86px;">generators</a><a href="../tags/git/" style="font-size: 13.57px;">git</a><a href="../tags/grunt/" style="font-size: 13.57px;">grunt</a><a href="../tags/gulp/" style="font-size: 11.43px;">gulp</a><a href="../tags/immutable/" style="font-size: 10px;">immutable</a><a href="../tags/interview/" style="font-size: 11.43px;">interview</a><a href="../tags/jade/" style="font-size: 12.14px;">jade</a><a href="../tags/javascript/" style="font-size: 20px;">javascript</a><a href="../tags/jshint/" style="font-size: 11.43px;">jshint</a><a href="../tags/modular-development/" style="font-size: 15px;">modular development</a><a href="../tags/nodejs/" style="font-size: 18.57px;">nodejs</a><a href="../tags/performance/" style="font-size: 15.71px;">performance</a><a href="../tags/promises/" style="font-size: 16.43px;">promises</a><a href="../tags/proposal/" style="font-size: 10.71px;">proposal</a><a href="../tags/reactive/" style="font-size: 10.71px;">reactive</a><a href="../tags/reactjs/" style="font-size: 10.71px;">reactjs</a><a href="../tags/security/" style="font-size: 12.14px;">security</a><a href="../tags/sentry/" style="font-size: 13.57px;">sentry</a><a href="../tags/testing/" style="font-size: 17.86px;">testing</a><a href="../tags/tutorial/" style="font-size: 12.86px;">tutorial</a><a href="../tags/ui/" style="font-size: 10px;">ui</a><a href="../tags/web-workers/" style="font-size: 12.86px;">web workers</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../the-senior-engineer-role/">The senior engineer role</a>
          </li>
        
          <li>
            <a href="../instant-web-application/">Instant Web Application</a>
          </li>
        
          <li>
            <a href="">Hydrate at build time</a>
          </li>
        
          <li>
            <a href="../hydrate-your-apps/">Hydrate your apps</a>
          </li>
        
          <li>
            <a href="../my-node-tools/">My Node tools</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="..//" class="mobile-nav-link">Home</a>
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'http://glebbahmutov.com/blog/hydrate-at-build-time/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css" type="text/css">
  <script src="../fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="../js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>