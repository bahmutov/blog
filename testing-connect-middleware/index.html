<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Testing Connect middleware | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="BackgroundConnect and its bigger
brother Express are extremely
popular general servers for Node. Connect takes an onion approach:
it is all about layers. Each layer can answer a request, modify it
or">
<meta property="og:type" content="article">
<meta property="og:title" content="Testing Connect middleware">
<meta property="og:url" content="http://glebbahmutov.com/blog/testing-connect-middleware/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="BackgroundConnect and its bigger
brother Express are extremely
popular general servers for Node. Connect takes an onion approach:
it is all about layers. Each layer can answer a request, modify it
or">
<meta property="og:image" content="https://raw2.github.com/bahmutov/talks/master/images/connect-slow-tests.jpg">
<meta property="og:image" content="https://raw2.github.com/bahmutov/talks/master/images/connect-slow-coverage.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Testing Connect middleware">
<meta name="twitter:description" content="BackgroundConnect and its bigger
brother Express are extremely
popular general servers for Node. Connect takes an onion approach:
it is all about layers. Each layer can answer a request, modify it
or">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="..//" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="..//" id="subtitle">Software advice from Dr. Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">Software advice from <a id="subtitle" href="http://glebbahmutov.com">Dr. Gleb Bahmutov PhD</a></span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="..//">Home</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-testing-connect-middleware" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2014-01-17T19:00:00.000Z" itemprop="datePublished">Jan 17 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Testing Connect middleware
    </h1>

    <h2 class="article-title" itemprop="name">
      How to test Connect or Express middleware functions.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="background">Background</h2><p><a href="http://www.senchalabs.org/connect/" target="_blank" rel="external">Connect</a> and its bigger
brother <a href="http://expressjs.com/" target="_blank" rel="external">Express</a> are extremely
popular general servers for Node. Connect takes an onion approach:
it is all about layers. Each layer can answer a request, modify it
or pass it to the next layer to be answered. This architecture makes it very
intuitive and powerful. Each layer is called middleware and generally
all one needs is to write a JavaScript function with this signature
to create custom middleware:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logUrl</span>(<span class="params">req, res, next</span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&apos;request url&apos;</span>, req.url);</span><br><span class="line">    <span class="comment">// pass everything unchanged to next middleware</span></span><br><span class="line">    next();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>To allow configuring the middleware, it is a convention to
return the actual worker function from a function that accepts configuration
options:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logMatchingUrls</span>(<span class="params">pattern</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">req, res, next</span>) </span>{</span><br><span class="line">        <span class="keyword">if</span> (pattern.test(req.url)) {</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&apos;request url&apos;</span>, req.url);</span><br><span class="line">        }</span><br><span class="line">        next();</span><br><span class="line">    };</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>We can use same middleware multiple times, for example lets
log all JavaScript and CSS requests while serving all files from
folder <em>public</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = connect()</span><br><span class="line">    .use(logMatchingUrls(<span class="regexp">/\.js$/i</span>))</span><br><span class="line">    .use(logMatchingUrls(<span class="regexp">/\.css$/i</span>))</span><br><span class="line">    .use(connect.static(<span class="string">&apos;public&apos;</span>))</span><br><span class="line">    .use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>{</span><br><span class="line">        res.end(<span class="string">&apos;hello world\n&apos;</span>);</span><br><span class="line">    })</span><br><span class="line">http.createServer(app).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h2 id="testing-middleware">Testing middleware</h2><p>Creating custom middleware is so easy, that the Connect community created
more than <a href="https://github.com/senchalabs/connect/wiki" target="_blank" rel="external">60 layers</a> in addition
to the 18 that are included with Connect itself. If you are thinking about
creating your own middleware, here is how to make testing it as simple
as writing it. This example is based on the
<a href="https://github.com/bahmutov/connect-slow" target="_blank" rel="external">connect-slow</a> middleware I wrote to slow down
serving some requests to ease debugging website loading and performance problems.</p>
<p>Here is a typical example for <em>connect-slow</em> - delay serving <em>jquery.js</em> by 5 seconds
to look at how the website behaves during these 5 seconds.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> slow = <span class="built_in">require</span>(<span class="string">&apos;connect-slow&apos;</span>);</span><br><span class="line"><span class="keyword">var</span> app = connect()</span><br><span class="line">    .use(slow({</span><br><span class="line">        url: <span class="regexp">/\.jquery\.js$/i</span>,</span><br><span class="line">        delay: <span class="number">5000</span></span><br><span class="line">    }))</span><br><span class="line">    .use(connect.static(<span class="string">&apos;public&apos;</span>));</span><br><span class="line">http.createServer(app).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>There are 3 levels of testing one could do for this middleware:</p>
<ol>
<li>Small unit testing to make sure invalid arguments are handled properly.</li>
<li>Medium sized testing with mock request, response objects and next function.</li>
<li>End to end testing with actual connect stack running and separate live requests.</li>
</ol>
<p>I decided to only create tests to check invalid inputs (1) and perform end to end
testing (3). I skipped creating mock objects, because they introduce more complexity
and would essentially look like end to end tests.</p>
<h2 id="small-unit-testing">Small unit testing</h2><p>I used my own testing runner <a href="https://github.com/bahmutov/gt" target="_blank" rel="external">gt</a> that is pretty much
compatible with <a href="http://qunitjs.com/" target="_blank" rel="external">QUnit</a> syntax, runs natively on Node,
and provides code coverage via <a href="https://npmjs.org/package/istanbul" target="_blank" rel="external">istanbul</a> integration.</p>
<p>Here are the small tests that make sure an error is thrown if url is not a RegExp,
or delay is negative number. You can see the entire
<a href="https://github.com/bahmutov/connect-slow/blob/master/test/basic.js" target="_blank" rel="external">test file</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gt.test(<span class="string">&apos;url should be a regexp&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  gt.throws(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    slow({</span><br><span class="line">      url: <span class="string">&apos;.html&apos;</span></span><br><span class="line">    });</span><br><span class="line">  }, <span class="string">&apos;AssertionError&apos;</span>);</span><br><span class="line">});</span><br><span class="line">gt.test(<span class="string">&apos;delay should be positive&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  gt.throws(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    slow({</span><br><span class="line">      delay: -<span class="number">100</span></span><br><span class="line">    });</span><br><span class="line">  }, <span class="string">&apos;AssertionError&apos;</span>);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>I did not want to create the medium mock tests, but I still wanted to make sure
the function returned by <code>slow()</code> is a valid middleware function that expects 3 arguments.
So I added a unit test to check if the returned value is a function with arity 3</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gt.test(<span class="string">&apos;valid parameters&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> fn = slow({</span><br><span class="line">    url: <span class="regexp">/\.jpg$/i</span>,</span><br><span class="line">    delay: <span class="number">2000</span></span><br><span class="line">  });</span><br><span class="line">  gt.arity(fn, <span class="number">3</span>, <span class="string">&apos;middleware expects 3 arguments&apos;</span>);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h2 id="end-to-end-testing">End to end testing</h2><p>Lets validate that the middleware actually delays answering some requests but not
the others. This is an example of asynchronous testing and some testing frameworks
are better at this than others. <em>gt</em> provides lots of support for async testing,
most relevant for this problem that it <a href="https://github.com/bahmutov/gt#module" target="_blank" rel="external">provides</a>
<code>setupOnce</code> and <code>teardownOnce</code> methods that can create and tear down a Connect stack
before running multiple unit tests</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> request = q.denodeify(<span class="built_in">require</span>(<span class="string">&apos;request&apos;</span>));</span><br><span class="line"><span class="keyword">var</span> port = <span class="number">3440</span>;</span><br><span class="line"><span class="keyword">var</span> msg = <span class="string">&apos;hello world&apos;</span>;</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">&apos;http://localhost:&apos;</span> + port + <span class="string">&apos;/something&apos;</span>;</span><br><span class="line">gt.module(<span class="string">&apos;connect-slow some resources&apos;</span>, {</span><br><span class="line">  setupOnce: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> app = connect()</span><br><span class="line">    .use(connect.logger(<span class="string">&apos;dev&apos;</span>))</span><br><span class="line">    .use(slow({</span><br><span class="line">      url: <span class="regexp">/\.slow$/i</span>,</span><br><span class="line">      delay: <span class="number">500</span></span><br><span class="line">    }))</span><br><span class="line">    .use(sendMessage);</span><br><span class="line">    <span class="keyword">this</span>.server = http.createServer(app).listen(port);</span><br><span class="line">  },</span><br><span class="line">  teardownOnce: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">this</span>.server.close();</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>.server;</span><br><span class="line">  }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">gt.async(<span class="string">&apos;.slow requests are slow&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  request(url + <span class="string">&apos;/foo.slow&apos;</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{</span><br><span class="line">    gt.equal(data[<span class="number">0</span>].statusCode, <span class="number">200</span>, <span class="string">&apos;code 200&apos;</span>);</span><br><span class="line">    <span class="keyword">var</span> end = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">var</span> ms = end - start;</span><br><span class="line">    gt.ok(ms &gt;= <span class="number">500</span>, <span class="string">&apos;server responded in&apos;</span>, ms, <span class="string">&apos;not in 500ms&apos;</span>);</span><br><span class="line">  })</span><br><span class="line">  .fail(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>{</span><br><span class="line">    gt.ok(<span class="literal">false</span>, err);</span><br><span class="line">  })</span><br><span class="line">  .finally(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    gt.start();</span><br><span class="line">  });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">gt.async(<span class="string">&apos;other requests are still fast&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  request(url + <span class="string">&apos;/foo.html&apos;</span>)</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>{</span><br><span class="line">    gt.equal(data[<span class="number">0</span>].statusCode, <span class="number">200</span>, <span class="string">&apos;code 200&apos;</span>);</span><br><span class="line">    <span class="keyword">var</span> end = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">var</span> ms = end - start;</span><br><span class="line">    gt.ok(ms &gt;= <span class="number">0</span> &amp;&amp; ms &lt; <span class="number">150</span>, <span class="string">&apos;server responded in&apos;</span>, ms);</span><br><span class="line">  })</span><br><span class="line">  .fail(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>{</span><br><span class="line">    gt.ok(<span class="literal">false</span>, err);</span><br><span class="line">  })</span><br><span class="line">  .finally(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    gt.start();</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h2 id="result">Result</h2><p>You can try running the tests yourself:</p>
<pre><code>npm <span class="operator"><span class="keyword">install</span> <span class="keyword">connect</span>-slow
cd node_modules/<span class="keyword">connect</span>-slow
# <span class="keyword">install</span> devDependencies needed <span class="keyword">for</span> testing
npm <span class="keyword">install</span>
npm <span class="keyword">test</span></span>
</code></pre><p>The tests should pass, the code coverage is printed after the tests</p>
<p><img src="https://raw2.github.com/bahmutov/talks/master/images/connect-slow-tests.jpg" alt="connect-slow tests and coverage"></p>
<p>You can open <em>cover/lcov-report/index.html</em> and see code coverage line by line</p>
<p><img src="https://raw2.github.com/bahmutov/talks/master/images/connect-slow-coverage.jpg" alt="connect-slow code coverage"></p>
<h2 id="bonus-pre-git">Bonus - pre-git</h2><p>Remember, achieving passing tests is important initially, but is extremely
important in the future whenever any changes to the code are made. I use
my own <a href="http://github.com/bahmutov/pre-git" target="_blank" rel="external">pre-git</a> project that installs
Node hooks to run before <code>git commit</code> and <code>git push</code> commands. For example,
to make sure tests pass before each commit, I add the following to <em>package.json</em></p>
<pre><code>&quot;pre-<span class="operator"><span class="keyword">commit</span><span class="string">&quot;: &quot;</span>npm <span class="keyword">test</span><span class="string">&quot;</span></span>
</code></pre><p>To make sure the code pushed to master does not depend on unlisted dependencies,
the <code>pre-push</code> hook is more stringent</p>
<pre><code><span class="string">&quot;pre-push&quot;</span>: [
    <span class="string">&quot;rm -rf node_modules&quot;</span>,
    <span class="string">&quot;npm install&quot;</span>,
    <span class="string">&quot;npm test&quot;</span>
]
</code></pre><p>Using these safety mechanisms, you will keep your middleware working happily in the future.</p>
<p>Related: <a href="../how-to-correctly-unit-test-express-server/">How to unit test Express server</a></p>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>

    

    <footer class="article-footer">
      <a data-url="http://glebbahmutov.com/blog/testing-connect-middleware/" data-id="ciip3cgb8005p7fur4mbh1hdm" class="article-share-link">Share</a>
      
        <a href="http://glebbahmutov.com/blog/testing-connect-middleware/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/advice/">advice</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/testing/">testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../error-handling-in-promises/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Error handling in promises
        
      </div>
    </a>
  
  
    <a href="../review-smashing-book-4/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Review of &quot;The Smashing Book 4&quot;</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">70</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">190</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angular/">angular</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">54</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/database/">database</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">42</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">143</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">54</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">44</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 12.86px;">QUnit</a><a href="../tags/advice/" style="font-size: 19.29px;">advice</a><a href="../tags/angular/" style="font-size: 10px;">angular</a><a href="../tags/angularjs/" style="font-size: 18.57px;">angularjs</a><a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a><a href="../tags/assertions/" style="font-size: 13.57px;">assertions</a><a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a><a href="../tags/browser/" style="font-size: 14.29px;">browser</a><a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a><a href="../tags/d3/" style="font-size: 11.43px;">d3</a><a href="../tags/database/" style="font-size: 10px;">database</a><a href="../tags/db/" style="font-size: 12.86px;">db</a><a href="../tags/es6/" style="font-size: 14.29px;">es6</a><a href="../tags/es7/" style="font-size: 10px;">es7</a><a href="../tags/functional/" style="font-size: 17.14px;">functional</a><a href="../tags/generators/" style="font-size: 12.86px;">generators</a><a href="../tags/git/" style="font-size: 13.57px;">git</a><a href="../tags/grunt/" style="font-size: 13.57px;">grunt</a><a href="../tags/gulp/" style="font-size: 11.43px;">gulp</a><a href="../tags/immutable/" style="font-size: 10px;">immutable</a><a href="../tags/interview/" style="font-size: 11.43px;">interview</a><a href="../tags/jade/" style="font-size: 12.14px;">jade</a><a href="../tags/javascript/" style="font-size: 20px;">javascript</a><a href="../tags/jshint/" style="font-size: 11.43px;">jshint</a><a href="../tags/modular-development/" style="font-size: 15px;">modular development</a><a href="../tags/nodejs/" style="font-size: 18.57px;">nodejs</a><a href="../tags/performance/" style="font-size: 15.71px;">performance</a><a href="../tags/promises/" style="font-size: 16.43px;">promises</a><a href="../tags/proposal/" style="font-size: 10.71px;">proposal</a><a href="../tags/reactive/" style="font-size: 10.71px;">reactive</a><a href="../tags/reactjs/" style="font-size: 10.71px;">reactjs</a><a href="../tags/security/" style="font-size: 12.14px;">security</a><a href="../tags/sentry/" style="font-size: 13.57px;">sentry</a><a href="../tags/testing/" style="font-size: 17.86px;">testing</a><a href="../tags/tutorial/" style="font-size: 12.86px;">tutorial</a><a href="../tags/ui/" style="font-size: 10px;">ui</a><a href="../tags/web-workers/" style="font-size: 12.86px;">web workers</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../the-senior-engineer-role/">The senior engineer role</a>
          </li>
        
          <li>
            <a href="../instant-web-application/">Instant Web Application</a>
          </li>
        
          <li>
            <a href="../hydrate-at-build-time/">Hydrate at build time</a>
          </li>
        
          <li>
            <a href="../hydrate-your-apps/">Hydrate your apps</a>
          </li>
        
          <li>
            <a href="../my-node-tools/">My Node tools</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="..//" class="mobile-nav-link">Home</a>
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'http://glebbahmutov.com/blog/testing-connect-middleware/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css" type="text/css">
  <script src="../fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="../js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>