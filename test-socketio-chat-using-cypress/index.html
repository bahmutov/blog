<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Test a Socket.io Chat App using Cypress | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="This is the first blog post showing how to test a Socket.io real-time chat using the Cypress.io test runner. Subscribe to the Atom RSS feed and follow @bahmutov to learn when the new parts are publish">
<meta property="og:type" content="article">
<meta property="og:title" content="Test a Socket.io Chat App using Cypress">
<meta property="og:url" content="https://glebbahmutov.com/blog/test-socketio-chat-using-cypress/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="This is the first blog post showing how to test a Socket.io real-time chat using the Cypress.io test runner. Subscribe to the Atom RSS feed and follow @bahmutov to learn when the new parts are publish">
<meta property="og:locale">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/chat-two.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/first-test.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/runs.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/random.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/client-api-spec.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/join.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/order.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/right-order.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/last-message.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/left.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/chat-intro/browser-spec.gif">
<meta property="article:published_time" content="2021-06-09T04:00:00.000Z">
<meta property="article:modified_time" content="2021-08-16T16:04:10.343Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="cypress">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/chat-intro/chat-two.png">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-test-socketio-chat-using-cypress" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2021-06-09T04:00:00.000Z" itemprop="datePublished">Jun 9 2021</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Test a Socket.io Chat App using Cypress
    </h1>

    <h2 class="article-title" itemprop="name">
      How to write simple test for a real-time chat web application.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is the first blog post showing how to test a <a target="_blank" rel="noopener" href="https://socket.io/">Socket.io</a> real-time chat using the <a target="_blank" rel="noopener" href="https://www.cypress.io/">Cypress.io</a> test runner. Subscribe to the <a href="../atom.xml">Atom RSS feed</a> and follow <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a> to learn when the new parts are published.</p>
<!-- toc -->
<ul>
<li><a href="#the-app">The app</a></li>
<li><a href="#the-first-test">The first test</a></li>
<li><a href="#use-a-random-user-name">Use a random user name</a></li>
<li><a href="#sending-events-from-the-test">Sending events from the test</a></li>
<li><a href="#use-socketio-from-cypress">Use Socket.io from Cypress</a></li>
<li><a href="#verify-message-received-by-the-second-user">Verify message received by the second user</a></li>
<li><a href="#test-user-leaving-the-chat">Test user leaving the chat</a></li>
<li><a href="#alternative-connect-to-the-socketio-server-from-the-spec-file">Alternative: connect to the Socket.io server from the spec file</a></li>
<li><a href="#see-also">See also</a></li>
</ul>
<!-- tocstop -->
<h2><span id="the-app">The app</span></h2><p>As the example app, I used the chat app from <a target="_blank" rel="noopener" href="https://github.com/dkhd/node-group-chat">dkhd/node-group-chat</a> repo, as described in <a target="_blank" rel="noopener" href="https://itnext.io/build-a-group-chat-app-in-30-lines-using-node-js-15bfe7a2417b">Build A Group-Chat App in 30 Lines Using Node.js</a> blog post. The app allows you to open multiple chat browser windows and exchange group messages.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br><span class="line"></span><br><span class="line">&gt; cypress-socketio-chat@1.0.0 start &#x2F;Users&#x2F;gleb&#x2F;git&#x2F;cypress-socketio-chat</span><br><span class="line">&gt; node .</span><br><span class="line"></span><br><span class="line">listening on *:8080</span><br><span class="line">new connection</span><br><span class="line">set username Joe</span><br><span class="line">new connection</span><br><span class="line">set username Ann</span><br><span class="line">&gt; Joe: Hi there, Ann</span><br><span class="line">&gt; Ann: Good to see you, Joe</span><br></pre></td></tr></table></figure>
<p><img src="../images/chat-intro/chat-two.png" alt="Two users chatting"></p>
<p>The server is relaying the messages from the users, the front end code is using event subscriptions to display new messages.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../../socket.io/socket.io.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;messages&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">id</span>=<span class="string">&quot;chatForm&quot;</span>&gt;</span></span><br><span class="line">    &lt;input</span><br><span class="line">      id=&quot;txt&quot;</span><br><span class="line">      autocomplete=&quot;off&quot;</span><br><span class="line">      autofocus=&quot;on&quot;</span><br><span class="line">      placeholder=&quot;type your message here...&quot;</span><br><span class="line">    /&gt;<span class="tag">&lt;<span class="name">button</span>&gt;</span>Send<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> socket = io.connect(<span class="string">&#x27;http://localhost:8080&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="comment">// submit text message without reload/refresh the page</span></span></span><br><span class="line"><span class="javascript">    $(<span class="string">&#x27;form&#x27;</span>).submit(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      e.preventDefault() <span class="comment">// prevents page reloading</span></span></span><br><span class="line"><span class="javascript">      socket.emit(<span class="string">&#x27;chat_message&#x27;</span>, $(<span class="string">&#x27;#txt&#x27;</span>).val())</span></span><br><span class="line"><span class="javascript">      $(<span class="string">&#x27;#txt&#x27;</span>).val(<span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="javascript">    socket.on(<span class="string">&#x27;chat_message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span></span></span><br><span class="line"><span class="javascript">      $(<span class="string">&#x27;#messages&#x27;</span>).append($(<span class="string">&#x27;&lt;li&gt;&#x27;</span>).html(msg)),</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="javascript">    socket.on(<span class="string">&#x27;is_online&#x27;</span>, <span class="function">(<span class="params">username</span>) =&gt;</span></span></span><br><span class="line"><span class="javascript">      $(<span class="string">&#x27;#messages&#x27;</span>).append($(<span class="string">&#x27;&lt;li&gt;&#x27;</span>).html(username)),</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// ask username</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> username = prompt(<span class="string">&#x27;Please tell me your name&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    socket.emit(<span class="string">&#x27;username&#x27;</span>, username)</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong> you can find the source code for the app, and the tests in the repo <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-socketio-chat">bahmutov/cypress-socketio-chat</a>.</p>
<h2><span id="the-first-test">The first test</span></h2><p>Even if there is a single user, the chat application is showing every message. Thus our first test can confirm the submitted messages appear.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/first-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;shows the message&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="function"><span class="title">onBeforeLoad</span>(<span class="params">win</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// when the application asks for the name</span></span><br><span class="line">      <span class="comment">// return &quot;Cy&quot; using https://on.cypress.io/stub</span></span><br><span class="line">      cy.stub(win, <span class="string">&#x27;prompt&#x27;</span>).returns(<span class="string">&#x27;Cy&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.get(<span class="string">&#x27;#txt&#x27;</span>).type(<span class="string">&#x27;Hello there&#123;enter&#125;&#x27;</span>)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#messages li&#x27;</span>, <span class="string">&#x27;Hello there&#x27;</span>).contains(<span class="string">&#x27;strong&#x27;</span>, <span class="string">&#x27;Cy&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>Tip:</strong> to start the server and open Cypress when the <code>localhost:8080</code> responds I use <a target="_blank" rel="noopener" href="https://github.com/bahmutov/start-server-and-test">start-server-and-test</a> utility.</p>
<p><img src="../images/chat-intro/first-test.png" alt="First test passing"></p>
<p>As soon as I have the first Cypress test passing, I configure the <a target="_blank" rel="noopener" href="https://on.cypress.io/ci">continuous integration</a> service to test every commit. In this repo, I will be using <a target="_blank" rel="noopener" href="https://github.com/cypress-io/github-action">Cypress GitHub Action</a> to run the tests, see <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-socketio-chat/blob/main/.github/workflows/ci.yml">.github/workflows/ci.yml</a> file:</p>
<figure class="highlight yml"><figcaption><span>.github/workflows/ci.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">ci</span></span><br><span class="line"><span class="attr">on:</span> <span class="string">push</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-20.04</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Check</span> <span class="string">out</span> <span class="string">code</span> <span class="string">üõé</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># install dependencies, start the app,</span></span><br><span class="line">      <span class="comment"># and run E2E tests using Cypress GitHub action</span></span><br><span class="line">      <span class="comment"># https://github.com/cypress-io/github-action</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">tests</span> <span class="string">üß™</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">start:</span> <span class="string">npm</span> <span class="string">start</span></span><br><span class="line">          <span class="attr">wait:</span> <span class="string">&#x27;http://localhost:8080&#x27;</span></span><br></pre></td></tr></table></figure>
<p>You can find the CI runs at <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-socketio-chat/actions">bahmutov/cypress-socketio-chat/actions</a>.</p>
<p><img src="../images/chat-intro/runs.png" alt="Test runs on CI using GitHub Actions"></p>
<h2><span id="use-a-random-user-name">Use a random user name</span></h2><p>We are working towards testing the full chat, thus we will have multiple users. To avoid every test typing the same <code>Cy</code> name, let&#39;s create the user names randomly using the bundled <a target="_blank" rel="noopener" href="https://on.cypress.io/_">Lodash</a> library.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/random-name-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;chats&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">`Cy_<span class="subst">$&#123;Cypress._.random(<span class="number">1000</span>)&#125;</span>`</span></span><br><span class="line">  <span class="comment">// we can make text bold using Markdown &quot;**&quot;</span></span><br><span class="line">  cy.log(<span class="string">`User **<span class="subst">$&#123;name&#125;</span>**`</span>)</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="function"><span class="title">onBeforeLoad</span>(<span class="params">win</span>)</span> &#123;</span><br><span class="line">      cy.stub(win, <span class="string">&#x27;prompt&#x27;</span>).returns(name)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.get(<span class="string">&#x27;#txt&#x27;</span>).type(<span class="string">&#x27;Hello there&#123;enter&#125;&#x27;</span>)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#messages li&#x27;</span>, <span class="string">&#x27;Hello there&#x27;</span>).contains(<span class="string">&#x27;strong&#x27;</span>, name)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="../images/chat-intro/random.png" alt="Using a randomly generates user name"></p>
<blockquote class="pullquote"><p>üåç Notice the name <code>Cy_350</code> in the command log. By coincidence <a target="_blank" rel="noopener" href="https://350.org/">350.org</a> is a climate organization fighting to bring us back to 350 parts per million (ppm) of carbon dioxide gas (CO2) in the atmosphere - which is the safe limit. Currently we are at <a target="_blank" rel="noopener" href="https://research.noaa.gov/article/ArtMID/587/ArticleID/2764/Coronavirus-response-barely-slows-rising-carbon-dioxide">420 ppm</a> - a level of this greenhouse planet-warming gas we had 4 million years ago, when the average temperatures were 3C / 7F higher, and the sea level were higher by 26m / 70 feet. Plan your future with this in mind.</p>
</blockquote>
<h2><span id="sending-events-from-the-test">Sending events from the test</span></h2><p>We need to see what happens when some other user joins the chat and sends a message. Because this communication happens over WebSockets, we cannot simply use <a target="_blank" rel="noopener" href="https://on.cypress.io/intercept">cy.intercept</a>, at least not in v7. But let&#39;s see what happens <em>immediately</em> after a new message arrives via a socket channel:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">socket.on(<span class="string">&#x27;chat_message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span></span><br><span class="line">  $(<span class="string">&#x27;#messages&#x27;</span>).append($(<span class="string">&#x27;&lt;li&gt;&#x27;</span>).html(msg)),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">&#x27;is_online&#x27;</span>, <span class="function">(<span class="params">username</span>) =&gt;</span></span><br><span class="line">  $(<span class="string">&#x27;#messages&#x27;</span>).append($(<span class="string">&#x27;&lt;li&gt;&#x27;</span>).html(username)),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>We want to trigger those events from the test. The simplest way is to create an object abstraction between the <code>socket</code> and the rest of the code.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> socket = io.connect(<span class="string">&#x27;http://localhost:8080&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clientActions = &#123;</span><br><span class="line">  <span class="function"><span class="title">onChatMessage</span>(<span class="params">msg</span>)</span> &#123;</span><br><span class="line">    $(<span class="string">&#x27;#messages&#x27;</span>).append($(<span class="string">&#x27;&lt;li&gt;&#x27;</span>).html(msg))</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">isOnline</span>(<span class="params">username</span>)</span> &#123;</span><br><span class="line">    $(<span class="string">&#x27;#messages&#x27;</span>).append($(<span class="string">&#x27;&lt;li&gt;&#x27;</span>).html(username))</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">&#x27;chat_message&#x27;</span>, clientActions.onChatMessage)</span><br><span class="line">socket.on(<span class="string">&#x27;is_online&#x27;</span>, clientActions.isOnline)</span><br></pre></td></tr></table></figure>
<p>The application works, the same, but now we can expose the <code>clientActions</code> object during end-to-end tests.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.Cypress) &#123;</span><br><span class="line">  <span class="built_in">window</span>.clientActions = clientActions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Here is how we can use it from the test to test what happens when another user joins the chat and posts a message. We are not delivering the messages via the socket connection, instead we trigger them <em>right</em> after.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/client-api-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;shows status for 2nd user&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">`Cy_<span class="subst">$&#123;Cypress._.random(<span class="number">1000</span>)&#125;</span>`</span></span><br><span class="line">  cy.log(<span class="string">`User **<span class="subst">$&#123;name&#125;</span>**`</span>)</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="function"><span class="title">onBeforeLoad</span>(<span class="params">win</span>)</span> &#123;</span><br><span class="line">      cy.stub(win, <span class="string">&#x27;prompt&#x27;</span>).returns(name)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  cy.get(<span class="string">&#x27;#txt&#x27;</span>).type(<span class="string">&#x27;Hello there&#123;enter&#125;&#x27;</span>)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#messages li&#x27;</span>, <span class="string">&#x27;Hello there&#x27;</span>)</span><br><span class="line">    .contains(<span class="string">&#x27;strong&#x27;</span>, name)</span><br><span class="line">    .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      cy.log(<span class="string">&#x27;**second user**&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// pretend to send a message from another user</span></span><br><span class="line">  cy.window()</span><br><span class="line">    .its(<span class="string">&#x27;clientActions&#x27;</span>)</span><br><span class="line">    .invoke(<span class="string">&#x27;isOnline&#x27;</span>, <span class="string">&#x27;üëª &lt;i&gt;Ghost is testing&lt;/i&gt;&#x27;</span>)</span><br><span class="line">  cy.window()</span><br><span class="line">    .its(<span class="string">&#x27;clientActions&#x27;</span>)</span><br><span class="line">    .invoke(<span class="string">&#x27;onChatMessage&#x27;</span>, <span class="string">&#x27;&lt;strong&gt;Ghost&lt;/strong&gt;: Boo&#x27;</span>)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#messages li&#x27;</span>, <span class="string">&#x27;Boo&#x27;</span>).contains(<span class="string">&#x27;strong&#x27;</span>, <span class="string">&#x27;Ghost&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="../images/chat-intro/client-api-spec.png" alt="Testing messages from another user"></p>
<p>We can refactor the spec code and save the <code>clientActions</code> reference as an <a target="_blank" rel="noopener" href="https://on.cypress.io/as">alias</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pretend to send a message from another user</span></span><br><span class="line">cy.window().its(<span class="string">&#x27;clientActions&#x27;</span>).as(<span class="string">&#x27;client&#x27;</span>)</span><br><span class="line">cy.get(<span class="string">&#x27;@client&#x27;</span>).invoke(<span class="string">&#x27;isOnline&#x27;</span>, <span class="string">&#x27;üëª &lt;i&gt;Ghost is testing&lt;/i&gt;&#x27;</span>)</span><br><span class="line">cy.get(<span class="string">&#x27;@client&#x27;</span>).invoke(<span class="string">&#x27;onChatMessage&#x27;</span>, <span class="string">&#x27;&lt;strong&gt;Ghost&lt;/strong&gt;: Boo&#x27;</span>)</span><br><span class="line">cy.contains(<span class="string">&#x27;#messages li&#x27;</span>, <span class="string">&#x27;Boo&#x27;</span>).contains(<span class="string">&#x27;strong&#x27;</span>, <span class="string">&#x27;Ghost&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>Tip:</strong> the above approach is what I call <a href="/blog/realworld-app-action/" title="app actions">app actions</a>.</p>
<h2><span id="use-socketio-from-cypress">Use Socket.io from Cypress</span></h2><p>The above approach has an advantage - it does not require the backend to run. We can simply use <code>clientActions</code> without a server to exercise our web page as needed. But we really won&#39;t have any confidence in the server running correctly. We won&#39;t have confidence in our WebSocket communication channel working either. Let&#39;s truly &quot;drive&quot; the conversation by opening a second connection to the server and &quot;chatting&quot; with our web user.</p>
<p>First, let&#39;s install the <code>socket.io-client</code> NPM module</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -D socket.io-client</span><br><span class="line">+socket.io-client@4.1.2</span><br></pre></td></tr></table></figure>
<p>Now in Cypress plugin file <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-socketio-chat/blob/main/cypress/plugins/index.js">cypress/plugins/index.js</a> we will add an optional socket.io client logic to be controlled using the <a target="_blank" rel="noopener" href="https://on.cypress.io/task">cy.task</a> command.</p>
<figure class="highlight js"><figcaption><span>cypress/plugins/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Socket.io client to allow Cypress itself</span></span><br><span class="line"><span class="comment">// to connect from the plugin file to the chat app</span></span><br><span class="line"><span class="comment">// to play the role of another user</span></span><br><span class="line"><span class="comment">// https://socket.io/docs/v4/client-initialization/</span></span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">&#x27;socket.io-client&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@type <span class="type">&#123;Cypress.PluginConfig&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// eslint-disable-next-line no-unused-vars</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">on, config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// `on` is used to hook into various events Cypress emits</span></span><br><span class="line">  <span class="comment">// `config` is the resolved Cypress config</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// connection to the chat server</span></span><br><span class="line">  <span class="keyword">let</span> socket</span><br><span class="line"></span><br><span class="line">  on(<span class="string">&#x27;task&#x27;</span>, &#123;</span><br><span class="line">    <span class="function"><span class="title">connect</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;Cypress is connecting to socket server under name %s&#x27;</span>, name)</span><br><span class="line">      socket = io(<span class="string">&#x27;http://localhost:8080&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      socket.emit(<span class="string">&#x27;username&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The test can call the task and confirm the web UI receives the new user message</p>
<figure class="highlight js"><figcaption><span>cypress/integration/socket-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;sees the 2nd user join&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// the browser is the 1st user</span></span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">`Cy_<span class="subst">$&#123;Cypress._.random(<span class="number">1000</span>)&#125;</span>`</span></span><br><span class="line">  cy.log(<span class="string">`User **<span class="subst">$&#123;name&#125;</span>**`</span>)</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="function"><span class="title">onBeforeLoad</span>(<span class="params">win</span>)</span> &#123;</span><br><span class="line">      cy.stub(win, <span class="string">&#x27;prompt&#x27;</span>).returns(name)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// make sure the greeting message is shown</span></span><br><span class="line">  cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;name&#125;</span> join the chat..`</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// connect to the server using 2nd user</span></span><br><span class="line">  <span class="keyword">const</span> secondName = <span class="string">&#x27;Ghost&#x27;</span></span><br><span class="line">  cy.task(<span class="string">&#x27;connect&#x27;</span>, secondName)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;secondName&#125;</span> join the chat..`</span>).should(</span><br><span class="line">    <span class="string">&#x27;be.visible&#x27;</span>,</span><br><span class="line">  )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test passes, our web page really sees the users joining the running Socket.io server.</p>
<p><img src="../images/chat-intro/join.png" alt="Seeing the second user join"></p>
<p>Let&#39;s send a message from the second user and confirm the web page receives it. We can add another task to the plugin file:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// task in cypress/plugins/index.js file</span></span><br><span class="line"><span class="function"><span class="title">say</span>(<span class="params">message</span>)</span> &#123;</span><br><span class="line">  socket.emit(<span class="string">&#x27;chat_message&#x27;</span>, message)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>The test can send the message using the 2nd user (via <code>cy.task</code>) and verify it shows up in the web page</p>
<figure class="highlight js"><figcaption><span>cypress/integration/socket-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;sees messages from the 2nd user&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// the browser is the 1st user</span></span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">`Cy_<span class="subst">$&#123;Cypress._.random(<span class="number">1000</span>)&#125;</span>`</span></span><br><span class="line">  cy.log(<span class="string">`User **<span class="subst">$&#123;name&#125;</span>**`</span>)</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="function"><span class="title">onBeforeLoad</span>(<span class="params">win</span>)</span> &#123;</span><br><span class="line">      cy.stub(win, <span class="string">&#x27;prompt&#x27;</span>).returns(name)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> secondName = <span class="string">&#x27;Ghost&#x27;</span></span><br><span class="line">  cy.task(<span class="string">&#x27;connect&#x27;</span>, secondName)</span><br><span class="line">  <span class="keyword">const</span> message = <span class="string">&#x27;hello from 2nd user&#x27;</span></span><br><span class="line">  cy.task(<span class="string">&#x27;say&#x27;</span>, message)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#messages li&#x27;</span>, message)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test passes - but it shows the typical distributed system behavior; it is hard to guarantee that messages are delivered in the expected order.</p>
<p><img src="../images/chat-intro/order.png" alt="Unexpected order of messages"></p>
<p>We really want to ensure the first user joins before sending messages from the 2nd user, let&#39;s add assertions.</p>
<figure class="highlight js"><figcaption><span>cypress/plugins/index.js file</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// make sure the greeting message is shown</span></span><br><span class="line">cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;name&#125;</span> join the chat..`</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> secondName = <span class="string">&#x27;Ghost&#x27;</span></span><br><span class="line">cy.task(<span class="string">&#x27;connect&#x27;</span>, secondName)</span><br><span class="line">cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;secondName&#125;</span> join the chat..`</span>)</span><br><span class="line">  .should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> message = <span class="string">&#x27;hello from 2nd user&#x27;</span></span><br><span class="line">cy.task(<span class="string">&#x27;say&#x27;</span>, message)</span><br><span class="line">cy.contains(<span class="string">&#x27;#messages li&#x27;</span>, message)</span><br></pre></td></tr></table></figure>
<p>Now the test behaves as expected</p>
<p><img src="../images/chat-intro/right-order.png" alt="Additional commands ensure the expected order of events"></p>
<p>We have verified that web page shows the messages sent to the Socket.io server from other users.</p>
<h2><span id="verify-message-received-by-the-second-user">Verify message received by the second user</span></h2><p>Let&#39;s verify the messages sent by the web page reach the other users connected to the Socket.io server. We will store the last received message in the plugin file and will add fetching it via <code>cy.task</code>. This is similar to checking the last received email I have described in the blog post <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2021/05/24/full-testing-of-html-emails-using-ethereal-accounts/">Full Testing of HTML Emails using SendGrid and Ethereal Accounts</a>.</p>
<figure class="highlight js"><figcaption><span>cypress/plugins/index.js file</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// connection to the chat server</span></span><br><span class="line"><span class="keyword">let</span> socket</span><br><span class="line"><span class="keyword">let</span> lastMessage</span><br><span class="line"></span><br><span class="line">on(<span class="string">&#x27;task&#x27;</span>, &#123;</span><br><span class="line">  <span class="function"><span class="title">connect</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Cypress is connecting to socket server under name %s&#x27;</span>, name)</span><br><span class="line">    socket = io(<span class="string">&#x27;http://localhost:8080&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    socket.emit(<span class="string">&#x27;username&#x27;</span>, name)</span><br><span class="line">    socket.on(<span class="string">&#x27;chat_message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> (lastMessage = msg))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">say</span>(<span class="params">message</span>)</span> &#123;</span><br><span class="line">    socket.emit(<span class="string">&#x27;chat_message&#x27;</span>, message)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">getLastMessage</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// cy.task cannot return undefined value</span></span><br><span class="line">    <span class="keyword">return</span> lastMessage || <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test sends the message using the web page UI and then fetches it for the second user.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/socket-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;verifies messages received&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// the browser is the 1st user</span></span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">`Cy_<span class="subst">$&#123;Cypress._.random(<span class="number">1000</span>)&#125;</span>`</span></span><br><span class="line">  cy.log(<span class="string">`User **<span class="subst">$&#123;name&#125;</span>**`</span>)</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="function"><span class="title">onBeforeLoad</span>(<span class="params">win</span>)</span> &#123;</span><br><span class="line">      cy.stub(win, <span class="string">&#x27;prompt&#x27;</span>).returns(name)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// make sure the greeting message is shown</span></span><br><span class="line">  cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;name&#125;</span> join the chat..`</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> secondName = <span class="string">&#x27;Ghost&#x27;</span></span><br><span class="line">  cy.task(<span class="string">&#x27;connect&#x27;</span>, secondName)</span><br><span class="line">  cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;secondName&#125;</span> join the chat..`</span>)</span><br><span class="line">    .should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// send the message from the first user</span></span><br><span class="line">  <span class="comment">// and use a random code to guarantee we truly receive our message</span></span><br><span class="line">  <span class="keyword">const</span> message = <span class="string">`Hello there <span class="subst">$&#123;Cypress._.random(<span class="number">10000</span>)&#125;</span>`</span></span><br><span class="line">  cy.get(<span class="string">&#x27;#txt&#x27;</span>).type(message)</span><br><span class="line">  cy.get(<span class="string">&#x27;form&#x27;</span>).submit()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// verify the web page shows the message</span></span><br><span class="line">  <span class="comment">// this ensures we can ask the 2nd user for its last message</span></span><br><span class="line">  <span class="comment">// and it should already be there</span></span><br><span class="line">  cy.contains(<span class="string">&#x27;#messages li&#x27;</span>, message).contains(<span class="string">&#x27;strong&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line">  cy.task(<span class="string">&#x27;getLastMessage&#x27;</span>)</span><br><span class="line">    <span class="comment">// note that the message includes the sending user</span></span><br><span class="line">    <span class="comment">// and the message itself</span></span><br><span class="line">    .should(<span class="string">&#x27;include&#x27;</span>, name)</span><br><span class="line">    .and(<span class="string">&#x27;include&#x27;</span>, message)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="../images/chat-intro/last-message.gif" alt="Verifying the message is received"></p>
<p><strong>Tip:</strong> you can poll the plugin process for the last message using <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-recurse">cypress-recurse</a> plugin.</p>
<h2><span id="test-user-leaving-the-chat">Test user leaving the chat</span></h2><p>Finally, let&#39;s confirm the web page shows the users leaving the chat. In the plugin file, let&#39;s add another task:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// task in cypress/plugins/index.js file</span></span><br><span class="line"><span class="function"><span class="title">disconnect</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  socket.disconnect()</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The test can verify the messages shown by the web page.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> secondName = <span class="string">&#x27;Ghost&#x27;</span></span><br><span class="line">cy.task(<span class="string">&#x27;connect&#x27;</span>, secondName)</span><br><span class="line">cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;secondName&#125;</span> join the chat..`</span>)</span><br><span class="line">  .should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line"><span class="comment">// the 2nd user is leaving</span></span><br><span class="line">cy.task(<span class="string">&#x27;disconnect&#x27;</span>)</span><br><span class="line">cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;secondName&#125;</span> left the chat..`</span>)</span><br><span class="line">  .should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>Beautiful.</p>
<p><img src="../images/chat-intro/left.png" alt="The user has left the chat test"></p>
<blockquote class="pullquote"><p>üß≠ You can find the source code for the app, and the tests in the repo <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-socketio-chat">bahmutov/cypress-socketio-chat</a>.</p>
</blockquote>
<h2><span id="alternative-connect-to-the-socketio-server-from-the-spec-file">Alternative: connect to the Socket.io server from the spec file</span></h2><p>You can connect to the Socket.io server from the plugin file. You could also connect to the server straight from the spec file. Here is a complete test that simulates the second user via separate chat connection. The first user works through the page, while the second user works through the chat messages.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/socket-from-browser-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">&#x27;socket.io-client&#x27;</span>)</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;Open 2nd socket connection&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;sees the 2nd user join&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// the browser is the 1st user</span></span><br><span class="line">    <span class="keyword">const</span> name = <span class="string">`Cy_<span class="subst">$&#123;Cypress._.random(<span class="number">1000</span>)&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">    cy.log(<span class="string">`User **<span class="subst">$&#123;name&#125;</span>**`</span>)</span><br><span class="line">    cy.visit(<span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">      <span class="function"><span class="title">onBeforeLoad</span>(<span class="params">win</span>)</span> &#123;</span><br><span class="line">        cy.stub(win, <span class="string">&#x27;prompt&#x27;</span>).returns(name)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// make sure the greeting message is shown</span></span><br><span class="line">    cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;name&#125;</span> join the chat..`</span>)</span><br><span class="line">      .should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">      .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// and now connect to the server using 2nd user</span></span><br><span class="line">        <span class="comment">// by opening a new Socket connection from the same browser window</span></span><br><span class="line">        <span class="keyword">const</span> secondName = <span class="string">&#x27;Ghost&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> socket = io.connect(<span class="string">&#x27;http://localhost:8080&#x27;</span>)</span><br><span class="line">        socket.emit(<span class="string">&#x27;username&#x27;</span>, secondName)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// keep track of the last message sent by the server</span></span><br><span class="line">        <span class="keyword">let</span> lastMessage</span><br><span class="line">        socket.on(<span class="string">&#x27;chat_message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> (lastMessage = msg))</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the page shows that the second user has joined the chat</span></span><br><span class="line">        cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;secondName&#125;</span> join the chat..`</span>).should(</span><br><span class="line">          <span class="string">&#x27;be.visible&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the second user can send a message and the page shows it</span></span><br><span class="line">        <span class="keyword">const</span> message = <span class="string">&#x27;hello from 2nd user&#x27;</span></span><br><span class="line">        socket.emit(<span class="string">&#x27;chat_message&#x27;</span>, message)</span><br><span class="line">        cy.contains(<span class="string">&#x27;#messages li&#x27;</span>, message)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when the first user sends the message from the page</span></span><br><span class="line">        <span class="comment">// the second user receives it via socket</span></span><br><span class="line">        <span class="keyword">const</span> greeting = <span class="string">`Hello there <span class="subst">$&#123;Cypress._.random(<span class="number">10000</span>)&#125;</span>`</span></span><br><span class="line">        cy.get(<span class="string">&#x27;#txt&#x27;</span>).type(greeting)</span><br><span class="line">        cy.get(<span class="string">&#x27;form&#x27;</span>).submit()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// verify the web page shows the message</span></span><br><span class="line">        <span class="comment">// this ensures we can ask the 2nd user for its last message</span></span><br><span class="line">        <span class="comment">// and it should already be there</span></span><br><span class="line">        cy.contains(<span class="string">&#x27;#messages li&#x27;</span>, greeting).contains(<span class="string">&#x27;strong&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// place the assertions in a should callback</span></span><br><span class="line">        <span class="comment">// to retry them, maybe there is a delay in delivery</span></span><br><span class="line">        cy.should(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// using &quot;include&quot; assertion since the server adds HTML markup</span></span><br><span class="line">          expect(lastMessage, <span class="string">&#x27;last message for 2nd user&#x27;</span>).to.include(greeting)</span><br><span class="line">          expect(lastMessage, <span class="string">&#x27;has the sender&#x27;</span>).to.include(name)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        cy.log(<span class="string">&#x27;**second user leaves**&#x27;</span>).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          socket.disconnect()</span><br><span class="line">        &#125;)</span><br><span class="line">        cy.contains(<span class="string">&#x27;#messages li i&#x27;</span>, <span class="string">`<span class="subst">$&#123;secondName&#125;</span> left the chat..`</span>).should(</span><br><span class="line">          <span class="string">&#x27;be.visible&#x27;</span>,</span><br><span class="line">        )</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test behaves as expected.</p>
<p><img src="../images/chat-intro/browser-spec.gif" alt="The 2nd user is a separate socket connection from the same browser"></p>
<h2><span id="see-also">See also</span></h2><ul>
<li><a href="/blog/run-two-cypress-runners/" title="Run Two Cypress Test Runners At The Same Time">Run Two Cypress Test Runners At The Same Time</a></li>
<li><a href="/blog/sync-two-cypress-runners/" title="Sync Two Cypress Runners via Checkpoints">Sync Two Cypress Runners via Checkpoints</a></li>
<li><a href="#">Post not found: code-coverage-for-chat-test</a>
</li>
</ul>

      
    </div>

    
      <footer class="article-footer personal-links">
  <p>
    Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
    see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
    watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
    browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
  </p>
  <p>
    Want to know more about Cypress? Check out <a href="https://cypress.tips" target="_blank">cypress.tips</a>
  </p>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/test-socketio-chat-using-cypress/" data-id="cktk55chb01uudtvgaak68gof" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/test-socketio-chat-using-cypress/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/" rel="tag">cypress</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../cypress-vs-other-test-runners/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Cypress vs Other Test Runners
        
      </div>
    </a>
  
  
    <a href="../cypress-automation/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Cypress Automation</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">138</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">417</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">109</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">143</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">68</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">165</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">130</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.38px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.54px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.77px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.85px;">advice</a> <a href="../tags/algolia/" style="font-size: 10.38px;">algolia</a> <a href="../tags/angularjs/" style="font-size: 17.69px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.08px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.69px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.77px;">browser</a> <a href="../tags/ci/" style="font-size: 16.54px;">ci</a> <a href="../tags/circle/" style="font-size: 12.69px;">circle</a> <a href="../tags/climate/" style="font-size: 14.62px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 13.46px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.31px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 19.62px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 13.85px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.77px;">d3</a> <a href="../tags/db/" style="font-size: 14.62px;">db</a> <a href="../tags/docker/" style="font-size: 14.23px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.92px;">documentation</a> <a href="../tags/es6/" style="font-size: 14.62px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.08px;">functional</a> <a href="../tags/generators/" style="font-size: 11.54px;">generators</a> <a href="../tags/git/" style="font-size: 15px;">git</a> <a href="../tags/github/" style="font-size: 15.38px;">github</a> <a href="../tags/graphql/" style="font-size: 11.15px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.31px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.77px;">gulp</a> <a href="../tags/hiring/" style="font-size: 10.77px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.31px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.54px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.77px;">interview</a> <a href="../tags/jade/" style="font-size: 11.15px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.77px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.85px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 16.92px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.15px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.46px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.15px;">performance</a> <a href="../tags/presentation/" style="font-size: 12.31px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.31px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.38px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/react/" style="font-size: 11.54px;">react</a> <a href="../tags/react-native/" style="font-size: 11.15px;">react native</a> <a href="../tags/reactive/" style="font-size: 14.23px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.15px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.54px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 13.08px;">security</a> <a href="../tags/sentry/" style="font-size: 13.85px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.92px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.23px;">testing</a> <a href="../tags/tutorial/" style="font-size: 15.77px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 11.92px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.38px;">ui</a> <a href="../tags/vercel/" style="font-size: 13.08px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.15px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.54px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.92px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.77px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/09/">September 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/08/">August 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../what-i-do-after-a-conference/">What I Do After A Conference</a>
          </li>
        
          <li>
            <a href="../test-plain-or-markdown-file/">Test Plain Or Markdown File Using Cypress</a>
          </li>
        
          <li>
            <a href="../skip-cypress-install-on-ci/">Skip Cypress Install On CI</a>
          </li>
        
          <li>
            <a href="../verify-phone-part-two/">How To Verify Phone Number During Tests Part 2</a>
          </li>
        
          <li>
            <a href="../verify-phone-part-one/">How To Verify Phone Number During Tests Part 1</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/test-socketio-chat-using-cypress/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
