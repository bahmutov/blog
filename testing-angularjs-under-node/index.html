<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Testing AngularJS under Node | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is continuation of 
Server side Angular under Node.
If we can load and run an Angular application using synthetic browser environment under Node,
how can use it for testing? This blog post descri">
<meta property="og:type" content="article">
<meta property="og:title" content="Testing AngularJS under Node">
<meta property="og:url" content="http://glebbahmutov.com/blog/testing-angularjs-under-node/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="This is continuation of 
Server side Angular under Node.
If we can load and run an Angular application using synthetic browser environment under Node,
how can use it for testing? This blog post descri">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Testing AngularJS under Node">
<meta name="twitter:description" content="This is continuation of 
Server side Angular under Node.
If we can load and run an Angular application using synthetic browser environment under Node,
how can use it for testing? This blog post descri">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="../css/style.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="..//" id="logo">Better world by better software</a>
      </h1>
      <!--
      
        <h2 id="subtitle-wrap">
          <a href="..//" id="subtitle">Software advice from Dr. Gleb Bahmutov PhD</a>
        </h2>
      
      -->
      <h2 id="subtitle-wrap">
        <span class="subtitle">Software advice from <a id="subtitle" href="http://glebbahmutov.com">Dr. Gleb Bahmutov PhD</a></span>
      </h2>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="..//">Home</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://glebbahmutov.com/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-testing-angularjs-under-node" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2014-10-04T04:00:00.000Z" itemprop="datePublished">Oct 4 2014</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Testing AngularJS under Node
    </h1>

    <h2 class="article-title" itemprop="name">
      Examples of unit testing Angular code from Node.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is continuation of 
<a href="../server-side-vanilla-angular-rendering-under-node/">Server side Angular under Node</a>.</p>
<p>If we can load and run an Angular application using synthetic browser environment under Node,
how can use it for testing? This blog post describes unit testing basic angular components:
modules, values, constants and services. I will use <a href="http://visionmedia.github.io/mocha/" target="_blank" rel="external">Mocha</a> to
run the BDD unit tests.</p>
<h2 id="setup-and-teardown">Setup and teardown</h2><p>Before each unit test we need a clean application environment. After each test we want to destroy
the entire environment (<code>window</code> and <code>document</code> objects). We can easily achieve this using the
following commands to <a href="https://www.npmjs.org/package/benv" target="_blank" rel="external">benv</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> benv = <span class="built_in">require</span>(<span class="string">&apos;benv&apos;</span>);</span><br><span class="line">describe(<span class="string">&apos;angular app&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  beforeEach(<span class="function"><span class="keyword">function</span> <span class="title">setupEnvironment</span>(<span class="params">done</span>) </span>{</span><br><span class="line">    benv.setup(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">      benv.expose({</span><br><span class="line">        angular: benv.require(<span class="string">&apos;./bower_components/angular/angular.js&apos;</span>, <span class="string">&apos;angular&apos;</span>)</span><br><span class="line">      });</span><br><span class="line">      done();</span><br><span class="line">    });</span><br><span class="line">  });</span><br><span class="line">  afterEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="comment">// completely destroy window and document objects</span></span><br><span class="line">    benv.teardown(<span class="literal">true</span>);</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>Because browser environment is asynchronous, we use <code>done</code> argument to let Mocha know when the setup has finished.</p>
<h2 id="loading-the-application-itself">Loading the application itself</h2><p>For simplicity, before each unit test let us load an angular module to test right inside the unit
test code.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">beforeEach(<span class="function"><span class="keyword">function</span> <span class="title">loadMyApp</span>(<span class="params"></span>) </span>{</span><br><span class="line">  angular.module(<span class="string">&apos;foo&apos;</span>, [])</span><br><span class="line">    .value(<span class="string">&apos;bar&apos;</span>, <span class="string">&apos;baz&apos;</span>)</span><br><span class="line">    .constant(<span class="string">&apos;name&apos;</span>, <span class="string">&apos;jim&apos;</span>)</span><br><span class="line">    .service(<span class="string">&apos;add&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>{ <span class="keyword">return</span> a + b; };</span><br><span class="line">    });</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>We could also load the module using Node&apos;s <code>require</code> method if the code is in the external file (as it is in
typical application).</p>
<figure class="highlight js"><figcaption><span>value-app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&apos;loading value app&apos;</span>);</span><br><span class="line">angular.module(<span class="string">&apos;foo&apos;</span>, [])</span><br><span class="line">  .value(<span class="string">&apos;bar&apos;</span>, <span class="string">&apos;baz&apos;</span>)</span><br><span class="line">  .constant(<span class="string">&apos;name&apos;</span>, <span class="string">&apos;jim&apos;</span>)</span><br><span class="line">  .service(<span class="string">&apos;add&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>{ <span class="keyword">return</span> a + b; };</span><br><span class="line">  });</span><br><span class="line"><span class="comment">// spec.js</span></span><br><span class="line">beforeEach(<span class="function"><span class="keyword">function</span> <span class="title">loadMyApp</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">delete</span> <span class="built_in">require</span>.cache[<span class="built_in">require</span>.resolve(<span class="string">&apos;./value-app&apos;</span>)]; <span class="comment">// 1</span></span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&apos;./value-app&apos;</span>);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>Notice that in order to force Node to actually evaluate <code>value-app.js</code> every time, we need to
clear the evaluated value from the loaded modules cache (<code>// 1</code>).</p>
<h2 id="testing-by-injecting-values">Testing by injecting values</h2><p>We can test individual entities inside angular module <code>foo</code> by loading them into the unit test using
<code>injector</code> service. For example, we can check if the application module has a dependency by name <em>bar</em>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&apos;has bar&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">var</span> injector = angular.injector([<span class="string">&apos;foo&apos;</span>]);</span><br><span class="line">  expect(injector.has(<span class="string">&apos;bar&apos;</span>)).toBe(<span class="literal">true</span>);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>We can also test the actual value</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&apos;has correct value&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> injector = angular.injector([<span class="string">&apos;foo&apos;</span>]);</span><br><span class="line">    expect(injector.get(<span class="string">&apos;bar&apos;</span>)).toEqual(<span class="string">&apos;baz&apos;</span>);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<h2 id="testing-by-running-a-test-module">Testing by running a test module</h2><p>Creating an injector and getting separate values one by one is tiresome. Luckily, there is a nice method to
get all necessary dependencies in a single shot using Angular itself. This can be done in 3 steps:</p>
<ul>
<li>inside a unit test we can create another module (let us call it <code>testFoo</code>) purely for testing.
We will make <code>testFoo</code> depend on the application module <code>foo</code>.</li>
<li>we will register a <em>test callback</em> with actual tests to be run using Angular 
<a href="https://docs.angularjs.org/api/ng/type/angular.Module#run" target="_blank" rel="external">module.run</a> method. This way the test method
can declare by name any dependencies it needs, and the angular dependency injection will load them
and pass them into the method automatically.</li>
<li>finally, we will start the angular application by bootstrapping the application.</li>
</ul>
<p>Here is the same unit test as above that checks the value of <em>bar</em>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&apos;has correct bar value&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">  angular.module(<span class="string">&apos;testFoo&apos;</span>, [<span class="string">&apos;foo&apos;</span>])</span><br><span class="line">    .run(<span class="function"><span class="keyword">function</span> (<span class="params">bar</span>) </span>{</span><br><span class="line">      expect(bar).toEqual(<span class="string">&apos;baz&apos;</span>);</span><br><span class="line">    });</span><br><span class="line">  angular.bootstrap(<span class="built_in">document</span>, [<span class="string">&apos;testFoo&apos;</span>]);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>Notice that <code>run</code> is executed immediately on the application bootstrap, thus the unit test is synchronous.</p>
<p>The boilerplate code that surrounds the <code>run</code> function can be moved to a helper method.
I created <a href="https://github.com/bahmutov/ng-node-bdd" target="_blank" rel="external">ng-node-bdd</a> repository that exposes <code>ngIt</code> 
function that can be used in place of the ordinary <code>it</code> spec function. It allows to declare
modules and dependencies and run unit test right away</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ngIt</span>(<span class="params">name, deps, cb</span>) </span>{</span><br><span class="line">  it(name, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> m = angular.module(<span class="string">&apos;test-module&apos;</span>, deps);</span><br><span class="line">    m.run(cb);</span><br><span class="line">    angular.bootstrap(<span class="built_in">document</span>, [<span class="string">&apos;test-module&apos;</span>]);</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><code>cb</code> is the actual unit test callback function with dependencies as arguments</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ngBdd = <span class="built_in">require</span>(<span class="string">&apos;ng-node-bdd&apos;</span>);</span><br><span class="line">ngBdd.ngIt(<span class="string">&apos;gets value&apos;</span>, [<span class="string">&apos;foo&apos;</span>], <span class="function"><span class="keyword">function</span> (<span class="params">bar</span>) </span>{</span><br><span class="line">  expect(bar).toEqual(<span class="string">&apos;baz&apos;</span>);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p><strong>testing service</strong></p>
<p>Testing synchronous custom Angular services is also simple</p>
<figure class="highlight js"><figcaption><span>value-app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">&apos;foo&apos;</span>, [])</span><br><span class="line">  .service(<span class="string">&apos;add&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>{ <span class="keyword">return</span> a + b; };</span><br><span class="line">  });</span><br><span class="line"><span class="comment">// spec.js</span></span><br><span class="line">ngIt(<span class="string">&apos;adds numbers&apos;</span>, [<span class="string">&apos;foo&apos;</span>], <span class="function"><span class="keyword">function</span> (<span class="params">add</span>) </span>{</span><br><span class="line">  expect(add(<span class="number">2</span>, <span class="number">3</span>)).toEqual(<span class="number">5</span>);</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>Pretty cool!</p>
<h2 id="testing-asynchronous-code">Testing asynchronous code</h2><p>What if our Angular service has asynchronous logic? For example, instead of adding two numbers and returning
the sum, it could add them after an interval. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">&apos;foo&apos;</span>, [])</span><br><span class="line">  .service(<span class="string">&apos;add&apos;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$q, $timeout</span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>{</span><br><span class="line">      <span class="keyword">var</span> deferred = $q.defer();</span><br><span class="line">      $timeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        deferred.resolve(a + b);</span><br><span class="line">      }, <span class="number">1000</span>);</span><br><span class="line">      <span class="keyword">return</span> deferred.promise;</span><br><span class="line">    };</span><br><span class="line">  });</span><br></pre></td></tr></table></figure>
<p>A typical asynchronous unit test in Mocha either returns a promise, or uses optional <code>done</code> argument
to let the testing framework engine know it has finished. Unfortunately, we cannot simply return the promise
from the unit test, because it gets lost in the <code>module.run</code> method. Thus we need to use <code>done</code> callback.</p>
<p>Trying to just declare <code>done</code> argument in the unit test callback does not work, because Angular tries to inject <code>done</code>
argument</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ngBdd.ngIt(<span class="string">&apos;adds numbers&apos;</span>, [<span class="string">&apos;foo&apos;</span>], <span class="function"><span class="keyword">function</span> (<span class="params">add, done</span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> add(<span class="number">2</span>, <span class="number">3</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>{</span><br><span class="line">    expect(result).toEqual(<span class="number">5</span>);</span><br><span class="line">    done();</span><br><span class="line">  });</span><br><span class="line">});</span><br><span class="line"><span class="comment">// output</span></span><br><span class="line"><span class="built_in">Error</span>: [$injector:unpr] Unknown provider: doneProvider &lt;- done</span><br></pre></td></tr></table></figure>
<p>Luckily, we can easily inject the <code>done</code> callback as a value into the test module!</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ngIt</span>(<span class="params">name, deps, cb</span>) </span>{</span><br><span class="line">  it(name, <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>{</span><br><span class="line">    <span class="comment">// done is callback injected by the Mocha&apos;s engine</span></span><br><span class="line">    <span class="keyword">var</span> m = angular.module(<span class="string">&apos;test-module&apos;</span>, deps);</span><br><span class="line">    <span class="comment">// make it available to unit tests via Angular DI</span></span><br><span class="line">    m.constant(<span class="string">&apos;done&apos;</span>, done);</span><br><span class="line">    m.run(cb);</span><br><span class="line">    angular.bootstrap(<span class="built_in">document</span>, [<span class="string">&apos;test-module&apos;</span>]);</span><br><span class="line">  });</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>This makes Mocha&apos;s <code>done</code> callback available via Angular dependency injection, and the unit test above passed. 
The downside is that every unit test has to call <code>done()</code>, but this could be fixed later.</p>
<h2 id="update-1-removing-need-to-always-call-done-from-unit-tests">Update 1 - removing need to always call done from unit tests</h2><p>We can determine if the unit test callback function <code>cb</code> actually lists <code>done</code> as one of its arguments
using angular injector <code>annotate</code> method. It returns in the simplest case list of argument names 
(by parsing function&apos;s <code>toString</code> text).</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">bar</span>) </span>{}</span><br><span class="line">angular.injector([]).annotate(foo); <span class="comment">// [&apos;bar&apos;]</span></span><br></pre></td></tr></table></figure>
<p>Thus we can transform <code>ngIt</code> to provide <code>done</code> only if the test needs it</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ngIt</span> ...</span><br><span class="line">  <span class="title">it</span>(<span class="params">name, function (done</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> testDependencies = angular.injector([]).annotate(cb);</span><br><span class="line">    <span class="keyword">var</span> isAsyncTest = testDependencies.indexOf(<span class="string">&apos;done&apos;</span>) !== -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> m = angular.module(<span class="string">&apos;test-module&apos;</span>, deps);</span><br><span class="line">    <span class="keyword">if</span> (isAsyncTest) {</span><br><span class="line">      m.constant(<span class="string">&apos;done&apos;</span>, done);</span><br><span class="line">    }</span><br><span class="line">    m.run(cb);</span><br><span class="line">    angular.bootstrap(<span class="built_in">document</span>, [<span class="string">&apos;test-module&apos;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!isAsyncTest) {</span><br><span class="line">      <span class="comment">// call Mocha&apos;s done ourselves</span></span><br><span class="line">      done();</span><br><span class="line">    }</span><br><span class="line">  });</span><br></pre></td></tr></table></figure>
<h2 id="update-2-whats-next">Update 2 - what&apos;s next?</h2><p>See how you can load and unit test private parts in an Angular application that uses
CommonJS modules: <a href="../unit-testing-angular-from-node-like-a-boss/">Unit testing Angular from Node like a boss</a>.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="http://glebbahmutov.com">glebbahmutov.com</a>
</footer>

    

    <footer class="article-footer">
      <a data-url="http://glebbahmutov.com/blog/testing-angularjs-under-node/" data-id="ciihys1o30061aommfv3n8euk" class="article-share-link">Share</a>
      
        <a href="http://glebbahmutov.com/blog/testing-angularjs-under-node/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/angularjs/">angularjs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/nodejs/">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/testing/">testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../building-runtime-tree-of-angular-modules/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Building runtime tree of Angular modules
        
      </div>
    </a>
  
  
    <a href="../avoiding-silent-angular-failures/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Avoiding silent Angular failures</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">69</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">190</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/">advice</a><span class="tag-list-count">83</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angular/">angular</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/">angularjs</a><span class="tag-list-count">54</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/">assertions</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/">boilerplate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/">browser</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/database/">database</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/">db</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/">es6</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/">functional</a><span class="tag-list-count">42</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/">git</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/">immutable</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/">javascript</a><span class="tag-list-count">143</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/">modular development</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/">nodejs</a><span class="tag-list-count">54</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/">performance</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/">promises</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/">reactive</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/">reactjs</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/">security</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/">sentry</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/">testing</a><span class="tag-list-count">44</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/">tutorial</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/">ui</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/">web workers</a><span class="tag-list-count">5</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/QUnit/" style="font-size: 13.08px;">QUnit</a><a href="../tags/advice/" style="font-size: 19.23px;">advice</a><a href="../tags/angular/" style="font-size: 10px;">angular</a><a href="../tags/angularjs/" style="font-size: 18.46px;">angularjs</a><a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a><a href="../tags/assertions/" style="font-size: 13.85px;">assertions</a><a href="../tags/boilerplate/" style="font-size: 15.38px;">boilerplate</a><a href="../tags/browser/" style="font-size: 14.62px;">browser</a><a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a><a href="../tags/d3/" style="font-size: 11.54px;">d3</a><a href="../tags/database/" style="font-size: 10px;">database</a><a href="../tags/db/" style="font-size: 13.08px;">db</a><a href="../tags/es6/" style="font-size: 14.62px;">es6</a><a href="../tags/es7/" style="font-size: 10px;">es7</a><a href="../tags/functional/" style="font-size: 16.92px;">functional</a><a href="../tags/generators/" style="font-size: 13.08px;">generators</a><a href="../tags/git/" style="font-size: 13.85px;">git</a><a href="../tags/grunt/" style="font-size: 13.85px;">grunt</a><a href="../tags/gulp/" style="font-size: 11.54px;">gulp</a><a href="../tags/immutable/" style="font-size: 10px;">immutable</a><a href="../tags/interview/" style="font-size: 11.54px;">interview</a><a href="../tags/jade/" style="font-size: 12.31px;">jade</a><a href="../tags/javascript/" style="font-size: 20px;">javascript</a><a href="../tags/jshint/" style="font-size: 11.54px;">jshint</a><a href="../tags/modular-development/" style="font-size: 15.38px;">modular development</a><a href="../tags/nodejs/" style="font-size: 18.46px;">nodejs</a><a href="../tags/performance/" style="font-size: 15.38px;">performance</a><a href="../tags/promises/" style="font-size: 16.15px;">promises</a><a href="../tags/proposal/" style="font-size: 10.77px;">proposal</a><a href="../tags/reactive/" style="font-size: 10.77px;">reactive</a><a href="../tags/reactjs/" style="font-size: 10.77px;">reactjs</a><a href="../tags/security/" style="font-size: 12.31px;">security</a><a href="../tags/sentry/" style="font-size: 13.85px;">sentry</a><a href="../tags/testing/" style="font-size: 17.69px;">testing</a><a href="../tags/tutorial/" style="font-size: 13.08px;">tutorial</a><a href="../tags/ui/" style="font-size: 10px;">ui</a><a href="../tags/web-workers/" style="font-size: 13.08px;">web workers</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../hydrate-at-build-time/">Hydrate at build time</a>
          </li>
        
          <li>
            <a href="../hydrate-your-apps/">Hydrate your apps</a>
          </li>
        
          <li>
            <a href="../my-node-tools/">My Node tools</a>
          </li>
        
          <li>
            <a href="../pass-the-logic/">Pass the logic</a>
          </li>
        
          <li>
            <a href="../use-some-es6-in-cli-apps/">Use some ES6 in CLI apps</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="..//" class="mobile-nav-link">Home</a>
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'http://glebbahmutov.com/blog/testing-angularjs-under-node/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="../fancybox/jquery.fancybox.css" type="text/css">
  <script src="../fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="../js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>