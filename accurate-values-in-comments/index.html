<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Accurate values in comments | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Values in commentsTake any JavaScript code example. Usually, the inputs are given and expected output is shown as a comment. For example, Ramda R.compose function is shown below. The library gives two">
<meta property="og:type" content="article">
<meta property="og:title" content="Accurate values in comments">
<meta property="og:url" content="https://glebbahmutov.com/blog/accurate-values-in-comments/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="Values in commentsTake any JavaScript code example. Usually, the inputs are given and expected output is shown as a comment. For example, Ramda R.compose function is shown below. The library gives two">
<meta property="og:locale">
<meta property="og:image" content="https://developers.google.com/web/updates/images/2015-07-07-preview-javascript-values-inline-while-debugging/inline-js-values.gif">
<meta property="article:published_time" content="2017-01-28T05:00:00.000Z">
<meta property="article:modified_time" content="2021-12-01T15:18:55.774Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="javascript">
<meta property="article:tag" content="ramda">
<meta property="article:tag" content="nodejs">
<meta property="article:tag" content="ast">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://developers.google.com/web/updates/images/2015-07-07-preview-javascript-values-inline-while-debugging/inline-js-values.gif">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-accurate-values-in-comments" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2017-01-28T05:00:00.000Z" itemprop="datePublished">Jan 28 2017</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/process/">process</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Accurate values in comments
    </h1>

    <h2 class="article-title" itemprop="name">
      How to update the code comments during program execution.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2><span id="values-in-comments">Values in comments</span></h2><p>Take any JavaScript code example. Usually, the inputs are given and
expected output is shown as a comment. For example,
Ramda <a target="_blank" rel="noopener" href="http://ramdajs.com/docs/#compose">R.compose</a> function is shown below.
The library gives two examples for <code>compose</code>. I find that the more examples
are given, the faster I understand the code.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> classyGreeting = <span class="function">(<span class="params">firstName, lastName</span>) =&gt;</span></span><br><span class="line">  <span class="string">&quot;The name&#x27;s &quot;</span> + lastName + <span class="string">&quot;, &quot;</span> + firstName + <span class="string">&quot; &quot;</span> + lastName</span><br><span class="line"><span class="keyword">var</span> yellGreeting = R.compose(R.toUpper, classyGreeting);</span><br><span class="line">yellGreeting(<span class="string">&#x27;James&#x27;</span>, <span class="string">&#x27;Bond&#x27;</span>); <span class="comment">//=&gt; &quot;THE NAME&#x27;S BOND, JAMES BOND&quot;</span></span><br><span class="line"></span><br><span class="line">R.compose(<span class="built_in">Math</span>.abs, R.add(<span class="number">1</span>), R.multiply(<span class="number">2</span>))(-<span class="number">4</span>) <span class="comment">//=&gt; 7</span></span><br></pre></td></tr></table></figure>
<p>Similarly, <a target="_blank" rel="noopener" href="https://lodash.com/docs">Lodash docs</a> follow the same convention.
The code examples in blog <a target="_blank" rel="noopener" href="http://bdavidxyz.com/blog/clean-code/">posts</a>,
tutorial <a target="_blank" rel="noopener" href="http://ova2.github.io/es6-presentations/slides/restspread/index.html#7">slides</a>
and even <a target="_blank" rel="noopener" href="https://leanpub.com/javascript-allonge/read">books</a>
use the same &quot;code, result as a comment&quot; format.</p>
<p>Yet, there is a problem. More complex examples, especially the ones that
evolve over time require extra effort from the author to ensure that the
value comments alongside the code remain accurate. There is nothing worse
for the reader than to see an out of date comment!</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">R.compose(<span class="built_in">Math</span>.abs, R.add(<span class="number">1</span>), R.multiply(<span class="number">2</span>))(-<span class="number">4</span>) <span class="comment">//=&gt; 3</span></span><br><span class="line"><span class="comment">// oops, value &quot;3&quot; was produced when we had `R.add(5)`!</span></span><br></pre></td></tr></table></figure>
<h2><span id="inspiration">Inspiration</span></h2><p>Recently, Chrome DevTools implemented live value previews. When the debugger is
paused, the values of the variables that are already computed are shown
right next to the code. Here is how the JavaScript values preview works
(source <a target="_blank" rel="noopener" href="https://developers.google.com/web/updates/2015/07/preview-javascript-values-inline-while-debugging">https://developers.google.com/web/updates/2015/07/preview-javascript-values-inline-while-debugging</a>)</p>
<p><img src="https://developers.google.com/web/updates/images/2015-07-07-preview-javascript-values-inline-while-debugging/inline-js-values.gif" alt="Live Preview"></p>
<p>This is extremely nice feature, if only we could mark values in comments as
&quot;live&quot; during Nodejs execution and ask the runtime to update them.
Wait a minute!</p>
<h2><span id="code-and-comment-instrumentation">Code and comment instrumentation</span></h2><p>Recording executed statements is the main feature of code coverage tools
like <a target="_blank" rel="noopener" href="https://github.com/gotwarlost/istanbul#readme">istanbul</a>. It is
implemented via on the fly code instrumentation; when a JavaScript file is
loaded by the Nodejs module system a user-supplied callback function is
called. This function can transform the loaded source before it is evaluated.
Thus we can do all sorts of
<a href="../hooking-into-node-loader-for-fun-and-profit/">interesting things</a>.
For example, using my <a target="_blank" rel="noopener" href="https://github.com/bahmutov/node-hook">node-hook</a> to
instrument we can print a message on file load.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hook = <span class="built_in">require</span>(<span class="string">&#x27;node-hook&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logLoadedFilename</span>(<span class="params">source, filename</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;console.log(&quot;&#x27;</span> + filename + <span class="string">&#x27;&quot;);\n&#x27;</span> + source;</span><br><span class="line">&#125;</span><br><span class="line">hook.hook(<span class="string">&#x27;.js&#x27;</span>, logLoadedFilename);</span><br><span class="line"><span class="comment">// load the actual file</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./dummy&#x27;</span>);</span><br><span class="line"><span class="comment">// prints fulle dummy.js filename, runs dummy.js</span></span><br></pre></td></tr></table></figure>
<p>We do not have to include the above wrapper code in our application. Instead
I prefer using Node &quot;preload&quot; module feature. Place the wrapper code into
a separate module and load it before the first JavaScript file.</p>
<figure class="highlight js"><figcaption><span>printer.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hook = <span class="built_in">require</span>(<span class="string">&#x27;node-hook&#x27;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logLoadedFilename</span>(<span class="params">source, filename</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;console.log(&quot;&#x27;</span> + filename + <span class="string">&#x27;&quot;);\n&#x27;</span> + source;</span><br><span class="line">&#125;</span><br><span class="line">hook.hook(<span class="string">&#x27;.js&#x27;</span>, logLoadedFilename);</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node -r ./printer.js dummy.js</span><br><span class="line">/home/user/dummy.js</span><br></pre></td></tr></table></figure>
<p>Thus we can create a wrapper for Node that is simple to use and can modify
any loaded JavaScript file to include any desired additional code.
For example we could find all variables in the comments and insert additional
statements into the loaded source to save the values of those variables in
a big data structure. When the program finishes its run, we need to save this
data structure and / or update the original file with new values.</p>
<h2><span id="comment-value">comment-value</span></h2><p>This is how the <a target="_blank" rel="noopener" href="https://github.com/bahmutov/comment-value">comment-value</a>
was born. Its first goal is to update the variable values in specially
formatted line comments that put just the variable name followed by
colon like this <code>// name:</code>.</p>
<p>In the simple example we added 3 extra line comments (<code>// a:</code>, <code>// b:</code> and
<code>// sum:</code>, recording argument variables <code>a</code> and <code>b</code> and the variable <code>sum</code>.
The comments are empty - we do not even bother writing the expected values
manually.</p>
<figure class="highlight js"><figcaption><span>example.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// a:</span></span><br><span class="line">  <span class="comment">// b:</span></span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> sum = add(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// sum:</span></span><br></pre></td></tr></table></figure>
<p>Install the tool <code>comment-value</code> and run it on the file <code>example.js</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ npm i -g comment-value</span><br><span class="line">$ values example.js</span><br><span class="line">$ cat example.js</span><br><span class="line"><span class="keyword">function</span> add(a, b) &#123;</span><br><span class="line">  // a: 10</span><br><span class="line">  // b: 2</span><br><span class="line">  <span class="built_in">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line">const sum = add(10, 2)</span><br><span class="line">// sum: 12</span><br></pre></td></tr></table></figure>
<p>Now, imagine that we have decided to use simple <code>2 + 3</code> to explain the above
addition. Just change the values when calling the <code>add</code> function to
<code>add(2, 3)</code> and rerun the <code>values example.js</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ values example.js</span><br><span class="line">$ cat example.js</span><br><span class="line"><span class="keyword">function</span> add(a, b) &#123;</span><br><span class="line">  // a: 2</span><br><span class="line">  // b: 3</span><br><span class="line">  <span class="built_in">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line">const sum = add(2, 3)</span><br><span class="line">// sum: 5</span><br></pre></td></tr></table></figure>
<p>All values have been recomputed and the comments have been updated. No need
to do this manually, and the reader can rest assured - the example is
correct and up to date.</p>
<p>The implementation is pretty simple. We look at each source line, finding
every variable name that matches format <code>// name:</code>. Then we insert an object
at the begging of the source file to record values and a statement after
the comment line to record the value. The above <code>example.js</code> code
would look something like this when instrumented</p>
<figure class="highlight js"><figcaption><span>example.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> values = []</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// a:</span></span><br><span class="line">  values[<span class="number">0</span>] = a</span><br><span class="line">  <span class="comment">// b:</span></span><br><span class="line">  values[<span class="number">1</span>] = b</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> sum = add(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// sum:</span></span><br><span class="line">values[<span class="number">2</span>] = a</span><br><span class="line"><span class="comment">// saveUpdated puts the values back</span></span><br><span class="line"><span class="comment">// into example.js and saves it to disk</span></span><br><span class="line">process.on(<span class="string">&#x27;exit&#x27;</span>, saveUpdated)</span><br></pre></td></tr></table></figure>
<p>Perfect.</p>
<h2><span id="taking-it-to-the-next-level">Taking it to the next level</span></h2><p>While the <code>comment-value</code> tool is already useful, we can do better. Not only
we want to show the <em>result variable</em>, we also want to easily show the
<em>intermediate expression values</em>. For example, the large Ramda <code>compose</code>
function example in the beginning blog post has been written with implicit
code style without intermediate variables.</p>
<figure class="highlight js"><figcaption><span>compose-example.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> R = <span class="built_in">require</span>(<span class="string">&#x27;ramda&#x27;</span>)</span><br><span class="line">R.compose(<span class="built_in">Math</span>.abs, R.add(<span class="number">1</span>), R.multiply(<span class="number">2</span>))(-<span class="number">4</span>) <span class="comment">//=&gt; 7</span></span><br></pre></td></tr></table></figure>
<p>There is no result variable even! Can we somehow update the value in the
line comment <code>//=&gt; 7</code>? Yes, but using a more complex transformation.</p>
<p>We cannot simply look at each line in isolation, finding a single variable name
and inserting a quick assignment statement.
Instead we need to understand the structure of our code <em>to the left</em> of
a &quot;magical&quot; line comment that starts with <code>//=&gt;</code> string. Luckily, the
raw JavaScript source can be parsed into an Abstract Syntax Tree (AST) using
off the shelf tools. I am using
<a target="_blank" rel="noopener" href="https://github.com/substack/node-falafel#readme">falafel</a> which takes source
string and a callback function that visits every node in the tree.</p>
<p>In this tiny example, we discovered <code>CallExpression</code> and a &quot;magic&quot; comment
that are next to each other.</p>
<figure class="highlight js"><figcaption><span>index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">2</span>, <span class="number">3</span>) <span class="comment">//=&gt; ?</span></span><br><span class="line">---</span><br><span class="line">add(<span class="number">2</span>, <span class="number">3</span>): CallExpression, <span class="string">&quot;add&quot;</span> is callee,</span><br><span class="line">                           <span class="number">2</span> and <span class="number">3</span> are <span class="built_in">arguments</span></span><br><span class="line">add: Identifier</span><br><span class="line"><span class="number">2</span>  : Literal</span><br><span class="line"><span class="number">3</span>  : Literal</span><br></pre></td></tr></table></figure>
<p>Each node in the AST has its location information and the source code.
For example the above <code>CallExpression</code> node would be processed like this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source = fs.readFileSync(<span class="string">&#x27;./index.js&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> output = falafel(source, visitor)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">visitor</span> (<span class="params">node</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// node.type is &quot;CallExpression&quot;</span></span><br><span class="line">  <span class="comment">// node.source() returns &quot;add(2, 3)&quot;</span></span><br><span class="line">  <span class="comment">// node.loc.end is &#123;line: 0, column: 9&#125;</span></span><br><span class="line">  <span class="keyword">const</span> c = findSpecialCommentToTheRight(node.loc.end)</span><br><span class="line">  <span class="comment">// c is &#123;index: 0&#125; pointing to &quot;values&quot; array</span></span><br><span class="line">  <span class="keyword">const</span> wrapped = wrap(node)</span><br><span class="line">  node.update(wrapped)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If we call <code>node.update()</code> with new source code, it will replace the code
for this particular node. With <code>falafel</code>, there is no need to generate a
complex replacement AST node when wrapping a source fragment, we could
just return a new string.</p>
<p>We could do anything inside the wrapping logic, but we have to be careful not
to break the surrounding code. For <code>CallExpression</code> node we want to
actually execute the function, record its result and then return it to the
outside code. For example here is the input and instrumented code.</p>
<figure class="highlight js"><figcaption><span>index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = add(<span class="number">2</span>, <span class="number">3</span>) <span class="comment">//=&gt; ?</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>instrumented.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> values = []</span><br><span class="line"><span class="keyword">const</span> sum = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = add(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">  values[<span class="number">0</span>] = result</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;())</span><br></pre></td></tr></table></figure>
<p>You can see the actual instrumented code by passing <code>-i</code> option to the
<code>values</code> program. It will look a lot more complex in order to handle some
edge cases.</p>
<h3><span id="in-action">In action</span></h3><p>Let us take the compose example again and see how useful comments could be.
Rewrite the example to split the composed functions to one per line for
clarity.</p>
<figure class="highlight js"><figcaption><span>compose-example.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> R = <span class="built_in">require</span>(<span class="string">&#x27;ramda&#x27;</span>)</span><br><span class="line">R.compose(</span><br><span class="line">  <span class="built_in">Math</span>.abs,</span><br><span class="line">  R.add(<span class="number">1</span>),</span><br><span class="line">  R.multiply(<span class="number">2</span>)</span><br><span class="line">)(-<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<p>In the real example, we would split making the composed function and we would
print the result, right?</p>
<figure class="highlight js"><figcaption><span>compose-example.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> R = <span class="built_in">require</span>(<span class="string">&#x27;ramda&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fn = R.compose(</span><br><span class="line">  <span class="built_in">Math</span>.abs,</span><br><span class="line">  R.add(<span class="number">1</span>),</span><br><span class="line">  R.multiply(<span class="number">2</span>)</span><br><span class="line">)</span><br><span class="line"><span class="built_in">console</span>.log(fn(-<span class="number">4</span>))</span><br></pre></td></tr></table></figure>
<p>Let us insert &quot;magic&quot; comments - and we can insert them <em>inside</em> the
composition! We can use
<a target="_blank" rel="noopener" href="https://github.com/bahmutov/comment-value#comment-format">different strings</a>
to mark the comments, I prefer short <code>//&gt;</code> (or <code>// &gt;</code> to be compatible with
<a target="_blank" rel="noopener" href="http://standardjs.com/">standard js</a> linter)</p>
<figure class="highlight js"><figcaption><span>compose-example.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> R = <span class="built_in">require</span>(<span class="string">&#x27;ramda&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fn = R.compose(</span><br><span class="line">  <span class="built_in">Math</span>.abs,     <span class="comment">//&gt;</span></span><br><span class="line">  R.add(<span class="number">1</span>),     <span class="comment">//&gt;</span></span><br><span class="line">  R.multiply(<span class="number">2</span>) <span class="comment">//&gt;</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">console</span>.log(fn(-<span class="number">4</span>))</span><br></pre></td></tr></table></figure>
<p>Run the <code>values</code> to compute the values <code>values compose-example.js</code></p>
<figure class="highlight js"><figcaption><span>compose-example.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> R = <span class="built_in">require</span>(<span class="string">&#x27;ramda&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fn = R.compose(</span><br><span class="line">  <span class="built_in">Math</span>.abs,     <span class="comment">//&gt; 7</span></span><br><span class="line">  R.add(<span class="number">1</span>),     <span class="comment">//&gt; -7</span></span><br><span class="line">  R.multiply(<span class="number">2</span>) <span class="comment">//&gt; -8</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">console</span>.log(fn(-<span class="number">4</span>))</span><br></pre></td></tr></table></figure>
<p>Great! We can even wrap the call inside the <code>console.log</code> (going extra mile for
a common use case). Just put <code>//&gt;</code> after <code>console.log(fn(-4))</code> to extract
the value of the first argument.</p>
<figure class="highlight js"><figcaption><span>compose-example.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> R = <span class="built_in">require</span>(<span class="string">&#x27;ramda&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fn = R.compose(</span><br><span class="line">  <span class="built_in">Math</span>.abs,     <span class="comment">//&gt; 7</span></span><br><span class="line">  R.add(<span class="number">1</span>),     <span class="comment">//&gt; -7</span></span><br><span class="line">  R.multiply(<span class="number">2</span>) <span class="comment">//&gt; -8</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">console</span>.log(fn(-<span class="number">4</span>)) <span class="comment">//&gt; 7</span></span><br></pre></td></tr></table></figure>
<p>Finally, we can enable live update and let the users explore how the
intermediate values change as we keep changing the parameters. Just run
the tool in watch mode and keep editing the file. See this in action
in the clip below</p>
<iframe width="805" height="720" src="https://www.youtube.com/embed/tuaoDBarQ2M?rel=0" frameborder="0" allowfullscreen></iframe>

<h2><span id="future-work">Future work</span></h2><p>The current <a target="_blank" rel="noopener" href="https://github.com/bahmutov/comment-value">comment-value</a> tool
solves my problems, but I hope to extend it with several features.</p>
<ul>
<li><strong>testing</strong> - the tool could run in &quot;comparison&quot; mode. If a value comment is
empty, then a new value will be filled. If there is a value there already
the tool will compare the computed and the current value. If they are
different it will raise an error. This can be used to test code and
intermediate values given some specific inputs.</li>
<li><strong>online mode</strong> - testing lots of code examples in the my presentation
<a target="_blank" rel="noopener" href="https://slides.com/bahmutov">slides</a>. Maybe if I target GitHub gists ...</li>
<li><strong>type signatures</strong> - we could record the run time type signatures of
intermediate expressions, instead of values. This would explain the code
and allow its refactoring</li>
<li><strong>data coverage</strong> during unit tests - we could collect all different data
items for a given variable during unit tests. This would be helpful to
find out if there are missing tests. For example, the following testing code
achieves 100% code coverage during unit tests.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEmail</span>(<span class="params">email</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^[\w\.]+@\w+\.\w+$/</span>.test(email)</span><br><span class="line">&#125;</span><br><span class="line">it(<span class="string">&#x27;allows valid email&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.assert(isEmail(<span class="string">&#x27;foo@gmail.com&#x27;</span>))</span><br><span class="line">&#125;)</span><br><span class="line">it(<span class="string">&#x27;allows email with dots&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.assert(isEmail(<span class="string">&#x27;foo.bar@gmail.com&#x27;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Yet, this is a perfect example when full statement coverage is possible yet
guarantees neither code robustness nor correctness. But what if we could
collect all values of input argument <code>email</code> during unit tests?</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEmail</span>(<span class="params">email</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// s:</span></span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^[\w\.]+@\w+\.\w+$/</span>.test(s)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// all unit tests</span></span><br></pre></td></tr></table></figure>
<p>We would get a list back, probably as a JSON file. In our case, the variable
<code>email</code> would be all emails we have passed to <code>isEmail</code>, no matter how they
arrived, maybe even from other tests!</p>
<figure class="highlight json"><figcaption><span>data-coverage.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;email&quot;</span>: [<span class="string">&quot;foo@gmail.com&quot;</span>, <span class="string">&quot;foo.bar@gmail.com&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This will quickly give you an idea of more email &quot;types&quot; that you should
test. For example, there were no emails with other characters, like dashes!
We really would quickly notice (or could even automate) missing test data
classes and edge cases.</p>
<p><blockquote class="twitter-tweet" data-lang="en"><p lang="nl" dir="ltr">QA Engineer walks into a bar. Orders a beer. Orders 0 beers. Orders 999999999 beers. Orders a lizard. Orders -1 beers. Orders a sfdeljknesv.</p>&mdash; Bill Sempf (@sempf) <a target="_blank" rel="noopener" href="https://twitter.com/sempf/status/514473420277694465">September 23, 2014</a></blockquote></p>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<ul>
<li><strong>code documentation</strong> - we should stop using <code>@example</code> inside JavaDoc
block comments. They are hard to format, paint to write and a chore to
maintain. Instead we could have little executable snippets with
&quot;comment-value&quot; tool executing them and updating the expected values.</li>
</ul>
<p><strong>related</strong> <a target="_blank" rel="noopener" href="https://github.com/bahmutov/xplain">xplain</a> generates
documentation examples from unit tests, which makes sure the code examples
are accurate and in sync with the code, but approaching this problem from
the opposite direction.</p>

      
    </div>

    
      <footer class="article-footer personal-links">
  <p>
    Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
    see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
    watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
    browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
  </p>
  <p>
    Want to know more about Cypress? Check out <a href="https://cypress.tips" target="_blank">cypress.tips</a>
  </p>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/accurate-values-in-comments/" data-id="ckwy0acxs001ioevgcs2afv54" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/accurate-values-in-comments/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/ast/" rel="tag">ast</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/javascript/" rel="tag">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/ramda/" rel="tag">ramda</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../accurate-call-sites/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Accurate call sites
        
      </div>
    </a>
  
  
    <a href="../SPA-authentication-with-auth0/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">SPA authentication with Auth0</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">138</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">434</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">109</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">26</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">160</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">69</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">165</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">134</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.38px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.54px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.77px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.85px;">advice</a> <a href="../tags/algolia/" style="font-size: 10.38px;">algolia</a> <a href="../tags/angularjs/" style="font-size: 17.69px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.08px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.69px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.77px;">browser</a> <a href="../tags/ci/" style="font-size: 16.54px;">ci</a> <a href="../tags/circle/" style="font-size: 13.46px;">circle</a> <a href="../tags/climate/" style="font-size: 14.62px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 14.62px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.31px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 19.62px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 13.85px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.77px;">d3</a> <a href="../tags/db/" style="font-size: 14.62px;">db</a> <a href="../tags/docker/" style="font-size: 14.23px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.92px;">documentation</a> <a href="../tags/es6/" style="font-size: 14.62px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.08px;">functional</a> <a href="../tags/generators/" style="font-size: 11.54px;">generators</a> <a href="../tags/git/" style="font-size: 15px;">git</a> <a href="../tags/github/" style="font-size: 15.38px;">github</a> <a href="../tags/graphql/" style="font-size: 11.54px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.31px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.77px;">gulp</a> <a href="../tags/hiring/" style="font-size: 10.77px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.31px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.54px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.77px;">interview</a> <a href="../tags/jade/" style="font-size: 11.15px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.77px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.85px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 16.92px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.15px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.46px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.15px;">performance</a> <a href="../tags/presentation/" style="font-size: 12.31px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.31px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.38px;">proposal</a> <a href="../tags/ramda/" style="font-size: 16.92px;">ramda</a> <a href="../tags/react/" style="font-size: 11.54px;">react</a> <a href="../tags/react-native/" style="font-size: 11.15px;">react native</a> <a href="../tags/reactive/" style="font-size: 14.23px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.15px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.54px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 13.08px;">security</a> <a href="../tags/sentry/" style="font-size: 13.85px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.92px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.23px;">testing</a> <a href="../tags/tutorial/" style="font-size: 15.38px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 12.31px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.38px;">ui</a> <a href="../tags/vercel/" style="font-size: 13.08px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.15px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.54px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.92px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.77px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/12/">December 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/11/">November 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/10/">October 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/09/">September 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/08/">August 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../gh-reusable-workflows/">The Simplest CI Setup For Running Cypress Tests</a>
          </li>
        
          <li>
            <a href="../spy-on-dom-methods/">Spy On DOM Methods And Properties</a>
          </li>
        
          <li>
            <a href="../fp-cy-helpers/">Functional Helpers For Cypress Tests</a>
          </li>
        
          <li>
            <a href="../custom-assertions/">Create Custom Assertions For Test Readability</a>
          </li>
        
          <li>
            <a href="../flaky-cy-type/">Solve Flake In Cypress Typing Into An Input Element</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/accurate-values-in-comments/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
