<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Test The Interface Not The Implementation | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Background The setup Hello World ExpandCollapse Login form BDD assertions Selector Playground   Network requests Pizza toppings RemotePizza with Ajax call 1. Dependency injection 2. Dependency inje">
<meta property="og:type" content="article">
<meta property="og:title" content="Test The Interface Not The Implementation">
<meta property="og:url" content="https://glebbahmutov.com/blog/test-the-interface/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="Background The setup Hello World ExpandCollapse Login form BDD assertions Selector Playground   Network requests Pizza toppings RemotePizza with Ajax call 1. Dependency injection 2. Dependency inje">
<meta property="og:locale">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/click-test.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/hello-test.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/hello-test-devtools.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/name.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/not-found.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/not-found-200.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/jest-fails.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/expand-collapse.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/login.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/stub-alias.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/selector-playground.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/pizza.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/remote-pizza-di.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/pizza-delay.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/stub-default.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/stub-import.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/stub-ajax.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/test-interface/stub-ajax-delay.gif">
<meta property="article:published_time" content="2020-08-05T04:00:00.000Z">
<meta property="article:modified_time" content="2021-06-15T13:13:30.364Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="cypress">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/test-interface/click-test.png">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-test-the-interface" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2020-08-05T04:00:00.000Z" itemprop="datePublished">Aug 5 2020</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/process/">process</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Test The Interface Not The Implementation
    </h1>

    <h2 class="article-title" itemprop="name">
      Moving from Jest + RTL to Cypress + @testing-library/cypress for testing React components
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- toc -->

<ul>
<li><a href="#background">Background</a></li>
<li><a href="#the-setup">The setup</a></li>
<li><a href="#hello-world">Hello World</a></li>
<li><a href="#expandcollapse">ExpandCollapse</a></li>
<li><a href="#login-form">Login form</a><ul>
<li><a href="#bdd-assertions">BDD assertions</a></li>
<li><a href="#selector-playground">Selector Playground</a></li>
</ul>
</li>
<li><a href="#network-requests">Network requests</a><ul>
<li><a href="#pizza-toppings">Pizza toppings</a></li>
<li><a href="#remotepizza-with-ajax-call">RemotePizza with Ajax call</a></li>
<li><a href="#1-dependency-injection">1. Dependency injection</a></li>
<li><a href="#2-dependency-injection-with-delay">2. Dependency injection with delay</a></li>
<li><a href="#3-stubbing-the-default-property">3. Stubbing the default property</a></li>
<li><a href="#4-mocking-named-imports">4. Mocking named imports</a></li>
<li><a href="#5-stubbing-network">5. Stubbing network</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#relate-blog-posts">Relate blog posts</a></li>
</ul>
<!-- tocstop -->

<p><strong>Note:</strong> you can find the source code for this blog post with both Jest + RTL and Cypress + CTL specs in the repository <a target="_blank" rel="noopener" href="https://github.com/bahmutov/rtl-article-2019">rtl-article-2019</a>.</p>
<h2><span id="background">Background</span></h2><p>This blog post is based on the excellent series of posts from <a target="_blank" rel="noopener" href="https://blog.sapegin.me/">Artem Sapegin</a> about testing front-end code. In particular, this blog post follows the examples from <a target="_blank" rel="noopener" href="https://blog.sapegin.me/all/react-testing-3-jest-and-react-testing-library/">Modern React testing, part 3: Jest and React Testing Library</a> blog post. As the title says, we will be testing React components, only instead of using Jest test runner plus <a target="_blank" rel="noopener" href="https://testing-library.com/docs/react-testing-library/intro">@testing-library&#x2F;react</a> (known as RTL) I will be using <a target="_blank" rel="noopener" href="https://www.cypress.io/">Cypress</a> + <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-react-unit-test">cypress-react-unit-test</a> to run the tests. Fear not - the change will be minimal, because we also will be using <a target="_blank" rel="noopener" href="https://testing-library.com/docs/cypress-testing-library/intro">@testing-library&#x2F;cypress</a> (also called CTL). Thus our component tests will <em>look exactly</em> (well, almost, they will in fact be simpler) like before.</p>
<h2><span id="the-setup">The setup</span></h2><p>We install the testing tools using NPM commands</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npm i -D cypress cypress-react-unit-test @testing-library/cypress</span></span><br><span class="line">+ @testing-library/cypress@6.0.0</span><br><span class="line">+ cypress@4.11.0</span><br><span class="line">+ cypress-react-unit-test@4.11.2</span><br></pre></td></tr></table></figure>

<p>The <code>cypress.json</code> file has all Cypress global configuration settings, where I enable <a target="_blank" rel="noopener" href="https://on.cypress.io/experiments#Component-Testing">component testing</a> and <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2020/06/29/experimental-fetch-polyfill/">fetch polyfill</a> experimental features.</p>
<figure class="highlight json"><figcaption><span>cypress.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;experimentalComponentTesting&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;experimentalFetchPolyfill&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;testFiles&quot;</span><span class="punctuation">:</span> <span class="string">&quot;**/*cy-spec.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;componentFolder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;src&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>The project uses <a href>react-scripts</a> to run the application, thus we should point Cypress to bundle specs using the same settings as the application.</p>
<figure class="highlight js"><figcaption><span>cypress/plugins/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">on, config</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;cypress-react-unit-test/plugins/react-scripts&#x27;</span>)(on, config);</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Finally, we need to load the <code>@testing-library/cypress</code> from the Cypress support file - this will set up the querying commands like <code>cy.findByText</code> we will use in our tests.</p>
<figure class="highlight js"><figcaption><span>cypress/support/index.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/bahmutov/cypress-react-unit-test#install</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;cypress-react-unit-test/support&#x27;</span>);</span><br><span class="line"><span class="comment">// https://testing-library.com/docs/cypress-testing-library/intro</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;@testing-library/cypress/add-commands&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>I like having component and unit tests close to the source files, thus our tests will live in the <code>src/components/__tests__</code> folder. There are Jest + RTL spec files there already; they use suffix <code>.spec.js</code>, so I will give Cypress component spec files <code>.cy-spec.js</code> suffix.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">src/components/</span><br><span class="line">  __tests__/</span><br><span class="line">    # Jest + RTL test files</span><br><span class="line">    ExpandCollapse.spec.js</span><br><span class="line">    Hello.spec.js</span><br><span class="line">    Login.spec.js</span><br><span class="line">    Pizza.spec.js</span><br><span class="line">    RemotePizza_*.spec.js</span><br><span class="line">    # Cypress + CTL test files</span><br><span class="line">    ExpandCollapse.cy-spec.js</span><br><span class="line">    Hello.cy-spec.js</span><br><span class="line">    Login.cy-spec.js</span><br><span class="line">    Pizza.cy-spec.js</span><br><span class="line">    RemotePizza.cy-spec.js</span><br><span class="line"></span><br><span class="line">  # component source files</span><br><span class="line">  ExpandCollapse.js</span><br><span class="line">  Login.js</span><br><span class="line">  Pizza.js</span><br><span class="line">  RemotePizza.js</span><br></pre></td></tr></table></figure>

<p>To limit Jest to only run <code>__tests_/*.spec.js</code> files we can add the following to the <code>package.json</code> file</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;jest&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;testMatch&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;**/__tests__/**/*.spec.js&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>There are several <code>RemotePizza_*.spec.js</code> Jest files showing the different ways of dealing with the network calls. We will look at them later; dealing with method stubbing and network control is one of the nicer Cypress features. For now, let&#39;s start with &quot;Hello World&quot; example.</p>
<h2><span id="hello-world">Hello World</span></h2><p>We can start by inspecting a Jest + RTL spec file <code>Hello.spec.js</code> - it does not even have a corresponding component source file, since it renders an inline JSX.</p>
<figure class="highlight js"><figcaption><span>src/components/__tests__/Hello.spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;@testing-library/react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;hello world&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; getByText &#125; = <span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello Jest!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>);</span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">getByText</span>(<span class="string">&#x27;Hello Jest!&#x27;</span>)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The same test but using <code>cypress-react-unit-test</code> replaces <code>render</code> with <code>mount</code> and synchronous calls like <code>render</code>, <code>getByText</code> with implicitly <em>asynchronous</em> commands.</p>
<figure class="highlight js"><figcaption><span>src/components/__tests__/Hello.cy-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&#x27;cypress-react-unit-test&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;hello world&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello Jest!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>);</span><br><span class="line">  cy.<span class="title function_">findByText</span>(<span class="string">&#x27;Hello Jest!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>Note:</strong> In @testing-library&#x2F;cypress v6 synchronous commands like <code>getBy*</code> were removed in favor of asynchronous commands like <code>findBy*</code></p>
<p>Open Cypress and click the spec filename</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npx cypress open</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">or</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">yarn cypress open</span></span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/test-interface/click-test.png" alt="Click on the spec filename"></p>
<p>The component is mounted and shows up on the right side of the browser. The commands from the test <code>mount</code> and <code>findByText</code> are shown in the Command Log on the left.</p>
<p><img src="/blog/images/test-interface/hello-test.png" alt="Hello world test"></p>
<p>The Command Log is magical. This is where you can time travel and get more information about every command by clicking on it. Open the DevTools to see more information - because this is a real browser and real DOM elements.</p>
<p><img src="/blog/images/test-interface/hello-test-devtools.gif" alt="Inspecting the results of command cy.findByText"></p>
<p>You can see how <code>cy.findByText</code> command searched the document to find the element. Because this is a real DOM node, it is highlighted on the right automatically as you hover over its reference.</p>
<p><strong>Tip:</strong> you see the <code>&lt;Unknown ...&gt;</code> in the Command Log for the <code>mount</code> command - this is because the component has no JSX name. In majority of cases you would see the JSX name because there would be a function name or component class name:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;hello world component&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">HelloWorld</span> = (<span class="params"></span>) =&gt; <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello Jest!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">HelloWorld</span> /&gt;</span></span>);</span><br><span class="line">  cy.<span class="title function_">findByText</span>(<span class="string">&#x27;Hello Jest!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/test-interface/name.png" alt="Component name displayed in the Command Log"></p>
<p><strong>Tip 2:</strong> Cypress has built-in <a target="_blank" rel="noopener" href="https://on.cypress.io/contains">.contains</a> command that searches by text or regular expression. Thus the above test could be written as</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;hello world component&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">HelloWorld</span> = (<span class="params"></span>) =&gt; <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello Jest!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">HelloWorld</span> /&gt;</span></span>);</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Hello Jest!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Just like <code>cy.findTextBy</code>, if the text does not appear in the DOM within 4 seconds, the <code>cy.contains</code> command fails.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;fails if text is not found&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">HelloWorld</span> = (<span class="params"></span>) =&gt; <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello Jest!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">HelloWorld</span> /&gt;</span></span>);</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Hello Mocha!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/test-interface/not-found.gif" alt="Command fails after retrying for four seconds"></p>
<p>We can shorten the retry time globally or per command if we know that our application updates faster.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;fails if text is not found&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">HelloWorld</span> = (<span class="params"></span>) =&gt; <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello Jest!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">HelloWorld</span> /&gt;</span></span>);</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Hello Mocha!&#x27;</span>, &#123;<span class="attr">timeout</span>: <span class="number">200</span>&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/test-interface/not-found-200.gif" alt="Command fails after retrying for 200 milliseconds"></p>
<p>The test still fails searching for the text that is not there, but now it fails after retrying for only 200ms. Cypress test runner has the built-in <a target="_blank" rel="noopener" href="https://on.cypress.io/retry-ability">retry-ability</a> which allows the tests to be less flaky, and allows us to write tests where every command is asynchronous, even if the test code looks &quot;simple&quot;. This is well shown in the next spec file testing the <code>ExpandCollapse.js</code> component.</p>
<h2><span id="expandcollapse">ExpandCollapse</span></h2><p>The original Jest component test is below. It renders the component, clicks on the button and checks if the children elements are shown. Then it clicks on the button again and asserts the children elements are hidden.</p>
<figure class="highlight js"><figcaption><span>src/components/__tests__/ExpandCollapse.spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render, fireEvent &#125; <span class="keyword">from</span> <span class="string">&#x27;@testing-library/react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ExpandCollapse</span> <span class="keyword">from</span> <span class="string">&#x27;../ExpandCollapse&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&#x27;button expands and collapses the content&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> children = <span class="string">&#x27;Hello world&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; getByRole, queryByText &#125; = <span class="title function_">render</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ExpandCollapse</span> <span class="attr">excerpt</span>=<span class="string">&quot;Information about dogs&quot;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">ExpandCollapse</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">queryByText</span>(children)).<span class="property">not</span>.<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">  fireEvent.<span class="title function_">click</span>(<span class="title function_">getByRole</span>(<span class="string">&#x27;button&#x27;</span>, &#123; <span class="attr">name</span>: <span class="regexp">/expand/i</span> &#125;));</span><br><span class="line"></span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">queryByText</span>(children)).<span class="title function_">toBeTruthy</span>();</span><br><span class="line"></span><br><span class="line">  fireEvent.<span class="title function_">click</span>(<span class="title function_">getByRole</span>(<span class="string">&#x27;button&#x27;</span>, &#123; <span class="attr">name</span>: <span class="regexp">/collapse/i</span> &#125;));</span><br><span class="line"></span><br><span class="line">  <span class="title function_">expect</span>(<span class="title function_">queryByText</span>(children)).<span class="property">not</span>.<span class="title function_">toBeTruthy</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The test is synchronous - every action like firing the click event MUST be handled by the component synchronously in order for the test to work. For example, the component has the following logic to re-render on click:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;button</span><br><span class="line">  aria-expanded=&#123;isExpanded ? <span class="string">&#x27;true&#x27;</span> : <span class="string">&#x27;false&#x27;</span>&#125;</span><br><span class="line">  onClick=&#123;<span class="function">() =&gt;</span> <span class="title function_">setExpanded</span>(!isExpanded)&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>Later we will break the above test by introducing <code>setTimeout</code> into <code>onClick</code> handler, breaking the test. But first let&#39;s see the equivalent Cypress spec file.</p>
<figure class="highlight js"><figcaption><span>src/components/__tests__/ExpandCollapse.cy-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ExpandCollapse</span> <span class="keyword">from</span> <span class="string">&#x27;../ExpandCollapse&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&#x27;cypress-react-unit-test&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;button expands and collapses the content&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> children = <span class="string">&#x27;Hello world&#x27;</span>;</span><br><span class="line">  <span class="title function_">mount</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ExpandCollapse</span> <span class="attr">excerpt</span>=<span class="string">&quot;Information about dogs&quot;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">ExpandCollapse</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  cy.<span class="title function_">findByText</span>(children).<span class="title function_">should</span>(<span class="string">&#x27;not.exist&#x27;</span>);</span><br><span class="line">  cy.<span class="title function_">findByRole</span>(<span class="string">&#x27;button&#x27;</span>, &#123; <span class="attr">name</span>: <span class="regexp">/expand/i</span> &#125;).<span class="title function_">click</span>();</span><br><span class="line">  cy.<span class="title function_">findByText</span>(children); <span class="comment">// should exist assertion is built-in</span></span><br><span class="line">  cy.<span class="title function_">findByRole</span>(<span class="string">&#x27;button&#x27;</span>, &#123; <span class="attr">name</span>: <span class="regexp">/collapse/i</span> &#125;).<span class="title function_">click</span>();</span><br><span class="line">  cy.<span class="title function_">findByText</span>(children).<span class="title function_">should</span>(<span class="string">&#x27;not.exist&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The test looks almost exactly the same, and very similar to the <code>HelloWorld</code> spec.</p>
<ul>
<li>we use <code>cy.findByText</code> and <code>cy.findByRole</code> commands to find the elements to test</li>
<li>we can add an assertion to &quot;flip&quot; the meaning of the command. For example, after clicking on the &quot;Collapse&quot; button, the element with text &quot;Hello world&quot; should not longer exist in the DOM</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cy.<span class="title function_">findByRole</span>(<span class="string">&#x27;button&#x27;</span>, &#123; <span class="attr">name</span>: <span class="regexp">/collapse/i</span> &#125;).<span class="title function_">click</span>();</span><br><span class="line">cy.<span class="title function_">findByText</span>(children).<span class="title function_">should</span>(<span class="string">&#x27;not.exist&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>The Cypress commands are declarative and asynchronous. The component might have the internal logic to only re-render after 1000ms when clicking the &quot;Collapse&quot; button - let&#39;s change the component to this:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;button</span><br><span class="line">  aria-expanded=&#123;isExpanded ? <span class="string">&#x27;true&#x27;</span> : <span class="string">&#x27;false&#x27;</span>&#125;</span><br><span class="line">  onClick=&#123;<span class="function">() =&gt;</span> <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">setExpanded</span>(!isExpanded), <span class="number">1000</span>)&#125;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>Instead of immediately updating the DOM, the component now &quot;waits&quot; 1 second. Our Jest test fails.</p>
<p><img src="/blog/images/test-interface/jest-fails.png" alt="Jest test fails if the component updates asynchronously"></p>
<p>In fact, the Jest test as written fails even if the component has a delay of just zero milliseconds: <code>setTimeout(..., 0)</code>. The Cypress tests meanwhile are happy as a clam. We can change the component update from synchronous to asynchronous, we can change the delay - it is fine, the Test Runner will retry its commands until the timeout or the DOM updates</p>
<p><img src="/blog/images/test-interface/expand-collapse.gif" alt="Modifying the component&#39;s delay while the test re-runs"></p>
<p>The component tests in Cypress are meant to interact with the component using its public API: the props and the DOM without assuming anything about its internal code.</p>
<h2><span id="login-form">Login form</span></h2><p>Our next example component renders a form with submit button. When the user fills the input fields and clicks the Submit button, the function <code>onSubmit</code> passed from the parent component as a prop is called.</p>
<figure class="highlight js"><figcaption><span>src/components/Login.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Login</span>(<span class="params">&#123; onSubmit &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [username, setUsername] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [password, setPassword] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleSubmit</span> = event =&gt; &#123;</span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="title function_">onSubmit</span>(&#123; username, password &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;handleSubmit&#125;</span> <span class="attr">data-testid</span>=<span class="string">&quot;loginForm&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Username</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;username&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;username&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;event</span> =&gt;</span> setUsername(event.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">          data-testid=&quot;loginForm-username&quot;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Password</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">name</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">value</span>=<span class="string">&#123;password&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onChange</span>=<span class="string">&#123;event</span> =&gt;</span> setPassword(event.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">          data-testid=&quot;loginForm-password&quot;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Log in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The Cypress test is below; we create a stub function using the built-in <a target="_blank" rel="noopener" href="https://on.cypress.io/stub">cy.stub</a> command. The stubs are reset automatically before each test, thus we don&#39;t need to worry about resetting them ourselves.</p>
<figure class="highlight js"><figcaption><span>src/components/__tests__/Login.cy-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Login</span> <span class="keyword">from</span> <span class="string">&#x27;../Login&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&#x27;cypress-react-unit-test&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;form&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;submits username and password using testing-library&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> username = <span class="string">&#x27;me&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> password = <span class="string">&#x27;please&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> onSubmit = cy.<span class="title function_">stub</span>();</span><br><span class="line">    <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Login</span> <span class="attr">onSubmit</span>=<span class="string">&#123;onSubmit&#125;</span> /&gt;</span></span>);</span><br><span class="line"></span><br><span class="line">    cy.<span class="title function_">findByLabelText</span>(<span class="regexp">/username/i</span>).<span class="title function_">type</span>(username);</span><br><span class="line">    cy.<span class="title function_">findByLabelText</span>(<span class="regexp">/password/i</span>).<span class="title function_">type</span>(password);</span><br><span class="line">    cy.<span class="title function_">findByRole</span>(<span class="string">&#x27;button&#x27;</span>, &#123; <span class="attr">name</span>: <span class="regexp">/log in/i</span> &#125;)</span><br><span class="line">      .<span class="title function_">click</span>()</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// use explicit assertion using sinon-chai matchers</span></span><br><span class="line">        <span class="comment">/* eslint-disable-next-line no-unused-expressions */</span></span><br><span class="line">        <span class="title function_">expect</span>(onSubmit).<span class="property">to</span>.<span class="property">be</span>.<span class="property">calledOnce</span>;</span><br><span class="line">        <span class="title function_">expect</span>(onSubmit).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">calledWith</span>(&#123;</span><br><span class="line">          username,</span><br><span class="line">          password,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/test-interface/login.gif" alt="Login test"></p>
<p>The test passes - our component does call the passed <code>onSubmit</code> prop with the password and the username object.</p>
<p><strong>Tip:</strong> Cypress takes a video of the entire test run and screenshot images on test failures by default, you probably want to keep the sensitive data like the password out of the Command Log. Read the blog post <a href="../keep-passwords-secret-in-e2e-tests/">Keep passwords secret in E2E tests</a> to learn how.</p>
<h3><span id="bdd-assertions">BDD assertions</span></h3><p>The assertion block using <code>.then</code> that checks the function stub gives away the asynchronous nature of the test.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cy.<span class="title function_">findByRole</span>(<span class="string">&#x27;button&#x27;</span>, &#123; <span class="attr">name</span>: <span class="regexp">/log in/i</span> &#125;)</span><br><span class="line">  .<span class="title function_">click</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// use explicit assertion using sinon-chai matchers</span></span><br><span class="line">    <span class="comment">/* eslint-disable-next-line no-unused-expressions */</span></span><br><span class="line">    <span class="title function_">expect</span>(onSubmit).<span class="property">to</span>.<span class="property">be</span>.<span class="property">calledOnce</span>;</span><br><span class="line">    <span class="title function_">expect</span>(onSubmit).<span class="property">to</span>.<span class="property">be</span>.<span class="title function_">calledWith</span>(&#123;</span><br><span class="line">      username,</span><br><span class="line">      password,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>We need this <code>.then</code> block to run the synchronous code <code>expect(onSubmit)...</code> assertions <em>after</em> the <code>click()</code> command. We can avoid using <code>.then</code> by giving the stub an alias using <a target="_blank" rel="noopener" href="https://on.cypress.io/as">.as</a> command. Later we can retrieve the stub using this alias and use <a target="_blank" rel="noopener" href="https://on.cypress.io/assertions">BDD assertions</a>. The relevant changes in the test are below:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a stub and save under an alias</span></span><br><span class="line"><span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Login</span> <span class="attr">onSubmit</span>=<span class="string">&#123;cy.stub().as(</span>&#x27;<span class="attr">submit</span>&#x27;)&#125; /&gt;</span></span>);</span><br><span class="line">...</span><br><span class="line">cy.<span class="title function_">findByRole</span>(<span class="string">&#x27;button&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="regexp">/log in/i</span>,</span><br><span class="line">&#125;).<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">cy.<span class="title function_">get</span>(<span class="string">&#x27;@submit&#x27;</span>)</span><br><span class="line">  .<span class="title function_">should</span>(<span class="string">&#x27;be.calledOnce&#x27;</span>)</span><br><span class="line">  <span class="comment">// .and is an alias to .should</span></span><br><span class="line">  .<span class="title function_">and</span>(<span class="string">&#x27;calledWith&#x27;</span>, &#123; username, password &#125;);</span><br></pre></td></tr></table></figure>

<p>The test passes and you can see the alias in the Command Log when the stub is called.</p>
<p><img src="/blog/images/test-interface/stub-alias.png" alt="Stub alias shows when the function was called"></p>
<p>Cypress <a target="_blank" rel="noopener" href="https://on.cypress.io/stubs-spies-and-clocks">stubs and spies</a> are built on top of the powerful <a target="_blank" rel="noopener" href="https://sinonjs.org/">Sinon.js</a> library, and Cypress includes <a target="_blank" rel="noopener" href="https://on.cypress.io/assertions#Sinon-Chai">Sinon-Chai</a> assertion matchers. These assertions help you confirm the methods are called precisely as intended.</p>
<h3><span id="selector-playground">Selector Playground</span></h3><p>When the test typed the username and the password, we used <code>@testing-library/cypress</code> command <code>findByLabelText</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cy.<span class="title function_">findByLabelText</span>(<span class="regexp">/username/i</span>).<span class="title function_">type</span>(username);</span><br><span class="line">cy.<span class="title function_">findByLabelText</span>(<span class="regexp">/password/i</span>).<span class="title function_">type</span>(password);</span><br></pre></td></tr></table></figure>

<p>The <code>Login</code> component does have <a target="_blank" rel="noopener" href="https://on.cypress.io/best-practices#Selecting-Elements">good testing attributes</a> on those input fields though:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=<span class="string">&quot;username&quot;</span> value=&#123;username&#125;</span><br><span class="line">  onChange=&#123;<span class="function"><span class="params">event</span> =&gt;</span> <span class="title function_">setUsername</span>(event.<span class="property">target</span>.<span class="property">value</span>)&#125;</span><br><span class="line">  data-testid=<span class="string">&quot;loginForm-username&quot;</span></span><br><span class="line">/&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&#123;password&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">onChange</span>=<span class="string">&#123;event</span> =&gt;</span> setPassword(event.target.value)&#125;</span></span><br><span class="line"><span class="language-xml">  data-testid=&quot;loginForm-password&quot;</span></span><br><span class="line"><span class="language-xml">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Thus we can let Cypress pick the selector for us using <a target="_blank" rel="noopener" href="https://on.cypress.io/selector-playground">Selector Playground</a>. It will inspect every DOM element we hover over to suggest the most precise Cypress built-in command to select that element. In our case, the Selector Playground suggest using the <code>data-testid</code> attribute.</p>
<p><img src="/blog/images/test-interface/selector-playground.gif" alt="Selector Playground suggesting command for selecting the username input field"></p>
<p>The copied command <code>cy.get(&#39;[data-testid=loginForm-username]&#39;)</code> can be pasted directly into the spec file, and then we need to add <code>.type()</code> command.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-testid=loginForm-username]&#x27;</span>).<span class="title function_">type</span>(username)</span><br></pre></td></tr></table></figure>

<p>Picking selector commands using the Selector Playground is a nifty little tool for quickly writing tests.</p>
<h2><span id="network-requests">Network requests</span></h2><h3><span id="pizza-toppings">Pizza toppings</span></h3><p>The final component we are going to test renders the list of pizza toppings. If the list of topics is passed via a prop, the test is simple.</p>
<figure class="highlight js"><figcaption><span>src/components/Pizza.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Pizza</span>(<span class="params">&#123; ingredients &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Pizza<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;ingredients.map(ingredient =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;ingredient&#125;</span>&gt;</span>&#123;ingredient&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>src/components/__tests__/Pizza.cy-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&#x27;cypress-react-unit-test&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Pizza</span> <span class="keyword">from</span> <span class="string">&#x27;../Pizza&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;contains all ingredients&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> ingredients = [<span class="string">&#x27;bacon&#x27;</span>, <span class="string">&#x27;tomato&#x27;</span>, <span class="string">&#x27;mozzarella&#x27;</span>, <span class="string">&#x27;pineapples&#x27;</span>];</span><br><span class="line">  <span class="comment">// component Pizza shows the passed list of toppings</span></span><br><span class="line">  <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Pizza</span> <span class="attr">ingredients</span>=<span class="string">&#123;ingredients&#125;</span> /&gt;</span></span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> ingredient <span class="keyword">of</span> ingredients) &#123;</span><br><span class="line">    cy.<span class="title function_">findByText</span>(ingredient);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/test-interface/pizza.gif" alt="Verifying every topping is rendered"></p>
<h3><span id="remotepizza-with-ajax-call">RemotePizza with Ajax call</span></h3><p>But what if the component fetches the list of toppings from a remote REST API? Let&#39;s look at the <code>RemotePizza</code> component</p>
<figure class="highlight js"><figcaption><span>src/components/RemotePizza.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fetchIngredients <span class="keyword">as</span> defaultFetchIngredients &#125; <span class="keyword">from</span> <span class="string">&#x27;../services&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">RemotePizza</span>(<span class="params">&#123; fetchIngredients &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [ingredients, setIngredients] = <span class="title class_">React</span>.<span class="title function_">useState</span>([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleCook</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">fetchIngredients</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setIngredients</span>(response.<span class="property">args</span>.<span class="property">ingredients</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Pizza<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleCook&#125;</span>&gt;</span>Cook<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;ingredients.length &gt; 0 &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;ingredients.map((ingredient) =&gt; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;ingredient&#125;</span>&gt;</span>&#123;ingredient&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">RemotePizza</span>.<span class="property">defaultProps</span> = &#123;</span><br><span class="line">  <span class="attr">fetchIngredients</span>: <span class="function">(<span class="params">url</span>) =&gt;</span> <span class="title function_">defaultFetchIngredients</span>(url),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Let&#39;s write component tests confirming the fetched pizza toppings are displayed correctly. We can take several approaches to this.</p>
<h3><span id="1-dependency-injection">1. Dependency injection</span></h3><p>The component allows passing the fetcher function via a prop. Thus we can pass a stub like before</p>
<figure class="highlight js"><figcaption><span>src/components/__tests__/RemotePizza.cy-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">RemotePizza</span> <span class="keyword">from</span> <span class="string">&#x27;../RemotePizza&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mount &#125; <span class="keyword">from</span> <span class="string">&#x27;cypress-react-unit-test&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ingredients = [<span class="string">&#x27;bacon&#x27;</span>, <span class="string">&#x27;tomato&#x27;</span>, <span class="string">&#x27;mozzarella&#x27;</span>, <span class="string">&#x27;pineapples&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;RemotePizza&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;stubs via prop (di)&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fetchIngredients = cy.<span class="title function_">stub</span>().<span class="title function_">resolves</span>(&#123; <span class="attr">args</span>: &#123; ingredients &#125; &#125;);</span><br><span class="line">    <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">RemotePizza</span> <span class="attr">fetchIngredients</span>=<span class="string">&#123;fetchIngredients&#125;</span> /&gt;</span></span>);</span><br><span class="line">    cy.<span class="title function_">contains</span>(<span class="string">&#x27;button&#x27;</span>, <span class="regexp">/cook/i</span>).<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> ingredient <span class="keyword">of</span> ingredients) &#123;</span><br><span class="line">      cy.<span class="title function_">contains</span>(ingredient);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/test-interface/remote-pizza-di.png" alt="Passing fetch stub as a prop"></p>
<h3><span id="2-dependency-injection-with-delay">2. Dependency injection with delay</span></h3><p>How does our component behave when the remote server responds after a delay? Let&#39;s pass a stub that resolves after one second delay using the <a target="_blank" rel="noopener" href="http://bluebirdjs.com/docs/api-reference.html">Bluebird Promise</a> library <a target="_blank" rel="noopener" href="https://on.cypress.io/bundled-tools">bundled with Cypress</a>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;stubs via prop (di with delay)&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> fetchIngredients = cy</span><br><span class="line">    .<span class="title function_">stub</span>()</span><br><span class="line">    <span class="comment">// resolves after 1 second delay</span></span><br><span class="line">    .<span class="title function_">resolves</span>(</span><br><span class="line">      <span class="title class_">Cypress</span>.<span class="property">Promise</span>.<span class="title function_">resolve</span>(&#123; <span class="attr">args</span>: &#123; ingredients &#125; &#125;).<span class="title function_">delay</span>(<span class="number">1000</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">RemotePizza</span> <span class="attr">fetchIngredients</span>=<span class="string">&#123;fetchIngredients&#125;</span> /&gt;</span></span>);</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;button&#x27;</span>, <span class="regexp">/cook/i</span>).<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> ingredient <span class="keyword">of</span> ingredients) &#123;</span><br><span class="line">    cy.<span class="title function_">contains</span>(ingredient);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The test passes just fine - but it shows the need for some kind of loading indicator. Our users would not know what is happening while the toppings are being fetched.</p>
<p><img src="/blog/images/test-interface/pizza-delay.gif" alt="The component shows nothing while the toppings are being fetched"></p>
<h3><span id="3-stubbing-the-default-property">3. Stubbing the default property</span></h3><p>We can &quot;reach&quot; into the component and replace the default fetch method from our test using the <code>defaultProps</code> object exposed by the component.</p>
<figure class="highlight js"><figcaption><span>src/components/RemotePizza.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">RemotePizza</span>.<span class="property">defaultProps</span> = &#123;</span><br><span class="line">  <span class="attr">fetchIngredients</span>: <span class="function">(<span class="params">url</span>) =&gt;</span> <span class="title function_">defaultFetchIngredients</span>(url),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Our test stubs the method <code>RemotePizza.defaultProps</code></p>
<figure class="highlight js"><figcaption><span>src/components/__tests__/RemotePizza.cy-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;mocks method via defaultProps&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">stub</span>(<span class="title class_">RemotePizza</span>.<span class="property">defaultProps</span>, <span class="string">&#x27;fetchIngredients&#x27;</span>).<span class="title function_">resolves</span>(&#123;</span><br><span class="line">    <span class="attr">args</span>: &#123; ingredients &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">RemotePizza</span> /&gt;</span></span>);</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;button&#x27;</span>, <span class="regexp">/cook/i</span>).<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> ingredient <span class="keyword">of</span> ingredients) &#123;</span><br><span class="line">    cy.<span class="title function_">contains</span>(ingredient);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/test-interface/stub-default.png" alt="Stubbing a method in the default props object"></p>
<h3><span id="4-mocking-named-imports">4. Mocking named imports</span></h3><p>Our <code>RemotePizza</code> component imports the default fetcher from the services module.</p>
<figure class="highlight js"><figcaption><span>src/components/RemotePizza.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fetchIngredients <span class="keyword">as</span> defaultFetchIngredients &#125; <span class="keyword">from</span> <span class="string">&#x27;../services&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>The Jest test mocked the exported function <code>fetchIngredients</code>.</p>
<figure class="highlight js"><figcaption><span>src/components/__tests__/RemotePizza_jestmock.spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fetchIngredients &#125; <span class="keyword">from</span> <span class="string">&#x27;../../services&#x27;</span>;</span><br><span class="line"></span><br><span class="line">jest.<span class="title function_">mock</span>(<span class="string">&#x27;../../services&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">afterEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  fetchIngredients.<span class="title function_">mockReset</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// during test</span></span><br><span class="line">fetchIngredients.<span class="title function_">mockResolvedValue</span>(&#123; <span class="attr">args</span>: &#123; ingredients &#125; &#125;);</span><br></pre></td></tr></table></figure>

<p>In Cypress we can mock the <code>fetchIngredients</code> import using the included Sinon <a target="_blank" rel="noopener" href="https://on.cypress.io/stub">cy.stub</a> just like before.</p>
<figure class="highlight js"><figcaption><span>src/components/__tests__/RemotePizza.cy-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// prepare for import mocking</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> services <span class="keyword">from</span> <span class="string">&#x27;../../services&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;mocks named import from services&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">stub</span>(services, <span class="string">&#x27;fetchIngredients&#x27;</span>).<span class="title function_">resolves</span>(&#123; <span class="attr">args</span>: &#123; ingredients &#125; &#125;);</span><br><span class="line">  <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">RemotePizza</span> /&gt;</span></span>);</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;button&#x27;</span>, <span class="regexp">/cook/i</span>).<span class="title function_">click</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> ingredient <span class="keyword">of</span> ingredients) &#123;</span><br><span class="line">    cy.<span class="title function_">contains</span>(ingredient);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>To mock a named ES6 module import, we import the entire module using wildcard syntax, which gives us an object. Then we stub the method of that object, just like we did when stubbing method <code>fetchIngredients</code> of the object <code>RemotePizza.defaultProps</code>.</p>
<p><img src="/blog/images/test-interface/stub-import.png" alt="Stubbing named ES6 module import"></p>
<p>Note that all Cypress spies and stubs created during the test are <a target="_blank" rel="noopener" href="https://on.cypress.io/stubs-spies-and-clocks">reset automatically</a>, thus you do not have to reset them manually.</p>
<h3><span id="5-stubbing-network">5. Stubbing network</span></h3><p>The above tactics for stubbing the component&#39;s method all reached deep into its implementation. With Cypress&#39; <a target="_blank" rel="noopener" href="https://on.cypress.io/network-requests">built-in network control</a> we can avoid testing the component&#39;s internals and stub the outgoing Ajax request instead.</p>
<figure class="highlight js"><figcaption><span>src/components/__tests__/RemotePizza.cy-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;download ingredients from internets (network mock)&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">server</span>();</span><br><span class="line">  <span class="comment">// using https://on.cypress.io/route</span></span><br><span class="line">  <span class="comment">// to stub every request to particular URL a response</span></span><br><span class="line">  cy.<span class="title function_">route</span>(<span class="string">&#x27;https://httpbin.org/anything*&#x27;</span>, &#123; <span class="attr">args</span>: &#123; ingredients &#125; &#125;).<span class="title function_">as</span>(</span><br><span class="line">    <span class="string">&#x27;pizza&#x27;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">mount</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">RemotePizza</span> /&gt;</span></span>);</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;button&#x27;</span>, <span class="regexp">/cook/i</span>).<span class="title function_">click</span>();</span><br><span class="line">  cy.<span class="title function_">wait</span>(<span class="string">&#x27;@pizza&#x27;</span>); <span class="comment">// make sure the network stub was used</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> ingredient <span class="keyword">of</span> ingredients) &#123;</span><br><span class="line">    cy.<span class="title function_">contains</span>(ingredient);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The test passes and we can see the Ajax request information in the ROUTES table of the Command Log.</p>
<p><img src="/blog/images/test-interface/stub-ajax.png" alt="Stubbing Ajax network request"></p>
<p>We can also add a delay to the network response to simulate a slow server response:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cy.<span class="title function_">route</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://httpbin.org/anything*&#x27;</span>,</span><br><span class="line">  <span class="attr">response</span>: &#123; <span class="attr">args</span>: &#123; ingredients &#125; &#125;,</span><br><span class="line">  <span class="attr">delay</span>: <span class="number">1000</span>,</span><br><span class="line">&#125;).<span class="title function_">as</span>(<span class="string">&#x27;pizza&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/test-interface/stub-ajax-delay.gif" alt="Stubbing Ajax network request with delay of 1 second"></p>
<p>Using <a target="_blank" rel="noopener" href="https://on.cypress.io/route">cy.route</a> we can spy or stub network requests made by the component with ease.</p>
<h2><span id="conclusion">Conclusion</span></h2><ul>
<li>If you have existing Jest + React Testing Library tests you can quickly port them to run as Cypress component tests using <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-react-unit-test">cypress-react-unit-test</a> + <a target="_blank" rel="noopener" href="https://testing-library.com/docs/cypress-testing-library/intro">@testing-library&#x2F;cypress</a>. The commands are identical.</li>
<li>Cypress <a target="_blank" rel="noopener" href="https://on.cypress.io/test-runner">Test Runner</a> offers advantages over running tests in the terminal<ul>
<li>full browser with DevTools: Electron, Chrome, Firefox, Edge instead of its emulation</li>
<li>Command Log with time-traveling debugger</li>
<li>Selector Playground</li>
<li>screenshots on failure</li>
<li>videos of the test runs on the CI server</li>
</ul>
</li>
<li>Cypress test syntax is declarative, and every command runs asynchronously - you can change the implementation of your components and the tests still work correctly using the built-in automatic retries</li>
<li>You can control the behavior of the component by passing properties when mounting it, stubbing exposed method, mocking module imports and stubbing network calls</li>
</ul>
<p>You can fine the source code and the spec files described in this blog post in repo <a target="_blank" rel="noopener" href="https://github.com/bahmutov/rtl-article-2019">rtl-article-2019</a>.</p>
<h2><span id="relate-blog-posts">Relate blog posts</span></h2><ul>
<li><a href="../my-vision-for-component-tests/">My Vision for Component Tests in Cypress</a></li>
<li><a target="_blank" rel="noopener" href="https://itnext.io/unit-testing-react-components-with-cypress-4d4cf8cd59a0">Unit Testing React components with Cypress</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.to/bahmutov/test-react-component-with-cypress-react-unit-test-example-4d99">Test React Component with cypress-react-unit-test Example</a></li>
<li><a href="../tic-tac-toe-component-tests/">Tic-Tac-Toe Component Tests</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/@bahmutov/using-env-and-env-test-from-react-component-tests-c11aa2040bc8">Using .env and .env.test from React component tests</a></li>
<li><a href="../open-source-visual-testing-of-components/">Visual testing for React components using open source tools</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.to/bahmutov/12-recipes-for-testing-react-applications-using-cypress-react-unit-test-46g6">12 Recipes for testing React applications using cypress-react-unit-test</a> (compare to <a target="_blank" rel="noopener" href="https://dev.to/jooforja/12-recipes-for-testing-react-applications-using-testing-library-1bh2#portal">12 Recipes for testing React applications using Testing Library</a>)</li>
<li><a target="_blank" rel="noopener" href="https://medium.com/swlh/cypress-unit-testing-react-components-with-typescript-77b38e5043b3">Cypress Unit Testing React Components With TypeScript</a></li>
</ul>

      
    </div>

    
      <footer class="article-footer personal-links">
  <p>
    Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
    see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
    watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
    browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
  </p>
  <p>
    Want to know more about Cypress? Check out <a href="https://cypress.tips" target="_blank">cypress.tips</a>
  </p>
  <p>
    Have a Cypress question? Want me to answer it? Consider supporting me via <a target="_blank" rel="noopener" href="https://github.com/sponsors/bahmutov">GitHub Sponsors</a> or by purchasing my <a target="_blank" rel="noopener" href="https://cypress.tips/courses">Cypress courses</a>.
  </p>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/test-the-interface/" data-id="cl8sug89300glsdvg9ahq6sy2" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/test-the-interface/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/" rel="tag">cypress</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../develop-preview-test/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Test the Preview Vercel Deploys
        
      </div>
    </a>
  
  
    <a href="../why-cypress/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Why Cypress?</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">148</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">497</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">113</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angular/" rel="tag">angular</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">230</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">70</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">166</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">149</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">21</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.37px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.48px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.74px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.89px;">advice</a> <a href="../tags/algolia/" style="font-size: 10.74px;">algolia</a> <a href="../tags/angular/" style="font-size: 10px;">angular</a> <a href="../tags/angularjs/" style="font-size: 17.78px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 12.96px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.59px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 14.81px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.56px;">browser</a> <a href="../tags/ci/" style="font-size: 17.41px;">ci</a> <a href="../tags/circle/" style="font-size: 14.44px;">circle</a> <a href="../tags/climate/" style="font-size: 14.44px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 15.19px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.22px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 20px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 14.07px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.74px;">d3</a> <a href="../tags/db/" style="font-size: 14.44px;">db</a> <a href="../tags/docker/" style="font-size: 14.07px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.85px;">documentation</a> <a href="../tags/es6/" style="font-size: 14.44px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.15px;">functional</a> <a href="../tags/generators/" style="font-size: 11.48px;">generators</a> <a href="../tags/git/" style="font-size: 15.19px;">git</a> <a href="../tags/github/" style="font-size: 16.67px;">github</a> <a href="../tags/graphql/" style="font-size: 11.48px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.22px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.74px;">gulp</a> <a href="../tags/hiring/" style="font-size: 11.11px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.22px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.48px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.74px;">interview</a> <a href="../tags/jade/" style="font-size: 11.11px;">jade</a> <a href="../tags/javascript/" style="font-size: 19.63px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.74px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.7px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 17.04px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.11px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.52px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.3px;">performance</a> <a href="../tags/presentation/" style="font-size: 12.22px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.41px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.37px;">proposal</a> <a href="../tags/ramda/" style="font-size: 17.04px;">ramda</a> <a href="../tags/react/" style="font-size: 12.22px;">react</a> <a href="../tags/react-native/" style="font-size: 11.11px;">react native</a> <a href="../tags/reactive/" style="font-size: 14.07px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.11px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.48px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 12.96px;">security</a> <a href="../tags/sentry/" style="font-size: 13.7px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.85px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.26px;">testing</a> <a href="../tags/tutorial/" style="font-size: 15.93px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 12.59px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.37px;">ui</a> <a href="../tags/vercel/" style="font-size: 13.33px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.11px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.48px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.85px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.74px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/10/">October 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/09/">September 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/08/">August 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/07/">July 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/06/">June 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/05/">May 2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/04/">April 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/03/">March 2022</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/02/">February 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/01/">January 2022</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/12/">December 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/11/">November 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/10/">October 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/09/">September 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/08/">August 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../test-bash-2022-ui-challenge/">Solving Test.Bash 2022 UI Challenge With Cypress</a>
          </li>
        
          <li>
            <a href="../cypress-webkit/">Run Cypress Tests Using WebKit Browser</a>
          </li>
        
          <li>
            <a href="../ui-to-api-to-app-actions/">Change E2E Tests From UI To API To App Actions</a>
          </li>
        
          <li>
            <a href="../dependent-test/">Writing Tests That Depend On Other Tests</a>
          </li>
        
          <li>
            <a href="../cypress-component-testing-vs-angular-test-harness/">Cypress Component Testing vs Angular Test Harness</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/test-the-interface/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
