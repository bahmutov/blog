<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Cypress Flakiness Examples | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Recently I watched Filip Hric YT livestream Debugging test flakes in Cypress. Good video. He has shown several examples of flaky tests caused by the bad test design. In this blog post, I will give my">
<meta property="og:type" content="article">
<meta property="og:title" content="Cypress Flakiness Examples">
<meta property="og:url" content="https://glebbahmutov.com/blog/flakiness-example/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="Recently I watched Filip Hric YT livestream Debugging test flakes in Cypress. Good video. He has shown several examples of flaky tests caused by the bad test design. In this blog post, I will give my">
<meta property="og:locale">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e1.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e2.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e3.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e4.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/progress.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e5.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e6.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e7.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e8.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e9.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e10.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e11.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/slide.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/co1.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/co2.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/co3.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/co4.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/co5.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/p1.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/else.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/copy.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/full.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/api.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/flakiness-example/spy-test.png">
<meta property="article:published_time" content="2024-01-19T05:00:00.000Z">
<meta property="article:modified_time" content="2024-04-23T22:55:08.528Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="testing">
<meta property="article:tag" content="cypress">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/flakiness-example/e1.png">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-flakiness-example" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2024-01-19T05:00:00.000Z" itemprop="datePublished">Jan 19 2024</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/process/">process</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Cypress Flakiness Examples
    </h1>

    <h2 class="article-title" itemprop="name">
      A few examples of solving test flake plus how to use GitHub Copilot to write Cypress tests.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recently I watched <a target="_blank" rel="noopener" href="https://filiphric.com/">Filip Hric</a> YT livestream <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=fFw-FkXk3ec">Debugging test flakes in Cypress</a>. Good video. He has shown several examples of flaky tests caused by the bad test design. In this blog post, I will give my take on the solid test design that avoids all shown pitfalls.</p>
<!-- toc -->

<ul>
<li><a href="#the-application">The application</a></li>
<li><a href="#the-loading">The loading</a><ul>
<li><a href="#the-loading-time">The loading time</a></li>
</ul>
</li>
<li><a href="#the-number-of-items">The number of items</a></li>
<li><a href="#active-subscriptions">Active subscriptions</a></li>
<li><a href="#sample-data">Sample data</a></li>
<li><a href="#github-copilot-trick">GitHub Copilot trick</a></li>
<li><a href="#the-data-edge-case">The data edge case</a></li>
<li><a href="#control-the-data">Control the data</a></li>
<li><a href="#response-data-changes">Response data changes</a><ul>
<li><a href="#api-test">API test</a></li>
<li><a href="#network-spy-test">Network spy test</a></li>
</ul>
</li>
<li><a href="#see-also">See also</a></li>
</ul>
<!-- tocstop -->

<blockquote class="pullquote"><p>üéÅ The source code for this blog post is in the public repo <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-flakiness-debug-examples">bahmutov&#x2F;cypress-flakiness-debug-examples</a>. I have grabbed the initial code from <a target="_blank" rel="noopener" href="https://github.com/filiphric/cypress-flakiness-debug-examples">filiphric&#x2F;cypress-flakiness-debug-examples</a> branch <code>customer-subscriptions</code>. The examples in this blog post are using the application and the tests in the subfolder <code>customer-subscriptions</code>.</p>
</blockquote>

<h2><span id="the-application">The application</span></h2><p>The application displays a list of subscriptions. Some subscriptions are active and some are not.</p>
<p><img src="../images/flakiness-example/e1.png" alt="Customer subscriptions app"></p>
<p>The list is generated dynamically using <a target="_blank" rel="noopener" href="https://github.com/faker-js/faker#readme">@faker-js&#x2F;faker</a> module. The number of items can be from 1 to 6:</p>
<figure class="highlight ts"><figcaption><span>customer-subscriptions/src/modules/generateCustomers.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; faker &#125; <span class="keyword">from</span> <span class="string">&#x27;@faker-js/faker&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Subscription</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@/interfaces/subscription&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">generateCustomers</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">customers</span>: <span class="title class_">Subscription</span>[] = []</span><br><span class="line">  <span class="keyword">let</span> customerCount = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">6</span>) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; customerCount; index++) &#123;</span><br><span class="line">    <span class="keyword">let</span> firstName = faker.<span class="property">person</span>.<span class="title function_">firstName</span>()</span><br><span class="line">    <span class="keyword">let</span> lastName = faker.<span class="property">person</span>.<span class="title function_">lastName</span>()</span><br><span class="line">    <span class="keyword">let</span> status = [<span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;inactive&#x27;</span>, <span class="string">&#x27;trial&#x27;</span>] <span class="keyword">as</span> <span class="keyword">const</span></span><br><span class="line"></span><br><span class="line">    customers.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">id</span>: faker.<span class="property">string</span>.<span class="title function_">uuid</span>(),</span><br><span class="line">      <span class="attr">fullName</span>: <span class="string">`<span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">email</span>: faker.<span class="property">internet</span>.<span class="title function_">exampleEmail</span>(&#123; firstName, lastName &#125;),</span><br><span class="line">      <span class="attr">status</span>: status[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">3</span>)],</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> customers</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>There is also a loading &quot;splash&quot; screen before the items load.</p>
<figure class="highlight ts"><figcaption><span>customer-subscriptions/src/components/SubscriptionList.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Fetch subscriptions from API</span></span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&#x27;/api/subscriptions&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network response was not ok&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> response.<span class="title function_">json</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setSubscriptions</span>(data)</span><br><span class="line">      <span class="title function_">setLoading</span>(<span class="literal">false</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setError</span>(error.<span class="property">message</span>)</span><br><span class="line">      <span class="title function_">setLoading</span>(<span class="literal">false</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, [])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (loading) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (error) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Error: &#123;error&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Let&#39;s see how Cypress end-to-end tests for this app can be flaky or solid.</p>
<h2><span id="the-loading">The loading</span></h2><p>If you just started the application, the webserver might take longer to bundle and return the homepage, especially in the dev mode. To better simulate the unpredictable initial load, I will add a random delay between 1 and 11 seconds to the <code>fetch</code> call.</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(</span><br><span class="line">    <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// Fetch subscriptions from API</span></span><br><span class="line">      <span class="title function_">fetch</span>(<span class="string">&#x27;/api/subscriptions&#x27;</span>)</span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10_000</span> + <span class="number">1000</span>,</span><br><span class="line">  )</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure>

<p>Here is the first test as shown by Filip. It is flaky <em>on purpose</em>. Can you see at least two potential problems?</p>
<figure class="highlight js"><figcaption><span>customer-subscriptions/cypress/e2e/spec.cy.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;Activates a subscription&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> randomItem = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">  cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>).<span class="title function_">eq</span>(randomItem).<span class="title function_">click</span>()</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Activate Subscription&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Subscription was activated&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3><span id="the-loading-time">The loading time</span></h3><p>The first problem we see when running the test is the command <code>cy.get(&#39;[data-cy=customer-item]&#39;)</code> failing.</p>
<p><img src="../images/flakiness-example/e2.png" alt="The test fails to find any items"></p>
<p>The test runner simply did not &quot;see&quot; the subscriptions list in time. To determine it, click on the failed command <code>GET</code> and look at the restored DOM snapshot: the app was still showing the &quot;Loading&quot; message.</p>
<p><img src="../images/flakiness-example/e3.png" alt="The app snapshot at the moment the GET command failed"></p>
<p>But sometimes the test succeeds. If you inspect the same command <code>GET</code> using the time-traveling debugger, instead of &quot;Loading&quot; you see the items.</p>
<p><img src="../images/flakiness-example/e4.png" alt="The app snapshot at the moment the GET command succeeded"></p>
<p>This is test flake: depending on the application&#39;s speed the same command step fails or succeeds. We need to take the maximum loading time into the account. The error message &quot;Timed out retrying after 4000ms: Expected to find element: <code>[data-cy=customer-item]</code>, but never found it.&quot; tells us the solution: we must increase the timeout for the <code>GET</code> command because the application might not show the items until after 11 seconds passed. Let&#39;s fix the test:</p>
<figure class="highlight js"><figcaption><span>customer-subscriptions/cypress/e2e/spec.cy.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>, &#123; <span class="attr">timeout</span>: <span class="number">11_000</span> &#125;)</span><br><span class="line">  .<span class="title function_">eq</span>(randomItem)</span><br><span class="line">  .<span class="title function_">click</span>()</span><br></pre></td></tr></table></figure>

<p>The command now retries for 11 seconds instead of the default 4. You can see the slower progress bar.</p>
<p><img src="../images/flakiness-example/progress.gif" alt="The GET command can retry finding items up to 11 seconds"></p>
<h2><span id="the-number-of-items">The number of items</span></h2><p>Here is the second problem with the test. The application can show between 1 and 6 items. The test picks a random index between 1 and 6. If the test picks an index larger than the random number of items, the test will fail, since there is no such item. We must pick one of the <em>existing</em> items. Filip changed his test to do so:</p>
<figure class="highlight js"><figcaption><span>customer-subscriptions/cypress/e2e/spec.cy.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;Activates a subscription&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>, &#123; <span class="attr">timeout</span>: <span class="number">11_000</span> &#125;)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;length&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">numberOfItems</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> randomItem = <span class="title class_">Cypress</span>.<span class="property">_</span>.<span class="title function_">random</span>(<span class="number">0</span>, numberOfItems - <span class="number">1</span>)</span><br><span class="line">      cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>).<span class="title function_">eq</span>(randomItem).<span class="title function_">click</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Activate Subscription&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Subscription was activated&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote class="pullquote"><p>üí° If you do need to pick a random number between min and max in your Cypress tests, please use the bundled <a target="_blank" rel="noopener" href="https://lodash.com/docs">Lodash</a> function <a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#random">_.random</a>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// instead of this</span></span><br><span class="line"><span class="keyword">let</span> randomItem = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">7</span>)</span><br><span class="line"><span class="comment">// use Cypress._.random function</span></span><br><span class="line"><span class="keyword">const</span> randomItem = <span class="title class_">Cypress</span>.<span class="property">_</span>.<span class="title function_">random</span>(<span class="number">0</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure></blockquote>

<p>The above test is good. I would also print the picked item index to make it very clear which item we are subscribing to. It certainly removes the flake from trying to pick an item that is not there.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">numberOfItems</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> randomItem = <span class="title class_">Cypress</span>.<span class="property">_</span>.<span class="title function_">random</span>(<span class="number">0</span>, numberOfItems - <span class="number">1</span>)</span><br><span class="line">  cy.<span class="title function_">log</span>(<span class="string">`Activating subscription for item #<span class="subst">$&#123;randomItem&#125;</span>`</span>)</span><br><span class="line">  cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>).<span class="title function_">eq</span>(randomItem).<span class="title function_">click</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2><span id="active-subscriptions">Active subscriptions</span></h2><p>The test is less flaky than before but occasionally it still fails. Here is a good example of the failing test:</p>
<p><img src="../images/flakiness-example/e5.png" alt="The test fails to activate the subscription"></p>
<p>We only have one item, so we pick it to activate the subscription. But the item is <em>already</em> active. We cannot click on it to activate again. When picking an item, we must only consider the items that are &quot;trial&quot; or &quot;inactive&quot;.</p>
<p><img src="../images/flakiness-example/e6.png" alt="Can only activate trial or inactive subscriptions"></p>
<p>We can look at the HTML markup to see if the &quot;trial&quot; and &quot;inactive&quot; items have any HTML attributes that we can use to easily query them while omitting the &quot;active&quot; subscriptions.</p>
<p><img src="../images/flakiness-example/e7.png" alt="Subscription items HTML markup"></p>
<p>Hmm, nothing. No biggie, we can add <code>data-status</code> attribute to our <code>SubscriptionItem</code> component.</p>
<figure class="highlight tsx"><figcaption><span>customer-subscriptions/src/components/SubscriptionItem.tsx</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">SubscriptionItem</span>: <span class="title class_">React</span>.<span class="property">FC</span>&lt;<span class="title class_">SubscriptionItemProps</span>&gt; = <span class="function">(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">  subscription,</span></span></span><br><span class="line"><span class="params"><span class="function">  onOpenModal,</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&quot;flex items-center cursor-pointer hover:bg-slate-100 px-4 py-2 rounded-md&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">data-cy</span>=<span class="string">&quot;customer-item&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">data-status</span>=<span class="string">&#123;subscription.status&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> onOpenModal(subscription)&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">    ...</span></span><br></pre></td></tr></table></figure>

<p><strong>Tip:</strong> I use separate <code>data-</code> attribute to pass the status following the advice in my blog post <a href="/blog/no-id-in-test-ids/" title="Do Not Put Ids Into Test Ids">Do Not Put Ids Into Test Ids</a>.</p>
<p>Now our test can be very explicit and only consider the &quot;trial&quot; or &quot;inactive&quot; items by using the <code>OR</code> CSS selector.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cy.<span class="title function_">get</span>(</span><br><span class="line">  <span class="string">&#x27;[data-cy=customer-item][data-status=trial], [data-cy=customer-item][data-status=inactive]&#x27;</span>,</span><br><span class="line">  &#123; <span class="attr">timeout</span>: <span class="number">11_000</span> &#125;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>We can also go the other way and filter out all active subscriptions using the <a target="_blank" rel="noopener" href="https://on.cypress.io/not">cy.not</a> command.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>, &#123; <span class="attr">timeout</span>: <span class="number">11_000</span> &#125;)</span><br><span class="line">  .<span class="title function_">not</span>(<span class="string">&#x27;[data-status=active]&#x27;</span>)</span><br><span class="line">  .<span class="title function_">its</span>(<span class="string">&#x27;length&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">numberOfItems</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> randomItem = <span class="title class_">Cypress</span>.<span class="property">_</span>.<span class="title function_">random</span>(<span class="number">0</span>, numberOfItems - <span class="number">1</span>)</span><br><span class="line">    cy.<span class="title function_">log</span>(<span class="string">`Activating subscription for item #<span class="subst">$&#123;randomItem&#125;</span>`</span>)</span><br><span class="line">    cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>).<span class="title function_">eq</span>(randomItem).<span class="title function_">click</span>()</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>We still have two problems with this test that will cause flake. Do you see them? One is caused by the random data, another by the test design.</p>
<h2><span id="sample-data">Sample data</span></h2><p>Here is the problem caused by the test design. In the failure below we see that we are picking the item number one (zero-based index).</p>
<p><img src="../images/flakiness-example/e8.png" alt="Failed to active the subscription number one"></p>
<p>Hmm, let&#39;s hover over the items we picked initially using <code>cy.get(&#39;[data-cy=customer-item]&#39;, &#123; timeout: 11_000 &#125;).not(&#39;[data-status=active]&#39;)</code> command. Seems we correctly picked 4 subscriptions.</p>
<p><img src="../images/flakiness-example/e9.png" alt="Subscriptions that can be activated"></p>
<p>Now hover over the <code>EQ 1</code> command. Why it picking the already activated subscription that is NOT part of the original four items?</p>
<p><img src="../images/flakiness-example/e10.png" alt="Why is it picking the active subscription to try to activate it?"></p>
<p>Ohhh, we picked the &quot;trial&quot; or &quot;inactive&quot; subscriptions initially to pick the random item index. But then we applied this index to <em>all</em> items</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>, &#123; <span class="attr">timeout</span>: <span class="number">11_000</span> &#125;)</span><br><span class="line">  .<span class="title function_">not</span>(<span class="string">&#x27;[data-status=active]&#x27;</span>)</span><br><span class="line">  .<span class="title function_">its</span>(<span class="string">&#x27;length&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">numberOfItems</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> randomItem = <span class="title class_">Cypress</span>.<span class="property">_</span>.<span class="title function_">random</span>(<span class="number">0</span>, numberOfItems - <span class="number">1</span>)</span><br><span class="line">    cy.<span class="title function_">log</span>(<span class="string">`Activating subscription for item #<span class="subst">$&#123;randomItem&#125;</span>`</span>)</span><br><span class="line">    <span class="comment">// WRONG: we must pick on the of the original items</span></span><br><span class="line">    cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>).<span class="title function_">eq</span>(randomItem).<span class="title function_">click</span>()</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>Let&#39;s fix it. Just apply the same logic to filter items.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;Activates a subscription&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>, &#123; <span class="attr">timeout</span>: <span class="number">11_000</span> &#125;)</span><br><span class="line">    .<span class="title function_">not</span>(<span class="string">&#x27;[data-status=active]&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;length&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">numberOfItems</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> randomItem = <span class="title class_">Cypress</span>.<span class="property">_</span>.<span class="title function_">random</span>(<span class="number">0</span>, numberOfItems - <span class="number">1</span>)</span><br><span class="line">      cy.<span class="title function_">log</span>(<span class="string">`Activating subscription for item #<span class="subst">$&#123;randomItem&#125;</span>`</span>)</span><br><span class="line">      cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>)</span><br><span class="line">        .<span class="title function_">not</span>(<span class="string">&#x27;[data-status=active]&#x27;</span>)</span><br><span class="line">        .<span class="title function_">eq</span>(randomItem)</span><br><span class="line">        .<span class="title function_">click</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Activate Subscription&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Subscription was activated&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>The test works pretty well. But we can express our test even simpler by using my <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-map">cypress-map</a> plugin. Like Lodash, the <code>cypress-map</code> provides a lot of &quot;missing&quot; queries and commands that make Cypress tests much simpler and stable. In our case, we need something like Lodash&#39;s <a target="_blank" rel="noopener" href="https://lodash.com/docs/4.17.15#sample"><code>_.sample</code></a> function.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_.<span class="title function_">sample</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"><span class="comment">// =&gt; 2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><figcaption><span>customer-subscriptions/cypress/e2e/spec.cy.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/bahmutov/cypress-map</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;cypress-map&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;Activates a subscription&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>, &#123; <span class="attr">timeout</span>: <span class="number">11_000</span> &#125;)</span><br><span class="line">    .<span class="title function_">not</span>(<span class="string">&#x27;[data-status=active]&#x27;</span>)</span><br><span class="line">    .<span class="title function_">sample</span>()</span><br><span class="line">    .<span class="title function_">click</span>()</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Activate Subscription&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;Subscription was activated&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="../images/flakiness-example/e11.png" alt="Using cy.sample query command simplifies the test"></p>
<p>Boom. Simple and solid. Almost.</p>
<h2><span id="github-copilot-trick">GitHub Copilot trick</span></h2><p>Here my <strong>#1 tip</strong> for you when writing Cypress tests. I have stated it many many years ago at a <a target="_blank" rel="noopener" href="https://slides.com/bahmutov/well-tested-software">few conference presentations</a>. When writing Cypress tests, write first &quot;directions&quot; to a human user. For example:</p>
<p><img src="../images/flakiness-example/slide.png" alt="List of test steps for a human tester"></p>
<p>Write the steps as comments, telling the tester <em>what</em> to do, but not <em>how</em> to do it. Here are the steps I wrote as comments inside an empty Cypress test</p>
<figure class="highlight js"><figcaption><span>customer-subscriptions/cypress/e2e/spec.cy.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/bahmutov/cypress-map</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;cypress-map&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;Activates a subscription&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  <span class="comment">// get all items with data-cy attribute &quot;customer-item&quot;</span></span><br><span class="line">  <span class="comment">// omit all items with data-status attribute &quot;active&quot;</span></span><br><span class="line">  <span class="comment">// sample an item using cy.sample command</span></span><br><span class="line">  <span class="comment">// click on the item</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Now add an empty line in your VSCode and it should trigger GitHub Copilot. Here is what happens for me:</p>
<p><img src="../images/flakiness-example/co1.png" alt="GitHub Copilot suggest the right Cypress commands"></p>
<p>Nice! Our comments got &quot;translated&quot; into correct Cypress code that even uses the custom <code>cy.sample</code> command from <code>cypress-map</code>. Click &quot;Tab&quot; to accept the suggested code, and we have a passing test.</p>
<p><img src="../images/flakiness-example/co2.png" alt="The AI-generated test passes"></p>
<p>Let&#39;s continue generating our test. Write more user instructions.</p>
<p><img src="../images/flakiness-example/co3.png" alt="There should be a link to activate the subscription"></p>
<p>Then we need to confirm the subscription was activated.</p>
<p><img src="../images/flakiness-example/co4.png" alt="GitHub Copilot suggestion how to check the successfully activated subscription"></p>
<p>The test is complete.</p>
<p><img src="../images/flakiness-example/co5.png" alt="The full generated test"></p>
<p>Not bad, right?</p>
<h2><span id="the-data-edge-case">The data edge case</span></h2><p>Yet, there is one more source of test flake that we did not consider. Sometimes the test fails.</p>
<p><img src="../images/flakiness-example/p1.png" alt="The test can still fail sometimes"></p>
<p>Again, by inspecting the Command Log column, you can see the problem. The test did find items. The test failed to find non-active items, because there all randomly generated subscriptions were &quot;active&quot; already. Our test always assumed there will be some inactive subscriptions, but that is an invalid assumption. We can do <a href="https://glebbahmutov.com/cypress-examples/recipes/conditional-testing.html">conditional testing</a> in Cypress, even if it is an anti-pattern. The simplest way to run testing command only if there are items to be activated is by using my <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cypress-if">cypress-if</a> plugin.</p>
<figure class="highlight js"><figcaption><span>customer-subscriptions/cypress/e2e/spec.cy.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/bahmutov/cypress-map</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;cypress-map&#x27;</span></span><br><span class="line"><span class="comment">// https://github.com/bahmutov/cypress-if</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;cypress-if&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;Activates a subscription&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  <span class="comment">// get all items with data-cy attribute &quot;customer-item&quot;</span></span><br><span class="line">  <span class="comment">// omit all items with data-status attribute &quot;active&quot;</span></span><br><span class="line">  <span class="comment">// sample an item using cy.sample command</span></span><br><span class="line">  <span class="comment">// click on the item</span></span><br><span class="line">  cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>)</span><br><span class="line">    <span class="comment">// the elements are there, the list will not change</span></span><br><span class="line">    <span class="comment">// thus we can set the timeout to 0</span></span><br><span class="line">    <span class="comment">// to quickly move to the next steps</span></span><br><span class="line">    .<span class="title function_">not</span>(<span class="string">&#x27;[data-status=active]&#x27;</span>, &#123; <span class="attr">timeout</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    .<span class="title function_">if</span>(<span class="string">&#x27;exists&#x27;</span>)</span><br><span class="line">    .<span class="title function_">sample</span>()</span><br><span class="line">    .<span class="title function_">click</span>()</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// find the button that contains the text &quot;Activate Subscription&quot;</span></span><br><span class="line">      <span class="comment">// and click on it</span></span><br><span class="line">      cy.<span class="title function_">contains</span>(<span class="string">&#x27;Activate Subscription&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">      <span class="comment">// the page should contain a visible element</span></span><br><span class="line">      <span class="comment">// with text &quot;Subscription was activated&quot;</span></span><br><span class="line">      cy.<span class="title function_">contains</span>(<span class="string">&#x27;Subscription was activated&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">else</span>(<span class="string">&#x27;Could not find inactive subscription&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>If the <code>NOT [data-status=active]</code> command yields no elements, we take the <code>ELSE</code> branch where we simply print the info message.</p>
<p><img src="../images/flakiness-example/else.png" alt="Handle the data case when there are no items to activate"></p>
<h2><span id="control-the-data">Control the data</span></h2><p>Finally, let&#39;s confirm that our code works no matter what the backend sends us. We need to control the data, and the best way is to use <a target="_blank" rel="noopener" href="https://on.cypress.io/intercept">cy.intercept</a> command to stub the loading network call. We can use fixtures of different types: no inactive subscription, one item, a mixture of items to make sure our testing code can handle each possible situation. We can copy the starting response data straight from the browser.</p>
<p><img src="../images/flakiness-example/copy.png" alt="Copy the network response into a JSON fixture file"></p>
<p>The first JSON fixture will have a mixture of items, with &quot;active&quot; items first. This will test the case we discussed in the &quot;Sample data&quot; section above. The index of the inactive item should not accidentally apply to <em>all</em> items.</p>
<figure class="highlight json"><figcaption><span>customer-subscriptions/cypress/fixtures/mixed.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d216125a-426a-40f9-bfa4-03bfd96cff1c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Herman Stark&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Herman15@example.net&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;active&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ff86ef5d-da46-4079-8ac7-44135e399627&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Liliana Parisian&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Liliana_Parisian@example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;active&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4852ee4c-8d75-49de-8d99-fb49cc03318d&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Grover Bartoletti&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Grover.Bartoletti@example.org&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;inactive&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5e4cef59-116c-4f70-8e3f-fd8cf270c0af&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lacy Abshire&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lacy.Abshire@example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;inactive&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3291bea3-71a8-42e0-9199-0240827e58f1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Gia Marvin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Gia_Marvin53@example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;trial&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>Our next fixture will have just an active subscription to test the &quot;ELSE&quot; logic.</p>
<figure class="highlight json"><figcaption><span>customer-subscriptions/cypress/fixtures/active-only.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;d216125a-426a-40f9-bfa4-03bfd96cff1c&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Herman Stark&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Herman15@example.net&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;active&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ff86ef5d-da46-4079-8ac7-44135e399627&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Liliana Parisian&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Liliana_Parisian@example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;active&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>Finally, we want to make sure we test the &quot;trial&quot; items and that they can be activated</p>
<figure class="highlight json"><figcaption><span>customer-subscriptions/cypress/fixtures/trial.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3291bea3-71a8-42e0-9199-0240827e58f1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;fullName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Gia Marvin&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Gia_Marvin53@example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;trial&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>Let&#39;s write the tests. We can refactor the code to avoid the duplication.</p>
<figure class="highlight js"><figcaption><span>customer-subscriptions/cypress/e2e/spec.cy.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/bahmutov/cypress-map</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;cypress-map&#x27;</span></span><br><span class="line"><span class="comment">// https://github.com/bahmutov/cypress-if</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;cypress-if&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">activateOneSubscription</span>(<span class="params"></span>) &#123;</span><br><span class="line">  cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  <span class="comment">// get all items with data-cy attribute &quot;customer-item&quot;</span></span><br><span class="line">  <span class="comment">// omit all items with data-status attribute &quot;active&quot;</span></span><br><span class="line">  <span class="comment">// sample an item using cy.sample command</span></span><br><span class="line">  <span class="comment">// click on the item</span></span><br><span class="line">  cy.<span class="title function_">get</span>(<span class="string">&#x27;[data-cy=customer-item]&#x27;</span>)</span><br><span class="line">    <span class="comment">// the elements are there, the list will not change</span></span><br><span class="line">    <span class="comment">// thus we can set the timeout to 0</span></span><br><span class="line">    <span class="comment">// to quickly move to the next steps</span></span><br><span class="line">    .<span class="title function_">not</span>(<span class="string">&#x27;[data-status=active]&#x27;</span>, &#123; <span class="attr">timeout</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    .<span class="title function_">if</span>(<span class="string">&#x27;exists&#x27;</span>)</span><br><span class="line">    .<span class="title function_">sample</span>()</span><br><span class="line">    .<span class="title function_">click</span>()</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// find the button that contains the text &quot;Activate Subscription&quot;</span></span><br><span class="line">      <span class="comment">// and click on it</span></span><br><span class="line">      cy.<span class="title function_">contains</span>(<span class="string">&#x27;Activate Subscription&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">      <span class="comment">// the page should contain a visible element</span></span><br><span class="line">      <span class="comment">// with text &quot;Subscription was activated&quot;</span></span><br><span class="line">      cy.<span class="title function_">contains</span>(<span class="string">&#x27;Subscription was activated&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">else</span>(<span class="string">&#x27;Could not find inactive subscription&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;Activates a subscription&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">intercept</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/api/subscriptions&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">fixture</span>: <span class="string">&#x27;mixed.json&#x27;</span>,</span><br><span class="line">  &#125;).<span class="title function_">as</span>(<span class="string">&#x27;subscriptions&#x27;</span>)</span><br><span class="line">  <span class="title function_">activateOneSubscription</span>()</span><br><span class="line">  <span class="comment">// confirm the subscription network call happened</span></span><br><span class="line">  cy.<span class="title function_">wait</span>(<span class="string">&#x27;@subscriptions&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;Activates a trial subscription&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">intercept</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/api/subscriptions&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">fixture</span>: <span class="string">&#x27;trial.json&#x27;</span>,</span><br><span class="line">  &#125;).<span class="title function_">as</span>(<span class="string">&#x27;subscriptions&#x27;</span>)</span><br><span class="line">  <span class="title function_">activateOneSubscription</span>()</span><br><span class="line">  <span class="comment">// confirm the subscription network call happened</span></span><br><span class="line">  cy.<span class="title function_">wait</span>(<span class="string">&#x27;@subscriptions&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;Does not activate an active subscription&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">intercept</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/api/subscriptions&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">fixture</span>: <span class="string">&#x27;active-only.json&#x27;</span>,</span><br><span class="line">  &#125;).<span class="title function_">as</span>(<span class="string">&#x27;subscriptions&#x27;</span>)</span><br><span class="line">  <span class="title function_">activateOneSubscription</span>()</span><br><span class="line">  <span class="comment">// confirm the subscription network call happened</span></span><br><span class="line">  cy.<span class="title function_">wait</span>(<span class="string">&#x27;@subscriptions&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="../images/flakiness-example/full.png" alt="Three different tests use different data to confirm our logic works"></p>
<h2><span id="response-data-changes">Response data changes</span></h2><p>When using a network stub there is a danger that the server changes its response and our tests don&#39;t catch it. We can prevent this by adding a quick API test or a spy E2E test. Since we only want to ensure the properties &#x2F; types of the objects in the response, I recommend using my <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cy-spok">cy-spok</a> plugin.</p>
<h3><span id="api-test">API test</span></h3><p>In this test we will make a network call ourselves using the <a target="_blank" rel="noopener" href="https://on.cypress.io/request">cy.request</a> command and will validate the response. The response should be an array, and we can validate the first object using the built-in assertions plus <code>spok</code> property predicates.</p>
<figure class="highlight js"><figcaption><span>customer-subscriptions/cypress/e2e/api.cy.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spok <span class="keyword">from</span> <span class="string">&#x27;cy-spok&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isStatus</span> = (<span class="params">s</span>) =&gt;</span><br><span class="line">  s === <span class="string">&#x27;active&#x27;</span> || s === <span class="string">&#x27;inactive&#x27;</span> || s === <span class="string">&#x27;trial&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;responds with a subscription object&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;/api/subscriptions/&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;be.an&#x27;</span>, <span class="string">&#x27;array&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="number">0</span>, &#123; <span class="attr">timeout</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    <span class="comment">// confirm each item can only have these properties</span></span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;have.keys&#x27;</span>, [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;fullName&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;status&#x27;</span>])</span><br><span class="line">    <span class="comment">// use cy-spok to check the types of each property</span></span><br><span class="line">    .<span class="title function_">and</span>(</span><br><span class="line">      <span class="title function_">spok</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: spok.<span class="property">string</span>,</span><br><span class="line">        <span class="attr">fullName</span>: spok.<span class="property">string</span>,</span><br><span class="line">        <span class="attr">email</span>: spok.<span class="property">string</span>,</span><br><span class="line">        <span class="attr">status</span>: isStatus,</span><br><span class="line">      &#125;),</span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>There is no web page in this test, since we never called <code>cy.visit</code>. Instead we simply see the assertions in the Command Log.</p>
<p><img src="../images/flakiness-example/api.png" alt="The API test confirms the server response schema"></p>
<h3><span id="network-spy-test">Network spy test</span></h3><p>Sometimes it is hard to make a valid request from the test: the format of the call might be complicated, plus require authentication. It might be easier to just spy on the call made by the application. The same logic applies.</p>
<figure class="highlight js"><figcaption><span>customer-subscriptions/cypress/e2e/spy.cy.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> spok <span class="keyword">from</span> <span class="string">&#x27;cy-spok&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isStatus</span> = (<span class="params">s</span>) =&gt;</span><br><span class="line">  s === <span class="string">&#x27;active&#x27;</span> || s === <span class="string">&#x27;inactive&#x27;</span> || s === <span class="string">&#x27;trial&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;spies on the server response&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// set up the network spy before the page loads</span></span><br><span class="line">  cy.<span class="title function_">intercept</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/api/subscriptions&#x27;</span>).<span class="title function_">as</span>(<span class="string">&#x27;subscriptions&#x27;</span>)</span><br><span class="line">  cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  cy.<span class="title function_">wait</span>(<span class="string">&#x27;@subscriptions&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;response.body&#x27;</span>)</span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;be.an&#x27;</span>, <span class="string">&#x27;array&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="number">0</span>, &#123; <span class="attr">timeout</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    <span class="comment">// confirm each item can only have these properties</span></span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;have.keys&#x27;</span>, [<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;fullName&#x27;</span>, <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;status&#x27;</span>])</span><br><span class="line">    <span class="comment">// use cy-spok to check the types of each property</span></span><br><span class="line">    .<span class="title function_">and</span>(</span><br><span class="line">      <span class="title function_">spok</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: spok.<span class="property">string</span>,</span><br><span class="line">        <span class="attr">fullName</span>: spok.<span class="property">string</span>,</span><br><span class="line">        <span class="attr">email</span>: spok.<span class="property">string</span>,</span><br><span class="line">        <span class="attr">status</span>: isStatus,</span><br><span class="line">      &#125;),</span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="../images/flakiness-example/spy-test.png" alt="Spying on the network call to confirm its schema"></p>
<p>Beautiful.</p>
<blockquote class="pullquote"><p>üéì In this blog post I used a lot of Cypress plugins. If you want to learn them better, I have an online hands-on course <a target="_blank" rel="noopener" href="https://cypress.tips/courses/cypress-plugins">Cypress Plugins</a>. You can also level up your network testing by taking my <a target="_blank" rel="noopener" href="https://cypress.tips/courses/network-testing">Cypress Network Testing Exercises</a> course.</p>
</blockquote>

<h2><span id="see-also">See also</span></h2><ul>
<li><a href="/blog/flaky-cy-type/" title="Solve Flake In Cypress Typing Into An Input Element">Solve Flake In Cypress Typing Into An Input Element</a></li>
<li><a href="/blog/cypress-flaky-tests-exercises/" title="Cypress Flaky Tests Exercises">Cypress Flaky Tests Exercises</a></li>
<li><a href="/blog/repeat-to-fight-flake/" title="Repeat Test to Fight Flake">Repeat Test to Fight Flake</a></li>
</ul>

      
    </div>

    
      <footer class="article-footer personal-links">
  <p>
    Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
    see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
    watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
    browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
  </p>
  <p>
    Want to know more about Cypress? Check out <a href="https://cypress.tips" target="_blank">cypress.tips</a>
  </p>
  <p>
    Have a Cypress question? Want me to answer it? Consider supporting me via <a target="_blank" rel="noopener" href="https://github.com/sponsors/bahmutov">GitHub Sponsors</a> or by purchasing my <a target="_blank" rel="noopener" href="https://cypress.tips/courses">Cypress courses</a>.
  </p>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/flakiness-example/" data-id="cm2eq08rc00a2iyn7djmsdtoy" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/flakiness-example/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/" rel="tag">cypress</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/testing/" rel="tag">testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../use-cypress-for-api-testing/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Use Cypress For API Testing
        
      </div>
    </a>
  
  
    <a href="../check-broken-images/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Check Broken Images Using Cypress</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">173</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">579</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">120</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angular/" rel="tag">angular</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">35</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">16</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">330</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/email/" rel="tag">email</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">70</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">42</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">166</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">85</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">198</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.34px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.38px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.69px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.97px;">advice</a> <a href="../tags/algolia/" style="font-size: 10.69px;">algolia</a> <a href="../tags/angular/" style="font-size: 10.69px;">angular</a> <a href="../tags/angularjs/" style="font-size: 17.93px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 12.76px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.41px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 14.48px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.52px;">browser</a> <a href="../tags/ci/" style="font-size: 17.24px;">ci</a> <a href="../tags/circle/" style="font-size: 14.48px;">circle</a> <a href="../tags/climate/" style="font-size: 15.17px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 15.17px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.07px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 20px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 14.14px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.69px;">d3</a> <a href="../tags/db/" style="font-size: 14.14px;">db</a> <a href="../tags/docker/" style="font-size: 13.79px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.72px;">documentation</a> <a href="../tags/email/" style="font-size: 10.69px;">email</a> <a href="../tags/es6/" style="font-size: 14.14px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.28px;">functional</a> <a href="../tags/generators/" style="font-size: 11.38px;">generators</a> <a href="../tags/git/" style="font-size: 14.83px;">git</a> <a href="../tags/github/" style="font-size: 17.59px;">github</a> <a href="../tags/graphql/" style="font-size: 11.38px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.07px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.69px;">gulp</a> <a href="../tags/hiring/" style="font-size: 11.38px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.07px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.38px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.69px;">interview</a> <a href="../tags/jade/" style="font-size: 11.03px;">jade</a> <a href="../tags/javascript/" style="font-size: 19.31px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.69px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.45px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 16.21px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.03px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.62px;">nodejs</a> <a href="../tags/performance/" style="font-size: 15.86px;">performance</a> <a href="../tags/presentation/" style="font-size: 12.07px;">presentation</a> <a href="../tags/promises/" style="font-size: 16.9px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.34px;">proposal</a> <a href="../tags/ramda/" style="font-size: 16.21px;">ramda</a> <a href="../tags/react/" style="font-size: 12.07px;">react</a> <a href="../tags/react-native/" style="font-size: 11.72px;">react native</a> <a href="../tags/reactive/" style="font-size: 13.79px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.38px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.38px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 13.45px;">security</a> <a href="../tags/sentry/" style="font-size: 13.45px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.72px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.66px;">testing</a> <a href="../tags/tutorial/" style="font-size: 16.55px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 12.76px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.34px;">ui</a> <a href="../tags/vercel/" style="font-size: 13.1px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.38px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.38px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.72px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.69px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2024/10/">October 2024</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2024/09/">September 2024</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2024/08/">August 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2024/07/">July 2024</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2024/06/">June 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2024/04/">April 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2024/03/">March 2024</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2024/02/">February 2024</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2024/01/">January 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/12/">December 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/11/">November 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/10/">October 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/09/">September 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/08/">August 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/07/">July 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/06/">June 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/05/">May 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/04/">April 2023</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/03/">March 2023</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/02/">February 2023</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2023/01/">January 2023</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/12/">December 2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/11/">November 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/10/">October 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/09/">September 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/08/">August 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/07/">July 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/06/">June 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/05/">May 2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/04/">April 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/03/">March 2022</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/02/">February 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/01/">January 2022</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/12/">December 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/11/">November 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/10/">October 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/09/">September 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/08/">August 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../cypress-namespaces/">Cypress Namespaces For Custom Commands</a>
          </li>
        
          <li>
            <a href="../election-2024/">I Endorse Kamala Harris For US President</a>
          </li>
        
          <li>
            <a href="../cypress-local-storage/">Cypress Local Storage Example</a>
          </li>
        
          <li>
            <a href="../cypress-env-types/">Cypress Env Types</a>
          </li>
        
          <li>
            <a href="../test-print-styles/">Testing CSS Print Media Styles</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/flakiness-example/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
