<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Testing Angular application via App Actions | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="You can find the entire source code for this example at bahmutov&#x2F;angular-heroes-app-actions. IntroductionIn my previous blog posts I have shown how end-to-end tests do not always have to go through th">
<meta property="og:type" content="article">
<meta property="og:title" content="Testing Angular application via App Actions">
<meta property="og:url" content="https://glebbahmutov.com/blog/testing-angular-application-via-app-actions/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="You can find the entire source code for this example at bahmutov&#x2F;angular-heroes-app-actions. IntroductionIn my previous blog posts I have shown how end-to-end tests do not always have to go through th">
<meta property="og:locale">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/delete-and-reload.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/heroes-component.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/after-clear.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/app-ref-tick.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/multiple-click.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/clear-heroes.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/cannot-find-new-hero.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/click-clear.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/retry-length-plus-1.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/resolve.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/window-prop.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/appref.gif">
<meta property="article:published_time" content="2019-09-14T04:00:00.000Z">
<meta property="article:modified_time" content="2021-06-15T13:13:30.365Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="testing">
<meta property="article:tag" content="cypress">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/angular-app-actions/delete-and-reload.gif">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-testing-angular-application-via-app-actions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2019-09-14T04:00:00.000Z" itemprop="datePublished">Sep 14 2019</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/process/">process</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Testing Angular application via App Actions
    </h1>

    <h2 class="article-title" itemprop="name">
      How to bypass user interface to directly dispatch actions to Angular 8 application from Cypress end-to-end tests.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>You can find the entire source code for this example at <a target="_blank" rel="noopener" href="https://github.com/bahmutov/angular-heroes-app-actions">bahmutov/angular-heroes-app-actions</a>.</p>
<h2><span id="introduction">Introduction</span></h2><p>In my previous blog posts I have shown how end-to-end tests do not always have to go through the user interface to interact with the application <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2019/01/03/stop-using-page-objects-and-start-using-app-actions/">1</a>, <a href="../realworld-app-action/">2</a>, <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2019/02/28/shrink-the-untestable-code-with-app-actions-and-effects/">3</a>. Those examples used Vue, React and Overmind.js front-end libraries. In this blog post I will show how to access application state directly from the test code for Angular 8 application. We will access the state both to make assertions against it during test, and to dispatch actions against it. This allows us to be both quick and build our tests on top of the component&#39;s API, not on top of the page DOM.</p>
<!-- toc -->
<ul>
<li><a href="#regular-test">Regular test</a></li>
<li><a href="#exposing-heroes-component">Exposing Heroes component</a></li>
<li><a href="#asserting-application-state">Asserting application state</a></li>
<li><a href="#changing-data-inside-the-component">Changing data inside the component</a></li>
<li><a href="#triggering-application-update">Triggering application update</a></li>
<li><a href="#tests-using-app-actions">Tests using app actions</a><ul>
<li><a href="#avoid-setup-using-ui">Avoid setup using UI</a></li>
<li><a href="#prefer-controlling-app-directly">Prefer controlling app directly</a></li>
<li><a href="#avoiding-race-conditions">Avoiding race conditions</a></li>
</ul>
</li>
<li><a href="#fixing-typescript">Fixing TypeScript</a></li>
<li><a href="#conclusions">Conclusions</a><ul>
<li><a href="#see-more">See more</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h2><span id="regular-test">Regular test</span></h2><p>But first, let me give an example of a &quot;normal&quot; end-to-end test. We will write these tests first to cover individual features of the app, simulating the behavior of a normal human user. Let&#39;s take a user story like this</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- user goes to /heroes view</span><br><span class="line">- user sees list of heroes</span><br><span class="line">- &quot;Dr Nice&quot; is at the top of the list</span><br><span class="line">- user does not like &quot;Dr Nice&quot; and deletes him from the list</span><br><span class="line">- &quot;Dr Nice&quot; is gone</span><br><span class="line">- when the user reloads the page, &quot;Dr Nice&quot; appears again</span><br></pre></td></tr></table></figure>
<p>Here is the corresponding Cypress test, reading almost as naturally as the English sentences above.</p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;Returns deleted hero after reload&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;ul.heroes li&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">    .first().should(<span class="string">&#x27;include.text&#x27;</span>, <span class="string">&#x27;Dr Nice&#x27;</span>)</span><br><span class="line">    .find(<span class="string">&#x27;.delete&#x27;</span>).click()</span><br><span class="line">  cy.get(<span class="string">&#x27;ul.heroes li&#x27;</span>)</span><br><span class="line">    .should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">9</span>).and(<span class="string">&#x27;not.include.text&#x27;</span>, <span class="string">&#x27;Dr Nice&#x27;</span>)</span><br><span class="line">  cy.reload()</span><br><span class="line">  <span class="comment">// Dr Nice is back</span></span><br><span class="line">  cy.get(<span class="string">&#x27;ul.heroes li&#x27;</span>)</span><br><span class="line">    .should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">    .first().should(<span class="string">&#x27;include.text&#x27;</span>, <span class="string">&#x27;Dr Nice&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/angular-app-actions/delete-and-reload.gif" alt="Deleting a hero and reloading the page test"></p>
<p>This test uses the application through the user interface and confirms the &quot;delete&quot; behavior. We now that the UI element <code>&lt;button class=&quot;delete&quot;&gt;</code> is really working. Let&#39;s never press it again.</p>
<p>When writing other tests, we can bypass clicking on &quot;Delete&quot; button, instead we can call the underlying component&#39;s &quot;delete&quot; method. This will allow us to build up better application&#39;s internal API, which are public methods in each component, rather than try to come up with a page object that encapsulates <code>cy.find(&#39;.delete&#39;).click()</code> commands.</p>
<p>But first we will need to somehow expose a reference to a component we want to control, so our test can even get to the component.</p>
<h2><span id="exposing-heroes-component">Exposing Heroes component</span></h2><p>To reach inside the application from our test, we need to pass a reference to a component or service from the app to the spec. The easiest way to do this is by attaching the reference to the <code>window</code> object. Let&#39;s pass reference to the Heroes component.</p>
<figure class="highlight ts"><figcaption><span>heroes.component.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">&#x27;app-heroes&#x27;</span>,</span><br><span class="line">  templateUrl: <span class="string">&#x27;./heroes.component.html&#x27;</span>,</span><br><span class="line">  styleUrls: [<span class="string">&#x27;./heroes.component.css&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroesComponent</span> <span class="title">implements</span> <span class="title">OnInit</span> </span>&#123;</span><br><span class="line">  heroes: Hero[];</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> heroService: HeroService</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.Cypress) &#123;</span><br><span class="line">      <span class="comment">// @ts-ignore</span></span><br><span class="line">      <span class="built_in">window</span>.HeroesComponent = <span class="built_in">this</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// the rest of the component</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If our application is running inside Cypress tests, we will set <code>window.HeroesComponent</code>. Notice <code>// @ts-ignore</code> directives - I need to use them because normally <code>window</code> object has neither <code>Cypress</code>, nor <code>HeroesComponent</code> property. The beauty of TypeScript. We will fix this later.</p>
<p>From our tests, we can reach into the application&#39;s <code>window</code> and use the property <code>HeroesComponent</code> <em>when it gets set</em>. We will do this via assertions taking advantage of <a target="_blank" rel="noopener" href="https://on.cypress.io/retry-ability">retry-ability</a>. Imagine the <code>window</code> starting without <code>HeroesComponent</code> and we want to wait until the property gets set. We need to use <code>should</code> assertion - it will get retried and retried until our application starts and <code>window.HeroesComponent = this</code> is executed.</p>
<figure class="highlight js"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;sets reference to HeroesComponent&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  cy.window()</span><br><span class="line">    .should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;HeroesComponent&#x27;</span>) <span class="comment">// yields window.HeroesComponent</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The assertion &quot;have.property&quot; automatically yields that property to the next command in the chain. Thus we can check and assert the number of heroes initially.</p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;starts with 10 heroes&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  cy.window()</span><br><span class="line">    .should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;HeroesComponent&#x27;</span>) <span class="comment">// yields window.HeroesComponent</span></span><br><span class="line">    .should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;heroes&#x27;</span>) <span class="comment">// yields window.HeroesComponent.heroes array</span></span><br><span class="line">    .should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>If you click on any <code>SHOULD</code> command in the Command Log on the left, the yielded object will be printed to the DevTools console. You can see what the application state was at each step, which makes it simple to understand the test and application behavior.</p>
<p><img src="/blog/images/angular-app-actions/heroes-component.png" alt="The HeroesComponent"></p>
<p>It is a good idea to factor out the access to the application&#39;s component into a utility function for reuse.</p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getHeroesComponent = <span class="function">() =&gt;</span></span><br><span class="line">  cy.window()</span><br><span class="line">    .should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;HeroesComponent&#x27;</span>) <span class="comment">// yields window.HeroesComponent</span></span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;starts with 10 heroes&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  getHeroesComponent()</span><br><span class="line">    .should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;heroes&#x27;</span>) <span class="comment">// yields window.HeroesComponent.heroes array</span></span><br><span class="line">    .should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Or if you prefer to a custom command</p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Cypress.Commands.add(<span class="string">&#x27;getHeroesComponent&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">   <span class="comment">// yields window.HeroesComponent</span></span><br><span class="line">  <span class="keyword">return</span> cy.window().should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;HeroesComponent&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;starts with 10 heroes (custom command)&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  cy.getHeroesComponent()</span><br><span class="line">    .should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;heroes&#x27;</span>) <span class="comment">// yields window.HeroesComponent.heroes array</span></span><br><span class="line">    .should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>I am not a big fan of custom commands, because at least in TypeScript specs you need to either add <code>// @ts-ignore</code> or have a separate TS files that extends <code>cy</code> with new commands, see <a target="_blank" rel="noopener" href="https://on.cypress.io/typescript">Cypress TypeScript page</a>.</p>
<h2><span id="asserting-application-state">Asserting application state</span></h2><p>Let&#39;s use the reference to the component to check its state. We will take the same test as before and will add a few more assertions to confirm the first hero in the list before and after &quot;delete&quot;, and after page reload.</p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;Returns deleted hero after reload - with assertions against data&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  <span class="comment">// confirm the data in the component</span></span><br><span class="line">  getHeroes().should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    .its(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    .should(<span class="string">&#x27;deep.equal&#x27;</span>, &#123;</span><br><span class="line">      id: <span class="number">11</span>,</span><br><span class="line">      name: <span class="string">&#x27;Dr Nice&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  <span class="comment">// confirm the UI</span></span><br><span class="line">  cy.get(<span class="string">&#x27;ul.heroes li&#x27;</span>).should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">    .first().should(<span class="string">&#x27;include.text&#x27;</span>, <span class="string">&#x27;Dr Nice&#x27;</span>)</span><br><span class="line">    .find(<span class="string">&#x27;.delete&#x27;</span>).click()</span><br><span class="line">  cy.get(<span class="string">&#x27;ul.heroes li&#x27;</span>)</span><br><span class="line">    .should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">9</span>).and(<span class="string">&#x27;not.include.text&#x27;</span>, <span class="string">&#x27;Dr Nice&#x27;</span>)</span><br><span class="line">  <span class="comment">// confirm the data in the component</span></span><br><span class="line">  getHeroes()</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    .its(<span class="string">&#x27;0&#x27;</span>).should(<span class="string">&#x27;deep.equal&#x27;</span>, &#123;</span><br><span class="line">      id: <span class="number">12</span>,</span><br><span class="line">      name: <span class="string">&#x27;Narco&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  cy.reload()</span><br><span class="line">  <span class="comment">// Dr Nice is back</span></span><br><span class="line">  cy.get(<span class="string">&#x27;ul.heroes li&#x27;</span>)</span><br><span class="line">    .should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">    .first().should(<span class="string">&#x27;include.text&#x27;</span>, <span class="string">&#x27;Dr Nice&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Having assertions against the internal application data ties your tests to the implementation, so judge if it is necessary yourself. If the application&#39;s implementation has reached maturity, and won&#39;t change much in the future, it is probably ok, as it allows you to lock down the internal data details.</p>
<h2><span id="changing-data-inside-the-component">Changing data inside the component</span></h2><p>We know how to access data inside a component, now let&#39;s change it. Let&#39;s set the number of heroes to zero for example.</p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;sets zero heroes&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  cy.getHeroesComponent()</span><br><span class="line">    .should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;heroes&#x27;</span>) <span class="comment">// yields window.HeroesComponent.heroes array</span></span><br><span class="line">    .should(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">10</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">heroes</span> =&gt;</span> &#123;</span><br><span class="line">      heroes.length = <span class="number">0</span></span><br><span class="line">      cy.log(<span class="string">&#x27;cleared heroes&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Hmm, the test claims that is has cleared the list of heroes, but the app still shows all of them.</p>
<p><img src="/blog/images/angular-app-actions/after-clear.png" alt="Application still shows all heroes"></p>
<h2><span id="triggering-application-update">Triggering application update</span></h2><p>So far we have changed the data inside the application, yet the user interface does not refresh - the application has no idea that it needs to re-render. Let&#39;s force the update. To do this, we need to get a reference to <a target="_blank" rel="noopener" href="https://angular.io/api/core/ApplicationRef">ApplicationRef</a> instance, so we can call <a target="_blank" rel="noopener" href="https://angular.io/api/core/ApplicationRef#tick"><code>appRef.tick()</code></a> method.</p>
<p>In order to do this, we will change how the application bootstraps in <code>app.module.ts</code>. Usually we just list component to be bootstrapped like this:</p>
<figure class="highlight ts"><figcaption><span>app.module.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NgModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; AppComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.component&#x27;</span></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  bootstrap: [ AppComponent ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>But we will implement the bootstrap interface <a target="_blank" rel="noopener" href="https://angular.io/api/core/DoBootstrap">DoBootstrap</a> ourselves - because the callback gets the <code>ApplicationRef</code> argument we want to access later. Here is the small change.</p>
<figure class="highlight ts"><figcaption><span>app.module.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NgModule, DoBootstrap, ApplicationRef &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; AppComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.component&#x27;</span></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  <span class="comment">// instead of elements to bootstrap</span></span><br><span class="line">  <span class="comment">// just put app component in the entry components list</span></span><br><span class="line">  entryComponents: [AppComponent]</span><br><span class="line">  <span class="comment">// and remove the &quot;bootstrap&quot; property</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule</span> <span class="title">implements</span> <span class="title">DoBootstrap</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">ngDoBootstrap</span>(<span class="params">appRef: ApplicationRef</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// bootstrap AppComponent ourselves</span></span><br><span class="line">    appRef.bootstrap(AppComponent)</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.Cypress) &#123;</span><br><span class="line">      <span class="comment">// and save the application reference!</span></span><br><span class="line">      <span class="comment">// @ts-ignore</span></span><br><span class="line">      <span class="built_in">window</span>.appRef = appRef</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now we can force the application re-render from the DevTools console.</p>
<p><img src="/blog/images/angular-app-actions/app-ref-tick.gif" alt="Using application reference tick to re-render DOM"></p>
<p>If we can control our application from DevTools console, we can control it from Cypress - it is just JavaScript.</p>
<h2><span id="tests-using-app-actions">Tests using app actions</span></h2><h3><span id="avoid-setup-using-ui">Avoid setup using UI</span></h3><p>What happens when there are no heroes and the user does a search? Let&#39;s test it. Our test needs to delete all heroes from the app and then search. Hmm, deleting heroes is complicated because we don&#39;t know how many heroes the application loads. Of course Cypress has a way to click multiple buttons like this</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;deletes all heroes through UI&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  <span class="comment">// confirm the heroes have loaded and select &quot;delete&quot; buttons</span></span><br><span class="line">  cy.get(<span class="string">&#x27;ul.heroes li button.delete&#x27;</span>)</span><br><span class="line">    .should(<span class="string">&#x27;have.length.gt&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="comment">// and delete all heroes</span></span><br><span class="line">    .click(&#123; <span class="attr">multiple</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>This works, because our application shows ALL items on the same page. Cypress just licks each delete button one by one.</p>
<p><img src="/blog/images/angular-app-actions/multiple-click.gif" alt="Deleting Heroes by clicking"></p>
<p>But I advise against this type of test, because in general a test that performs a variable number of steps is prone to be flaky and hard to understand and debug in the future. We call such tests <a target="_blank" rel="noopener" href="https://on.cypress.io/conditional-testing">non-deterministic</a> and advise against them. The test should always follow the same scenario - it should prepare the data beforehand to always follow the same path.</p>
<p>Imagine our application changes, and starts with zero heroes. The test will FAIL because it cannot click zero delete buttons! Imagine the test starts with 100 heroes. The test will take a long time just to delete a hundred items by clicking a hundred buttons. What if the application paginates the list? Deleting of heroes through the user interface suddenly becomes a hard problem by itself, and any test that needs to have zero heroes becomes flaky and complicated.</p>
<h3><span id="prefer-controlling-app-directly">Prefer controlling app directly</span></h3><p>There is a better way.</p>
<p>Let&#39;s avoid the unknown number of clicks problem. We can clear the list by reaching inside the application and just setting the length of list of heroes to zero.</p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getHeroesComponent = <span class="function">() =&gt;</span></span><br><span class="line">  cy.window()</span><br><span class="line">    .should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;HeroesComponent&#x27;</span>) <span class="comment">// yields window.HeroesComponent</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * yields window.HeroesComponent.heroes array</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> *  // starts with 10 heroes</span></span><br><span class="line"><span class="comment"> *  cy.visit(&#x27;/heroes&#x27;).should(&#x27;have.length&#x27;, 10)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getHeroes = <span class="function">() =&gt;</span></span><br><span class="line">  getHeroesComponent().should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;heroes&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sets the length of heroes array to 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> clearHeroes = <span class="function">() =&gt;</span></span><br><span class="line">  getHeroes()</span><br><span class="line">    .then(<span class="function"><span class="params">heroes</span> =&gt;</span> &#123;</span><br><span class="line">      cy.log(<span class="string">`clearing <span class="subst">$&#123;heroes.length&#125;</span> heroes`</span>)</span><br><span class="line">      <span class="comment">// @ts-ignore</span></span><br><span class="line">      heroes.length = <span class="number">0</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;deletes all heroes through app action&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  <span class="comment">// confirm the heroes have loaded - because the array has items</span></span><br><span class="line">  getHeroes().should(<span class="string">&#x27;have.length.gt&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">  clearHeroes()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Great, we are settings <code>heroes.length</code> to zero, we need to re-render the application, right. So let&#39;s add <code>appRef.tick()</code> call. We will add utility function to access <code>window.appRef</code> and then to call <code>tick</code> method.</p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getAppRef = <span class="function">() =&gt;</span></span><br><span class="line">  cy.window().should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;appRef&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calls `appRef.tick()` to force UI refresh</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> tick = <span class="function">() =&gt;</span></span><br><span class="line">  getAppRef()</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    .invoke(<span class="string">&#x27;tick&#x27;</span>)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;deletes all heroes through app action&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  <span class="comment">// confirm the heroes have loaded - because the array has items</span></span><br><span class="line">  getHeroes().should(<span class="string">&#x27;have.length.gt&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">  clearHeroes()</span><br><span class="line">  tick()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test passes.</p>
<p><img src="/blog/images/angular-app-actions/clear-heroes.gif" alt="Deleting Heroes by app action"></p>
<p>There is nothing non-deterministic about this test. It will just work, assuming the initial list has more than zero items. It is also faster that going through the DOM, although in this case the difference is small in absolute terms - 1 second vs 2 seconds.</p>
<h3><span id="avoiding-race-conditions">Avoiding race conditions</span></h3><p>Let&#39;s extend the test. After clearing the list of heroes using app action, let&#39;s add a new hero, again using an app action and then confirm the new hero shows up in the UI. We are using the same helper functions plus a new one - <code>addHero</code></p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds a new hero.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> addHero = <span class="function">(<span class="params">name: <span class="built_in">string</span></span>) =&gt;</span></span><br><span class="line">  cy.window()</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    .its(<span class="string">&#x27;HeroesComponent&#x27;</span>)</span><br><span class="line">    .invoke(<span class="string">&#x27;add&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;shows new hero&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  clearHeroes()</span><br><span class="line">  tick()</span><br><span class="line"></span><br><span class="line">  addHero(<span class="string">&#x27;Gleb&#x27;</span>) <span class="comment">// the world needs a new hero</span></span><br><span class="line">  tick()</span><br><span class="line">  cy.contains(<span class="string">&#x27;.heroes li&#x27;</span>, <span class="string">&#x27;Gleb&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Ohhh, the test fails, guess I am no hero.</p>
<p><img src="/blog/images/angular-app-actions/cannot-find-new-hero.png" alt="The new hero does not appear"></p>
<p>Hmm, there is something weird going on. The list has been cleared, and the UI has refreshed after that. But where is the new hero? Even more suspicious is an observation that if while the <code>cy.contains</code> command is spinning trying to find the new text, I click &quot;Clear&quot; button, the new record suddenly appears, and the test passes.</p>
<p><img src="/blog/images/angular-app-actions/click-clear.gif" alt="Clicking clear suddenly brings the new record to UI"></p>
<p>Seems like our <code>tick()</code> action did NOT refresh the user interface after adding a new item, yet it did work when clearing the list of heroes. What is the difference between the two actions? Let&#39;s look at the code.</p>
<p>When we are clearing heroes, we are just setting <code>heroes.length = 0</code>. This is a synchronous action, thus when the test executes <code>tick()</code> the list has zero items. But the <code>addHero</code> app action calls the following code in the component:</p>
<figure class="highlight ts"><figcaption><span>heroes.component.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">add</span>(<span class="params">name: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">  name = name.trim();</span><br><span class="line">  <span class="keyword">if</span> (!name) &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">  <span class="built_in">this</span>.heroService.addHero(&#123; name &#125; <span class="keyword">as</span> Hero)</span><br><span class="line">  .subscribe(<span class="function"><span class="params">hero</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.heroes.push(hero);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Hmm, there is an Observable there - this is an asynchronous method, and if we call <code>tick()</code> from the test ... which runs in the same event loop as the application code, we refresh the UI <em>before</em> the asynchronous <code>subscribe</code> callback even runs! We have a race condition between the test calling <code>tick()</code> and calling application code.</p>
<p>We can try solving this problem in several ways, depending on how much we can modify our application code or slow down our tests.</p>
<ol>
<li>Add delays to app actions that involve asynchronous application methods. For example <code>addName</code> test function can just delay the next test command.</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> addHero = <span class="function">(<span class="params">name: string</span>) =&gt;</span></span><br><span class="line">  cy.window()</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    .its(<span class="string">&#x27;HeroesComponent&#x27;</span>)</span><br><span class="line">    .invoke(<span class="string">&#x27;add&#x27;</span>, name)</span><br><span class="line">    .wait(<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<p>Ughh, waiting an entire second? Might be too slow for the interactive mode when Cypress is running locally, yet not enough for running tests on CI, leading to flaky tests.</p>
<ol start="2">
<li>Wait until the heroes list increases its length by 1, which means the application code has finished running <code>this.heroes.push(hero)</code>. Here is how to save the initial length of array, then call app action, then use <code>should(cb)</code> to retry until the array gets an extra item.</li>
</ol>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds a new hero. Waits for number of heroes to increase by 1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> addHero = <span class="function">(<span class="params">name: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// first, save the number of items in the list</span></span><br><span class="line">  <span class="comment">// save under alias &quot;n&quot;, available in the test context &quot;this.n&quot;</span></span><br><span class="line">  getHeroes().its(<span class="string">&#x27;length&#x27;</span>).as(<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line">  cy.window()</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    .its(<span class="string">&#x27;HeroesComponent&#x27;</span>)</span><br><span class="line">    .invoke(<span class="string">&#x27;add&#x27;</span>, name)</span><br><span class="line">  <span class="comment">// now retry reading &quot;heroes&quot; array until its length has increased by 1</span></span><br><span class="line">  getHeroes().should(<span class="function"><span class="keyword">function</span> (<span class="params">heroes</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// use &quot;function () &#123;...&#125;&quot; callback to make sure</span></span><br><span class="line">    <span class="comment">// &quot;this&quot; points at the test context</span></span><br><span class="line">    <span class="comment">// and we can access previously saved alias &quot;n&quot;</span></span><br><span class="line">    expect(heroes).to.have.length(<span class="built_in">this</span>.n + <span class="number">1</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;shows new hero&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  clearHeroes()</span><br><span class="line">  tick()</span><br><span class="line"></span><br><span class="line">  addHero(<span class="string">&#x27;Gleb&#x27;</span>) <span class="comment">// the world needs a new hero</span></span><br><span class="line">  tick()</span><br><span class="line">  cy.contains(<span class="string">&#x27;.heroes li&#x27;</span>, <span class="string">&#x27;Gleb&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test works, and it is as fast it can be.</p>
<p><img src="/blog/images/angular-app-actions/retry-length-plus-1.png" alt="Waiting until array increases its length by one"></p>
<ol start="3">
<li>Refactor application code to signal when its data has finished updating. Simply, let&#39;s return a promise from component&#39;s method <code>addName</code>. Then the Cypress test can wait for this promise to resolve.</li>
</ol>
<figure class="highlight ts"><figcaption><span>heroes.component.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">add(name: <span class="built_in">string</span>): <span class="built_in">Promise</span>&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">  name = name.trim();</span><br><span class="line">  <span class="keyword">if</span> (!name) &#123; <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(); &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.heroService.addHero(&#123; name &#125; <span class="keyword">as</span> Hero)</span><br><span class="line">    .subscribe(<span class="function"><span class="params">hero</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.heroes.push(hero);</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Cypress automatically waits for promise returned from <code>cy.invoke(...)</code> to resolve, thus our test becomes really simple.</p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds a new hero. If the application method &quot;add(name)&quot; returns a promise,</span></span><br><span class="line"><span class="comment"> * the Cypress test command chain automatically waits for the promise to resolve.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> addHero = <span class="function">(<span class="params">name: <span class="built_in">string</span></span>) =&gt;</span></span><br><span class="line">  cy.window()</span><br><span class="line">    <span class="comment">// @ts-ignore</span></span><br><span class="line">    .its(<span class="string">&#x27;HeroesComponent&#x27;</span>)</span><br><span class="line">    .invoke(<span class="string">&#x27;add&#x27;</span>, name)</span><br><span class="line"></span><br><span class="line">it(<span class="string">&#x27;shows new hero&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/heroes&#x27;</span>)</span><br><span class="line">  clearHeroes()</span><br><span class="line">  tick()</span><br><span class="line"></span><br><span class="line">  addHero(<span class="string">&#x27;Gleb&#x27;</span>) <span class="comment">// the world needs a new hero</span></span><br><span class="line">  tick()</span><br><span class="line">  cy.contains(<span class="string">&#x27;.heroes li&#x27;</span>, <span class="string">&#x27;Gleb&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/angular-app-actions/resolve.gif" alt="Cypress test waits for application&#39;s promise to resolve"></p>
<h2><span id="fixing-typescript">Fixing TypeScript</span></h2><p>Let&#39;s tell TypeScript that <code>window</code> object can have our new properties set. Create a new file <code>src/index.d.ts</code> and describe new properties that the application can add to the <code>window</code> object.</p>
<figure class="highlight ts"><figcaption><span>src/index.d.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HeroesComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./app/heroes/heroes.component&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ApplicationRef &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">declare</span> <span class="built_in">global</span> &#123;</span><br><span class="line">  <span class="keyword">interface</span> Window &#123;</span><br><span class="line">    Cypress?: unknown</span><br><span class="line">    appRef?: ApplicationRef</span><br><span class="line">    HeroesComponent?: HeroesComponent</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The file <code>src/index.d.ts</code> will be automatically loaded by TypeScript compiler while process <code>.ts</code> files in <code>src</code> folder, so the <code>window</code> object will be updated. Great, now we can remove all <code>// @ts-ignore</code> from the source code to be simply:</p>
<figure class="highlight ts"><figcaption><span>src/heroes.component.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">private</span> heroService: HeroService</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">window</span>.Cypress) &#123;</span><br><span class="line">    <span class="built_in">window</span>.HeroesComponent = <span class="built_in">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now let&#39;s tell our spec files that these new properties are available on the <code>window</code>. Include the <code>src/index.d.ts</code> from the <code>cypress/tsconfig.json</code> file:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;extends&quot;</span>: <span class="string">&quot;../tsconfig.json&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;include&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;*/*.ts&quot;</span>,</span><br><span class="line">    <span class="string">&quot;../node_modules/cypress&quot;</span>,</span><br><span class="line">    <span class="string">&quot;../src/index.d.ts&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now when we write a test, the window will have optional application properties, like this:</p>
<p><img src="/blog/images/angular-app-actions/window-prop.png" alt="IntelliSense shows the new HeroComponent property exists"></p>
<p>Let&#39;s cast the property returned by the <code>getHeroes()</code> utility function so that our specs &quot;know&quot; what kind of object they are asserting.</p>
<figure class="highlight ts"><figcaption><span>spec.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ApplicationRef &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Hero &#125; <span class="keyword">from</span> <span class="string">&quot;app/hero&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * yields window.HeroesComponent.heroes array</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span></span></span><br><span class="line"><span class="comment"> *  // starts with 10 heroes</span></span><br><span class="line"><span class="comment"> *  cy.visit(&#x27;/heroes&#x27;).should(&#x27;have.length&#x27;, 10)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getHeroes = <span class="function">() =&gt;</span></span><br><span class="line">  getHeroesComponent().should(<span class="string">&#x27;have.property&#x27;</span>, <span class="string">&#x27;heroes&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">list</span> =&gt;</span> &lt;Hero[]&gt;&lt;unknown&gt;list) // make the type work</span><br><span class="line"></span><br><span class="line">const getAppRef = () =&gt;</span><br><span class="line">  cy.window().should(&#x27;have.property&#x27;, &#x27;appRef&#x27;)</span><br><span class="line">  .then(x =&gt; &lt;ApplicationRef&gt;&lt;unknown&gt;x) // make the type work</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Calls `appRef.tick()` to force UI refresh</span><br><span class="line"> */</span><br><span class="line">const tick = () =&gt;</span><br><span class="line">  getAppRef()</span><br><span class="line">    .invoke(&#x27;tick&#x27;)</span><br></pre></td></tr></table></figure>
<p>Now we can remove all <code>// @ts-ignore</code> from the spec file. When we have types, even hovering over <code>getAppRef().invoke</code> method correctly shows only the methods available on the <code>ApplicationRef</code> type.</p>
<p><img src="/blog/images/angular-app-actions/appref.gif" alt="TypeScript provides intelligent code completion for `cy.invoke` over ApplicationRef"></p>
<p>Finally, let&#39;s add a custom command we have added <code>cy.getHeroesComponent()</code> to TypeScript. As shown in <a target="_blank" rel="noopener" href="https://on.cypress.io/typescript">Cypress TypeScript documentation</a>, to add new commands to the global <code>cy</code> object type we need to create <code>cypress/support/index.d.ts</code></p>
<figure class="highlight ts"><figcaption><span>cypress/support/index.d.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">namespace</span> Cypress &#123;</span><br><span class="line">  <span class="keyword">interface</span> Chainable &#123;</span><br><span class="line">    getHeroesComponent(): Chainable&lt;<span class="built_in">any</span>&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For some reason I could not import <code>HeroesComponent</code> and return <code>Chainable&lt;HeroesComponent&gt;</code> - TypeScript compiler would complain about generic interface. The beauty of TypeScript.</p>
<h2><span id="conclusions">Conclusions</span></h2><p>In this blog post I have shown how to expose an Angular component instance and access it from Cypress tests. Using the instance reference we can check the internal application&#39;s state, and also trigger data changes, bypassing user interface. I have also shown how to trigger user interface updates by getting a reference to the application during bootstrap. We have seen several solutions to race conditions between the app and the test runner. Finally I have shown how to fix TypeScript errors when we extend global <code>window</code> and <code>cy</code> objects with custom properties.</p>
<h3><span id="see-more">See more</span></h3><ul>
<li>Find the source code from this blog post at <a target="_blank" rel="noopener" href="https://github.com/bahmutov/angular-heroes-app-actions">bahmutov/angular-heroes-app-actions</a></li>
<li>Read <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2019/01/03/stop-using-page-objects-and-start-using-app-actions/">Stop using page objects and start using app actions</a></li>
<li>See more <a target="_blank" rel="noopener" href="https://github.com/cypress-io/cypress-example-recipes">Cypress recipes</a> and read my <a href="../tags/cypress/">blog posts about Cypress</a> and the official <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/">Cypress blog</a></li>
</ul>

      
    </div>

    
      <footer class="article-footer personal-links">
  <p>
    Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
    see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
    watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
    browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
  </p>
  <p>
    Want to know more about Cypress? Check out <a href="https://cypress.tips" target="_blank">cypress.tips</a>
  </p>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/testing-angular-application-via-app-actions/" data-id="cku8t3pos01v81cvghyn04pw8" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/testing-angular-application-via-app-actions/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/" rel="tag">cypress</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/testing/" rel="tag">testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../cambridge-elections/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Cambridge MA elections
        
      </div>
    </a>
  
  
    <a href="../visual-diffing-for-CLI-apps/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Visual diffing flow for your pretty CLI applications</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">138</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">419</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">109</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">145</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">68</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">165</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">130</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.38px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.54px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.77px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.85px;">advice</a> <a href="../tags/algolia/" style="font-size: 10.38px;">algolia</a> <a href="../tags/angularjs/" style="font-size: 17.69px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.08px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.69px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.77px;">browser</a> <a href="../tags/ci/" style="font-size: 16.54px;">ci</a> <a href="../tags/circle/" style="font-size: 12.69px;">circle</a> <a href="../tags/climate/" style="font-size: 14.62px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 13.46px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.31px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 19.62px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 13.85px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.77px;">d3</a> <a href="../tags/db/" style="font-size: 14.62px;">db</a> <a href="../tags/docker/" style="font-size: 14.23px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.92px;">documentation</a> <a href="../tags/es6/" style="font-size: 14.62px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.08px;">functional</a> <a href="../tags/generators/" style="font-size: 11.54px;">generators</a> <a href="../tags/git/" style="font-size: 15px;">git</a> <a href="../tags/github/" style="font-size: 15.38px;">github</a> <a href="../tags/graphql/" style="font-size: 11.54px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.31px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.77px;">gulp</a> <a href="../tags/hiring/" style="font-size: 10.77px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.31px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.54px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.77px;">interview</a> <a href="../tags/jade/" style="font-size: 11.15px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.77px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.85px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 16.92px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.15px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.46px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.15px;">performance</a> <a href="../tags/presentation/" style="font-size: 12.31px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.31px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.38px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/react/" style="font-size: 11.54px;">react</a> <a href="../tags/react-native/" style="font-size: 11.15px;">react native</a> <a href="../tags/reactive/" style="font-size: 14.23px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.15px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.54px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 13.08px;">security</a> <a href="../tags/sentry/" style="font-size: 13.85px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.92px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.23px;">testing</a> <a href="../tags/tutorial/" style="font-size: 15.77px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 11.92px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.38px;">ui</a> <a href="../tags/vercel/" style="font-size: 13.08px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.15px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.54px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.92px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.77px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/10/">October 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/09/">September 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/08/">August 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../request-graphql/">Make GraphQL Calls From Cypress Tests</a>
          </li>
        
          <li>
            <a href="../dynamic-tests-from-fixture/">Dynamic Tests From Cypress Fixture</a>
          </li>
        
          <li>
            <a href="../what-i-do-after-a-conference/">What I Do After A Conference</a>
          </li>
        
          <li>
            <a href="../test-plain-or-markdown-file/">Test Plain Or Markdown File Using Cypress</a>
          </li>
        
          <li>
            <a href="../skip-cypress-install-on-ci/">Skip Cypress Install On CI</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/testing-angular-application-via-app-actions/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
