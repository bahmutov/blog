<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Triple Tested Static Site Deployed to GitHub Pages Using GitHub Actions | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="This blog post shows something I have wanted to achieve for a while: deploying a fully tested static site or a web application and then testing the deployed site.   Introduction The static site Buildi">
<meta property="og:type" content="article">
<meta property="og:title" content="Triple Tested Static Site Deployed to GitHub Pages Using GitHub Actions">
<meta property="og:url" content="https://glebbahmutov.com/blog/triple-tested/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="This blog post shows something I have wanted to achieve for a while: deploying a fully tested static site or a web application and then testing the deployed site.   Introduction The static site Buildi">
<meta property="og:locale">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/main-to-about.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/develop-reload.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/dist.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/ci-workflow.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/main-to-about.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/spec.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/search.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/search-markup.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/search-test.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/testing-on-ci.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/logs.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/deploy1.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/link-to-main.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/failed-links.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/failed-css.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/html.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/vuepress-deploy.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/testing-deploy.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/assertion.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/test-fails.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/events.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/page.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/deployed-workflow-failed.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/both-tests-failed.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/deploy-tests-passed.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/working-site.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/serve-output.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/broken-prod.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/passing-test.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/gh-passed.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/prod-tested.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/badges.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/record-key.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/runs.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/triple-tested/ci-runs.png">
<meta property="article:published_time" content="2020-03-24T04:00:00.000Z">
<meta property="article:modified_time" content="2021-06-15T13:13:30.375Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="cypress">
<meta property="article:tag" content="cypress dashboard">
<meta property="article:tag" content="tutorial">
<meta property="article:tag" content="ci">
<meta property="article:tag" content="github">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/triple-tested/main-to-about.gif">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-triple-tested" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2020-03-24T04:00:00.000Z" itemprop="datePublished">Mar 24 2020</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/process/">process</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Triple Tested Static Site Deployed to GitHub Pages Using GitHub Actions
    </h1>

    <h2 class="article-title" itemprop="name">
      How to test static sites three times before and after deployment to GitHub pages.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This blog post shows something I have wanted to achieve for a while: <strong>deploying a fully tested static site or a web application and then testing the deployed site</strong>.</p>
<!-- toc -->
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#the-static-site">The static site</a></li>
<li><a href="#building-the-production-site">Building the production site</a></li>
<li><a href="#deploying-to-github-pages">Deploying to GitHub Pages</a></li>
<li><a href="#local-testing">Local testing</a></li>
<li><a href="#local-test-on-ci">Local test on CI</a></li>
<li><a href="#the-problem-with-deployed-site">The problem with deployed site</a></li>
<li><a href="#testing-the-deployed-site">Testing the deployed site</a></li>
<li><a href="#testing-the-deployed-site-from-ci">Testing the deployed site from CI</a></li>
<li><a href="#fixing-the-deploy-url">Fixing the deploy url</a></li>
<li><a href="#preventing-broken-deployments">Preventing broken deployments</a></li>
<li><a href="#tips">Tips</a><ul>
<li><a href="#github-actions-badges">GitHub Actions badges</a></li>
<li><a href="#environment-variables">Environment variables</a></li>
<li><a href="#record-to-dashboard">Record to Dashboard</a></li>
</ul>
</li>
<li><a href="#discussion">Discussion</a></li>
<li><a href="#see-more">See more</a></li>
</ul>
<!-- tocstop -->
<h2><span id="introduction">Introduction</span></h2><p>My previous attempts used a combination of continuous integration (CI) systems and deployment tools; in all cases the result is a workflow that was unnecessary complex and hard to understand. You can see these attempts for yourself from these blog posts:</p>
<ul>
<li><a href="../gatsby-netlify-circle-and-cypress/">Gatsby Netlify Circle and Cypress</a> uses CircleCI + Netlify and requires webhook back Netlify to Circle on deploy to run a test job</li>
<li><a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2018/08/28/record-test-artifacts-from-any-ci/">Record Test Artifacts from any Docker CI</a> uses Docker image to run tests locally, but does not test the deployed site</li>
<li><a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2017/05/30/cypress-and-immutable-deploys/">Immutable deploys and Cypress</a> uses GitLab CI to run tests locally, then deploys using Zeit Now and tests the deployed site, not too bad, but still a combination of two systems and lots of custom glue code; I am not even sure my tool <a target="_blank" rel="noopener" href="https://github.com/bahmutov/now-pipeline">now-pipeline</a> is even working still against Zeit API</li>
</ul>
<p>This blog post shows how to deploy a static site or a web apps to <a target="_blank" rel="noopener" href="https://pages.github.com/">GitHub Pages</a> while testing the site three times using <a target="_blank" rel="noopener" href="https://github.com/features/actions">GitHub Actions</a>:</p>
<ul>
<li>first time running site <em>in development mode</em></li>
<li>second time by building the production bundles and serving the site using a static server</li>
<li>third time <em>after deploying</em> the site to GitHub Pages</li>
</ul>
<p><strong>Source code:</strong> you can find the code for this blog post in <a target="_blank" rel="noopener" href="https://github.com/bahmutov/triple-tested">bahmutov/triple-tested</a>. You can see the finished (well-tested) version of the site deployed at <a href="https://glebbahmutov.com/triple-tested/">https://glebbahmutov.com/triple-tested/</a>.</p>
<p>Let&#39;s roll!</p>
<h2><span id="the-static-site">The static site</span></h2><p>As an example, I created a static blog site using <a target="_blank" rel="noopener" href="https://vuepress.vuejs.org/">VuePress</a>. First, let&#39;s install it using NPM</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm init --yes</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm i -D vuepress</span></span><br><span class="line">+ vuepress@1.4.0</span><br></pre></td></tr></table></figure>
<p>In <a target="_blank" rel="noopener" href="https://github.com/bahmutov/triple-tested/blob/master/package.json">package.json</a> we can add commands to run the local development server and build the production site:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;triple-tested&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;docs:dev&quot;</span>: <span class="string">&quot;vuepress dev docs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;docs:build&quot;</span>: <span class="string">&quot;vuepress build docs&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;vuepress&quot;</span>: <span class="string">&quot;1.4.0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Then I have added a new folder called <code>docs</code> with a few Markdown files - these files will be converted into HTML pages using VuePress settings from <code>docs/.vuepress</code> folder.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ ls -la docs/</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x   5 gleb  staff  160 Mar 22 17:23 .</span><br><span class="line">drwxr-xr-x  13 gleb  staff  416 Mar 22 17:30 ..</span><br><span class="line">drwxr-xr-x   4 gleb  staff  128 Mar 21 14:51 .vuepress</span><br><span class="line">-rw-r--r--   1 gleb  staff  101 Mar 22 17:28 README.md</span><br><span class="line">-rw-r--r--   1 gleb  staff  152 Mar 22 17:29 about.md</span><br><span class="line"></span><br><span class="line">$ cat docs/.vuepress/config.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  title: &#x27;Triple Tested&#x27;,</span><br><span class="line">  description: &#x27;Example static site&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>README.md</code> file has the content for the main or index page</p>
<figure class="highlight md"><figcaption><span>docs/README.md</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># Main page</span></span><br><span class="line"><span class="quote">&gt; This is an experiment</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> does it work?</span><br><span class="line"><span class="bullet">-</span> maybe</span><br><span class="line"><span class="bullet">-</span> hope so!</span><br><span class="line"></span><br><span class="line">Go to [<span class="string">about page</span>](<span class="link">./about</span>)</span><br></pre></td></tr></table></figure>
<p>The <code>about.md</code> file has a link back to the main page</p>
<figure class="highlight md"><figcaption><span>docs/about.md</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># About</span></span><br><span class="line"></span><br><span class="line">This is a static blog used as example in [<span class="string">bahmutov/triple-tested</span>](<span class="link">https://github.com/bahmutov/triple-tested</span>) repo.</span><br><span class="line"></span><br><span class="line">Back to the [<span class="string">main page</span>](<span class="link">/</span>)</span><br></pre></td></tr></table></figure>
<p>We can start the local development server that bundles the Markdown files and serves the HTML pages using <code>npm run docs:dev</code> command. The <code>vuepress dev docs</code> command serves the content at port 8080 by default.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm run docs:dev</span></span><br><span class="line">success [17:38:19] Build 62f9fb finished in 116 ms! ( http://localhost:8080/ )</span><br></pre></td></tr></table></figure>
<p>Open that URL in your browser and find a nice, clean static site</p>
<p><img src="/blog/images/triple-tested/main-to-about.gif" alt="Main page to About page and back"></p>
<p>The development server watches the source files, and automatically rebuilds the pages on changes. It also forces the browser to reload the page.</p>
<p><img src="/blog/images/triple-tested/develop-reload.gif" alt="Development process reloads the page when Markdown file changes"></p>
<p><strong>Tip:</strong> the above example used relative link <code>[about page](./about)</code>, but according to <a target="_blank" rel="noopener" href="https://vuepress.vuejs.org/guide/markdown.html#links">VuePress docs</a> you should use the file path with extension <code>[about page](./about.md)</code> to generate the correct link.</p>
<h2><span id="building-the-production-site">Building the production site</span></h2><p>We cannot run the <code>npm run docs:dev</code> in production though: we need to convert the Markdown into finalized HTML pages. VuePress has the <code>build</code> command that does the production build and optimizes the HTML, CSS and JavaScript asset bundles.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm run docs:build</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> triple-tested@1.0.0 docs:build /Users/gleb/git/triple-tested</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> vuepress build docs</span></span><br><span class="line"></span><br><span class="line">wait Extracting site metadata...</span><br><span class="line">tip Apply theme @vuepress/theme-default ...</span><br><span class="line">tip Apply plugin container (i.e. &quot;vuepress-plugin-container&quot;) ...</span><br><span class="line">tip Apply plugin @vuepress/register-components (i.e. &quot;@vuepress/plugin-register-components&quot;) ...</span><br><span class="line">tip Apply plugin @vuepress/active-header-links (i.e. &quot;@vuepress/plugin-active-header-links&quot;) ...</span><br><span class="line">tip Apply plugin @vuepress/search (i.e. &quot;@vuepress/plugin-search&quot;) ...</span><br><span class="line">tip Apply plugin @vuepress/nprogress (i.e. &quot;@vuepress/plugin-nprogress&quot;) ...</span><br><span class="line"></span><br><span class="line">‚úî Client</span><br><span class="line">  Compiled successfully in 7.25s</span><br><span class="line"></span><br><span class="line">‚úî Server</span><br><span class="line">  Compiled successfully in 4.58s</span><br><span class="line"></span><br><span class="line">wait Rendering static HTML...</span><br><span class="line">success Generated static files in docs/.vuepress/dist.</span><br></pre></td></tr></table></figure>
<p>The <code>build</code> command prepares the static site for <a target="_blank" rel="noopener" href="https://vuepress.vuejs.org/guide/deploy.html">deployment</a> - assuming the hosting platform &quot;simply&quot; serves the produced folder <code>docs/.vuepress/dist</code>.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ls -la docs/.vuepress/dist</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  5 gleb  staff   160 Mar 22 17:57 .</span><br><span class="line">drwxr-xr-x  4 gleb  staff   128 Mar 22 17:56 ..</span><br><span class="line">-rw-r--r--  1 gleb  staff  2990 Mar 22 17:57 about.html</span><br><span class="line">drwxr-xr-x  5 gleb  staff   160 Mar 22 17:57 assets</span><br><span class="line">-rw-r--r--  1 gleb  staff  2508 Mar 22 17:57 index.html</span><br></pre></td></tr></table></figure>
<p>In fact, we can serve the <code>dist</code> folder ourselves to see how it looks. Let&#39;s use a quick static server utility called <a target="_blank" rel="noopener" href="https://github.com/zeit/serve">serve</a>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm i -D serve</span></span><br><span class="line">+ serve@11.3.0</span><br><span class="line"><span class="meta">$</span><span class="bash"> npx serve docs/.vuepress/dist</span></span><br><span class="line"></span><br><span class="line">   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">   ‚îÇ                                                ‚îÇ</span><br><span class="line">   ‚îÇ   Serving!                                     ‚îÇ</span><br><span class="line">   ‚îÇ                                                ‚îÇ</span><br><span class="line">   ‚îÇ   - Local:            http://localhost:5000    ‚îÇ</span><br><span class="line">   ‚îÇ   - On Your Network:  http://10.0.0.124:5000   ‚îÇ</span><br><span class="line">   ‚îÇ                                                ‚îÇ</span><br><span class="line">   ‚îÇ   Copied local address to clipboard!           ‚îÇ</span><br><span class="line">   ‚îÇ                                                ‚îÇ</span><br><span class="line">   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></pre></td></tr></table></figure>
<p>Open <code>localhost:5000</code> in the browser - it should look and work exactly the same way as the development server, and perhaps even faster, since it was optimized for production and does not include the extra development code.</p>
<p><img src="/blog/images/triple-tested/dist.png" alt="Production static site served from dist/.vuepress/dist folder"></p>
<h2><span id="deploying-to-github-pages">Deploying to GitHub Pages</span></h2><p>Now that we have built such a beautiful content, let&#39;s host it somewhere. I will use <a target="_blank" rel="noopener" href="https://pages.github.com/">GitHub Page</a> to host. I love using GH Pages for static pages, even this blog you are reading is hosted there! Any public GH repository can push HTML files into <code>gh-pages</code> branch, and the GH Pages serve it.</p>
<p>I could push the <code>dist</code> folder to <a target="_blank" rel="noopener" href="https://github.com/bahmutov/triple-tested/tree/gh-pages">gh-pages branch</a> manually, but I want to automate this process. Thus I have created a GitHub Actions workflow file <a target="_blank" rel="noopener" href="https://github.com/bahmutov/triple-tested/blob/b0f84916ac45f1b1f83617818f365d007c3d3958/.github/workflows/ci.yml">.github/workflow/ci.yml</a> that checks out the code, installs NPM dependencies, builds the production site and deploys the <code>dist</code> folder to the <code>gh-pages</code> branch where GitHub Pages host it:</p>
<figure class="highlight yml"><figcaption><span>.github/workflow/ci.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">ci</span></span><br><span class="line"><span class="comment"># only deploy site from master branch</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># https://github.com/actions/checkout</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">üõéÔ∏è</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">persist-credentials:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NPM</span> <span class="string">install</span> <span class="string">üì¶</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">bahmutov/npm-install@v1</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">site</span> <span class="string">üèó</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">docs:build</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># https://github.com/marketplace/actions/github-pages-action</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">üöÄ</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">peaceiris/actions-gh-pages@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">github_token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">publish_dir:</span> <span class="string">./docs/.vuepress/dist</span></span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong> if you have never used GitHub Actions, spend 30 minutes watching my recent talk <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=zhPqf5z_crc">GitHub Actions in Action</a> and browse the <a target="_blank" rel="noopener" href="https://slides.com/bahmutov/gh-actions">slides</a>, or read the blog post <a href="../trying-github-actions/">Trying GitHub Actions</a>.</p>
<p>In the above <code>ci.yml</code> file we are using 3rd party GitHub action from repo <a target="_blank" rel="noopener" href="https://github.com/peaceiris/actions-gh-pages">peaceiris/actions-gh-pages</a> and pass it two parameters. The <code>secrets.GITHUB_TOKEN</code> is created automatically by GitHub workflow; this token allows the action to push a new commit back to the <code>gh-pages</code> branch if there are changed HTML files. The <code>public_dir</code> parameter tells the action which folder we want to deploy.</p>
<p><strong>Warning ‚ö†Ô∏è:</strong> if the first deploy fails, read <a target="_blank" rel="noopener" href="https://github.com/peaceiris/actions-gh-pages#%EF%B8%8F-first-deployment-with-github_token">this issue</a> - there seems to be a bug with GH Pages and the <code>GITHUB_TOKEN</code> on first deploy. I pushed the code manually once using <a target="_blank" rel="noopener" href="https://github.com/josh-egan/deploy-gh-pages">deploy-gh-pages</a> and my personal GitHub access token <code>GH_TOKEN=... npx deploy-gh-pages ./docs/.vuepress/dist</code>. After that the <code>ci.yml</code> was able to push the new commits automatically.</p>
<p>You can see the workflow <code>ci</code> run at GitHub inside the repo&#39;s <a target="_blank" rel="noopener" href="https://github.com/bahmutov/triple-tested/actions?query=workflow%3Aci">Actions tab</a></p>
<p><img src="/blog/images/triple-tested/ci-workflow.png" alt="Workflow &quot;ci&quot; has successfully finished"></p>
<p>Before we look at the deployed site, let&#39;s go back to the local development mode and make sure it works correctly.</p>
<h2><span id="local-testing">Local testing</span></h2><p>In a section above, I have shown navigation from the Main page to the About page and back by clicking on the links.</p>
<p><img src="/blog/images/triple-tested/main-to-about.gif" alt="Main page to About page and back"></p>
<p>What if we accidentally change the filename <code>about.md</code> to <code>info.md</code>? We will have a broken link, which leads to frustrated users. Let&#39;s prevent this by adding an end-to-end Cypress test. First, we will install Cypress test runner and a useful utility <a target="_blank" rel="noopener" href="https://github.com/bahmutov/start-server-and-test">start-server-and-test</a> to help run and stop multiple processes.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm i -D cypress start-server-and-test</span></span><br><span class="line">+ cypress@4.2.0</span><br><span class="line">+ start-server-and-test@1.10.11</span><br></pre></td></tr></table></figure>
<p>When we work locally we want to run the VuePress develop command, wait for the server to respond at port 8080, then we can open Cypress. Here are the scripts:</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;docs:dev&quot;</span>: <span class="string">&quot;vuepress dev docs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;docs:build&quot;</span>: <span class="string">&quot;vuepress build docs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cy:open&quot;</span>: <span class="string">&quot;cypress open&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cy:run&quot;</span>: <span class="string">&quot;cypress run&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;dev&quot;</span>: <span class="string">&quot;start-test docs:dev 8080 cy:open&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;devDependencies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;cypress&quot;</span>: <span class="string">&quot;4.2.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;serve&quot;</span>: <span class="string">&quot;11.3.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;start-server-and-test&quot;</span>: <span class="string">&quot;1.10.11&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;vuepress&quot;</span>: <span class="string">&quot;1.4.0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Whenever we need to start everything locally, we will use <code>npm run dev</code> script. Let&#39;s write a Cypress test.</p>
<figure class="highlight js"><figcaption><span>cypress/integration/spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;cypress&quot; /&gt;</span></span><br><span class="line">describe(<span class="string">&#x27;Triple tested&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  it(<span class="string">&#x27;has index and about pages&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cy.visit(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;Main page&#x27;</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;hope so!&#x27;</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;about page&#x27;</span>).click()</span><br><span class="line">    cy.url().should(<span class="string">&#x27;match&#x27;</span>, <span class="regexp">/about/</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">    cy.contains(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;main page&#x27;</span>).click()</span><br><span class="line">    cy.url().should(<span class="string">&#x27;not.match&#x27;</span>, <span class="regexp">/about/</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test does not hardcode the URL to visit - instead the command <code>cy.visit(&#39;/&#39;)</code> relies on <code>baseUrl</code> set in the <code>cypress.json</code> file</p>
<figure class="highlight json"><figcaption><span>cypress.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;baseUrl&quot;</span>: <span class="string">&quot;http://localhost:8080&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Start the development server and open Cypress with NPM script</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm run dev</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> start-test docs:dev 8080 cy:open</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - runs <span class="string">&quot;docs:dev&quot;</span> script</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - waits <span class="keyword">for</span> port 8080 to respond</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   - opens Cypress application</span></span><br></pre></td></tr></table></figure>
<p>The test in <code>spec.js</code> runs very quickly</p>
<p><img src="/blog/images/triple-tested/spec.gif" alt="Cypress test going from Main to About page and back using links"></p>
<p><strong>Tip:</strong> if we <em>only</em> wanted to check the local Markdown links, we could just do so, read the blog post <a href="../check-markdown-links/">Check links in your Markdown documents</a>. But in this blog post we want to write other kinds of functional tests.</p>
<p>While we are at it, we can verify the &quot;Search&quot; behavior. VuePress automatically adds search widget with page titles. Users can go to a page by typing the title:</p>
<p><img src="/blog/images/triple-tested/search.gif" alt="Going to the About page using the search"></p>
<p>Let&#39;s write a test. First, we need to select the search input box. Here is the relevant markup:</p>
<p><img src="/blog/images/triple-tested/search-markup.png" alt="HTML markup for search widget"></p>
<p><strong>Tip:</strong> I have described how to test VuePress Search widget in details in the blog post <a href="../vuepress-conditional-testing/">VuePress and some Cypress end-to-end testing tips</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">&#x27;finds About page using search&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.visit(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  cy.get(<span class="string">&#x27;.search-box input&#x27;</span>).type(<span class="string">&#x27;about&#x27;</span>)</span><br><span class="line">  <span class="comment">// suggestions list appears</span></span><br><span class="line">  cy.get(<span class="string">&#x27;.suggestions li&#x27;</span>).should(<span class="string">&#x27;be.visible&#x27;</span>)</span><br><span class="line">    <span class="comment">// and should have at least 1 item</span></span><br><span class="line">    .and(<span class="string">&#x27;have.length.gte&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="comment">// and the first search result is our &quot;About&quot; page</span></span><br><span class="line">    .first()</span><br><span class="line">    .contains(<span class="string">&#x27;.page-title&#x27;</span>, <span class="string">&#x27;About&#x27;</span>).click()</span><br><span class="line">  <span class="comment">// check we are on the right page</span></span><br><span class="line">  cy.title().should(<span class="string">&#x27;contain&#x27;</span>, <span class="string">&#x27;About&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>The test runs and confirms the search is working</p>
<p><img src="/blog/images/triple-tested/search-test.gif" alt="The search test finds the About page"></p>
<h2><span id="local-test-on-ci">Local test on CI</span></h2><p>Now that we have end-to-end tests, let&#39;s run them on GitHub Actions CI. We could extend the <code>ci.yml</code> with commands to start the development server in the background and run Cypress tests like this:</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NPM</span> <span class="string">install</span> <span class="string">üì¶</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">bahmutov/npm-install@v1</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">docs:develop</span> <span class="string">&amp;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">cy:run</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">site</span> <span class="string">üèó</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">docs:build</span></span><br></pre></td></tr></table></figure>
<p>Or we could use <code>start-server-and-test</code> utility on CI by defining one more script:</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;docs:dev&quot;</span>: <span class="string">&quot;vuepress dev docs&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cy:run&quot;</span>: <span class="string">&quot;cypress run&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;dev:ci&quot;</span>: <span class="string">&quot;start-test docs:dev 8080 cy:run&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Where the <code>cypress run</code> command just runs Cypress headlessly.</p>
<figure class="highlight yml"><figcaption><span>ci.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">NPM</span> <span class="string">install</span> <span class="string">üì¶</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">bahmutov/npm-install@v1</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">dev:ci</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">site</span> <span class="string">üèó</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">docs:build</span></span><br></pre></td></tr></table></figure>
<p>The above approach is imperfect. The action step <code>bahmutov/npm-install@v1</code> does NOT understand how to <a target="_blank" rel="noopener" href="https://on.cypress.io/caching">cache Cypress binary correctly</a>, leading to slow or failing builds. To greatly simplify running Cypress on GitHub Actions CI, we have written <a target="_blank" rel="noopener" href="https://github.com/cypress-io/github-action">cypress-io/github-action</a>. This action &quot;knows&quot; how to install Cypress and NPM dependencies, cache them, start the server, and run the tests. Let&#39;s use this action:</p>
<figure class="highlight yml"><figcaption><span>ci.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">and</span> <span class="string">test</span> <span class="string">üì¶‚úÖ</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v1</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">start:</span> <span class="string">&#x27;npm run docs:dev&#x27;</span></span><br><span class="line">    <span class="attr">wait-on:</span> <span class="string">&#x27;http://localhost:8080&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">site</span> <span class="string">üèó</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">docs:build</span></span><br></pre></td></tr></table></figure>
<p>The GitHub Actions execute and pass</p>
<p><img src="/blog/images/triple-tested/testing-on-ci.png" alt="Cypress tests successfully ran on GitHub"></p>
<p>We can see the logs from the <code>npm run docs:dev</code> command followed by the Cypress&#39; terminal output.</p>
<p><img src="/blog/images/triple-tested/logs.gif" alt="Cypress GitHub Action logs"></p>
<p>Nice, our static site will work correctly when deployed; we have tested it!</p>
<p>Or will it?</p>
<h2><span id="the-problem-with-deployed-site">The problem with deployed site</span></h2><p>We have tested the site on GitHub CI by running the VuePress development server. Then we built the site and pushed the <code>./docs/.vuepress/dist</code> folder to GitHub Pages. Everything must be good, right? Let&#39;s check.</p>
<p>I have a custom domain <code>glebbahmutov.com</code> <a target="_blank" rel="noopener" href="https://help.github.com/en/github/working-with-github-pages/configuring-a-custom-domain-for-your-github-pages-site">configured with GitHub Pages</a> via CloudFlare. My personal repository <a target="_blank" rel="noopener" href="https://github.com/bahmutov/bahmutov.github.io">bahmutov/bahmutov.github.io</a> is hosted at <code>https://glebbahmutov.com/</code> and every repo <code>&lt;name&gt;</code> will be available under <code>https://glebbahmutov.com/&lt;name&gt;/</code> sub path. Thus we can open <a href="https://glebbahmutov.com/triple-tested/">https://glebbahmutov.com/triple-tested/</a> and see our blog.</p>
<p>Let&#39;s open that URL ...</p>
<p><img src="/blog/images/triple-tested/deploy1.png" alt="The deployed site is terribly broken"></p>
<p>Oh no, the site ... does not look good. Click on the &quot;About&quot; page link - we can browser to it. But going to the &quot;Main&quot; page does not work. Instead it redirects to the top level domain <code>https://glebbahmutov.com</code>.</p>
<p><img src="/blog/images/triple-tested/link-to-main.png" alt="Link to the main page is wrong"></p>
<p>Open the DevTools Network tab and reload the main page - you will see that only the <code>index.html</code> really loads, all other links fail to load.</p>
<p><img src="/blog/images/triple-tested/failed-links.png" alt="Network tab shows that resources fail to load"></p>
<p>Clicking on any resource shows the full path - and it looks wrong, because it does not include <code>/triple-tested/</code> folder.</p>
<p><img src="/blog/images/triple-tested/failed-css.png" alt="Failed CSS resource"></p>
<p>Let&#39;s look at the source of the page - notice that all resource links start with <code>/assets/...</code>, which means they are served from the <em>root of the domain</em>.</p>
<p><img src="/blog/images/triple-tested/html.png" alt="Deployed site HTML"></p>
<p>Each resource link &quot;forgets&quot; to include the <em>base url</em> of the site - the subfolder <code>/triple-tested</code> part. We should have read the entire <a target="_blank" rel="noopener" href="https://vuepress.vuejs.org/guide/deploy.html">VuePress deployment guide</a> that explains GitHub deployment in details:</p>
<p><img src="/blog/images/triple-tested/vuepress-deploy.png" alt="VuePress deployment guide to GitHub Pages"></p>
<p>Ok, that can be done. But before we fix the problem, we need to</p>
<p>...</p>
<p>write a test for it.</p>
<h2><span id="testing-the-deployed-site">Testing the deployed site</span></h2><p>As you saw above, things can go wrong when deploying a site. The problems that arise are <em>outside of source code</em> of the site itself. It was not the link <code>[about page](./about)</code> from the Main page to the About page that we have tested. It was not the Search widget either. No, instead we have discovered a <em>hosting configuration</em> problem. If instead of our small static site example, we had a complex web application, we could have wrong environment variables, an invalid database connection string, an unreachable proxy address - all the things that worked perfectly locally, but were set up incorrectly in production.</p>
<p>To really validate the deployed production site, we need to run a quick smoke end-to-end test, just to see if the entire stack works together.</p>
<p>Remember how we set the base url to test in <code>cypress.json</code>? It is pointing at <code>http://localhost:8080</code>, but we can overwrite it from <a target="_blank" rel="noopener" href="https://on.cypress.io/configuration">command line or using an environment variable</a>. Let&#39;s see if our current tests catch the errors with the deployed site. Open Cypress GUI locally, but pass the full production site URL:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npx cypress open --config baseUrl=https://glebbahmutov.com/triple-tested</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or equivalent</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> CYPRESS_baseUrl=https://glebbahmutov.com/triple-tested npx cypress open</span></span><br></pre></td></tr></table></figure>
<p>Then run the same tests against it.</p>
<p><img src="/blog/images/triple-tested/testing-deploy.gif" alt="Running end-to-end tests against the deployed site"></p>
<p>The &quot;finds About page using search&quot; test catches the broken site - because the JavaScript bundle for the search widget did not load.</p>
<p><strong>Tip:</strong> notice the 404 HTTP status codes Cypress shows in its terminal output - meaning the page under test fails to load a lot of its resources! That&#39;s a red flag.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /__cypress/iframes/integration/spec.js 200 1.025 ms - 629</span><br><span class="line">GET /__cypress/tests?p=cypress/integration/spec.js-331 200 1.689 ms - -</span><br><span class="line">GET /triple-tested/ 200 2.891 ms - -</span><br><span class="line">GET /assets/css/0.styles.59ba12ca.css 404 22.829 ms - -</span><br><span class="line">GET /assets/js/app.b08d2fd8.js 404 26.132 ms - -</span><br><span class="line">GET /assets/js/5.620a0c16.js 404 31.183 ms - -</span><br><span class="line">GET /assets/js/2.28d5c6fe.js 404 32.865 ms - -</span><br><span class="line">GET /assets/js/3.d052a4f0.js 404 32.142 ms - -</span><br><span class="line">GET /assets/js/4.5f60d4ea.js 404 28.854 ms - -</span><br><span class="line">GET /assets/js/6.fa5f4b7d.js 404 30.396 ms - -</span><br><span class="line">GET /triple-tested/about 200 92.170 ms - -</span><br></pre></td></tr></table></figure>
<p>Why did the first test &quot;has index and about pages&quot; pass? I remember it had an assertion after navigating back from the &quot;About&quot; to the &quot;Main&quot; page... It should have failed.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cy.contains(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;main page&#x27;</span>).click()</span><br><span class="line">cy.url().should(<span class="string">&#x27;not.match&#x27;</span>, <span class="regexp">/about/</span>)</span><br></pre></td></tr></table></figure>
<p>Hmm, look at the time traveling debugger - the assertion passes, but for a wrong reason - the site&#39;s url is <code>https://glebbahmutov.com</code> that does not match the regular expression <code>/about/</code>, so the test &quot;thinks&quot; everything is peachy.</p>
<p><img src="/blog/images/triple-tested/assertion.png" alt="The negative assertion against the URL passes"></p>
<p>You have to be careful about negative assertions like <code>should(&#39;not.match&#39;, ...)</code>, because they can be passing but for completely unexpected (and wrong) reasons. Let&#39;s add a <em>positive</em> assertion that checks something on the page that <em>only the right Main</em> page has.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cy.contains(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;main page&#x27;</span>).click()</span><br><span class="line">cy.url().should(<span class="string">&#x27;not.match&#x27;</span>, <span class="regexp">/about/</span>)</span><br><span class="line"><span class="comment">// only our Main page has &lt;h1&gt;Main page&lt;/h1&gt;</span></span><br><span class="line">cy.contains(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;Main page&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>The test fails correctly.</p>
<p><img src="/blog/images/triple-tested/test-fails.png" alt="The first test correctly fails"></p>
<p><strong>Tip:</strong> Cypress is a <em>functional testing tool</em>. Thus if the elements are present on the page, Cypress will happily click on the buttons, navigate using links, check the DOM and urls, etc. And it won&#39;t &quot;notice&quot; that the page&#39;s styles are missing, and everything looks broken. For that you need to add <a target="_blank" rel="noopener" href="https://on.cypress.io/visual-testing">visual testing</a>; luckily it not too difficult to do.</p>
<h2><span id="testing-the-deployed-site-from-ci">Testing the deployed site from CI</span></h2><p>We cannot rely on manual testing of the deployed site. We need to automatically test the site from CI after it has been deployed. Since we deploy the site to GitHub Pages from GitHub Actions, let&#39;s write <em>another action workflow</em> that would be triggered after the deploy finish. I will create a new file <code>.github/workflows/deployed.yml</code> with another GitHub workflow. Creating a separate workflow file is a great for keeping your CI files simple to understand and use.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">deployed</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">status:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">test-deployed-page:</span></span><br><span class="line">    <span class="attr">if:</span> <span class="string">github.event.context</span> <span class="string">==</span> <span class="string">&#x27;github/pages&#x27;</span> <span class="string">&amp;&amp;</span> <span class="string">github.event.state</span> <span class="string">==</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;gh-pages üìë built successfully ‚úÖ&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">show</span> <span class="string">deployed</span> <span class="string">page</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">curl</span> <span class="string">-s</span> <span class="string">https://glebbahmutov.com/triple-tested</span></span><br></pre></td></tr></table></figure>
<p>This workflow only runs when a commit on the <code>master</code> branch has its status updated. GitHub Pages bot sets this status when it starts building the pages, and when it finishes the deployment. We can use <a target="_blank" rel="noopener" href="https://help.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions">GitHub Actions expressions</a> to skip the job <code>test-deployed-page</code> unless the event that triggered the workflow tells us the GitHub Pages deploy was a success.</p>
<p><strong>Tip:</strong> you can dump the entire GH event object and inspect all the fields in order to write the <code>if: ...</code> expressions. Here is a dummy workflow job that simply prints the event (it is a huge JSON object)</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">show-event:</span></span><br><span class="line">  <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">  <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Dump</span> <span class="string">GitHub</span> <span class="string">context</span></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">        <span class="attr">GITHUB_CONTEXT:</span> <span class="string">$&#123;&#123;</span> <span class="string">toJson(github)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;$GITHUB_CONTEXT&quot;</span></span><br></pre></td></tr></table></figure>
<p>Let&#39;s see this workflow in action. I have added line <code>another one üëÜ</code> the <code>docs/README.md</code> file and have commited and pushed the code.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">Go to [about page](./about)</span><br><span class="line">another one üëÜ</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git add docs/README.md</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -m <span class="string">&quot;another one&quot;</span></span></span><br><span class="line">[master 1e8d247] another one</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git push</span></span><br></pre></td></tr></table></figure>
<p>We can see the 3 workflows at GitHub: the original <code>ci.yml</code> on <code>push</code> to <code>master</code> branch, followed by the skipped <code>deployed.yml</code> workflow (because the event status is <code>pending</code>), and then the full deployed workflow runs when the page has been deployed.</p>
<p><img src="/blog/images/triple-tested/events.png" alt="The workflows: one builds and deploys, the other runs after the deploy"></p>
<p>We can click on the finished <code>deployed</code> workflow and look at the output of the <code>curl -s https://glebbahmutov.com/triple-tested</code> command. The site has been updated with new text</p>
<p><img src="/blog/images/triple-tested/page.png" alt="The static site has been updated"></p>
<p>Now that we have the workflow that runs AFTER the deploy, let&#39;s run Cypress tests there, using the same <a target="_blank" rel="noopener" href="https://github.com/cypress-io/github-action">cypress-io/github-action</a> code, but just pointing the tests at the external site.</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">show</span> <span class="string">deployed</span> <span class="string">page</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">curl</span> <span class="string">-s</span> <span class="string">https://glebbahmutov.com/triple-tested/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># we need our source code that has package.json and Cypress specs</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">üõéÔ∏è</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">persist-credentials:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test</span> <span class="string">deployed</span> <span class="string">site</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">config:</span> <span class="string">baseUrl=https://glebbahmutov.com/triple-tested/</span></span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong> if we only change the <code>deployed.yml</code> file, the deploy event WILL NOT be triggered - because the VuePress content has stayed the same! Thus we need to change some text in the <code>docs</code> folder in order to trigger a new deploy and see the tests in action. I will remove <code>another one üëÜ</code> line and push again.</p>
<p>The CI workflows shows the <code>deployed</code> workflow failing - because the tests we have added detect the broken static site</p>
<p><img src="/blog/images/triple-tested/deployed-workflow-failed.png" alt="The deployed workflow fails as expected"></p>
<p>Click on the <code>deployed</code> workflow to see both Cypress tests failing as expected.</p>
<p><img src="/blog/images/triple-tested/both-tests-failed.png" alt="Both tests failed against the production site"></p>
<p>We have automated the deployment and testing the production site. At least now we know when the deployment went badly and corrective measures should be taken.</p>
<h2><span id="fixing-the-deploy-url">Fixing the deploy url</span></h2><p>After reading the <a target="_blank" rel="noopener" href="https://vuepress.vuejs.org/guide/deploy.html">VuePress deploy guide</a> one more time, I open the <code>docs/.vuepress/config.js</code> file and add the <a target="_blank" rel="noopener" href="https://vuepress.vuejs.org/config/#base"><code>base</code> parameter</a>:</p>
<figure class="highlight js"><figcaption><span>docs/.vuepress/config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  title: <span class="string">&#x27;Triple Tested&#x27;</span>,</span><br><span class="line">  description: <span class="string">&#x27;Example static site&#x27;</span>,</span><br><span class="line">  base: <span class="string">&#x27;/triple-tested/&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>base</code> parameter also changes the local url when using <code>npm run docs:dev</code> script, thus we update <code>cypress.json</code> (and related <code>start-server-and-wait</code> parameters)</p>
<figure class="highlight json"><figcaption><span>cypress.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;baseUrl&quot;</span>: <span class="string">&quot;http://localhost:8080/triple-tested&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><figcaption><span>.github/workflows/ci.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">and</span> <span class="string">test</span> <span class="string">üì¶‚úÖ</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v1</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">start:</span> <span class="string">&#x27;npm run docs:dev&#x27;</span></span><br><span class="line">    <span class="attr">wait-on:</span> <span class="string">&#x27;http://localhost:8080/triple-tested/&#x27;</span></span><br></pre></td></tr></table></figure>
<p>Let&#39;s push the commit, the local tests pass, then the deploy happens. And now the post-deploy Cypress tests pass!</p>
<p><img src="/blog/images/triple-tested/deploy-tests-passed.png" alt="Post-deploy CI job passes"></p>
<p>We can check the site at GitHub Pages - it is working.</p>
<p><img src="/blog/images/triple-tested/working-site.gif" alt="The site is working correctly"></p>
<p>Great!</p>
<h2><span id="preventing-broken-deployments">Preventing broken deployments</span></h2><p>Can we prevent a broken site from being deployed to production in the first place? Could we have caught an invalid or missing <code>base</code> configuration?</p>
<p>When we tested the site in the section <a href="#local-test-on-ci">Local test on CI</a>, we used the development VuePress server via <code>vuepress dev docs</code> command. The served site passed the tests, then we built the production version and deployed it. We then ran the production site - which failed at first. We should have tested the production version before deployment in a way <em>similar to the production site</em>. I have already showed that we can serve the <code>dist</code> folder using <a target="_blank" rel="noopener" href="https://github.com/zeit/serve">serve</a> module: <code>$ npx serve docs/.vuepress/dist</code>.</p>
<p>Let&#39;s simulate the broken build again by removing the <code>base</code> property from the file <code>docs/.vuepress/config.js</code>:</p>
<figure class="highlight js"><figcaption><span>docs/.vuepress/config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  title: <span class="string">&#x27;Triple Tested&#x27;</span>,</span><br><span class="line">  description: <span class="string">&#x27;Example static site&#x27;</span>,</span><br><span class="line">  <span class="comment">// removing &quot;base&quot; property to break production site</span></span><br><span class="line">  <span class="comment">// base: &#x27;/triple-tested/&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To simulate sub path, we can serve the bundle from a nested folder.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> build the production site</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm run docs:build</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir output</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp -r docs/.vuepress/dist output/triple-tested</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">let</span><span class="string">&#x27;s look at the &quot;production&quot; folder</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -la output</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   3 gleb  staff   96 Mar 23 22:02 .</span><br><span class="line">drwxr-xr-x  14 gleb  staff  448 Mar 23 22:02 ..</span><br><span class="line">drwxr-xr-x   5 gleb  staff  160 Mar 23 22:02 triple-tested</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls -la output/triple-tested/</span></span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  5 gleb  staff   160 Mar 23 22:02 .</span><br><span class="line">drwxr-xr-x  3 gleb  staff    96 Mar 23 22:02 ..</span><br><span class="line">-rw-r--r--  1 gleb  staff  2990 Mar 23 22:02 about.html</span><br><span class="line">drwxr-xr-x  5 gleb  staff   160 Mar 23 22:02 assets</span><br><span class="line">-rw-r--r--  1 gleb  staff  2512 Mar 23 22:02 index.html</span><br></pre></td></tr></table></figure>
<p>Now let&#39;s serve the <code>output</code> folder</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npx serve output</span></span><br><span class="line"></span><br><span class="line">   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span><br><span class="line">   ‚îÇ                                                ‚îÇ</span><br><span class="line">   ‚îÇ   Serving!                                     ‚îÇ</span><br><span class="line">   ‚îÇ                                                ‚îÇ</span><br><span class="line">   ‚îÇ   - Local:            http://localhost:5000    ‚îÇ</span><br><span class="line">   ‚îÇ   - On Your Network:  http://10.0.0.124:5000   ‚îÇ</span><br><span class="line">   ‚îÇ                                                ‚îÇ</span><br><span class="line">   ‚îÇ   Copied local address to clipboard!           ‚îÇ</span><br><span class="line">   ‚îÇ                                                ‚îÇ</span><br><span class="line">   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span><br></pre></td></tr></table></figure>
<p>Open <code>http://localhost:5000/triple-tested</code> in the browser to see exactly the same broken site as we had in production before.</p>
<p><img src="/blog/images/triple-tested/serve-output.png" alt="Accessing the sub path site locally shows missing resources"></p>
<p>Cypress catches the broken site</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> CYPRESS_baseUrl=http://localhost:5000/triple-tested npx cypress open</span></span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/triple-tested/broken-prod.png" alt="Testing production bundle locally"></p>
<p>Let&#39;s restore the <code>base</code> property in file <code>docs/.vuepress/config.js</code>, build the site, copy the <code>dist</code> folder into <code>output</code> and try again.</p>
<p><img src="/blog/images/triple-tested/passing-test.png" alt="Testing production site built correctly using base sub path"></p>
<p>Great, the tests pass when when we correctly set the <code>base</code> property. Now we need to make sure we test the production site on CI. Let&#39;s add these commands to <a target="_blank" rel="noopener" href="https://github.com/bahmutov/triple-tested/blob/master/.github/workflows/ci.yml">ci.yml</a> file</p>
<figure class="highlight yml"><figcaption><span>.github/workflows/ci.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">ci</span></span><br><span class="line"><span class="comment"># only deploy site from master branch</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># https://github.com/actions/checkout</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">üõéÔ∏è</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">persist-credentials:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># https://github.com/cypress-io/github-action</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">and</span> <span class="string">test</span> <span class="string">üì¶‚úÖ</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">start:</span> <span class="string">&#x27;npm run docs:dev&#x27;</span></span><br><span class="line">          <span class="attr">wait-on:</span> <span class="string">&#x27;http://localhost:8080/triple-tested/&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">site</span> <span class="string">üèó</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">docs:build</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Prepare</span> <span class="string">built</span> <span class="string">site</span> <span class="string">for</span> <span class="string">testing</span> <span class="string">üöõ</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">mkdir</span> <span class="string">output</span></span><br><span class="line">          <span class="string">cp</span> <span class="string">-r</span> <span class="string">./docs/.vuepress/dist</span> <span class="string">output/triple-tested</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Test</span> <span class="string">production</span> <span class="string">site</span> <span class="string">‚úÖ</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="comment"># we have already installed all dependencies above</span></span><br><span class="line">          <span class="attr">install:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">start:</span> <span class="string">&#x27;npx serve output&#x27;</span></span><br><span class="line">          <span class="attr">wait-on:</span> <span class="string">&#x27;http://localhost:5000/triple-tested/&#x27;</span></span><br><span class="line">          <span class="attr">config:</span> <span class="string">baseUrl=http://localhost:5000/triple-tested/</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># https://github.com/marketplace/actions/github-pages-action</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">üöÄ</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">peaceiris/actions-gh-pages@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">github_token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">publish_dir:</span> <span class="string">./docs/.vuepress/dist</span></span><br></pre></td></tr></table></figure>
<p>The GitHub Actions run and pass.</p>
<p><img src="/blog/images/triple-tested/gh-passed.png" alt="GitHub Actions tested the site in dev mode and as built production bundle"></p>
<p>The deploy went through to GitHub Pages and then was tested the 3rd time</p>
<p><img src="/blog/images/triple-tested/prod-tested.png" alt="Test jobs before and after deploy have passed"></p>
<h2><span id="tips">Tips</span></h2><p>Before I reach the <a href="#discussion">Discussion</a> section, let me give a couple of tips.</p>
<h3><span id="github-actions-badges">GitHub Actions badges</span></h3><p>For each GitHub workflow you can add a <a href="../trying-github-actions/#badges">badge to README file</a>. In our case we will have two separate workflows:</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">ci</span>](<span class="link">https://github.com/bahmutov/triple-tested/workflows/ci/badge.svg?branch=master</span>)</span><br><span class="line">![<span class="string">deployed</span>](<span class="link">https://github.com/bahmutov/triple-tested/workflows/deployed/badge.svg?branch=master</span>)</span><br></pre></td></tr></table></figure>
<p>If you want each badge to lead immediately to matching workflow, add destination urls</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">![ci</span>](<span class="link">https://github.com/bahmutov/triple-tested/workflows/ci/badge.svg?branch=master</span>)](<span class="link">https://github.com/bahmutov/triple-tested/actions?query=workflow%3Aci</span>)</span><br><span class="line">[<span class="string">![deployed</span>](<span class="link">https://github.com/bahmutov/triple-tested/workflows/deployed/badge.svg?branch=master</span>)](<span class="link">https://github.com/bahmutov/triple-tested/actions?query=workflow%3Adeployed</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/blog/images/triple-tested/badges.png" alt="CI badges"></p>
<h3><span id="environment-variables">Environment variables</span></h3><p>We can avoid hard-coding the production URL in several places in CI configuration files, and instead can use <a target="_blank" rel="noopener" href="https://help.github.com/en/actions/configuring-and-managing-workflows/using-environment-variables">GitHub environment variables</a> to specify the base url to test.</p>
<p>Instead of</p>
<figure class="highlight yml"><figcaption><span>deployed.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test</span> <span class="string">deployed</span> <span class="string">site</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">config:</span> <span class="string">baseUrl=https://glebbahmutov.com/triple-tested/</span></span><br></pre></td></tr></table></figure>
<p>we will set the <code>CYPRESS_baseUrl</code> at the job level</p>
<figure class="highlight yml"><figcaption><span>deployed.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">deployed</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">status:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">test-deployed-page:</span></span><br><span class="line">    <span class="attr">if:</span> <span class="string">github.event.context</span> <span class="string">==</span> <span class="string">&#x27;github/pages&#x27;</span> <span class="string">&amp;&amp;</span> <span class="string">github.event.state</span> <span class="string">==</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="attr">CYPRESS_baseUrl:</span> <span class="string">https://glebbahmutov.com/triple-tested/</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;gh-pages üìë built successfully ‚úÖ&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">show</span> <span class="string">deployed</span> <span class="string">page</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">curl</span> <span class="string">-s</span> <span class="string">$CYPRESS_baseUrl</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># we need our source code that has package.json and Cypress specs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">üõéÔ∏è</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">persist-credentials:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># https://github.com/cypress-io/github-action</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v1</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">test</span> <span class="string">deployed</span> <span class="string">site</span></span><br></pre></td></tr></table></figure>
<h3><span id="record-to-dashboard">Record to Dashboard</span></h3><p>GitHub Actions give you a lot of free resources for public repositories. But storing and viewing the Cypress test artifacts (screenshots on failure, videos of the test runs, test results) is inconvenient. Thus I recommend using <a target="_blank" rel="noopener" href="https://on.cypress.io/dashboard-introduction">Cypress Dashboard</a> to record the tests.</p>
<p>I have <a target="_blank" rel="noopener" href="https://on.cypress.io/projects">set up project to record</a> and stored the <code>CYPRESS_RECORD_KEY</code> as a secret at GitHub repo settings.</p>
<p><img src="/blog/images/triple-tested/record-key.png" alt="Cypress record key kept in secrets"></p>
<p>We can set the secret as environment variable in the specific steps that run Cypress tests, and pass <code>record: true</code> parameter. You can find all parameters in examples inside the <a target="_blank" rel="noopener" href="https://github.com/cypress-io/github-action">cypress-io/github-action</a> repository.</p>
<figure class="highlight yml"><figcaption><span>ci.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">and</span> <span class="string">test</span> <span class="string">üì¶‚úÖ</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v1</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">start:</span> <span class="string">&#x27;npm run docs:dev&#x27;</span></span><br><span class="line">    <span class="attr">wait-on:</span> <span class="string">&#x27;http://localhost:8080/triple-tested/&#x27;</span></span><br><span class="line">    <span class="attr">record:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">&#x27;development&#x27;</span></span><br><span class="line">    <span class="attr">tag:</span> <span class="string">&#x27;ci&#x27;</span></span><br><span class="line">  <span class="attr">env:</span></span><br><span class="line">    <span class="attr">CYPRESS_RECORD_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.CYPRESS_RECORD_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Test</span> <span class="string">production</span> <span class="string">site</span> <span class="string">‚úÖ</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v1</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="comment"># we have already installed all dependencies above</span></span><br><span class="line">    <span class="attr">install:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">start:</span> <span class="string">&#x27;npx serve output&#x27;</span></span><br><span class="line">    <span class="attr">wait-on:</span> <span class="string">&#x27;http://localhost:5000/triple-tested/&#x27;</span></span><br><span class="line">    <span class="attr">config:</span> <span class="string">baseUrl=http://localhost:5000/triple-tested/</span></span><br><span class="line">    <span class="attr">record:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">group:</span> <span class="string">&#x27;production bundle&#x27;</span></span><br><span class="line">  <span class="attr">env:</span></span><br><span class="line">    <span class="attr">CYPRESS_RECORD_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.CYPRESS_RECORD_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure>
<p>In the <code>deployed.yml</code> workflow we similarly record the test results</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">cypress-io/github-action@v1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test</span> <span class="string">deployed</span> <span class="string">site</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">record:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">tag:</span> <span class="string">&#x27;production&#x27;</span></span><br><span class="line">  <span class="attr">env:</span></span><br><span class="line">    <span class="attr">CYPRESS_RECORD_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.CYPRESS_RECORD_KEY</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>You can add a badge to the README.md pointing at the project&#39;s dashboard, so users can find the test results. The project Id is stored in <code>cypress.json</code> file, in our case it is <code>rroimy</code>.</p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">![Cypress Dashboard</span>](<span class="link">https://img.shields.io/badge/cypress-dashboard-brightgreen.svg</span>)](<span class="link">https://dashboard.cypress.io/#/projects/rroimy/runs</span>)</span><br></pre></td></tr></table></figure>
<p>See results for yourself: <a target="_blank" rel="noopener" href="https://dashboard.cypress.io/#/projects/rroimy/runs">Cypress Dashboard</a></p>
<p>For each deployment, we see two runs: one is tagged <code>ci</code> and and the second one is tagged <code>production</code>.</p>
<p><img src="/blog/images/triple-tested/runs.png" alt="Two runs for each deployment"></p>
<p>In the run tagged <code>ci</code>, the two sets of tests are in two groups:</p>
<p><img src="/blog/images/triple-tested/ci-runs.png" alt="CI run has two groups of tests"></p>
<p>Each spec has its video captured, and if there were any failures, there would be screenshots too.</p>
<h2><span id="discussion">Discussion</span></h2><p>I have shown how to build, test and deploy a static site using GitHub Actions and Pages working together. Because many things can go wrong, I have tested the site three times:</p>
<ul>
<li>First using the development server that comes with VuePress.</li>
<li>Second time after building the production version by serving it locally to simulate the sub path hosting</li>
<li>Third time after deployment to check if the production site is working for my users</li>
</ul>
<p>While triple testing might seem like an overkill, I hope you see why it was necessary. We ran end-to-end tests after each major code transformation: building the production bundle is such a big change, it was necessary to validate the produced bundle. Deploying the site to GitHub Pages is also a big change, so we want to run tests after that. GitHub Actions allowed us to run Cypress tests in all scenarios.</p>
<p>We did not have to run <em>all tests</em> in every scenario. For example, we could have executed just a few smoke tests after building the production bundles and after the deployment. Read the blog post <a target="_blank" rel="noopener" href="https://www.cypress.io/blog/2019/12/06/use-meaningful-smoke-tests/">Use meaningful smoke tests</a> about running a small  subset of tests.</p>
<p><strong>Source code:</strong> you can find the code for this blog post in <a target="_blank" rel="noopener" href="https://github.com/bahmutov/triple-tested">bahmutov/triple-tested</a>. You can see the finished (well-tested) version of the site deployed at <a href="https://glebbahmutov.com/triple-tested/">https://glebbahmutov.com/triple-tested/</a>.</p>
<h2><span id="see-more">See more</span></h2><ul>
<li>My other GitHub Actions blog posts are available under the tag <a href="../tags/github">/tags/github</a></li>
</ul>

      
    </div>

    
      <footer class="article-footer personal-links">
  Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
  see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
  watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
  browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/triple-tested/" data-id="ckrs8lrtm01xx99vgd9d88ecz" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/triple-tested/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/ci/" rel="tag">ci</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/" rel="tag">cypress</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/github/" rel="tag">github</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../scrape-static-site-with-algolia/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Scrape Static Site with Algolia
        
      </div>
    </a>
  
  
    <a href="../ccl-pitch-at-pkg/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">CitizenClimateLobby short pitch</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">138</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">406</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">109</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">132</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">68</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">165</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">22</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">128</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">18</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.38px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.54px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.77px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.85px;">advice</a> <a href="../tags/algolia/" style="font-size: 10px;">algolia</a> <a href="../tags/angularjs/" style="font-size: 17.69px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.08px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.69px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.77px;">browser</a> <a href="../tags/ci/" style="font-size: 16.54px;">ci</a> <a href="../tags/circle/" style="font-size: 12.69px;">circle</a> <a href="../tags/climate/" style="font-size: 14.62px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 13.46px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.31px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 19.62px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 13.85px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.77px;">d3</a> <a href="../tags/db/" style="font-size: 14.23px;">db</a> <a href="../tags/docker/" style="font-size: 14.23px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.92px;">documentation</a> <a href="../tags/es6/" style="font-size: 14.62px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.08px;">functional</a> <a href="../tags/generators/" style="font-size: 11.54px;">generators</a> <a href="../tags/git/" style="font-size: 15px;">git</a> <a href="../tags/github/" style="font-size: 15.38px;">github</a> <a href="../tags/graphql/" style="font-size: 11.15px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.31px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.77px;">gulp</a> <a href="../tags/hiring/" style="font-size: 10.77px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.31px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.54px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.77px;">interview</a> <a href="../tags/jade/" style="font-size: 11.15px;">jade</a> <a href="../tags/javascript/" style="font-size: 20px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.77px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.85px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 16.92px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.15px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.46px;">nodejs</a> <a href="../tags/performance/" style="font-size: 16.15px;">performance</a> <a href="../tags/presentation/" style="font-size: 11.92px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.31px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.38px;">proposal</a> <a href="../tags/ramda/" style="font-size: 10px;">ramda</a> <a href="../tags/react/" style="font-size: 11.54px;">react</a> <a href="../tags/react-native/" style="font-size: 11.15px;">react native</a> <a href="../tags/reactive/" style="font-size: 14.23px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.15px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.54px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 13.08px;">security</a> <a href="../tags/sentry/" style="font-size: 13.85px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.92px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.23px;">testing</a> <a href="../tags/tutorial/" style="font-size: 15.77px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 11.92px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.38px;">ui</a> <a href="../tags/vercel/" style="font-size: 12.69px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.15px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.54px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.92px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.77px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../visit-blank-page-between-tests/">Visit The Blank Page Between Cypress Tests</a>
          </li>
        
          <li>
            <a href="../burn-tests-on-circle/">Burn Cypress Tests on CircleCI</a>
          </li>
        
          <li>
            <a href="../avoid-cypress-pyramid-of-doom/">Avoid Cypress Pyramid of Doom</a>
          </li>
        
          <li>
            <a href="../control-nextjs-data-during-tests/">Control Next.js Server-Side Data During Cypress Tests</a>
          </li>
        
          <li>
            <a href="../test-feature-flags/">Test Feature Flags Using Cypress and Flagsmith</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/triple-tested/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
