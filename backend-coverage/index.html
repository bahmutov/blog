<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Backend Code Coverage from Cypress API tests | Better world by better software</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="üì¶ you can find the source code for this blog post in the repository bahmutov&#x2F;todomvc-express-api-test-coverage      Best practices The example application Cypress API tests Show the result   Cod">
<meta property="og:type" content="article">
<meta property="og:title" content="Backend Code Coverage from Cypress API tests">
<meta property="og:url" content="https://glebbahmutov.com/blog/backend-coverage/index.html">
<meta property="og:site_name" content="Better world by better software">
<meta property="og:description" content="üì¶ you can find the source code for this blog post in the repository bahmutov&#x2F;todomvc-express-api-test-coverage      Best practices The example application Cypress API tests Show the result   Cod">
<meta property="og:locale">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/app.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/source.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/first-test.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/confirm.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/write-html.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/messages.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/report-folder.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/report.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/report-on-circle.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/codecov1.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/delete-todo.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/delete-todo-test.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/status-checks.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/comment.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/pr-file-change.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/mark-todo.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/mark-todo-test.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/mark-todo-comment.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/clear-completed-todos.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/clear-completed-pr.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/pages-code.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/todo-page.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/completed-page.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/pages-comment.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/delete-todo-edge-case.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/delete-edge-case.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/delete-covered.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/edge-cases-pr.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/one-line.png">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/clear-completed.gif">
<meta property="og:image" content="https://glebbahmutov.com/blog/images/backend-coverage/100-comment.png">
<meta property="article:published_time" content="2021-01-06T05:00:00.000Z">
<meta property="article:modified_time" content="2021-06-15T13:13:30.235Z">
<meta property="article:author" content="Gleb Bahmutov">
<meta property="article:tag" content="testing">
<meta property="article:tag" content="cypress">
<meta property="article:tag" content="code coverage">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://glebbahmutov.com/blog/images/backend-coverage/app.png">
<meta name="twitter:creator" content="@bahmutov">
  
    <link rel="alternative" href="/blog/atom.xml" title="Better world by better software" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="preload" href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" as="style">
  
<link rel="stylesheet" href="../css/style.css">

  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59999353-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-titles">
      <div id="header-title" class="inner">
        <h1 id="logo-wrap">
          <a href="../index.html" id="logo">Better world by better software</a>
        </h1>
        <!--
        
        -->
        <!-- <span class="no-mobile">Software advice from</span> -->
        <h2 id="subtitle-wrap">
          <span class="subtitle">
            <a id="subtitle" href="https://glebbahmutov.com">Gleb Bahmutov PhD</a>
            <a id="nav-house-link" class="nav-icon" href="/" title="Home"></a>
            
              <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
            
            <a id="nav-search-btn" class="nav-icon" title="Search"></a>
            <div id="search-form-wrap">
              <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://glebbahmutov.com/blog"></form>
            </div>
          </span>
        </h2>

      </div>
    </div>
    <div id="climate-crisis">
      <h2>Our planet üåè is in danger</h2>
      <h3>Act today: <a href="/blog/climate-emergency/">what you can do</a></h3>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-backend-coverage" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="" class="article-date">
  <time datetime="2021-01-06T05:00:00.000Z" itemprop="datePublished">Jan 6 2021</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../categories/products/">products</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Backend Code Coverage from Cypress API tests
    </h1>

    <h2 class="article-title" itemprop="name">
      How to cover the entire backend code using Cypress API tests.
    </h2>

  


      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote class="pullquote"><p>üì¶ you can find the source code for this blog post in the repository <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todomvc-express-api-test-coverage">bahmutov&#x2F;todomvc-express-api-test-coverage</a></p>
</blockquote>

<!-- toc -->

<ul>
<li><a href="#best-practices">Best practices</a></li>
<li><a href="#the-example-application">The example application</a></li>
<li><a href="#cypress-api-tests">Cypress API tests</a><ul>
<li><a href="#show-the-result">Show the result</a></li>
</ul>
</li>
<li><a href="#code-coverage">Code coverage</a></li>
<li><a href="#continuous-integration-service">Continuous integration service</a></li>
<li><a href="#code-coverage-service">Code coverage service</a><ul>
<li><a href="#codecov-github-app">Codecov GitHub app</a></li>
</ul>
</li>
<li><a href="#increasing-code-coverage">Increasing code coverage</a><ul>
<li><a href="#mark-todo-completed">Mark todo completed</a></li>
<li><a href="#clear-completed-todos">Clear completed todos</a></li>
<li><a href="#individual-pages">Individual pages</a></li>
</ul>
</li>
<li><a href="#covering-the-edge-cases">Covering the edge cases</a></li>
<li><a href="#the-last-step-to-reach-100">The last step to reach 100</a></li>
<li><a href="#see-also">See also</a></li>
</ul>
<!-- tocstop -->

<h2><span id="best-practices">Best practices</span></h2><ul>
<li>Instrument the backend JavaScript or TypeScript server using <a target="_blank" rel="noopener" href="https://github.com/istanbuljs/nyc">nyc</a> and create coverage reports using <a target="_blank" rel="noopener" href="https://github.com/cypress-io/code-coverage">@cypress&#x2F;code-coverage plugin</a></li>
<li>Hit the backend from Cypress tests using <a target="_blank" rel="noopener" href="https://on.cypress.io/">cy.request</a></li>
<li>Set up the continuous integration and code coverage services early</li>
<li>Start by adding tests for the major features, this is will quickly increase the coverage percentage</li>
<li>Later concentrate on the edge cases using the code coverage report to find the missing source lines</li>
</ul>
<h2><span id="the-example-application">The example application</span></h2><p>Let&#39;s test a TodoMVC application - except our application will be completely rendered server-side. Here is how the application looks to the user</p>
<p><img src="/blog/images/backend-coverage/app.png" alt="TodoMVC application UI"></p>
<p>If we look at the source code we can see the sources disabled using <a href="/blog/disable-inline-javascript-for-security/" title="Content-Security-Policy">Content-Security-Policy</a> and the entire application just using forms.</p>
<p><img src="/blog/images/backend-coverage/source.png" alt="TodoMVC application source code"></p>
<p>Note: for demo purpose this application has artificial delays added to its code.</p>
<h2><span id="cypress-api-tests">Cypress API tests</span></h2><p>We could write end-to-end tests to operate on the app via its user interface, as I have done in the <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todomvc-express">bahmutov&#x2F;todomvc-express</a> repo. But let&#39;s have some fun. Let&#39;s test our application by executing just API tests. We can use <a target="_blank" rel="noopener" href="https://on.cypress.io/request">cy.request</a> commands and assert the results. If we wanted we could even use <a target="_blank" rel="noopener" href="https://github.com/bahmutov/cy-api">cy.api</a> custom command to show each request in the empty iframe, as I described in <a href="/blog/api-testing-with-sever-logs/" title="Black box API testing with server logs">Black box API testing with server logs</a>.</p>
<p>For example, let&#39;s validate that we can add a todo by executing a POST request.</p>
<figure class="highlight json"><figcaption><span>cypress/integration/api-spec.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">describe(&#x27;TodoMVC API&#x27;<span class="punctuation">,</span> () =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">  beforeEach(() =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">    cy.request(&#x27;POST&#x27;<span class="punctuation">,</span> &#x27;/reset&#x27;)</span><br><span class="line">  <span class="punctuation">&#125;</span>)</span><br><span class="line"></span><br><span class="line">  it(&#x27;adds a todo&#x27;<span class="punctuation">,</span> () =&gt; <span class="punctuation">&#123;</span></span><br><span class="line">    cy.request(&#x27;/todos&#x27;).its(&#x27;body&#x27;).should(&#x27;have.length&#x27;<span class="punctuation">,</span> <span class="number">0</span>)</span><br><span class="line">    cy.request(&#x27;POST&#x27;<span class="punctuation">,</span> &#x27;/&#x27;<span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">      what<span class="punctuation">:</span> &#x27;new todo&#x27;<span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span>)</span><br><span class="line">    cy.request(&#x27;/todos&#x27;)</span><br><span class="line">      .its(&#x27;body&#x27;)</span><br><span class="line">      .should(&#x27;have.length&#x27;<span class="punctuation">,</span> <span class="number">1</span>)</span><br><span class="line">      .its(&#x27;<span class="number">0</span>&#x27;)</span><br><span class="line">      .should(&#x27;include&#x27;<span class="punctuation">,</span> <span class="punctuation">&#123;</span></span><br><span class="line">        what<span class="punctuation">:</span> &#x27;new todo&#x27;<span class="punctuation">,</span></span><br><span class="line">        done<span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#125;</span>)</span><br><span class="line">      .and(&#x27;have.property&#x27;<span class="punctuation">,</span> &#x27;id&#x27;)</span><br><span class="line">      <span class="comment">// our uuid is lowercase</span></span><br><span class="line">      .should(</span><br><span class="line">        &#x27;match&#x27;<span class="punctuation">,</span></span><br><span class="line">        /^<span class="punctuation">[</span><span class="number">0</span><span class="number">-9</span>a-f<span class="punctuation">]</span><span class="punctuation">&#123;</span><span class="number">8</span><span class="punctuation">&#125;</span>\b-<span class="punctuation">[</span><span class="number">0</span><span class="number">-9</span>a-f<span class="punctuation">]</span><span class="punctuation">&#123;</span><span class="number">4</span><span class="punctuation">&#125;</span>\b-<span class="punctuation">[</span><span class="number">0</span><span class="number">-9</span>a-f<span class="punctuation">]</span><span class="punctuation">&#123;</span><span class="number">4</span><span class="punctuation">&#125;</span>\b-<span class="punctuation">[</span><span class="number">0</span><span class="number">-9</span>a-f<span class="punctuation">]</span><span class="punctuation">&#123;</span><span class="number">4</span><span class="punctuation">&#125;</span>\b-<span class="punctuation">[</span><span class="number">0</span><span class="number">-9</span>a-f<span class="punctuation">]</span><span class="punctuation">&#123;</span><span class="number">12</span><span class="punctuation">&#125;</span>$/<span class="punctuation">,</span></span><br><span class="line">      )</span><br><span class="line">  <span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>The test passes - we can add a todo using API requests</p>
<p><img src="/blog/images/backend-coverage/first-test.gif" alt="The first API test"></p>
<h3><span id="show-the-result">Show the result</span></h3><p>We have an empty iframe where the application would normally be. Let&#39;s use it. We can simply load the base url using <code>cy.visit(&#39;/&#39;)</code> command at the end of the test.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the same API test</span></span><br><span class="line">cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// now that the server response is in the test runner</span></span><br><span class="line"><span class="comment">// let&#x27;s query it like a normal site</span></span><br><span class="line">cy.<span class="title function_">get</span>(<span class="string">&#x27;.todo-list li&#x27;</span>)</span><br><span class="line">  .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">  .<span class="title function_">first</span>()</span><br><span class="line">  .<span class="title function_">find</span>(<span class="string">&#x27;label&#x27;</span>)</span><br><span class="line">  .<span class="title function_">should</span>(<span class="string">&#x27;have.text&#x27;</span>, <span class="string">&#x27;new todo&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>We have confirmed the todo has the expected text</p>
<p><img src="/blog/images/backend-coverage/confirm.png" alt="Confirm the app shows the added todo"></p>
<p>We can also go about this the other way - the <code>GET /</code> should return the rendered HTML page. Let&#39;s write this HTML into the <code>document</code> directly, without using <code>cy.visit</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the same API test</span></span><br><span class="line">cy.<span class="title function_">log</span>(<span class="string">&#x27;**render HTML**&#x27;</span>)</span><br><span class="line">cy.<span class="title function_">request</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  .<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">html</span>) =&gt;</span> &#123;</span><br><span class="line">    cy.<span class="title function_">document</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">doc</span>) =&gt;</span> &#123;</span><br><span class="line">      doc.<span class="title function_">write</span>(html)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// now that the server response is in the test runner</span></span><br><span class="line"><span class="comment">// let&#x27;s query it like a normal site</span></span><br><span class="line">cy.<span class="title function_">get</span>(<span class="string">&#x27;.todo-list li&#x27;</span>)</span><br><span class="line">  .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">  .<span class="title function_">first</span>()</span><br><span class="line">  .<span class="title function_">find</span>(<span class="string">&#x27;label&#x27;</span>)</span><br><span class="line">  .<span class="title function_">should</span>(<span class="string">&#x27;have.text&#x27;</span>, <span class="string">&#x27;new todo&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>The tested application looks the same way.</p>
<p><img src="/blog/images/backend-coverage/write-html.png" alt="Writing the HTML into the document"></p>
<p><strong>Tip:</strong> a good way to always replace the document&#39;s HTML is to use a helper method</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// replaces any current HTML in the document with new html</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">writeHtml</span> = (<span class="params">html</span>) =&gt; &#123;</span><br><span class="line">  cy.<span class="title function_">document</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">doc</span>) =&gt;</span> &#123;</span><br><span class="line">    doc.<span class="title function_">open</span>()</span><br><span class="line">    doc.<span class="title function_">write</span>(html)</span><br><span class="line">    doc.<span class="title function_">close</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cy.<span class="title function_">log</span>(<span class="string">&#x27;**render HTML**&#x27;</span>)</span><br><span class="line">cy.<span class="title function_">request</span>(<span class="string">&#x27;/&#x27;</span>).<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">then</span>(writeHtml)</span><br></pre></td></tr></table></figure>

<h2><span id="code-coverage">Code coverage</span></h2><p>Let&#39;s measure the backend code in the &quot;src&quot; folder we exercise with our test. We can install <a target="_blank" rel="noopener" href="https://github.com/cypress-io/code-coverage">cypress-io&#x2F;code-coverage</a> to generate the reports and <a target="_blank" rel="noopener" href="https://github.com/istanbuljs/nyc">nyc</a> to instrument our Node.js server.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">npm i -D nyc @cypress/code-coverage</span></span><br><span class="line">+ nyc@15.1.0</span><br><span class="line">+ @cypress/code-coverage@3.9.0</span><br></pre></td></tr></table></figure>

<p>To instrument the server prepend the <code>node</code> command with <code>nyc</code> in the <code>package.json</code> start script</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- &quot;start&quot;: &quot;node src/start.js&quot;</span><br><span class="line">+ &quot;start&quot;: &quot;nyc --silent node src/start.js&quot;</span><br></pre></td></tr></table></figure>

<p>And add an endpoint returning the code coverage object when needed. Since our application uses Express.js we can use the Express helper code included with <code>@cypress/code-coverage</code></p>
<figure class="highlight js"><figcaption><span>src/app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">// returns code coverage information if available</span></span><br><span class="line"><span class="comment">// https://github.com/cypress-io/code-coverage</span></span><br><span class="line"><span class="comment">/* istanbul ignore next */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">global</span>.<span class="property">__coverage__</span>) &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;@cypress/code-coverage/middleware/express&#x27;</span>)(app)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Our Cypress config file tells the plugin where to find the backend code coverage. It also tells the plugin not to expect any frontend code coverage - since the app is purely HTML.</p>
<figure class="highlight json"><figcaption><span>cypress.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;baseUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:3000&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;codeCoverage&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:3000/__coverage__&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;expectBackendCoverageOnly&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>The application runs and shows messages from the code coverage plugin.</p>
<p><img src="/blog/images/backend-coverage/messages.png" alt="Messages from the code coverage plugin"></p>
<p>If you click on the last message &quot;Generating report&quot; you can find the output folder printed to the DevTools console</p>
<p><img src="/blog/images/backend-coverage/report-folder.png" alt="The output code coverage report folder"></p>
<p>The folder <code>coverage</code> contains reports in multiple formats: html, clover, JSON, lcov. I mostly look at the html report</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">open coverage/lcov-report/index.html</span></span><br></pre></td></tr></table></figure>

<p>Not bad - our single test covers 72% of the backend source code</p>
<p><img src="/blog/images/backend-coverage/report.png" alt="Code coverage after one test"></p>
<h2><span id="continuous-integration-service">Continuous integration service</span></h2><p>Before we write more tests, I want to run E2E tests on CI. I will pick CircleCI because I can use <a target="_blank" rel="noopener" href="https://github.com/cypress-io/circleci-orb">Cypress orb</a> to run tests, and because I can store the code coverage folder as a test artifact there.</p>
<figure class="highlight yml"><figcaption><span>.circleci/config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">2.1</span></span><br><span class="line"><span class="attr">orbs:</span></span><br><span class="line">  <span class="attr">cypress:</span> <span class="string">cypress-io/cypress@1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">commands:</span></span><br><span class="line">  <span class="attr">report-coverage:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Store</span> <span class="string">coverage</span> <span class="string">report</span> <span class="string">as</span> <span class="string">an</span> <span class="string">artifact</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">store_artifacts:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">coverage</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">npx</span> <span class="string">nyc</span> <span class="string">report</span> <span class="string">--reporter=text</span> <span class="string">||</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">workflows:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">jobs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">cypress/run:</span></span><br><span class="line">          <span class="attr">start:</span> <span class="string">npm</span> <span class="string">start</span></span><br><span class="line">          <span class="attr">wait-on:</span> <span class="string">&#x27;http://localhost:3000&#x27;</span></span><br><span class="line">          <span class="attr">no-workspace:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">post-steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">report-coverage</span></span><br></pre></td></tr></table></figure>

<p>Out tests pass and we can see the coverage report - it is a static HTML file served directly by CircleCI. Just click on the &quot;Test Artifacts&quot; tab in the job and select the &quot;index.html&quot; link.</p>
<p><img src="/blog/images/backend-coverage/report-on-circle.gif" alt="Viewing the code coverage report as CircleCI test artifact"></p>
<h2><span id="code-coverage-service">Code coverage service</span></h2><p>We want to ensure that our app works. Thus we want to test every commit and every pull request using the CI service. Similarly, we want to ensure that every feature we add to the web application is tested <em>at the same time</em>. The simplest way to ensure our code coverage increases with new features, and does not increase with code refactorings is to use code coverage as a service. For this example, I picked <a target="_blank" rel="noopener" href="https://codecov.io/">codecov.io</a> and you can see the latest results for this blog post&#39;s example repository at <a target="_blank" rel="noopener" href="https://codecov.io/gh/bahmutov/todomvc-express-api-test-coverage">todomvc-express-api-test-coverage</a> URL.</p>
<p>After every CI run, we need to upload the code coverage report (the JSON file in this case) to Codecov service. The simplest way to do this is to use <a target="_blank" rel="noopener" href="https://circleci.com/developer/orbs/orb/codecov/codecov">their orb</a></p>
<figure class="highlight yml"><figcaption><span>.circleci/config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">2.1</span></span><br><span class="line"><span class="attr">orbs:</span></span><br><span class="line">  <span class="attr">cypress:</span> <span class="string">cypress-io/cypress@1</span></span><br><span class="line">  <span class="attr">codecov:</span> <span class="string">codecov/codecov@1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">commands:</span></span><br><span class="line">  <span class="attr">report-coverage:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Store</span> <span class="string">coverage</span> <span class="string">report</span> <span class="string">as</span> <span class="string">an</span> <span class="string">artifact</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">store_artifacts:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">coverage</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">run:</span> <span class="string">npx</span> <span class="string">nyc</span> <span class="string">report</span> <span class="string">--reporter=text</span> <span class="string">||</span> <span class="literal">true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">codecov/upload:</span></span><br><span class="line">          <span class="attr">file:</span> <span class="string">coverage/coverage-final.json</span></span><br><span class="line"></span><br><span class="line"><span class="attr">workflows:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">jobs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">cypress/run:</span></span><br><span class="line">          <span class="attr">start:</span> <span class="string">npm</span> <span class="string">start</span></span><br><span class="line">          <span class="attr">wait-on:</span> <span class="string">&#x27;http://localhost:3000&#x27;</span></span><br><span class="line">          <span class="attr">no-workspace:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">post-steps:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">report-coverage</span></span><br></pre></td></tr></table></figure>

<p>We literally added 3 lines to our YML file: Codecov figures out the commit, the branch, the pull request automatically using the environment variables.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">codecov: codecov/codecov@1</span><br><span class="line">- codecov/upload:</span><br><span class="line">    file: coverage/coverage-final.json</span><br></pre></td></tr></table></figure>

<p>The dashboard shows approximately the same numbers (Codecov uses line coverage by default)</p>
<p><img src="/blog/images/backend-coverage/codecov1.png" alt="Codecov report"></p>
<h3><span id="codecov-github-app">Codecov GitHub app</span></h3><p>We will write more tests, but first let&#39;s ensure that every pull request increases the code coverage or at least keeps it the same. The simplest way to check the pull request against the current baseline coverage number is by installing a <a target="_blank" rel="noopener" href="https://github.com/apps/codecov">Codecov GitHub application</a>.</p>
<p>After the application has been installed and configured to work on [bahmutov&#x2F;todomvc-express-api-test-coverage]
<a target="_blank" rel="noopener" href="https://github.com/bahmutov/todomvc-express-api-test-coverage">todomvc-express-api-test-coverage</a> let&#39;s open a pull request. Let&#39;s inspect the source files with low code coverage to find a feature we are not testing yet.</p>
<p><img src="/blog/images/backend-coverage/delete-todo.gif" alt="Inspecting the code coverage to find untested code"></p>
<p>By inspecting the coverage report we see that deleting todos has not been tested yet. Let&#39;s write a test and open a pull request.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;deletes todo&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;new todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;0.id&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">      cy.<span class="title function_">request</span>(<span class="string">&#x27;DELETE&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123; id &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// after deleting the todo, we should get back to zero todos</span></span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>).<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/backend-coverage/delete-todo-test.gif" alt="Delete todo test"></p>
<p>Let&#39;s open the pull request <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todomvc-express-api-test-coverage/pull/1">#1</a>. The CI runs and the code coverage is sent to Codecov, which posts status checks on the pull request.</p>
<p><img src="/blog/images/backend-coverage/status-checks.png" alt="CI and code coverage status checks"></p>
<p>The status checks tell us the code coverage has increased by almost 6%. The more details are available in the PR comment posted by Codecov.</p>
<p><img src="/blog/images/backend-coverage/comment.png" alt="Code coverage details comment posted by Codecov"></p>
<p>We can click on the comment to open the Codecov PR page where we can find every source file with changed code coverage. For example the <code>src/app.js</code> shows the following lines are now covered.</p>
<p><img src="/blog/images/backend-coverage/pr-file-change.png" alt="Several source lines previously not covered are now being tested"></p>
<p>We can safely merge this pull request. The tests pass and the code coverage increases.</p>
<h2><span id="increasing-code-coverage">Increasing code coverage</span></h2><p>We can repeat the process several times:</p>
<ol>
<li>inspect the code coverage report to find major features without tests</li>
<li>write an API test to exercise the feature</li>
<li>open a pull request and merge if tests pass and code coverage increases</li>
</ol>
<h3><span id="mark-todo-completed">Mark todo completed</span></h3><p>For example, marking a todo completed needs a test.</p>
<p><img src="/blog/images/backend-coverage/mark-todo.png" alt="Mark todo source lines are not covered"></p>
<p>Let&#39;s write a test</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;completes todo&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;new todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;0.id&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">      cy.<span class="title function_">request</span>(<span class="string">&#x27;PATCH&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123; id, <span class="attr">done</span>: <span class="string">&#x27;true&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// confirm the todo was marked</span></span><br><span class="line">      cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>)</span><br><span class="line">        .<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">        .<span class="title function_">should</span>(<span class="string">&#x27;deep.equal&#x27;</span>, [</span><br><span class="line">          &#123;</span><br><span class="line">            id,</span><br><span class="line">            <span class="attr">what</span>: <span class="string">&#x27;new todo&#x27;</span>,</span><br><span class="line">            <span class="attr">done</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ])</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>The test passes locally</p>
<p><img src="/blog/images/backend-coverage/mark-todo-test.png" alt="Mark todo test"></p>
<p>The pull request<a target="_blank" rel="noopener" href="https://github.com/bahmutov/todomvc-express-api-test-coverage/pull/2">#2</a> increases the code coverage by another 6%.</p>
<p><img src="/blog/images/backend-coverage/mark-todo-comment.png" alt="Mark todo pull request code coverage comment"></p>
<p>We merge it.</p>
<h3><span id="clear-completed-todos">Clear completed todos</span></h3><p>Next we can add a test for uncovered lines for <code>clearCompleted</code> function.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;clears completed todo&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// let&#x27;s add two todos and mark one of them completed</span></span><br><span class="line">  <span class="comment">// after clearing the completed todos we can check</span></span><br><span class="line">  <span class="comment">// that only 1 item remains</span></span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;first todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;second todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">todos</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// confirm the order of returned todos</span></span><br><span class="line">      <span class="comment">// our application returns the last added todo first</span></span><br><span class="line">      <span class="title function_">expect</span>(todos[<span class="number">0</span>], <span class="string">&#x27;first item&#x27;</span>).<span class="property">to</span>.<span class="title function_">contain</span>(&#123;</span><br><span class="line">        <span class="attr">what</span>: <span class="string">&#x27;second todo&#x27;</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="title function_">expect</span>(todos[<span class="number">1</span>], <span class="string">&#x27;second item&#x27;</span>).<span class="property">to</span>.<span class="title function_">contain</span>(&#123;</span><br><span class="line">        <span class="attr">what</span>: <span class="string">&#x27;first todo&#x27;</span>,</span><br><span class="line">        <span class="attr">done</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      cy.<span class="title function_">request</span>(<span class="string">&#x27;PATCH&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123; <span class="attr">id</span>: todos[<span class="number">1</span>].<span class="property">id</span>, <span class="attr">done</span>: <span class="string">&#x27;true&#x27;</span> &#125;)</span><br><span class="line">      cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/clear-completed&#x27;</span>)</span><br><span class="line">      <span class="comment">// confirm a single item remains</span></span><br><span class="line">      cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>).<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;deep.equal&#x27;</span>, [todos[<span class="number">0</span>]])</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/backend-coverage/clear-completed-todos.png" alt="Clear completed todos test"></p>
<p>The pull request <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todomvc-express-api-test-coverage/pull/3">#3</a> increases the code coverage by 4%</p>
<p><img src="/blog/images/backend-coverage/clear-completed-pr.png" alt="Clear completed todos pull request status checks"></p>
<h3><span id="individual-pages">Individual pages</span></h3><p>Inspecting the lines not covered by tests we can find handlers for the individual pages</p>
<p><img src="/blog/images/backend-coverage/pages-code.png" alt="Page handlers were not covered by the tests"></p>
<p>The above functions are called in response to the individual page routes</p>
<figure class="highlight js"><figcaption><span>src/app.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/todo/:id&#x27;</span>, sendTodoPage)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/active&#x27;</span>, activeTodosPage)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/completed&#x27;</span>, completedTodosPage)</span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/todos&#x27;</span>, sendTodos)</span><br></pre></td></tr></table></figure>

<p>Let&#39;s test these pages. For example to test the individual todo item page, we could do</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;has todo page&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;new todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;0.id&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">      cy.<span class="title function_">log</span>(<span class="string">&#x27;**render todo page HTML**&#x27;</span>)</span><br><span class="line">      <span class="keyword">const</span> url = <span class="string">`/todo/<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">      cy.<span class="title function_">request</span>(url)</span><br><span class="line">        .<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">(<span class="params">html</span>) =&gt;</span> &#123;</span><br><span class="line">          cy.<span class="title function_">document</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">doc</span>) =&gt;</span> &#123;</span><br><span class="line">            doc.<span class="title function_">write</span>(html)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="comment">// and confirm a single todo is shown and it is a link to itself</span></span><br><span class="line">      cy.<span class="title function_">get</span>(<span class="string">&#x27;.todo-list li&#x27;</span>)</span><br><span class="line">        .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">        .<span class="title function_">first</span>()</span><br><span class="line">        .<span class="title function_">find</span>(<span class="string">&#x27;label&#x27;</span>)</span><br><span class="line">        .<span class="title function_">should</span>(<span class="string">&#x27;have.text&#x27;</span>, <span class="string">&#x27;new todo&#x27;</span>)</span><br><span class="line">        .<span class="title function_">find</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">        .<span class="title function_">should</span>(<span class="string">&#x27;have.attr&#x27;</span>, <span class="string">&#x27;href&#x27;</span>, url)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/backend-coverage/todo-page.png" alt="Single todo page test"></p>
<p>We can create a couple todos, mark one completed, the other should be displayed on the active page</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;has active page&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;first todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;second todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">todos</span>) =&gt;</span> &#123;</span><br><span class="line">      cy.<span class="title function_">request</span>(<span class="string">&#x27;PATCH&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123; <span class="attr">id</span>: todos[<span class="number">1</span>].<span class="property">id</span>, <span class="attr">done</span>: <span class="string">&#x27;true&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">      cy.<span class="title function_">log</span>(<span class="string">&#x27;**the first todo is active**&#x27;</span>)</span><br><span class="line">      cy.<span class="title function_">visit</span>(<span class="string">&#x27;/active&#x27;</span>)</span><br><span class="line">      cy.<span class="title function_">get</span>(<span class="string">&#x27;.todo-list li&#x27;</span>)</span><br><span class="line">        .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">        .<span class="title function_">first</span>()</span><br><span class="line">        .<span class="title function_">find</span>(<span class="string">&#x27;label&#x27;</span>)</span><br><span class="line">        .<span class="title function_">should</span>(<span class="string">&#x27;have.text&#x27;</span>, todos[<span class="number">0</span>].<span class="property">what</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Similarly, we can confirm the <code>/completed</code> page shows only the completed items, and every item has class &quot;completed&quot;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;has completed page&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;first todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;second todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>)</span><br><span class="line">    .<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>)</span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">todos</span>) =&gt;</span> &#123;</span><br><span class="line">      cy.<span class="title function_">request</span>(<span class="string">&#x27;PATCH&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123; <span class="attr">id</span>: todos[<span class="number">1</span>].<span class="property">id</span>, <span class="attr">done</span>: <span class="string">&#x27;true&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line">      cy.<span class="title function_">log</span>(<span class="string">&#x27;**the second todo is completed**&#x27;</span>)</span><br><span class="line">      cy.<span class="title function_">visit</span>(<span class="string">&#x27;/completed&#x27;</span>)</span><br><span class="line">      cy.<span class="title function_">get</span>(<span class="string">&#x27;.todo-list li&#x27;</span>)</span><br><span class="line">        .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">        .<span class="title function_">first</span>()</span><br><span class="line">        .<span class="title function_">should</span>(<span class="string">&#x27;have.class&#x27;</span>, <span class="string">&#x27;completed&#x27;</span>)</span><br><span class="line">        .<span class="title function_">find</span>(<span class="string">&#x27;label&#x27;</span>)</span><br><span class="line">        .<span class="title function_">should</span>(<span class="string">&#x27;have.text&#x27;</span>, todos[<span class="number">1</span>].<span class="property">what</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/backend-coverage/completed-page.png" alt="Completed todos page test"></p>
<p>The pull request <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todomvc-express-api-test-coverage/pull/4">#4</a> increases the code coverage by another 5% to 96%</p>
<p><img src="/blog/images/backend-coverage/pages-comment.png" alt="Pull request to test special pages"></p>
<h2><span id="covering-the-edge-cases">Covering the edge cases</span></h2><p>So far we have looked at the code coverage and added the tests for the features, like adding todos, deleting them, marking them completed. We have reached 96% code coverage this way. What remains now are the individual uncovered lines that really are edge cases in our code. For example, trying to delete a non-existent todo item is an edge case:</p>
<p><img src="/blog/images/backend-coverage/delete-todo-edge-case.png" alt="An edge case not covered by our delete test"></p>
<p>Usually such edge cases are hard to reach through the typical UI - after all, if the application has been wired correctly it should not try deleting a non-existent todo. The API tests on the other hand are ideal - we can just execute a DELETE action passing a random ID to reach these lines.</p>
<p>When adding an edge case test to the &quot;delete&quot; feature, I like to organize such tests under a suite of tests.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// instead of a single &quot;deletes todo&quot; test</span></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;TodoMVC API&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">context</span>(<span class="string">&#x27;delete&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;deletes todo&#x27;</span>, <span class="function">() =&gt;</span> &#123; ... &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;handles non-existent ID&#x27;</span>, <span class="function">() =&gt;</span> &#123; ... &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote class="pullquote"><p>üí° As the suites of tests grow you can move them into own spec file, and even split into a group of specs kept in a subfolder, see <a href="/blog/split-spec/" title="Make Cypress Run Faster by Splitting Specs">Make Cypress Run Faster by Splitting Specs</a>.</p>
</blockquote>

<p>The test its the delete endpoint</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;handles non-existent ID&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;new todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>).<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;DELETE&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123; <span class="attr">id</span>: <span class="string">&#x27;does-not-exist&#x27;</span> &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;/todos&#x27;</span>).<span class="title function_">its</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>It passes</p>
<p><img src="/blog/images/backend-coverage/delete-edge-case.png" alt="The delete non-existent ID test passes"></p>
<p>When working on the edge cases, I like running the test by itself and then checking the coverage report saved locally after the test. I see the above test precisely hits the lines we wanted to hit.</p>
<p><img src="/blog/images/backend-coverage/delete-covered.png" alt="The test reaches the line we wanted to cover"></p>
<p>You can find this and other edge case tests in the pull request <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todomvc-express-api-test-coverage/pull/5">#5</a>. Covering the edge cases pushes the total code coverage to 99.5%</p>
<p><img src="/blog/images/backend-coverage/edge-cases-pr.png" alt="Edge cases pull request code coverage comment"></p>
<h2><span id="the-last-step-to-reach-100">The last step to reach 100</span></h2><p>If we look at the report and drill into the missing coverage, we see that our tests missed just a single source line</p>
<p><img src="/blog/images/backend-coverage/one-line.png" alt="Single missing line"></p>
<p>This line is <em>not needed</em>, the &quot;clear completed&quot; button works even without a JavaScript handler, since it is part of the form. In fact, this code line is a leftover and should not remain in our server-rendered app. We can confirm this by removing the source line and adding a test that clicks on the &quot;Clear completed&quot; button. Because our target is the &quot;render&quot; UI code, we want to test this code by visiting the page and interacting with the UI elements, rather than by simply hitting the API endpoints</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">it</span>(<span class="string">&#x27;clears completed todos by clicking the button&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;first todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">request</span>(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">what</span>: <span class="string">&#x27;second todo&#x27;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  cy.<span class="title function_">visit</span>(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">  cy.<span class="title function_">get</span>(<span class="string">&#x27;.todo-list li&#x27;</span>)</span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">    .<span class="title function_">first</span>()</span><br><span class="line">    .<span class="title function_">find</span>(<span class="string">&#x27;button[name=done]&#x27;</span>)</span><br><span class="line">    .<span class="title function_">click</span>()</span><br><span class="line">  <span class="comment">// after the page reloads 1 item should have class completed</span></span><br><span class="line">  cy.<span class="title function_">get</span>(<span class="string">&#x27;.todo-list li.completed&#x27;</span>).<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">  cy.<span class="title function_">contains</span>(<span class="string">&#x27;button&#x27;</span>, <span class="string">&#x27;Clear completed&#x27;</span>).<span class="title function_">click</span>()</span><br><span class="line">  cy.<span class="title function_">get</span>(<span class="string">&#x27;.todo-list li&#x27;</span>)</span><br><span class="line">    .<span class="title function_">should</span>(<span class="string">&#x27;have.length&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">and</span>(<span class="string">&#x27;not.have.class&#x27;</span>, <span class="string">&#x27;completed&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>The test passes</p>
<p><img src="/blog/images/backend-coverage/clear-completed.gif" alt="Clear completed test passes"></p>
<p>The pull request <a target="_blank" rel="noopener" href="https://github.com/bahmutov/todomvc-express-api-test-coverage/pull/6">#6</a> shows the result</p>
<p><img src="/blog/images/backend-coverage/100-comment.png" alt="We have reached 100% code coverage for our backend code"></p>
<p>100%</p>
<h2><span id="see-also">See also</span></h2><ul>
<li><a href="/blog/code-coverage-for-e2e-tests/" title="Code Coverage for End-to-end Tests">Code Coverage for End-to-end Tests</a></li>
<li>Cypress <a target="_blank" rel="noopener" href="https://github.com/cypress-io/code-coverage">code coverage plugin</a></li>
<li>the first Cypress <a target="_blank" rel="noopener" href="https://youtu.be/C8g5X4vCZJA">code coverage webinar</a></li>
<li>Cypress <a target="_blank" rel="noopener" href="https://on.cypress.io/code-coverage">code coverage guide</a></li>
<li>you can show code coverage badges and compare the code coverage to the main branch using scripts from my <a target="_blank" rel="noopener" href="https://github.com/bahmutov/check-code-coverage">bahmutov&#x2F;check-code-coverage</a> package</li>
</ul>

      
    </div>

    
      <footer class="article-footer personal-links">
  <p>
    Follow Gleb Bahmutov <a target="_blank" rel="noopener" href="https://twitter.com/bahmutov">@bahmutov</a>,
    see his projects at <a href="https://glebbahmutov.com">glebbahmutov.com</a>,
    watch his Cypress <a target="_blank" rel="noopener" href="https://www.youtube.com/c/glebbahmutov/videos">videos</a>,
    browse his <a target="_blank" rel="noopener" href="https://slides.com/bahmutov">presentations</a>
  </p>
  <p>
    Want to know more about Cypress? Check out <a href="https://cypress.tips" target="_blank">cypress.tips</a>
  </p>
  <p>
    Have a Cypress question? Want me to answer it? Consider supporting me via <a target="_blank" rel="noopener" href="https://github.com/sponsors/bahmutov">GitHub Sponsors</a> or by purchasing my <a target="_blank" rel="noopener" href="https://cypress.tips/courses">Cypress courses</a>.
  </p>
</footer>
<script src="https://rawgit.com/toddmotto/linkjuice/702066a37124081e7ad1a972844a9a91115be05a/dist/linkjuice.js"></script>
<script>
function contentFn (node, icon) {
  const s = '<a href="#' + node.id + '" class="linkjuice">' +
    node.innerHTML + ' ' + icon + '</a>\n'
  return s
}
linkjuice.init('.article-entry', {
  selectors: ['h2 span'],
  icon: '<span class="link-symbol">#</span>',
  contentFn: contentFn
});
</script>

    

    <footer class="article-footer">
      <a data-url="https://glebbahmutov.com/blog/backend-coverage/" data-id="cl50xudtd001sl6vgbo9u0o9v" class="article-share-link">Share</a>
      
        <a href="https://glebbahmutov.com/blog/backend-coverage/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/cypress/" rel="tag">cypress</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../tags/testing/" rel="tag">testing</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../negative-assertions/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Be Careful With Negative Assertions
        
      </div>
    </a>
  
  
    <a href="../writing-custom-cypress-command/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Writing a Custom Cypress Command</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
          <aside id="sidebar">
  
    <style>
#carbonads {
  display: block;
  overflow: hidden;
  font-size: 11px;
  font-family: Verdana, "Helvetica Neue", Helvetica, sans-serif;
  line-height: 1.5;
}

#carbonads a {
  color: #258fb8;
  text-decoration: none;
}

#carbonads a:hover {
  text-decoration: underline;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

.carbon-img {
  float: left;
  margin-right: 1em;
}

.carbon-img img { display: block; }

.carbon-text {
  display: block;
  float: left;
  text-align: left;
  margin-top: 0.5em;
}
@media screen and (min-width: 1024px) {
  .carbon-text {
    max-width: calc(100% - 130px - 1em);
  }
}

.carbon-poweredby {
  /*position: absolute;
  right: 0;
  bottom: 0;*/
  float: right;
  display: block;
  font-size: 11px;
}
</style>
<div class="widget-wrap">
  <div class="widget-title">&nbsp;</div>
  <div class="widget">
    <!-- Carbon Ads -->
    <script async type="text/javascript"
      src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=glebbahmutovcom"
      id="_carbonads_js"></script>
  </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../categories/book-review/">book review</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/climate/">climate</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/people/">people</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/process/">process</a><span class="category-list-count">148</span></li><li class="category-list-item"><a class="category-list-link" href="../categories/products/">products</a><span class="category-list-count">480</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../tags/11ty/" rel="tag">11ty</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/QUnit/" rel="tag">QUnit</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/a11y/" rel="tag">a11y</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/advice/" rel="tag">advice</a><span class="tag-list-count">113</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/algolia/" rel="tag">algolia</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs/" rel="tag">angularjs</a><span class="tag-list-count">58</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/angularjs2/" rel="tag">angularjs2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/assertions/" rel="tag">assertions</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ast/" rel="tag">ast</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/boilerplate/" rel="tag">boilerplate</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/browser/" rel="tag">browser</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ci/" rel="tag">ci</a><span class="tag-list-count">30</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/circle/" rel="tag">circle</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/climate/" rel="tag">climate</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/code-coverage/" rel="tag">code coverage</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cyclejs/" rel="tag">cyclejs</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress/" rel="tag">cypress</a><span class="tag-list-count">214</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/cypress-dashboard/" rel="tag">cypress dashboard</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/d3/" rel="tag">d3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/db/" rel="tag">db</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/docker/" rel="tag">docker</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/documentation/" rel="tag">documentation</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es6/" rel="tag">es6</a><span class="tag-list-count">13</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/es7/" rel="tag">es7</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/functional/" rel="tag">functional</a><span class="tag-list-count">70</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/generators/" rel="tag">generators</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/git/" rel="tag">git</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/github/" rel="tag">github</a><span class="tag-list-count">24</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/graphql/" rel="tag">graphql</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/grunt/" rel="tag">grunt</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/gulp/" rel="tag">gulp</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hiring/" rel="tag">hiring</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/hyperapp/" rel="tag">hyperapp</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/immutable/" rel="tag">immutable</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/interview/" rel="tag">interview</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jade/" rel="tag">jade</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">166</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/jshint/" rel="tag">jshint</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/markdown/" rel="tag">markdown</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/model-based-testing/" rel="tag">model-based testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/modular-development/" rel="tag">modular development</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/netlify/" rel="tag">netlify</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">84</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/performance/" rel="tag">performance</a><span class="tag-list-count">23</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/presentation/" rel="tag">presentation</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/promises/" rel="tag">promises</a><span class="tag-list-count">31</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/proposal/" rel="tag">proposal</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ramda/" rel="tag">ramda</a><span class="tag-list-count">28</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react/" rel="tag">react</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/react-native/" rel="tag">react native</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactive/" rel="tag">reactive</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/reactjs/" rel="tag">reactjs</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/renovate/" rel="tag">renovate</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/screencast/" rel="tag">screencast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/security/" rel="tag">security</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/sentry/" rel="tag">sentry</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/service-workers/" rel="tag">service workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/state-machine/" rel="tag">state machine</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/testing/" rel="tag">testing</a><span class="tag-list-count">142</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/tutorial/" rel="tag">tutorial</a><span class="tag-list-count">19</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/typescript/" rel="tag">typescript</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/ui/" rel="tag">ui</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vercel/" rel="tag">vercel</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/visual-testing/" rel="tag">visual testing</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/vuejs/" rel="tag">vuejs</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/web-workers/" rel="tag">web workers</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="../tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="../tags/11ty/" style="font-size: 10.38px;">11ty</a> <a href="../tags/QUnit/" style="font-size: 11.54px;">QUnit</a> <a href="../tags/a11y/" style="font-size: 10.77px;">a11y</a> <a href="../tags/advice/" style="font-size: 18.85px;">advice</a> <a href="../tags/algolia/" style="font-size: 10.77px;">algolia</a> <a href="../tags/angularjs/" style="font-size: 17.69px;">angularjs</a> <a href="../tags/angularjs2/" style="font-size: 10px;">angularjs2</a> <a href="../tags/assertions/" style="font-size: 13.08px;">assertions</a> <a href="../tags/ast/" style="font-size: 12.69px;">ast</a> <a href="../tags/boilerplate/" style="font-size: 15px;">boilerplate</a> <a href="../tags/browser/" style="font-size: 15.38px;">browser</a> <a href="../tags/ci/" style="font-size: 16.92px;">ci</a> <a href="../tags/circle/" style="font-size: 13.85px;">circle</a> <a href="../tags/climate/" style="font-size: 14.62px;">climate</a> <a href="../tags/code-coverage/" style="font-size: 15px;">code coverage</a> <a href="../tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="../tags/cyclejs/" style="font-size: 12.31px;">cyclejs</a> <a href="../tags/cypress/" style="font-size: 20px;">cypress</a> <a href="../tags/cypress-dashboard/" style="font-size: 14.23px;">cypress dashboard</a> <a href="../tags/d3/" style="font-size: 10.77px;">d3</a> <a href="../tags/db/" style="font-size: 14.62px;">db</a> <a href="../tags/docker/" style="font-size: 14.23px;">docker</a> <a href="../tags/documentation/" style="font-size: 11.92px;">documentation</a> <a href="../tags/es6/" style="font-size: 14.62px;">es6</a> <a href="../tags/es7/" style="font-size: 10px;">es7</a> <a href="../tags/functional/" style="font-size: 18.08px;">functional</a> <a href="../tags/generators/" style="font-size: 11.54px;">generators</a> <a href="../tags/git/" style="font-size: 15px;">git</a> <a href="../tags/github/" style="font-size: 16.15px;">github</a> <a href="../tags/graphql/" style="font-size: 11.54px;">graphql</a> <a href="../tags/grunt/" style="font-size: 12.31px;">grunt</a> <a href="../tags/gulp/" style="font-size: 10.77px;">gulp</a> <a href="../tags/hiring/" style="font-size: 11.15px;">hiring</a> <a href="../tags/hyperapp/" style="font-size: 12.31px;">hyperapp</a> <a href="../tags/immutable/" style="font-size: 11.54px;">immutable</a> <a href="../tags/interview/" style="font-size: 10.77px;">interview</a> <a href="../tags/jade/" style="font-size: 11.15px;">jade</a> <a href="../tags/javascript/" style="font-size: 19.62px;">javascript</a> <a href="../tags/jshint/" style="font-size: 10.77px;">jshint</a> <a href="../tags/markdown/" style="font-size: 13.85px;">markdown</a> <a href="../tags/model-based-testing/" style="font-size: 10px;">model-based testing</a> <a href="../tags/modular-development/" style="font-size: 16.54px;">modular development</a> <a href="../tags/netlify/" style="font-size: 11.15px;">netlify</a> <a href="../tags/nodejs/" style="font-size: 18.46px;">nodejs</a> <a href="../tags/performance/" style="font-size: 15.77px;">performance</a> <a href="../tags/presentation/" style="font-size: 12.31px;">presentation</a> <a href="../tags/promises/" style="font-size: 17.31px;">promises</a> <a href="../tags/proposal/" style="font-size: 10.38px;">proposal</a> <a href="../tags/ramda/" style="font-size: 16.54px;">ramda</a> <a href="../tags/react/" style="font-size: 12.31px;">react</a> <a href="../tags/react-native/" style="font-size: 11.15px;">react native</a> <a href="../tags/reactive/" style="font-size: 14.23px;">reactive</a> <a href="../tags/reactjs/" style="font-size: 11.15px;">reactjs</a> <a href="../tags/renovate/" style="font-size: 11.54px;">renovate</a> <a href="../tags/screencast/" style="font-size: 10px;">screencast</a> <a href="../tags/security/" style="font-size: 13.08px;">security</a> <a href="../tags/sentry/" style="font-size: 13.85px;">sentry</a> <a href="../tags/service-workers/" style="font-size: 11.92px;">service workers</a> <a href="../tags/state-machine/" style="font-size: 10px;">state machine</a> <a href="../tags/testing/" style="font-size: 19.23px;">testing</a> <a href="../tags/tutorial/" style="font-size: 15.38px;">tutorial</a> <a href="../tags/typescript/" style="font-size: 12.31px;">typescript</a> <a href="../tags/ui/" style="font-size: 10.38px;">ui</a> <a href="../tags/vercel/" style="font-size: 13.46px;">vercel</a> <a href="../tags/visual-testing/" style="font-size: 11.15px;">visual testing</a> <a href="../tags/vuejs/" style="font-size: 11.54px;">vuejs</a> <a href="../tags/web-workers/" style="font-size: 11.92px;">web workers</a> <a href="../tags/webpack/" style="font-size: 10.77px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/06/">June 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/05/">May 2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/04/">April 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/03/">March 2022</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/02/">February 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2022/01/">January 2022</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/12/">December 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/11/">November 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/10/">October 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/09/">September 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/08/">August 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/07/">July 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/06/">June 2021</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/05/">May 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/04/">April 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/03/">March 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2021/01/">January 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/12/">December 2020</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/11/">November 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/02/">February 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2020/01/">January 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/08/">August 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/07/">July 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/06/">June 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/04/">April 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2019/01/">January 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/12/">December 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/10/">October 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/08/">August 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/06/">June 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/04/">April 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/03/">March 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/09/">September 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/08/">August 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/06/">June 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/05/">May 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/04/">April 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/03/">March 2017</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2017/01/">January 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/12/">December 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/11/">November 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/08/">August 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/06/">June 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/05/">May 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/04/">April 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/03/">March 2016</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/02/">February 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2016/01/">January 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/12/">December 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/11/">November 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/10/">October 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/09/">September 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/08/">August 2015</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/07/">July 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/06/">June 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/05/">May 2015</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/04/">April 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/03/">March 2015</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/02/">February 2015</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2015/01/">January 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/12/">December 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/11/">November 2014</a><span class="archive-list-count">19</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/10/">October 2014</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/09/">September 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/08/">August 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/07/">July 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/06/">June 2014</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/05/">May 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/04/">April 2014</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/03/">March 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/02/">February 2014</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2014/01/">January 2014</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/12/">December 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/11/">November 2013</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/10/">October 2013</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="../archives/2013/09/">September 2013</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../sinon-edge/">Sinon Edge Cases</a>
          </li>
        
          <li>
            <a href="../cypress-v10-env/">Cypress v10 Environment Variables</a>
          </li>
        
          <li>
            <a href="../cypress-v10-tips/">Cypress v10 Tips and Tricks</a>
          </li>
        
          <li>
            <a href="../test-app/">Test App From Another Repo</a>
          </li>
        
          <li>
            <a href="../run-all-specs-cypress-v10/">Run All Specs in Cypress v10</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Gleb Bahmutov<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
</nav>
    
<script>
  var disqus_shortname = 'betterworldbybettersoftware';
  
  var disqus_url = 'https://glebbahmutov.com/blog/backend-coverage/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="../fancybox/jquery.fancybox.css">

  
<script src="../fancybox/jquery.fancybox.pack.js"></script>




<script src="../js/script.js"></script>


  </div>
  <script src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
<script>
(function centerMainOnAsideScroll () {
  // when aside side bar scrolls outside the view
  // it centers the main content.
  const main = document.querySelector('#main')
  const aside = document.querySelector('aside#sidebar')
  console.assert(main, 'could not get #main')
  console.assert(aside, 'could not get aside')
  // initially the aside sidebar is visible
  let asideVisible = true

  function centerMain () {
    console.log('adding class center-main')
    main.classList.add('center-main')
  }
  function leftMain () {
    main.classList.remove('center-main')
  }

  function callWhenAsideScrollsUp (becameInvisible, becameVisible) {
    return function () {
      const border = 50
      const rect = aside.getBoundingClientRect()
      if (asideVisible && rect.bottom < -border) {
        asideVisible = false
        becameInvisible()
      }

      if (!asideVisible && window.scrollY < border) {
        asideVisible = true
        becameVisible()
      }
    }
  }
  const throttleWaitMs = 250
  const onScroll = _.throttle(
    callWhenAsideScrollsUp(centerMain, leftMain),
    throttleWaitMs
  )
  window.addEventListener('scroll', onScroll)
}())
</script>

</body>
</html>
